<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-码农/Java面试指北/技术面试题篇/系统设计&场景题/如何设计一个排行榜？" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">如何设计一个排行榜？ | Coisini</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://doc.minddiy.top/码农/Java面试指北/技术面试题篇/系统设计&amp;场景题/如何设计一个排行榜？/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="如何设计一个排行榜？ | Coisini"><meta data-rh="true" name="description" content="排行榜到处可见，比如直播间送礼物的排行榜、朋友圈的微信步数排行榜、王者荣耀中的段位排行榜等等。"><meta data-rh="true" property="og:description" content="排行榜到处可见，比如直播间送礼物的排行榜、朋友圈的微信步数排行榜、王者荣耀中的段位排行榜等等。"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://doc.minddiy.top/码农/Java面试指北/技术面试题篇/系统设计&amp;场景题/如何设计一个排行榜？/"><link data-rh="true" rel="alternate" href="https://doc.minddiy.top/码农/Java面试指北/技术面试题篇/系统设计&amp;场景题/如何设计一个排行榜？/" hreflang="en"><link data-rh="true" rel="alternate" href="https://doc.minddiy.top/码农/Java面试指北/技术面试题篇/系统设计&amp;场景题/如何设计一个排行榜？/" hreflang="x-default"><meta name="google-site-verification" content="1FUPX6Qo4y3ecU623ShEurhgnjhSTjK49rRMhEDlzFA">
<link rel="stylesheet" href="/katex/katex.min.css">
<script src="/js/matomo.js" async defer="defer"></script><link rel="stylesheet" href="/assets/css/styles.79037026.css">
<script src="/assets/js/runtime~main.468f2b27.js" defer="defer"></script>
<script src="/assets/js/main.4763ab3e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Coisini</b></a></div><div class="navbar__items navbar__items--right"><a href="https://minddiy.top" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Main site<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>如何设计一个排行榜？</h1></header>
<p>排行榜到处可见，比如直播间送礼物的排行榜、朋友圈的微信步数排行榜、王者荣耀中的段位排行榜等等。</p>
<p><img decoding="async" loading="lazy" alt="2021060714195385.png" src="/assets/images/1659798897967-7ebd0b21-da39-47af-9445-fcd75b0881a1-579893-f94b92cc4a1b54f8cfd793477aa402b5.png" width="483" height="620" class="img_ev3q"></p>
<p>今天让我们从程序设计的角度，来看看如何设计一个排行榜！</p>
<p>我们先从最基础的实现方式来说起。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mysql-的-order-by-关键字">MySQL 的 ORDER BY 关键字<a href="#mysql-的-order-by-关键字" class="hash-link" aria-label="Direct link to MySQL 的 ORDER BY 关键字" title="Direct link to MySQL 的 ORDER BY 关键字">​</a></h2>
<p>第一种要介绍的实现方式就是直接使用 MySQL 的 <code>ORDER BY</code> 关键字。 <code>ORDER BY</code> 关键字可以对查询出来的数据按照指定的字段进行排序。</p>
<p>我相信但凡是学过 MySQL 的人，一定都用过 <code>ORDER BY</code> 关键字！没用过的，先不要看下面的文章了，麻烦默默反思 3 分钟。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">SELECT</span><span class="token plain"> column1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> column2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">FROM</span><span class="token plain"> table_name</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">BY</span><span class="token plain"> column1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> column2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ASC</span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token keyword" style="color:hsl(301, 63%, 40%)">DESC</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我之前在一个用户数据量不大（6w 用户左右）并且排序需求并不复杂的项目中使用的就是这种方法。</p>
<p>这种方式的优缺点也比较明显。<strong>好处是比较简单，不需要引入额外的组件，成本比较低。坏处就是每次生成排行榜都比较耗时，对数据库的性能消耗非常之大，数据量一大，业务场景稍微复杂一点就顶不住了。</strong></p>
<p>我们这里创建一个名为 <code>cus_order</code> 的表，来实际测试一下这种排序方式。为了测试方便， <code>cus_order</code> 这张表只有 <code>id</code>、<code>score</code>、<code>name</code>这 3 个字段。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token identifier">cus_order</span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">int</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">11</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">unsigned</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">AUTO_INCREMENT</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token identifier">score</span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">int</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">11</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token identifier">name</span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">varchar</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">11</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ENGINE</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token keyword" style="color:hsl(301, 63%, 40%)">InnoDB</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">AUTO_INCREMENT</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">100000</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">CHARSET</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">utf8mb4</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们定义一个简单的存储过程（PROCEDURE）来插入 100w 测试数据。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">DELIMITER</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">DEFINER</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token identifier">root</span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token variable" style="color:hsl(221, 87%, 60%)">@`%`</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">PROCEDURE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token identifier">BatchinsertDataToCusOder</span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token operator" style="color:hsl(221, 87%, 60%)">IN</span><span class="token plain"> start_num </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">INT</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token operator" style="color:hsl(221, 87%, 60%)">IN</span><span class="token plain"> max_num </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">INT</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">DECLARE</span><span class="token plain"> i </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">INT</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">default</span><span class="token plain"> start_num</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">WHILE</span><span class="token plain"> i </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain"> max_num </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">DO</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">insert</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">into</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token identifier">cus_order</span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token identifier">id</span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token identifier">score</span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token identifier">name</span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">values</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain">RAND</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1000000</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain">CONCAT</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;user&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">SET</span><span class="token plain"> i </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> i </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">END</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">WHILE</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">END</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">DELIMITER</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>存储过程定义完成之后，我们执行存储过程即可！</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">CALL</span><span class="token plain"> BatchinsertDataToCusOder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1000000</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 插入100w+的随机数据</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>等待一会，100w 的测试数据就插入完成了！</p>
<p>为了能够对这 100w 数据按照 <code>score</code> 进行排序，我们需要执行下面的 SQL 语句。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">SELECT</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token identifier">score</span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token identifier">name</span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">FROM</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token identifier">cus_order</span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">BY</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token identifier">score</span><span class="token identifier punctuation" style="color:hsl(119, 34%, 47%)">`</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">DESC</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token comment" style="color:hsl(230, 4%, 64%)">#降序排序</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>为了能够查看这套 SQL 语句的执行时间，我们需要通过<code>show profiles</code>命令。</p>
<p>不过，请确保你的 <code>profiling</code> 是开启（on）的状态（可以通过 <code>show variables</code> 命令查看）。</p>
<p>默认情况下， <code>profiling</code> 是关闭（off）的状态，你直接通过<code>set @@profiling=1</code>命令即可开启。</p>
<p>然后，我们就查询到了具体的执行速度。</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">&quot;Query_ID&quot;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">6</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">&quot;Duration&quot;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3.63526325</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">&quot;Query&quot;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;SELECT `score`,`name` FROM `cus_order` ORDER BY `score` DESC&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以看到，一共耗时了接近 4 s。</p>
<p><strong>如何优化呢？</strong> <strong>加索引并且限制排序数据量</strong> 是一种比较常见的优化方式。</p>
<p>我们对 <code>score</code> 字段加索引，并限制只排序 <code>score</code> 排名前 500 的数据。</p>
<p>这个时候，我们再执行下面的 SQL 语句，速度就快了很多，只需要 0.01 秒就排序了前 500 名的数据。</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">&quot;Query_ID&quot;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">38</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">&quot;Duration&quot;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.0102915</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">&quot;Query&quot;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;SELECT `score`,`name` FROM `cus_order` ORDER BY `score` DESC LIMIT 500&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当然了，这只是一个最简单的场景，实际项目中的复杂度要比我这里列举的例子复杂很多，执行速度也会慢很多。</p>
<p>不过，<strong>能不能用 MySQL 的 ORDER BY 关键字还是要看具体的业务场景。如果说你的项目需要排序数据量比较小并且业务场景不复杂的话（比如你对你博客的所有文章按照阅读量来排序），我觉得直接使用 MySQL 的 <strong><code>**ORDER BY**</code></strong> 关键字就可以了。</strong></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="redis-的-sorted-set">Redis 的 Sorted Set<a href="#redis-的-sorted-set" class="hash-link" aria-label="Direct link to Redis 的 Sorted Set" title="Direct link to Redis 的 Sorted Set">​</a></h2>
<p><img decoding="async" loading="lazy" alt="up-d90863bb4c39ef96f9893244b9d5f1376ac.png" src="/assets/images/1677744806029-54caee45-e42a-4b86-ab2b-1178cde61c1e-762201-3347c17be07c16749529a6c23a949928.png" width="956" height="652" class="img_ev3q"></p>
<p>了解过 Redis 常见数据结构的小伙伴，都知道 Redis 中有一个叫做 Sorted Set 的数据结构经常被用在各种排行榜的场景下。</p>
<p>通过 Sorted Set，我们能够轻松应对百万级别的用户数据排序。这简直就是专门为排行榜设计的数据结构啊！</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sorted-set-介绍">Sorted Set 介绍<a href="#sorted-set-介绍" class="hash-link" aria-label="Direct link to Sorted Set 介绍" title="Direct link to Sorted Set 介绍">​</a></h3>
<p>Sorted Set 类似于 Set，但和 Set 相比，Sorted Set 增加了一个权重参数 <code>score</code>，使得集合中的元素能够按 <code>score</code> 进行有序排列，还可以通过 <code>score</code> 的范围来获取元素的列表。有点像是 Java 中 <code>HashMap</code> 和 <code>TreeSet</code> 的结合体。</p>
<p><img decoding="async" loading="lazy" alt="image-20220719124437791.png" src="/assets/images/1659944363991-9e0b5a17-56b2-46df-92f8-bac4eeaaa186-322587-40720f4fb7ae31725adcb0396f12714b.png" width="450" height="309" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sorted-set-常用命令">Sorted Set 常用命令<a href="#sorted-set-常用命令" class="hash-link" aria-label="Direct link to Sorted Set 常用命令" title="Direct link to Sorted Set 常用命令">​</a></h3>













































<table><thead><tr><th>命令</th><th>介绍</th></tr></thead><tbody><tr><td>ZADD key score1 member1 score2 member2 ...</td><td>向指定有序集合添加一个或多个元素</td></tr><tr><td>ZCARD KEY</td><td>获取指定有序集合的元素数量</td></tr><tr><td>ZSCORE key member</td><td>获取指定有序集合中指定元素的 score 值</td></tr><tr><td>ZINTERSTORE destination numkeys key1 key2 ...</td><td>将给定所有有序集合的交集存储在 destination 中，对相同元素对应的 score 值进行 SUM 聚合操作，numkeys 为集合数量</td></tr><tr><td>ZUNIONSTORE destination numkeys key1 key2 ...</td><td>求并集，其它和 ZINTERSTORE 类似</td></tr><tr><td>ZDIFF destination numkeys key1 key2 ...</td><td>求差集，其它和 ZINTERSTORE 类似</td></tr><tr><td>ZRANGE key start end</td><td>获取指定有序集合 start 和 end 之间的元素（score 从低到高）</td></tr><tr><td>ZREVRANGE key start end</td><td>获取指定有序集合 start 和 end 之间的元素（score 从高到底）</td></tr><tr><td>ZREVRANK key member</td><td>获取指定有序集合中指定元素的排名(score 从大到小排序)</td></tr></tbody></table>
<p>更多 Redis Sorted Set 命令以及详细使用指南，请查看 Redis 官网对应的介绍：<a href="https://redis.io/commands/?group=sorted-set" target="_blank" rel="noopener noreferrer">https://redis.io/commands/?group=sorted-set</a> 。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sorted-set-排序实战">Sorted Set 排序实战<a href="#sorted-set-排序实战" class="hash-link" aria-label="Direct link to Sorted Set 排序实战" title="Direct link to Sorted Set 排序实战">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="基本排序操作">基本排序操作<a href="#基本排序操作" class="hash-link" aria-label="Direct link to 基本排序操作" title="Direct link to 基本排序操作">​</a></h4>
<p>我们把下表中的数据添加到 Sorted Set 中。</p>

































<table><thead><tr><th>User</th><th>Score</th></tr></thead><tbody><tr><td>user1</td><td>112.0</td></tr><tr><td>user2</td><td>100.0</td></tr><tr><td>user3</td><td>123.0</td></tr><tr><td>user4</td><td>100.0</td></tr><tr><td>user5</td><td>33.0</td></tr><tr><td>user6</td><td>993.0</td></tr></tbody></table>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"># 通过 zadd 命令添加了 6 个元素到 cus_order_set 中</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">127.0.0.1:6379&gt; ZADD cus_order_set 112.0 user1 100.0 user2 123.0 user3 100.0 user4 33.0 user5 993.0 user6</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">(integer) 6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="up-c25cf4cc1d4d3a484b4db93672138b8c104.png" src="/assets/images/1677744805795-83d878b9-f466-436d-a889-fa633becf0bc-299315-7f90cc8520934d231264d8cadaebd6ed.png" width="801" height="373" class="img_ev3q"></p>
<p>Sorted Set 基本可以满足大部分排行榜的场景，下面我们来具体看看。</p>
<p><strong>如果我们要查看包含所有用户的排行榜怎么办？</strong></p>
<p>通过 <code>ZRANGE</code> (从小到大排序) / <code>ZREVRANGE</code> （从大到小排序）</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"># -1 代表的是全部的用户数据，</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">127.0.0.1:6379&gt; ZREVRANGE cus_order_set 0 -1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">1) &quot;user6&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">2) &quot;user3&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">3) &quot;user1&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">4) &quot;user4&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">5) &quot;user2&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">6) &quot;user5&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>如果我们要查看只包含前 3 名的排行榜怎么办？</strong></p>
<p>限定参与排序的元素范围区间即可。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"># 0 为 start  2 为 stop</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">127.0.0.1:6379&gt; ZREVRANGE cus_order_set 0 2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">1) &quot;user6&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">2) &quot;user3&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">3) &quot;user1&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>如果我们需要查询某个用户的分数怎么办呢？</strong></p>
<p>通过 <code>ZSCORE</code> 命令即可。 <code>ZSCORE</code> 可以获取指定有序集合中指定元素的 <code>score</code> 值。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">127.0.0.1:6379&gt; ZSCORE  cus_order_set &quot;user1&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">&quot;112&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>如果我们需要查询某个用户的具体排名怎么办呢？</strong></p>
<p>通过 <code>ZREVRANK</code> 命令即可。 <code>ZREVRANK</code> 可以获取指定有序集合中指定元素的排名(<code>score</code> 从大到小排序)</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">127.0.0.1:6379&gt; ZREVRANK  cus_order_set &quot;user3&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">(integer) 1 # user3 排名第2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>如何对用户的排名数据进行更新呢？</strong></p>
<p>通过 <code>ZINCRBY</code>命令即可。 <code>ZINCRBY</code>可以对指定有序集合中指定元素的 <code>score</code> 值加上一个具体的数值（可以是整数值或双精度浮点数），这个数值如果是负数的话，就相当于实现一个减操作。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"># 对 user1 的分数加2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">127.0.0.1:6379&gt; ZINCRBY cus_order_set +2 &quot;user1&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">&quot;114&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"># 对 user1 的分数减1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">127.0.0.1:6379&gt; ZINCRBY cus_order_set -1 &quot;user1&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">&quot;113&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"># 查看 user1 的分数</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">127.0.0.1:6379&gt; ZSCORE  cus_order_set &quot;user1&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">&quot;113&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>除了我上面提到的之外，还有一些其他的命令来帮助你解决更多排行榜场景的需求，想要深入研究的小伙伴可以仔细学习哦！</p>
<p>不过，需要注意的一点是：<strong>Redis 中只保存了排行榜展示所需的数据，需要用户的具体信息数据的话，还是需要去对应的数据库（比如 MySQL）中查。</strong></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="复杂排序操作">复杂排序操作<a href="#复杂排序操作" class="hash-link" aria-label="Direct link to 复杂排序操作" title="Direct link to 复杂排序操作">​</a></h4>
<p><strong>你以为这样就完事了？</strong></p>
<p>不存在的！还有一些无法仅仅通过 Redis 提供的命令解决的场景。</p>
<p>比如，<strong>如何实现多条件排序？</strong></p>
<p>其实，答案也比较简单，对于大部分场景，我们直接对 <code>score</code> 值做文章即可。</p>
<p>更具体点的话就是，我们根据特定的条件来拼接 <code>score</code> 值即可。比如我们还要加上时间先后条件的话，直接在<code>score</code> 值添加上时间戳即可。</p>
<p>再比如，<strong>如何实现指定日期（比如最近 7 天）的用户数据排序？</strong></p>
<p>我说一种比较简单的方法：我们把每一天的数据都按照日期为名字，比如 20350305 就代表 2035 年 3 月 5 号。</p>
<p>如果我们需要查询最近 n 天的排行榜数据的话，直接 <code>ZUNIONSTORE</code>来求 n 个 <code>sorted set</code> 的并集即可。</p>
<blockquote>
<p><code>ZUNIONSTORE destination numkeys key1 key2 ...</code>：求并集，将给定所有有序集合的并集存储在 <code>destination</code> 中，对相同元素对应的 <code>score</code> 值进行 <code>SUM</code> 聚合操作(可以通过<code>AGGREGATE</code> 参数指定聚合函数，默认为 <code>SUM</code>)，<code>numkeys</code> 为集合数量。</p>
</blockquote>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ZUNIONSTORE last_n_days n 20350305 20350306....</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>不知道大家看懂了没有，这里还是简单地造一些数据模拟一下吧！</p>
<p><strong>Zset 20350305</strong> :</p>





















<table><thead><tr><th>User</th><th>Score</th></tr></thead><tbody><tr><td>user1</td><td>112.0</td></tr><tr><td>user2</td><td>100.0</td></tr><tr><td>user3</td><td>123.0</td></tr></tbody></table>
<p><strong>Zset 20350306</strong> :</p>

















<table><thead><tr><th>User</th><th>Score</th></tr></thead><tbody><tr><td>user1</td><td>80.0</td></tr><tr><td>user4</td><td>100.0</td></tr></tbody></table>
<p><strong>Zset 20350307</strong> :</p>

















<table><thead><tr><th>User</th><th>Score</th></tr></thead><tbody><tr><td>user4</td><td>33.0</td></tr><tr><td>user5</td><td>993.0</td></tr></tbody></table>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"># 分别添加了 3 天的数据</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">127.0.0.1:6379&gt; ZADD 20350305 112.0 user1 100.0 user2 123.0 user3</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">(integer) 3</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">127.0.0.1:6379&gt; ZADD 20350306 80.0 user1 100.0 user4</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">(integer) 2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">127.0.0.1:6379&gt; ZADD 20350307 33.0 user4 993.0 user5</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">(integer) 2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>通过 <code>ZUNIONSTORE</code> 命令来查看最近 3 天的排行榜情况：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">127.0.0.1:6379&gt; ZUNIONSTORE last_3_days 3 20350305 20350306 20350307</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">(integer) 5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>现在，这 3 天的数据都集中在了 <code>last_3_days</code> 这个有序集合中。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">127.0.0.1:6379&gt; ZRANGE last_3_days 0 -1 WITHSCORES</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 1) &quot;user2&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 2) &quot;100&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 3) &quot;user3&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 4) &quot;123&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 5) &quot;user4&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 6) &quot;133&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 7) &quot;user1&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 8) &quot;192&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 9) &quot;user5&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">10) &quot;993&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="f96df332f62069398a006c631684edab.png" src="/assets/images/1677744805756-5e3e579b-3fd6-48cc-8fbe-108fc4c61b78-510738-56bf8712e746685e1f610c81757a0344.png" width="1450" height="1034" class="img_ev3q"></p>
<p>如果一个用户同时在多个 <code>sorted set</code> 中的话，它最终的 <code>score</code> 值就等于这些 <code>sorted set</code> 中该用户的 <code>score</code> 值之和。</p>
<p>如果说你不想对 <code>score</code> 值求和也没关系，我们通过 <code>AGGREGATE</code> 参数指定聚合函数：</p>
<ul>
<li><code>SUM</code>：对于不同集合的相同元素使用和作为结果集中对应元素的<code>score</code>。默认使用 <code>SUM</code>，如果不指定的话。</li>
<li><code>MIN</code>：对于不同集合的相同元素使用某个元素最小的<code>score</code> 值作为结果集中对应元素的<code>score</code>。</li>
<li><code>MAX</code>：对于不同集合的相同元素使用某个元素最大的<code>score</code> 值作为结果集中对应元素的<code>score</code>。</li>
</ul>
<p>指定聚合函数为 <code>MAX</code> 的情况：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">127.0.0.1:6379&gt;  ZUNIONSTORE last_3_days 3 20350305 20350306 20350307 AGGREGATE MAX</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">(integer) 5</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">127.0.0.1:6379&gt; ZRANGE last_3_days 0 -1 WITHSCORES</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 1) &quot;user2&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 2) &quot;100&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 3) &quot;user4&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 4) &quot;100&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 5) &quot;user1&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 6) &quot;112&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 7) &quot;user3&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 8) &quot;123&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 9) &quot;user5&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">10) &quot;993&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>指定聚合函数为 <code>MIN</code> 的情况：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">127.0.0.1:6379&gt; ZRANGE last_3_days 0 -1 WITHSCORES</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 1) &quot;user4&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 2) &quot;33&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 3) &quot;user1&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 4) &quot;80&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 5) &quot;user2&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 6) &quot;100&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 7) &quot;user3&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 8) &quot;123&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 9) &quot;user5&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">10) &quot;993&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>既然可以求并集，那必然也可以求交集。你可以通过 <code>ZINTERSTORE</code> 命令来求多个 n 个 <code>sorted set</code> 的交集。</p>
<blockquote>
<p><code>ZINTERSTORE destination numkeys key1 key2 ...</code> :将给定所有有序集合的交集存储在 destination 中，对相同元素对应的 score 值进行 SUM 聚合操作，numkeys 为集合数量。</p>
</blockquote>
<p><strong>有哪些场景可以用到多个</strong><code>**sorted set**</code>** 的交集呢？**</p>
<p>比如每日打卡的场景，你对某一段时间每天打卡的人  进行排序。</p>
<p><code>ZUNIONSTORE</code> 和 <code>ZINTERSTORE</code>命令还有一个常用的权重参数 <code>weights</code> （默认为 1）。在进行并集/交集的过程中，每个集合中的元素会将自己的 <code>score</code> *<code>weights</code> 。</p>
<p>我下面演示一下这个参数的作用。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"># staff_set 存放员工的排名信息</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">127.0.0.1:6379&gt; ZADD staff_set 3.0 staff1 4.0 staff2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">(integer) 2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"># staff_set 存放管理者的排名信息</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">127.0.0.1:6379&gt; ZADD manager_set 1.0 manager1 2.0 manager2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">(integer) 2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果，我们需要将员工和管理者放在一起比较，不过，两者权重分别为 1 和 3。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"># staff_set 的权重为1 manager_set的权重为3</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">127.0.0.1:6379&gt; ZUNIONSTORE all_user_set 2 staff_set manager_set WEIGHTS 1 3</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">(integer) 4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>最终排序的结果如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">127.0.0.1:6379&gt; ZREVRANGE all_user_set 0 -1 WITHSCORES</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">1) &quot;manager2&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">2) &quot;6&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">3) &quot;staff2&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">4) &quot;4&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">5) &quot;staff1&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">6) &quot;3&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">7) &quot;manager1&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">8) &quot;3&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>上面我一共提到了两种设计排行榜的方法：</p>
<ol>
<li>MySQL 的 ORDER BY 关键字</li>
<li>Redis 的 sorted set</li>
</ol>
<p>其实，这两种没有孰好孰坏，还是要看具体的业务场景。如果说你的项目需要排序数据量比较小并且业务场景不复杂的话（比如你对你博客的所有文章按照阅读量来排序），我觉得直接使用 MySQL 的 <code>ORDER BY</code> 关键字就可以了，没必要为了排行榜引入一个 Redis。</p>
<p>另外，<strong>在没有分页并且数据量不大的情况下，直接在前端拿到所有需要用到的数据之后再进行排序也是可以的。</strong></p>
<p>相关阅读：</p>
<ul>
<li><a href="https://time.geekbang.org/column/article/134595" target="_blank" rel="noopener noreferrer">43 丨如何使用 Redis 搭建玩家排行榜？</a> —《SQL 必知必会》</li>
<li><a href="https://time.geekbang.org/column/article/5933" target="_blank" rel="noopener noreferrer">构建一个科学的排行榜体系</a> —《推荐系统三十六式》</li>
<li><a href="https://mp.weixin.qq.com/s/2p84utXldMaeR4wU5guK1Q" target="_blank" rel="noopener noreferrer">如何设计一个排行榜？</a>—why 技术</li>
<li><a href="https://mp.weixin.qq.com/s/jWozyJ9vk9vM6u5_1WLGdw" target="_blank" rel="noopener noreferrer">亿级用户游戏排行榜设计方案</a> —老周聊架构</li>
</ul>
<blockquote>
<p>更新: 2023-10-14 22:30:49<br>
原文: <a href="https://www.yuque.com/snailclimb/mf2z3k/hbsnl8" target="_blank" rel="noopener noreferrer">https://www.yuque.com/snailclimb/mf2z3k/hbsnl8</a></p>
</blockquote></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mysql-的-order-by-关键字" class="table-of-contents__link toc-highlight">MySQL 的 ORDER BY 关键字</a></li><li><a href="#redis-的-sorted-set" class="table-of-contents__link toc-highlight">Redis 的 Sorted Set</a><ul><li><a href="#sorted-set-介绍" class="table-of-contents__link toc-highlight">Sorted Set 介绍</a></li><li><a href="#sorted-set-常用命令" class="table-of-contents__link toc-highlight">Sorted Set 常用命令</a></li><li><a href="#sorted-set-排序实战" class="table-of-contents__link toc-highlight">Sorted Set 排序实战</a></li></ul></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>