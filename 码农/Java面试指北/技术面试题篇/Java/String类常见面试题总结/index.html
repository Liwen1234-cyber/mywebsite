<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-码农/Java面试指北/技术面试题篇/Java/String类常见面试题总结" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">String 类常见面试题总结 | Coisini</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://doc.minddiy.top/码农/Java面试指北/技术面试题篇/Java/String类常见面试题总结/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="String 类常见面试题总结 | Coisini"><meta data-rh="true" name="description" content="这篇文章是我的一位好朋友 Hydra（公众号码农参上号主）写的原创干货，经他同意，我将其整理到了 《Java 面试指北》的 Java 部分。"><meta data-rh="true" property="og:description" content="这篇文章是我的一位好朋友 Hydra（公众号码农参上号主）写的原创干货，经他同意，我将其整理到了 《Java 面试指北》的 Java 部分。"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://doc.minddiy.top/码农/Java面试指北/技术面试题篇/Java/String类常见面试题总结/"><link data-rh="true" rel="alternate" href="https://doc.minddiy.top/码农/Java面试指北/技术面试题篇/Java/String类常见面试题总结/" hreflang="en"><link data-rh="true" rel="alternate" href="https://doc.minddiy.top/码农/Java面试指北/技术面试题篇/Java/String类常见面试题总结/" hreflang="x-default"><meta name="google-site-verification" content="1FUPX6Qo4y3ecU623ShEurhgnjhSTjK49rRMhEDlzFA">
<link rel="stylesheet" href="/katex/katex.min.css">
<script src="/js/matomo.js" async defer="defer"></script><link rel="stylesheet" href="/assets/css/styles.79037026.css">
<script src="/assets/js/runtime~main.468f2b27.js" defer="defer"></script>
<script src="/assets/js/main.4763ab3e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Coisini</b></a></div><div class="navbar__items navbar__items--right"><a href="https://minddiy.top" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Main site<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>String 类常见面试题总结</h1></header>
<blockquote>
<p>这篇文章是我的一位好朋友 Hydra（公众号码农参上号主）写的原创干货，经他同意，我将其整理到了 《Java 面试指北》的 Java 部分。</p>
<p>说明：这里主要使用的是 JDK 8 版本进行测试。</p>
</blockquote>
<p>String 字符串是我们日常工作中常用的一个类，在面试中也是高频考点，这里精心总结了一波常见但也 有点烧脑的 String 面试题，一共 5 道题，难度从简到难，来一起来看看你能做对几道吧。</p>
<p><strong>说明</strong> ：本文基于<strong>jdk8</strong>版本中的 String 进行讨论，文章例子中的代码运行结果基于<code>Java 1.8.0_261-b12</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="第-1-题奇怪的-nullnull">第 1 题，奇怪的 nullnull<a href="#第-1-题奇怪的-nullnull" class="hash-link" aria-label="Direct link to 第 1 题，奇怪的 nullnull" title="Direct link to 第 1 题，奇怪的 nullnull">​</a></h2>
<p>下面这段代码最终会打印什么？</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public class Test1 {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private static String s1;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private static String s2;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        String s= s1+s2;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        System.out.println(s);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>运行之后，你会发现打印了<code>nullnull</code>：</p>
<p>在分析这个结果之前，先扯点别的，说一下为空<code>null</code>的字符串的打印原理。查看一下<code>PrintStream</code>类的源码，<code>print</code>方法在打印<code>null</code>前进行了处理：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public void print(String s) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    if (s == null) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        s = &quot;null&quot;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    write(s);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>因此，一个为<code>null</code>的字符串就可以被打印在我们的控制台上了。</p>
<p>再回头看上面这道题，<code>s1</code>和<code>s2</code>没有经过初始化所以都是空对象<code>null</code>，需要注意这里不是字符串的<code>&quot;null&quot;</code>，打印结果的产生我们可以看一下字节码文件：</p>
<p><img decoding="async" loading="lazy" alt="1638172518378-2.png" src="/assets/images/1646203641978-0aa00c3f-97fb-42b6-9297-812b2b0b7b60-876899-e95cd3b928612f03874ee4f62ba958bb.png" width="1381" height="424" class="img_ev3q"></p>
<p>编译器会对<code>String</code>字符串相加的操作进行优化，会把这一过程转化为<code>StringBuilder</code>的<code>append</code>方法。那么，让我们再看看<code>append</code>方法的源码：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public AbstractStringBuilder append(String str) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    if (str == null)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return appendNull();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    	//...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果<code>append</code>方法的参数字符串为<code>null</code>，那么这里会调用其父类<code>AbstractStringBuilder</code>的<code>appendNull</code>方法：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">private AbstractStringBuilder appendNull() {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    int c = count;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ensureCapacityInternal(c + 4);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    final char[] value = this.value;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    value[c++] = &#x27;n&#x27;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    value[c++] = &#x27;u&#x27;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    value[c++] = &#x27;l&#x27;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    value[c++] = &#x27;l&#x27;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    count = c;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    return this;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里的<code>value</code>就是底层用来存储字符的<code>char</code>类型数组，到这里我们就可以明白了，其实<code>StringBuilder</code>也对<code>null</code>的字符串进行了特殊处理，在<code>append</code>的过程中如果碰到是<code>null</code>的字符串，那么就会以<code>&quot;null&quot;</code>的形式被添加进字符数组，这也就导致了两个为空<code>null</code>的字符串相加后会打印为<code>&quot;nullnull&quot;</code>。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=" 第-2-题改变-string-的值">第 2 题，改变 String 的值<a href="#第-2-题改变-string-的值" class="hash-link" aria-label="Direct link to 第 2 题，改变 String 的值" title="Direct link to 第 2 题，改变 String 的值">​</a></h2>
<p>如何改变一个 String 字符串的值，这道题可能看上去有点太简单了，像下面这样直接_赋值_不就可以了吗？</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">String s=&quot;Hydra&quot;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">s=&quot;Trunks&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>恭喜你，成功掉进了坑里！在回答这道题之前，我们需要知道 String 是<strong>不可变</strong>的，打开 String 的源码在开头就可以看到：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">private final char value[];</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以看到，String 的本质其实是一个<code>char</code>类型的数组，然后我们再看两个关键字。先看<code>final</code>，我们知道<code>final</code>在修饰引用数据类型时，就像这里的数组时，能够保证指向该数组地址的引用不能修改，但是数组本身内的值可以被修改。</p>
<p>是不是有点晕，没关系，我们看一个例子：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">final char[] one={&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;};</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">char[] two={&#x27;d&#x27;,&#x27;e&#x27;,&#x27;f&#x27;};</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">one=two;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果你这样写，那么编译器是会报错提示<code>Cannot assign a value to final variable &#x27;one&#x27;</code>，说明被<code>final</code>修饰的数组的引用地址是不可改变的。但是下面这段代码却能够正常的运行：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">final char[] one={&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;};</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">one[1]=&#x27;z&#x27;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>也就是说，即使被<code>final</code>修饰，但是我直接操作数组里的元素还是可以的，所以这里还加了另一个关键字<code>private</code>，防止从外部进行修改。此外，String 类本身也被添加了<code>final</code>关键字修饰，防止被继承后对属性进行修改。</p>
<p>到这里，我们就可以理解为什么 String 是不可变的了，那么在上面的代码进行_二次赋值_的过程中，发生了什么呢？答案很简单，前面的变量<code>s</code>只是一个 String 对象的引用，这里的重新赋值时将变量<code>s</code>指向了新的对象。</p>
<p><img decoding="async" loading="lazy" alt="1639101589121-5-2.png" src="/assets/images/1646203642028-c49008a9-3f35-42cd-b851-f6a2382478b3-523383-16c39e4c4d6ee9caac6b426520997913.png" width="512" height="292" class="img_ev3q"></p>
<p>上面白话了一大顿，其实是我们可以通过比较<code>hashCode</code>的方式来看一下引用指向的对象是否发生了改变，修改一下上面的代码，打印字符串的<code>hashCode</code>：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public static void main(String[] args) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    String s=&quot;Hydra&quot;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    System.out.println(s+&quot;:  &quot;+s.hashCode());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    s=&quot;Trunks&quot;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    System.out.println(s+&quot;: &quot;+s.hashCode());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>查看结果，发生了改变，证明指向的对象发生了改变：</p>
<p><img decoding="async" loading="lazy" alt="1639020597952-3.png" src="data:image/png;base64,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" width="588" height="147" class="img_ev3q"></p>
<p>那么，回到上面的问题，如果我想要改变一个 String 的值，而又不想把它重新指向其他对象的话，应该怎么办呢？答案是利用反射修改<code>char</code>数组的值：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public static void main(String[] args) throws NoSuchFieldException, IllegalAccessException {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    String s=&quot;Hydra&quot;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    System.out.println(s+&quot;:  &quot;+s.hashCode());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    Field field = String.class.getDeclaredField(&quot;value&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    field.setAccessible(true);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    field.set(s,new char[]{&#x27;T&#x27;,&#x27;r&#x27;,&#x27;u&#x27;,&#x27;n&#x27;,&#x27;k&#x27;,&#x27;s&#x27;});</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    System.out.println(s+&quot;: &quot;+s.hashCode());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>再对比一下<code>hashCode</code>，修改后和之前一样，对象没有发生任何变化：</p>
<p><img decoding="async" loading="lazy" alt="1639020600767-4.png" src="data:image/png;base64,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" width="565" height="139" class="img_ev3q"></p>
<p>最后，再啰嗦说一点题外话，这里看的是<code>jdk8</code>中 String 的源码，到这为止还是使用的<code>char</code>类型数组来存储字符，但是在<code>jdk9</code>中这个<code>char</code>数组已经被替换成了<code>byte</code>数组，能够使 String 对象占用的内存减少。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="第-3-题创建了几个对象">第 3 题，创建了几个对象？<a href="#第-3-题创建了几个对象" class="hash-link" aria-label="Direct link to 第 3 题，创建了几个对象？" title="Direct link to 第 3 题，创建了几个对象？">​</a></h2>
<p>相信不少小伙伴在面试中都遇到过这道经典面试题，下面这段代码中到底<strong>创建</strong>了几个对象？</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">String s = new String(&quot;Hydra&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>其实真正想要回答好这个问题，要铺垫的知识点还真是不少。首先，我  们需要了解 3 个关于<strong>常量池</strong>的概念，下面还是基于<code>jdk8</code>版本进行说明：</p>
<ul>
<li>class 文件常量池：在 class 文件中保存了一份常量池（<code>Constant Pool</code>），主要存储编译时确定的数据，包括代码中的<strong>字面量</strong>(<code>literal</code>)和<strong>符号引用</strong></li>
<li>运行时常量池：位于方法区中，全局共享，class 文件常量池中的内容会在类加载后存放到方法区的运行时常量池中。除此之外，在运行期间可以将新的变量放入运行时常量池中，相对 class 文件常量池而言运行时常量池更具备动态性</li>
<li>字符串常量池：位于堆中，全局共享，这里可以先粗略的认为它存储的是 String 对象的<strong>直接引用</strong>，而不是直接存放的对象，具体的实例对象是在堆中存放</li>
</ul>
<p>可以用一张图来描述它们各自所处的位置：</p>
<p><img decoding="async" loading="lazy" alt="1639462779176-6pool2.png" src="/assets/images/1646203642055-28f7d214-c451-4e77-abe9-e65343c4f428-662242-f9b8dc5b6382e47af13a66114851f9a2.png" width="552" height="332" class="img_ev3q"></p>
<p>接下来，我们来细说一下<strong>字符串常量池</strong>的结构，其实在 Hotspot JVM 中，字符串常量池<code>StringTable</code>的本质是一张<code>HashTable</code>，那么当我们说将一个字符串放入字符串常量池的时候，实际上放进去的是什么呢？</p>
<p>以字面量的方式创建 String 对象为例，字符串常量池以及堆栈的结构如下图所示（忽略了 jvm 中的各种<code>OopDesc</code>实例）：</p>
<p><img decoding="async" loading="lazy" alt="1644301410957-8stringtable.png" src="/assets/images/1646203642085-1d8eb77b-3fb3-4598-865c-ab6792ea866f-713639-6893236e4376d818d5c583301cc68b27.png" width="706" height="441" class="img_ev3q"></p>
<p>实际上字符串常量池<code>HashTable</code>采用的是<strong>数组</strong>加<strong>链表</strong>的结构，链表中的节点是一个个的<code>HashTableEntry</code>，而<code>HashTableEntry</code>中的<code>value</code>则存储了堆上 String 对象的<strong>引用</strong>。</p>
<p>那么，下一个问题来了，这个字符串对象的引用是<strong>什么时候</strong>被放到字符串常量池中的？具体可为两种情况：</p>
<ul>
<li>使用字面量声明 String 对象时，也就是被双引号包围的字符串，在堆上创建对象，并<strong>驻留</strong>到字符串常量池中（注意这个用词）</li>
<li>调用<code>intern()</code>方法，当字符串常量池没有相等的字符串时，会保存该字符串的引用</li>
</ul>
<p><strong>注意！<strong>我们在上面用到了一个词</strong>驻留</strong>，这里对它进行一下规范。当我们说驻留一个字符串到字符串常量池时，指的是创建<code>HashTableEntry</code>，再使它的<code>value</code>指向堆上的 String 实例，并把<code>HashTableEntry</code>放入字符串常量池，而不是直接把 String 对象放入字符串常量池中。简单来说，可以理解为将 String 对象的引用保存在字符串常量池中。</p>
<p>我们把<code>intern()</code>方法放在后面细说，先主要看第一种情况，这里直接整理引用 R 大的结论：</p>
<blockquote>
<p>在类加载阶段，JVM 会在堆中创建对应这些 class 文件常量池中的字符串对象实例，并在字符串常量池中驻留其引用。</p>
<p>这一过程具体是在 resolve 阶段(个人理解就是 resolution 解析阶段)执行，但是并不是立即就创建对象并驻留了引用，因为在 JVM 规范里指明了 resolve 阶段可以是 lazy 的。CONSTANT_String 会在第一次引用该项的 ldc 指令被第一次执行到的时候才会 resolve。</p>
<p>就 HotSpot VM 的实现来说，加载类时字符串字面量会进入到运行时常量池，不会进入全局的字符串常量池，即在 StringTable 中并没有相应的引用，在堆中 也没有对应的对象产生。</p>
</blockquote>
<p>这里大家可以暂时先记住这个结论，在后面还会用到。</p>
<p>在弄清楚上面几个概念后，我们再回过头来，先看看用<strong>字面量</strong>声明 String 的方式，代码如下：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public static void main(String[] args) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    String s = &quot;Hydra&quot;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>反编译生成的字节码文件：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public static void main(java.lang.String[]);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  descriptor: ([Ljava/lang/String;)V</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  flags: ACC_PUBLIC, ACC_STATIC</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Code:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    stack=1, locals=2, args_size=1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">       0: ldc           #2                  // String Hydra</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">       2: astore_1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">       3: return</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>解释一下上面的字节码指令：</p>
<ul>
<li><code>0: ldc</code>，查找后面索引为<code>#2</code>对应的项，<code>#2</code>表示常量在常量池中的位置。在这个过程中，会触发前面提到的<strong>lazy resolve</strong>，在 resolve 过程如果发现<code>StringTable</code>已经有了内容匹配的 String 引用，则直接返回这个引用，反之  如果<code>StringTable</code>里没有内容匹配的 String 对象的引用，则会在堆里创建一个对应内容的 String 对象，然后在<code>StringTable</code>驻留这个对象引用，并返回这个引用，之后再压入操作数栈中</li>
<li><code>2: astore_1</code>，弹出栈顶元素，并将栈顶引用类型值保存到局部变量 1 中，也就是保存到变量<code>s</code>中</li>
<li><code>3: return</code>，执行<code>void</code>函数返回</li>
</ul>
<p>可以看到，在这种模式下，只有堆中创建了一个<code>&quot;Hydra&quot;</code>对象，在字符串常量池中驻留了它的引用。并且，如果再给字符串<code>s2</code>、<code>s3</code>也用字面量的形式赋值为<code>&quot;Hydra&quot;</code>，它们用的都是堆中的唯一这一个对象。</p>
<p>好了，再看一下以构造方法的形式创建字符串的方式：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public static void main(String[] args) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    String s = new String(&quot;Hydra&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>同样反编译这段代码的字节码文件：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public static void main(java.lang.String[]);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  descriptor: ([Ljava/lang/String;)V</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  flags: ACC_PUBLIC, ACC_STATIC</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Code:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    stack=3, locals=2, args_size=1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">       0: new           #2                  // class java/lang/String</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">       3: dup</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">       4: ldc           #3                  // String Hydra</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">       6: invokespecial #4                  // Method java/lang/String.&quot;&lt;init&gt;&quot;:(Ljava/lang/String;)V</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">       9: astore_1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      10: return</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>看一下和之前不同的字节码指令部分：</p>
<ul>
<li><code>0: new</code>，在堆上创建一个 String 对象，并将它的引用压入操作数栈，注意这时的对象还只是一个空壳，并没有调用类的构造方法进行初始化</li>
<li><code>3: dup</code>，复制栈顶元素，也就是复制了上面的对象引用，并将复制后的对象引用压入栈顶。这里之所以要进行复制，是因为之后要执行的构造方法会从操作数栈弹出需要的参数和这个对象引用本身（这个引用起到的作用就是构造方法中的<code>this</code>指针），如果不进行复制，在弹出后会无法得到初始化后的对象引用</li>
<li><code>4: ldc</code>，在堆上创建字符串对象，驻留到字符串常量池，并将字符串的引用压入操作数栈</li>
<li><code>6: invokespecial</code>，执行 String 的构造方法，这一步执行完成后得到一个完整对象</li>
</ul>
<p>到这里，我们可以看到一共创建了<strong>两个</strong>String 对象，并且两个都是在堆上创建的，且字面量方式创建的 String 对象的引用被驻留到了字符串常量池中。而栈里的<code>s</code>只是一个变量，并不是实际意义上的对象，我们不把它  包括在内。</p>
<p>其实想要验证这个结论也很简单，可以使用 idea 中强大的 debug 功能来直观的对比一下对象数量的变化，先看字面量创建 String 方式：</p>
<p><img decoding="async" loading="lazy" alt="1644368408631-9.png" src="/assets/images/1646203642037-92144f5e-a19f-42d1-8629-9cadf2371688-719795-85242ab92f3706165b9fc33bb31d4b9a.png" width="1352" height="399" class="img_ev3q"></p>
<p>这个对象数量的计数器是在 debug 时，点击下方右侧<code>Memory</code>的<code>Load classes</code>弹出的。对比语句执行前后可以看到，只创建了一个 String 对象，以及一个 char 数组对象，也就是 String 对象中的<code>value</code>。</p>
<p>再看看构造方法创建 String 的方式：</p>
<p><img decoding="async" loading="lazy" alt="1644368963578-10.png" src="/assets/images/1646203642062-820121d0-ca33-44d4-8968-69d5a9c889f5-799334-a1ebbfdbcdff9d31203dbd100a439c86.png" width="1265" height="396" class="img_ev3q"></p>
<p>可以看到，创建了两个 String 对象，一个 char 数组对象，也说明了两个 String 中的<code>value</code>指向了同一个 char 数组对象，符合我们上面从字节码指令角度解释的结果。</p>
<p>最后再看一下下面的这种情况，当字符串常量池已经驻留过某个字符串引用，再使用构造方法创建 String 时，创建了几个对象？</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public static void main(String[] args) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	String s = &quot;Hydra&quot;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	String s2 = new String(&quot;Hydra&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>答案是<strong>只创建一个对象</strong>，对于这种重复字面量的字符串，看一下反编译后的字节码指令：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Code:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  stack=3, locals=3, args_size=1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     0: ldc           #2                  // String Hydra</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     2: astore_1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     3: new           #3                  // class java/lang/String</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     6: dup</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     7: ldc           #2                  // String Hydra</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     9: invokespecial #4                  // Method java/lang/String.&quot;&lt;init&gt;&quot;:(Ljava/lang/String;)V</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    12: astore_2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    13: return</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以看到两次执行<code>ldc</code>指令时后面索引相同，而<code>ldc</code>判断是否需要创建新的 String 实例的依据是根据在第一次执行这条指令时，<code>StringTable</code>是否已经保存了一个对应内容的 String 实例的引用。所以在第一次执行<code>ldc</code>时会创建 String 实例，而在第二次<code>ldc</code>就会直接返回而不需要再创建实例了。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="第-4-题烧脑的-intern">第 4 题，烧脑的 intern<a href="#第-4-题烧脑的-intern" class="hash-link" aria-label="Direct link to 第 4 题，烧脑的 intern" title="Direct link to 第 4 题，烧脑的 intern">​</a></h2>
<p>上面我们在研究字符串对象的引用如何驻留到字符串常量池中时，还留下了调用<code>intern</code>方法的方式，下面我们来具体分析。</p>
<p>从字面上理解<code>intern</code>这个单词，作为动词时它有<strong>禁闭</strong>、<strong>关押</strong>的意思，通过前面的介绍，与其说是将字符串关押到字符串常量池<code>StringTable</code>中，可能将它理解为<strong>缓存它的引用</strong>会更加贴切。</p>
<p>String 的<code>intern()</code>是一个本地方法，可以强制将 String 驻留进入字符串常量池，可以分为两种情况：</p>
<ul>
<li>如果字符串常量池中已经驻留了一个等于此 String 对象内容的字符串引用，则返回此字符串在常量池中的引用</li>
<li>否则，在常量池中创建一个引用指向这个 String 对象，然后返回常量池中的这个引用</li>
</ul>
<p>好了，我们下面看一下这段代码，它的运行结果应该是什么？</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public static void main(String[] args) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    String s1 = new String(&quot;Hydra&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    String s2 = s1.intern();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    System.out.println(s1 == s2);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    System.out.println(s1 == &quot;Hydra&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    System.out.println(s2 == &quot;Hydra&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>输出打印：</p>
<div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">false</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">false</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>用一张图来描述它们的关系，就很容易明白了：</p>
<p><img decoding="async" loading="lazy" alt="1644475169796-11intern.png" src="/assets/images/1646203641989-34a59f7f-c3ee-4fd9-ace8-8be54bc4838d-679663-2aed5f56a98af19468ef409e0c9f5c52.png" width="701" height="511" class="img_ev3q"></p>
<p>其实有了第三题的基础，了解这个结构已经很简单了：</p>
<ul>
<li>在创建<code>s1</code>的时候，其实堆里已经创建了两个字符串对象<code>StringObject1</code>和<code>StringObject2</code>，并且在字符串常量池中驻留了<code>StringObject2</code></li>
<li>当执行<code>s1.intern()</code>方法时，字符串常量池中已经存在内容等于<code>&quot;Hydra&quot;</code>的字符串<code>StringObject2</code>，直接返回这个引用并赋值给<code>s2</code></li>
<li><code>s1</code>和<code>s2</code>指向的是两个不同的 String 对象，因此返回 false</li>
<li><code>s2</code>指向的就是驻留在字符串常量池的<code>StringObject2</code>，因此<code>s2==&quot;Hydra&quot;</code>为 true，而<code>s1</code>指向的不是常量池中的对象引用所以返回 false</li>
</ul>
<p>上面是常量池中已存在内容相等的字符串驻留的情况，下面再看看常量池中不存在的情况，看下面的例子：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public static void main(String[] args) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    String s1 = new String(&quot;Hy&quot;) + new String(&quot;dra&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    s1.intern();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    String s2 = &quot;Hydra&quot;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    System.out.println(s1 == s2);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>执行结果：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>简单分析一下这个过程，第一步会在堆上创建<code>&quot;Hy&quot;</code>和<code>&quot;dra&quot;</code>的字符串对象，并驻留到字符串常量池中。</p>
<p>接下来，完成字符串的拼接操作，前面我们说过，实际上 jvm 会把拼接优化成<code>StringBuilder</code>的<code>append</code>方法，并最终调用<code>toString</code>方法返回一个 String 对象。在完成字符串的拼接后，字符串常量池中并没有驻留一个内容等于<code>&quot;Hydra&quot;</code>的字符串。</p>
<p><img decoding="async" loading="lazy" alt="1644481614827-12intern2-1.png" src="/assets/images/1646203642020-c9b71f01-e4ca-45c3-9265-644b371c1f17-965135-d2824cabc4624955e556f62b429f75a1.png" width="701" height="461" class="img_ev3q"></p>
<p>所以，执行<code>s1.intern()</code>时，会在字符串常量池创建一个引用，指向前面<code>StringBuilder</code>创建的那个字符串，也就是变量<code>s1</code>所指向的字符串对象。在《深入理解 Java 虚拟机》这本书中，作者对这进行了解释，因为从 jdk7 开始，字符串常量池就已经移到了堆中，那么这里就只需要在字符串常量池中记录一下首次出现的实例引用即可。</p>
<p><img decoding="async" loading="lazy" alt="1644481784310-13intern2-2.png" src="/assets/images/1646203642125-5e5d5bdb-26f3-4902-a91d-9ec1078351e2-655706-a8d982c4708a34c5e0949e35c0f0aa35.png" width="701" height="461" class="img_ev3q"></p>
<p>最后，当执行<code>String s2 = &quot;Hydra&quot;</code>时，发现字符串常量池中已经驻留这个字符串，直接返回对象的引用，因此<code>s1</code>和<code>s2</code>指向的是相同的对象。</p>
<p><img decoding="async" loading="lazy" alt="1644481880632-14intern2-3.png" src="/assets/images/1646203642054-38327ce5-7204-42d3-a21d-e5fe1ef60820-039991-cb58038baf75e3535acd8f3beb7f1c06.png" width="701" height="461" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="第-5-题还是创建了几个对象">第 5 题，还是创建了几个对象？<a href="#第-5-题还是创建了几个对象" class="hash-link" aria-label="Direct link to 第 5 题，还是创建了几个对象？" title="Direct link to 第 5 题，还是创建了几个对象？">​</a></h2>
<p>解决了前面数 String 对象个数的问题，那么我们接着加点难度，看看下面这段代码，创建了几个对象？</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">String s=&quot;a&quot;+&quot;b&quot;+&quot;c&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>先揭晓答案，<strong>只创建了一个对象！</strong> 可以直观的对比一下源代码和反编译后的字节码文件：</p>
<p><img decoding="async" loading="lazy" alt="1644486521169-15.png" src="/assets/images/1646203642307-54ad8c18-d448-46b1-984c-5e86782ba458-802772-e16ab6cd2a8f8f70a00c1200410c0c97.png" width="1107" height="442" class="img_ev3q"></p>
<p>如果使用前面提到过的 debug 小技巧，也可以直观的看到语句执行完后，只增加了一个 String 对象，以及一个 char 数组对象。并且这个字符串就是驻留在字符串常量池中的那一个，如果后面再使用字面量<code>&quot;abc&quot;</code>的方式声明一个字符串，指向的仍是这一个，堆中 String 对象的数量不会发生变化。</p>
<p>至于为什么源代码中字符串拼接的操作，在编译完成后会消失，直接呈现为一个拼接后的完整字符串，是因为在编译期间，应用了编译器优化中一种被称为<strong>常量折叠</strong>(Constant Folding)的技术。</p>
<blockquote>
<p>常量折叠会将<strong>编译期常量</strong>的加减乘除的运算过程在编译过程中折叠。编译器通过语法分析，会将常量表达式计算求值，并用求出的值来替换表达式，而不必等到运行期间再进行运算处理，从而在运行期间节省处理器资源。</p>
</blockquote>
<p>而上边提到的编译期常量的特点就是它的值在编译期就可以确定，并且需要完整满足下面的要求，才可能是一个编译期常量：</p>
<ul>
<li>被声明为<code>final</code></li>
<li>基本类型或者字符串类型</li>
<li>声明时就已经初始化</li>
<li>使用<strong>常量表达式</strong>进行初始化</li>
</ul>
<p>下面我们通过几段代码加深对它的理解：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public static void main(String[] args) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    final String h1 = &quot;hello&quot;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    String h2 = &quot;hello&quot;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    String s1 = h1 + &quot;Hydra&quot;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    String s2 = h2 + &quot;Hydra&quot;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    System.out.println((s1 == &quot;helloHydra&quot;));</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    System.out.println((s2 == &quot;helloHydra&quot;));</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>执行结果：</p>
<div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">true</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>代码中字符串<code>h1</code>和<code>h2</code>都使用常量赋值，区别在于是否使用了<code>final</code>进行修饰，对比编译后的代码，<code>s1</code>进行了折叠而<code>s2</code>没有，可以印证上面的理论，<code>final</code>修饰的字符串变量才有可能是编译期常量。</p>
<p><img decoding="async" loading="lazy" alt="1629032304846-4final-20220302144335158.png" src="/assets/images/1646203642177-b244b25a-dda1-4981-9b43-810c8ecd9ef4-780334-8bcef7e241d977d7c8ce8b1d36e3f492.png" width="1210" height="453" class="img_ev3q"></p>
<p>再看一段代码，执行下面的程序，结果会返回什么呢？</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public static void main(String[] args) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    String h =&quot;hello&quot;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    final String h2 = h;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    String s = h2 + &quot;Hydra&quot;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    System.out.println(s==&quot;helloHydra&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>答案是<code>false</code>，因为虽然这里字符串<code>h2</code>被<code>final</code>修饰，但是初始化时没有使用常量表达式，因此它也不是编译期常量。那么，有的小伙伴就要问了，到底什么才是常量表达式呢？</p>
<p>在<code>Oracle</code>官网的文档中，列举了很多种情况，下面对常见的情况进行列举（除了下面这些之外官方文档上还列举了不少情况，如果有兴趣的话，可以自己查看）：</p>
<ul>
<li>基本类型和 String 类型的字面量</li>
<li>基本类型和 String 类型的强制类型转换</li>
<li>使用<code>+</code>或<code>-</code>或<code>!</code>等一元运算符（不包括<code>++</code>和<code>--</code>）进行计算</li>
<li>使用加减运算符<code>+</code>、<code>-</code>，乘除运算符<code>*</code>、 <code>/</code> 、<code>%</code> 进行计算</li>
<li>使用移位运算符 <code>&gt;&gt;</code>、 <code>&lt;&lt;</code>、 <code>&gt;&gt;&gt;</code>进行位移操作</li>
<li>……</li>
</ul>
<p>至于我们从文章一开始就提到的字面量（literals），是用于表达源代码中一个固定值的表示法，在 Java 中创建一个对象时需要使用<code>new</code>关键字，但是给一个基本类型变量赋值时不需要使用<code>new</code>关键字，这种方式就可以被称为字面量。Java 中字面量主要包括了以下类型的字面量：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">//整数型字面量：</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">long l=1L;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">int i=1;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">//浮点类型字面量：</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">float f=11.1f;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">double d=11.1;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">//字符和字符串类型字面量：</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">char c=&#x27;h&#x27;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">String s=&quot;Hydra&quot;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">//布尔类型字面量：</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">boolean b=true;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>再说点题外话，和编译期常量相对的，另一种类型的常量是运行时常量，看一下下面这段代码：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">final String s1=&quot;hello &quot;+&quot;Hydra&quot;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">final String s2=UUID.randomUUID().toString()+&quot;Hydra&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>编译器能够在编译期就得到<code>s1</code>的值是<code>hello Hydra</code>，不需要等到程序的运行期间，因此<code>s1</code>属于编译期常量。而对<code>s2</code>来说，虽然也被声明为<code>final</code>类型，并且在声明时就已经初始化，但使用的不是常量表达式，因此不属于编译期常量，这一类型的常量被称为<strong>运行时常量</strong>。</p>
<p>再看一下编译后的字节码文件中的常量池区域：</p>
<p><img decoding="async" loading="lazy" alt="1628995844434-3constant.png" src="/assets/images/1646203642092-d52360ef-fed6-4cd5-a604-01109cb4162d-401728-55d6461f20cd72fcf2ff91a144c94ffd.png" width="1258" height="483" class="img_ev3q"></p>
<p>可以看到常量池中只有一个 String 类型的常量<code>hello Hydra</code>，而<code>s2</code>对应的字符串常量则不在此区域。对编译器来说，运行时常量在编译期间无法进行折叠，编译器只会对尝试修改它的操作进行报错处理。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>最后再强调一下，本文是基于<code>jdk8</code>进行测试，不同版本的<code>jdk</code>可能会有很大差异。例如<code>jdk6</code>之前，字符串常量池存储的是 String 对象实例，而在<code>jdk7</code>以后字符串常量池就改为存储引用，做了非常大的改变。</p>
<p>至于最后一题，其实 Hydra 在以前单独拎出来写过一篇文章，这次总结面试题把它归纳在了里面，省略了一些不重要的部分，大家如果觉得不够详细可以移步看看这篇：</p>
<p><a href="http://mp.weixin.qq.com/s?__biz=MzIwMTgzOTQ0Ng==&amp;mid=2247486096&amp;idx=1&amp;sn=03ffef3159889a2ca2e9f7287f2c5bad&amp;chksm=96e68ca9a19105bf3f3941732d913eaf6764f5d152a1f5eac649104d685c98cabd68a743e8b4&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">String s=“a”+“b”+“c”，到底创建了几个对象？</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考资料">参考资料<a href="#参考资料" class="hash-link" aria-label="Direct link to 参考资料" title="Direct link to 参考资料">​</a></h2>
<ul>
<li>《深入理解 Java 虚拟机（第三版）》</li>
<li><a href="https://www.zhihu.com/question/55994121" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/question/55994121</a></li>
<li><a href="https://www.iteye.com/blog/rednaxelafx-774673#" target="_blank" rel="noopener noreferrer">https://www.iteye.com/blog/rednaxelafx-774673#</a></li>
</ul>
<blockquote>
<p>更新: 2024-04-13 11:52:44<br>
原文: <a href="https://www.yuque.com/snailclimb/mf2z3k/daifks" target="_blank" rel="noopener noreferrer">https://www.yuque.com/snailclimb/mf2z3k/daifks</a></p>
</blockquote></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#第-1-题奇怪的-nullnull" class="table-of-contents__link toc-highlight">第 1 题，奇怪的 nullnull</a></li><li><a href="#第-2-题改变-string-的值" class="table-of-contents__link toc-highlight">第 2 题，改变 String 的值</a></li><li><a href="#第-3-题创建了几个对象" class="table-of-contents__link toc-highlight">第 3 题，创建了几个对象？</a></li><li><a href="#第-4-题烧脑的-intern" class="table-of-contents__link toc-highlight">第 4 题，烧脑的 intern</a></li><li><a href="#第-5-题还是创建了几个对象" class="table-of-contents__link toc-highlight">第 5 题，还是创建了几个对象？</a></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li><li><a href="#参考资料" class="table-of-contents__link toc-highlight">参考资料</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>