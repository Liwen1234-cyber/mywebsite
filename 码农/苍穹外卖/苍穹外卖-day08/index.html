<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-码农/苍穹外卖/苍穹外卖-day08" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">苍穹外卖-day08 | Coisini</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://doc.minddiy.top/码农/苍穹外卖/苍穹外卖-day08/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="苍穹外卖-day08 | Coisini"><meta data-rh="true" name="description" content="课程内容"><meta data-rh="true" property="og:description" content="课程内容"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://doc.minddiy.top/码农/苍穹外卖/苍穹外卖-day08/"><link data-rh="true" rel="alternate" href="https://doc.minddiy.top/码农/苍穹外卖/苍穹外卖-day08/" hreflang="en"><link data-rh="true" rel="alternate" href="https://doc.minddiy.top/码农/苍穹外卖/苍穹外卖-day08/" hreflang="x-default"><meta name="google-site-verification" content="1FUPX6Qo4y3ecU623ShEurhgnjhSTjK49rRMhEDlzFA">
<link rel="stylesheet" href="/katex/katex.min.css">
<script src="/js/matomo.js" async defer="defer"></script><link rel="stylesheet" href="/assets/css/styles.79037026.css">
<script src="/assets/js/runtime~main.468f2b27.js" defer="defer"></script>
<script src="/assets/js/main.4763ab3e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Coisini</b></a></div><div class="navbar__items navbar__items--right"><a href="https://minddiy.top" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Main site<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>苍穹外卖-day08</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="课程内容">课程内容<a href="#课程内容" class="hash-link" aria-label="Direct link to 课程内容" title="Direct link to 课程内容">​</a></h2>
<ul>
<li>导入地址簿功能代码</li>
<li>用户下单</li>
<li>订单支付</li>
</ul>
<p>功能实现：<strong>用户下单</strong>、<strong>订单支付</strong></p>
<p><strong>用户下单效果图：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214181127718-a83d88dc2b2e7a515d480773db747c06.png" width="338" height="665" class="img_ev3q"></p>
<p><strong>订单支付效果图：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214181221426-356623a20088ccb4bceda2c74b07582b.png" width="329" height="665" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-导入地址簿功能代码">1. 导入地址簿功能代码<a href="#1-导入地址簿功能代码" class="hash-link" aria-label="Direct link to 1. 导入地址簿功能代码" title="Direct link to 1. 导入地址簿功能代码">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-需求分析和设计">1.1 需求分析和设计<a href="#11-需求分析和设计" class="hash-link" aria-label="Direct link to 1.1 需求分析和设计" title="Direct link to 1.1 需求分析和设计">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="111-产品原型">1.1.1 产品原型<a href="#111-产品原型" class="hash-link" aria-label="Direct link to 1.1.1 产品原型" title="Direct link to 1.1.1 产品原型">​</a></h4>
<p>地址簿，指的是消费者用户的地址信息，用户登录成功后可以维护自己的地址信息。同一个用户可以有多个地址信息，但是只能有一个<strong>默认地址</strong>。</p>
<p><strong>效果图：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214183615228-9e8b35c17c78dd44304827c862b51b83.png" width="361" height="644" class="img_ev3q"></p>
<p>对于地址簿管理，我们需要实现以下几个功能：</p>
<ul>
<li>查询地址列表</li>
<li>新增地址</li>
<li>修改地址</li>
<li>删除地址</li>
<li>设置默认地址</li>
<li>查询默认地址</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="112-接口设计">1.1.2 接口设计<a href="#112-接口设计" class="hash-link" aria-label="Direct link to 1.1.2 接口设计" title="Direct link to 1.1.2 接口设计">​</a></h4>
<p>根据上述原型图先<strong>粗粒度</strong>设计接口，共包含7个接口。</p>
<p><strong>接口设计：</strong></p>
<ul>
<li>新增地址</li>
<li>查询登录用户所有地址</li>
<li>查询默认地址</li>
<li>根据id修改地址</li>
<li>根据id删除地址</li>
<li>根据id查询地址</li>
<li>设置默认地址</li>
</ul>
<p>接下来<strong>细粒度</strong>分析每个接口，明确每个接口的请求方式、请求路径、传入参数和返回值。</p>
<p><strong>1). 新增地址</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214185000982-f3c04ab91030cece0d77e02ec3707f65.png" width="593" height="513" class="img_ev3q"></p>
<p><strong>2). 查询登录用户所有地址</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214185112802-fdd9239db2d9a13b031df9caaf089a42.png" width="470" height="299" class="img_ev3q"></p>
<p><strong>3). 查询默认地址</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214185209235-d64d5d3d296a152a298c45a3e8e80095.png" width="500" height="329" class="img_ev3q"></p>
<p><strong>4). 修改地址</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214185309798-5dbf88585c0f447ed971918699d4b4d4.png" width="471" height="415" class="img_ev3q"></p>
<p><strong>5). 根据id删除地址</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214185443519-e3fc820bf18806a979cdda9ae7805eb8.png" width="565" height="780" class="img_ev3q"></p>
<p><strong>6). 根据id查询地址</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214185534450-1714cf6c1210153d3f06721d2ba72c7e.png" width="249" height="405" class="img_ev3q"></p>
<p><strong>7). 设置默认地址</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214185622092-c10b981ba83e6800514fe563705b5d45.png" width="571" height="656" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="113-表设计">1.1.3 表设计<a href="#113-表设计" class="hash-link" aria-label="Direct link to 1.1.3 表设计" title="Direct link to 1.1.3 表设计">​</a></h4>
<p>用户的地址信息会存储在address_book表，即地址簿表中。具体表结构如下：</p>































































































<table><thead><tr><th><strong>字段名</strong></th><th><strong>数据类型</strong></th><th><strong>说明</strong></th><th><strong>备注</strong></th></tr></thead><tbody><tr><td>id</td><td>bigint</td><td>主键</td><td>自增</td></tr><tr><td>user_id</td><td>bigint</td><td>用户id</td><td>逻辑外键</td></tr><tr><td>consignee</td><td>varchar(50)</td><td>收货人</td><td></td></tr><tr><td>sex</td><td>varchar(2)</td><td>性别</td><td></td></tr><tr><td>phone</td><td>varchar(11)</td><td>手机号</td><td></td></tr><tr><td>province_code</td><td>varchar(12)</td><td>省份编码</td><td></td></tr><tr><td>province_name</td><td>varchar(32)</td><td>省份名称</td><td></td></tr><tr><td>city_code</td><td>varchar(12)</td><td>城市编码</td><td></td></tr><tr><td>city_name</td><td>varchar(32)</td><td>城市名称</td><td></td></tr><tr><td>district_code</td><td>varchar(12)</td><td>区县编码</td><td></td></tr><tr><td>district_name</td><td>varchar(32)</td><td>区县名称</td><td></td></tr><tr><td>detail</td><td>varchar(200)</td><td>详细地址信息</td><td>具体到门牌号</td></tr><tr><td>label</td><td>varchar(100)</td><td>标签</td><td>公司、家、学校</td></tr><tr><td>is_default</td><td>tinyint(1)</td><td>是否默认地址</td><td>1是 0否</td></tr></tbody></table>
<p>这里面有一个字段is_default，实际上我们在设置默认地址时，只需要更新这个字段就可以了。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-代码导入">1.2 代码导入<a href="#12-代码导入" class="hash-link" aria-label="Direct link to 1.2 代码导入" title="Direct link to 1.2 代码导入">​</a></h3>
<p>对于这一类的单表的增删改查，我们已经写过很多了，基本的开发思路都是一样的，那么本小节的用户地址簿管理的增删改查功能，我们就不再一一实现了，基本的代码我们都已经提供了，直接导入进来，做一个测试即可。</p>
<p>导入课程资料中的地址簿模块功能代码：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214190135741-c5c039864890e7142318d0d809686c20.png" width="945" height="339" class="img_ev3q"></p>
<p>进入到sky-server模块中</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="121-mapper层">1.2.1 Mapper层<a href="#121-mapper层" class="hash-link" aria-label="Direct link to 1.2.1 Mapper层" title="Direct link to 1.2.1 Mapper层">​</a></h4>
<p><strong>创建AddressBookMapper.java</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.mapper;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.entity.AddressBook;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.apache.ibatis.annotations.*;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.util.List;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Mapper</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public interface AddressBookMapper {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 条件查询</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param addressBook</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    List&lt;AddressBook&gt; list(AddressBook addressBook);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 新增</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param addressBook</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Insert(&quot;insert into address_book&quot; +</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            &quot;        (user_id, consignee, phone, sex, province_code, province_name, city_code, city_name, district_code,&quot; +</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            &quot;         district_name, detail, label, is_default)&quot; +</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            &quot;        values (#{userId}, #{consignee}, #{phone}, #{sex}, #{provinceCode}, #{provinceName}, #{cityCode}, #{cityName},&quot; +</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            &quot;                #{districtCode}, #{districtName}, #{detail}, #{label}, #{isDefault})&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    void insert(AddressBook addressBook);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 根据id查询</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param id</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Select(&quot;select * from address_book where id = #{id}&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    AddressBook getById(Long id);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 根据id修改</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param addressBook</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    void update(AddressBook addressBook);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 根据 用户id修改 是否默认地址</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param addressBook</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Update(&quot;update address_book set is_default = #{isDefault} where user_id = #{userId}&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    void updateIsDefaultByUserId(AddressBook addressBook);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 根据id删除地址</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param id</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Delete(&quot;delete from address_book where id = #{id}&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    void deleteById(Long id);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>创建AddressBookMapper.xml</strong></p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token prolog" style="color:hsl(230, 4%, 64%)">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token doctype punctuation" style="color:hsl(119, 34%, 47%)">&lt;!</span><span class="token doctype doctype-tag" style="color:hsl(230, 8%, 24%)">DOCTYPE</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype name" style="color:hsl(230, 8%, 24%)">mapper</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype name" style="color:hsl(230, 8%, 24%)">PUBLIC</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype string" style="color:hsl(119, 34%, 47%)">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype string" style="color:hsl(119, 34%, 47%)">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">mapper</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">namespace</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">com.sky.mapper.AddressBookMapper</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">select</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">list</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">parameterType</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">AddressBook</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">resultType</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">AddressBook</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        select * from address_book</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">where</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">userId != null</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                and user_id = #{userId}</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">phone != null</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                and phone = #{phone}</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">isDefault != null</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                and is_default = #{isDefault}</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">where</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">select</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">update</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">update</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">parameterType</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">addressBook</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        update address_book</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">set</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">consignee != null</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                consignee = #{consignee},</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">sex != null</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                sex = #{sex},</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">phone != null</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                phone = #{phone},</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">detail != null</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                detail = #{detail},</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">label != null</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                label = #{label},</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">isDefault != null</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                is_default = #{isDefault},</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">set</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        where id = #{id}</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">update</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">mapper</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="122-service层">1.2.2 Service层<a href="#122-service层" class="hash-link" aria-label="Direct link to 1.2.2 Service层" title="Direct link to 1.2.2 Service层">​</a></h4>
<p><strong>创建AddressBookService.java</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.service;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.entity.AddressBook;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.util.List;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public interface AddressBookService {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    List&lt;AddressBook&gt; list(AddressBook addressBook);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    void save(AddressBook addressBook);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    AddressBook getById(Long id);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    void update(AddressBook addressBook);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    void setDefault(AddressBook addressBook);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    void deleteById(Long id);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>创建AddressBookServiceImpl.java</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.service.impl;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.context.BaseContext;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.entity.AddressBook;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.mapper.AddressBookMapper;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.service.AddressBookService;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import lombok.extern.slf4j.Slf4j;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.beans.factory.annotation.Autowired;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.stereotype.Service;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.transaction.annotation.Transactional;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.util.List;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public class AddressBookServiceImpl implements AddressBookService {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private AddressBookMapper addressBookMapper;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 条件查询</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param addressBook</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public List&lt;AddressBook&gt; list(AddressBook addressBook) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return addressBookMapper.list(addressBook);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 新增地址</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param addressBook</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void save(AddressBook addressBook) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        addressBook.setUserId(BaseContext.getCurrentId());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        addressBook.setIsDefault(0);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        addressBookMapper.insert(addressBook);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 根据id查询</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param id</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public AddressBook getById(Long id) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        AddressBook addressBook = addressBookMapper.getById(id);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return addressBook;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 根据id修改地址</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param addressBook</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void update(AddressBook addressBook) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        addressBookMapper.update(addressBook);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 设置默认地址</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param addressBook</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Transactional</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void setDefault(AddressBook addressBook) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //1、将当前用户的所有地址修改为非默认地址 update address_book set is_default = ? where user_id = ?</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        addressBook.setIsDefault(0);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        addressBook.setUserId(BaseContext.getCurrentId());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        addressBookMapper.updateIsDefaultByUserId(addressBook);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //2、将当前地址改为默认地址 update address_book set is_default = ? where id = ?</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        addressBook.setIsDefault(1);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        addressBookMapper.update(addressBook);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 根据id删除地址</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param id</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void deleteById(Long id) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        addressBookMapper.deleteById(id);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="123-controller层">1.2.3 Controller层<a href="#123-controller层" class="hash-link" aria-label="Direct link to 1.2.3 Controller层" title="Direct link to 1.2.3 Controller层">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.controller.user;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.context.BaseContext;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.entity.AddressBook;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.result.Result;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.service.AddressBookService;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import io.swagger.annotations.Api;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import io.swagger.annotations.ApiOperation;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.beans.factory.annotation.Autowired;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.web.bind.annotation.*;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.util.List;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@RequestMapping(&quot;/user/addressBook&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Api(tags = &quot;C端地址簿接口&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public class AddressBookController {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private AddressBookService addressBookService;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 查询当前登录用户的所有地址信息</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @GetMapping(&quot;/list&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;查询当前登录用户的所有地址信息&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result&lt;List&lt;AddressBook&gt;&gt; list() {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        AddressBook addressBook = new AddressBook();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        addressBook.setUserId(BaseContext.getCurrentId());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        List&lt;AddressBook&gt; list = addressBookService.list(addressBook);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success(list);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 新增地址</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param addressBook</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @PostMapping</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;新增地址&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result save(@RequestBody AddressBook addressBook) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        addressBookService.save(addressBook);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @GetMapping(&quot;/{id}&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;根据id查询地址&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result&lt;AddressBook&gt; getById(@PathVariable Long id) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        AddressBook addressBook = addressBookService.getById(id);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success(addressBook);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 根据id修改地址</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param addressBook</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @PutMapping</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;根据id修改地址&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result update(@RequestBody AddressBook addressBook) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        addressBookService.update(addressBook);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 设置默认地址</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param addressBook</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @PutMapping(&quot;/default&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;设置默认地址&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result setDefault(@RequestBody AddressBook addressBook) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        addressBookService.setDefault(addressBook);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 根据id删除地址</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param id</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @DeleteMapping</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;根据id删除地址&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result deleteById(Long id) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        addressBookService.deleteById(id);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 查询默认地址</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @GetMapping(&quot;default&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;查询默认地址&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result&lt;AddressBook&gt; getDefault() {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //SQL:select * from address_book where user_id = ? and is_default = 1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        AddressBook addressBook = new AddressBook();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        addressBook.setIsDefault(1);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        addressBook.setUserId(BaseContext.getCurrentId());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        List&lt;AddressBook&gt; list = addressBookService.list(addressBook);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        if (list != null &amp;&amp; list.size() == 1) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            return Result.success(list.get(0));</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.error(&quot;没有查询到默认地址&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-功能测试">1.3 功能测试<a href="#13-功能测试" class="hash-link" aria-label="Direct link to 1.3 功能测试" title="Direct link to 1.3 功能测试">​</a></h3>
<p>可以通过如下方式进行测试：</p>
<ul>
<li>查看控制台sql和数据库中的数据变化</li>
<li>Swagger接口文档测试</li>
<li>前后端联调</li>
</ul>
<p>我们直接使用<strong>前后端联调</strong>测试：</p>
<p>启动后台服务，编译小程序</p>
<p>登录进入首页--&gt;进入个人中心--&gt;进入地址管理</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214192141197-3183cd3daf828d85636c3018933223ff.png" width="466" height="741" class="img_ev3q"></p>
<p><strong>1). 新增收货地址</strong></p>
<p><strong>添加两条收货地址：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214193135164-46c90293c7b5753b05144015d2279604.png" width="478" height="691" class="img_ev3q"></p>
<p><strong>查看收货地址：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214193437578-237cfa4311a08a071836c12bd7434944.png" width="473" height="557" class="img_ev3q"></p>
<p><strong>查看数据库：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214193552879-b8febd9895d4564008d4ab2d5a7c5ab4.png" width="1838" height="86" class="img_ev3q"></p>
<p><strong>2). 设置默认收货地址</strong></p>
<p><strong>设置默认地址：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214193714137-769e4179c0f33b5258430cb84a823142.png" width="476" height="674" class="img_ev3q"></p>
<p><strong>查看数据库：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214193829043-9f95dcbacd0efbbfb4a996bd733edc42.png" width="1839" height="84" class="img_ev3q"></p>
<p><strong>3). 删除收货地址</strong></p>
<p><strong>进行编辑：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214194051783-3df89e77c146eebebfa091da27f6f353.png" width="476" height="678" class="img_ev3q"></p>
<p><strong>删除地址：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214194126920-9e2bcc6993df04449062af6dc61fe6eb.png" width="474" height="703" class="img_ev3q"></p>
<p><strong>查看数据库：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214194251343-442a0f6dc59a76314aa7f52485e9b095.png" width="1834" height="64" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="14-代码提交">1.4 代码提交<a href="#14-代码提交" class="hash-link" aria-label="Direct link to 1.4 代码提交" title="Direct link to 1.4 代码提交">​</a></h3>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214204411614-7a4ab4cf66be65fd0e06f608afbc6eee.png" width="1080" height="999" class="img_ev3q"></p>
<p>后续步骤和其它功能代码提交一致，不再赘述。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-用户下单">2. 用户下单<a href="#2-用户下单" class="hash-link" aria-label="Direct link to 2. 用户下单" title="Direct link to 2. 用户下单">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-需求分析和设计">2.1 需求分析和设计<a href="#21-需求分析和设计" class="hash-link" aria-label="Direct link to 2.1 需求分析和设计" title="Direct link to 2.1 需求分析和设计">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="211-产品原型">2.1.1 产品原型<a href="#211-产品原型" class="hash-link" aria-label="Direct link to 2.1.1 产品原型" title="Direct link to 2.1.1 产品原型">​</a></h4>
<p><strong>用户下单业务说明：</strong>
在电商系统中，用户是通过下单的方式通知商家，用户已经购买了商品，需要商家进行备货和发货。
用户下单后会产生订单相关数据，订单数据需要能够体现如下信息：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214195633802-20bac112df3a56c8f728682df207cc38.png" width="1190" height="712" class="img_ev3q"></p>
<p>用户将菜品或者套餐加入购物车后，可以点击购物车中的 &quot;去结算&quot; 按钮，页面跳转到订单确认页面，点击 &quot;去支付&quot; 按钮则完成下单操作。</p>
<p><strong>用户点餐业务流程(效果图)：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214195913467-db66b403cc35228a8dc5222e3e4dc075.png" width="1779" height="663" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="212-接口设计">2.1.2 接口设计<a href="#212-接口设计" class="hash-link" aria-label="Direct link to 2.1.2 接口设计" title="Direct link to 2.1.2 接口设计">​</a></h4>
<p><strong>接口分析：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214200913654-bd37d0e1d50afe429504ba4c891de401.png" width="847" height="752" class="img_ev3q"></p>
<p><strong>接口设计：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214201211364-f1285c675424c6d9bf53f75e3ded1f55.png" width="471" height="405" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="213-表设计">2.1.3 表设计<a href="#213-表设计" class="hash-link" aria-label="Direct link to 2.1.3 表设计" title="Direct link to 2.1.3 表设计">​</a></h4>
<p>用户下单业务对应的数据表为orders表和order_detail表(一对多关系,一个订单关联多个订单明细)：</p>




















<table><thead><tr><th>表名</th><th>含义</th><th>说明</th></tr></thead><tbody><tr><td>orders</td><td>订单表</td><td>主要存储订单的基本信息(如: 订单号、状态、金额、支付方式、下单用户、收件地址等)</td></tr><tr><td>order_detail</td><td>订单明细表</td><td>主要存储订单详情信息(如: 该订单关联的套餐及菜品的信息)</td></tr></tbody></table>
<p>具体的表结构如下:</p>
<p><strong>1). orders订单表</strong></p>





















































































































































<table><thead><tr><th><strong>字段名</strong></th><th><strong>数据类型</strong></th><th><strong>说明</strong></th><th><strong>备注</strong></th></tr></thead><tbody><tr><td>id</td><td>bigint</td><td>主键</td><td>自增</td></tr><tr><td>number</td><td>varchar(50)</td><td>订单号</td><td></td></tr><tr><td>status</td><td>int</td><td>订单状态</td><td>1待付款 2待接单 3已接单 4派送中 5已完成 6已取消</td></tr><tr><td>user_id</td><td>bigint</td><td>用户id</td><td>逻辑外键</td></tr><tr><td>address_book_id</td><td>bigint</td><td>地址id</td><td>逻辑外键</td></tr><tr><td>order_time</td><td>datetime</td><td>下单时间</td><td></td></tr><tr><td>checkout_time</td><td>datetime</td><td>付款时间</td><td></td></tr><tr><td>pay_method</td><td>int</td><td>支付方式</td><td>1微信支付 2支付宝支付</td></tr><tr><td>pay_status</td><td>tinyint</td><td>支付状态</td><td>0未支付 1已支付 2退款</td></tr><tr><td>amount</td><td>decimal(10,2)</td><td>订单金  额</td><td></td></tr><tr><td>remark</td><td>varchar(100)</td><td>备注信息</td><td></td></tr><tr><td>phone</td><td>varchar(11)</td><td>手机号</td><td>冗余字段</td></tr><tr><td>address</td><td>varchar(255)</td><td>详细地址信息</td><td>冗余字段</td></tr><tr><td>consignee</td><td>varchar(32)</td><td>收货人</td><td>冗余字段</td></tr><tr><td>cancel_reason</td><td>varchar(255)</td><td>订单取消原因</td><td></td></tr><tr><td>rejection_reason</td><td>varchar(255)</td><td>拒单原因</td><td></td></tr><tr><td>cancel_time</td><td>datetime</td><td>订单取消时间</td><td></td></tr><tr><td>estimated_delivery_time</td><td>datetime</td><td>预计送达时间</td><td></td></tr><tr><td>delivery_status</td><td>tinyint</td><td>配送状态</td><td>1立即送出 0选择具体时间</td></tr><tr><td>delivery_time</td><td>datetime</td><td>送达时间</td><td></td></tr><tr><td>pack_amount</td><td>int</td><td>打包费</td><td></td></tr><tr><td>tableware_number</td><td>int</td><td>餐具数量</td><td></td></tr><tr><td>tableware_status</td><td>tinyint</td><td>餐具数量状态</td><td>1按餐量提供 0选择具体数量</td></tr></tbody></table>
<p><strong>2). order_detail订单明细表</strong></p>

































































<table><thead><tr><th><strong>字段名</strong></th><th><strong>数据类型</strong></th><th><strong>说明</strong></th><th><strong>备注</strong></th></tr></thead><tbody><tr><td>id</td><td>bigint</td><td>主键</td><td>自增</td></tr><tr><td>name</td><td>varchar(32)</td><td>商品名称</td><td>冗余字段</td></tr><tr><td>image</td><td>varchar(255)</td><td>商品图片路径</td><td>冗余字段</td></tr><tr><td>order_id</td><td>bigint</td><td>订单id</td><td>逻辑外键</td></tr><tr><td>dish_id</td><td>bigint</td><td>菜品id</td><td>逻辑外键</td></tr><tr><td>setmeal_id</td><td>bigint</td><td>套餐id</td><td>逻辑外键</td></tr><tr><td>dish_flavor</td><td>varchar(50)</td><td>菜品口味</td><td></td></tr><tr><td>number</td><td>int</td><td>商品数量</td><td></td></tr><tr><td>amount</td><td>decimal(10,2)</td><td>商品单价</td><td></td></tr></tbody></table>
<p>**说明：**用户提交订单时，需要往订单表orders中插入一条记录，并且需要往order_detail中插入一条或多条记录。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-代码开发">2.2 代码开发<a href="#22-代码开发" class="hash-link" aria-label="Direct link to 2.2 代码开发" title="Direct link to 2.2 代码开发">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="221-dto设计">2.2.1 DTO设计<a href="#221-dto设计" class="hash-link" aria-label="Direct link to 2.2.1 DTO设计" title="Direct link to 2.2.1 DTO设计">​</a></h4>
<p><strong>根据用户下单接口的参数设计DTO：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214203913803-0bcaee65be5181935b99324e6ed7e48c.png" width="721" height="720" class="img_ev3q"></p>
<p>在sky-pojo模块，OrdersSubmitDTO.java已定义</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.dto;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.fasterxml.jackson.annotation.JsonFormat;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import lombok.Data;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.io.Serializable;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.math.BigDecimal;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.time.LocalDateTime;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public class OrdersSubmitDTO implements Serializable {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    //地址簿id</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private Long addressBookId;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    //付款方式</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private int payMethod;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    //备注</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private String remark;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    //预计送达时间</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @JsonFormat(shape = JsonFormat.Shape.STRING, pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private LocalDateTime estimatedDeliveryTime;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    //配送状态  1立即送出  0选择具体时间</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private Integer deliveryStatus;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    //餐具数量</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private Integer tablewareNumber;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    //餐具数量状态  1按餐量提供  0选择具体数量</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private Integer tablewareStatus;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    //打包费</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private Integer packAmount;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    //总金额</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private BigDecimal amount;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="222-vo设计">2.2.2 VO设计<a href="#222-vo设计" class="hash-link" aria-label="Direct link to 2.2.2 VO设计" title="Direct link to 2.2.2 VO设计">​</a></h4>
<p><strong>根据用户下单接口的返回结果设计VO：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214204113316-0c3eca34b167930f7cb5beb512820396.png" width="789" height="499" class="img_ev3q"></p>
<p>在sky-pojo模块，OrderSubmitVO.java已定义</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.vo;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import lombok.AllArgsConstructor;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import lombok.Builder;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import lombok.Data;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import lombok.NoArgsConstructor;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.io.Serializable;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.math.BigDecimal;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.time.LocalDateTime;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Builder</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@NoArgsConstructor</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@AllArgsConstructor</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public class OrderSubmitVO implements Serializable {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    //订单id</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private Long id;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    //订单号</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private String orderNumber;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    //订单金额</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private BigDecimal orderAmount;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    //下单时间</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private LocalDateTime orderTime;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="223-controller层">2.2.3 Controller层<a href="#223-controller层" class="hash-link" aria-label="Direct link to 2.2.3 Controller层" title="Direct link to 2.2.3 Controller层">​</a></h4>
<p><strong>创建OrderController并提供用户下单方法：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.controller.user;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.dto.OrdersPaymentDTO;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.dto.OrdersSubmitDTO;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.result.PageResult;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.result.Result;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.service.OrderService;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.vo.OrderPaymentVO;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.vo.OrderSubmitVO;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.vo.OrderVO;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import io.swagger.annotations.Api;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import io.swagger.annotations.ApiOperation;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import lombok.extern.slf4j.Slf4j;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.beans.factory.annotation.Autowired;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.web.bind.annotation.*;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> * 订单</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@RestController(&quot;userOrderController&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@RequestMapping(&quot;/user/order&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Api(tags = &quot;C端-订单接口&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public class OrderController {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private OrderService orderService;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 用户下单</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param ordersSubmitDTO</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @PostMapping(&quot;/submit&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;用户下单&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result&lt;OrderSubmitVO&gt; submit(@RequestBody OrdersSubmitDTO ordersSubmitDTO) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        log.info(&quot;用户下单：{}&quot;, ordersSubmitDTO);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        OrderSubmitVO orderSubmitVO = orderService.submitOrder(ordersSubmitDTO);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success(orderSubmitVO);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    } </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="224-service层接口">2.2.4 Service层接口<a href="#224-service层接口" class="hash-link" aria-label="Direct link to 2.2.4 Service层接口" title="Direct link to 2.2.4 Service层接口">​</a></h4>
<p><strong>创建OrderService接口，并声明用户下单方法：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.service;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.dto.*;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.vo.OrderSubmitVO;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public interface OrderService {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 用户下单</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param ordersSubmitDTO</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    OrderSubmitVO submitOrder(OrdersSubmitDTO ordersSubmitDTO);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="225-service层实现类">2.2.5 Service层实现类<a href="#225-service层实现类" class="hash-link" aria-label="Direct link to 2.2.5 Service层实现类" title="Direct link to 2.2.5 Service层实现类">​</a></h4>
<p><strong>创建OrderServiceImpl实现OrderService接口：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.service.impl;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> * 订单</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public class OrderServiceImpl implements OrderService {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private OrderMapper orderMapper;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private OrderDetailMapper orderDetailMapper;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private ShoppingCartMapper shoppingCartMapper;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private AddressBookMapper addressBookMapper;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 用户下单</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param ordersSubmitDTO</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Transactional</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public OrderSubmitVO submitOrder(OrdersSubmitDTO ordersSubmitDTO) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //异常情况的处理（收货地址为空、超出配送范围、购物车为空）</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        AddressBook addressBook = addressBookMapper.getById(ordersSubmitDTO.getAddressBookId());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        if (addressBook == null) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            throw new AddressBookBusinessException(MessageConstant.ADDRESS_BOOK_IS_NULL);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        Long userId = BaseContext.getCurrentId();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        ShoppingCart shoppingCart = new ShoppingCart();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        shoppingCart.setUserId(userId);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //查询当前用户的购物车数据</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        List&lt;ShoppingCart&gt; shoppingCartList = shoppingCartMapper.list(shoppingCart);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        if (shoppingCartList == null || shoppingCartList.size() == 0) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            throw new ShoppingCartBusinessException(MessageConstant.SHOPPING_CART_IS_NULL);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //构造订单数据</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        Orders order = new Orders();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        BeanUtils.copyProperties(ordersSubmitDTO,order);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        order.setPhone(addressBook.getPhone());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        order.setAddress(addressBook.getDetail());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        order.setConsignee(addressBook.getConsignee());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        order.setNumber(String.valueOf(System.currentTimeMillis()));</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        order.setUserId(userId);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        order.setStatus(Orders.PENDING_PAYMENT);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        order.setPayStatus(Orders.UN_PAID);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        order.setOrderTime(LocalDateTime.now());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //向订单表插入1条数据</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        orderMapper.insert(order);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //订单明细数据</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        List&lt;OrderDetail&gt; orderDetailList = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        for (ShoppingCart cart : shoppingCartList) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            OrderDetail orderDetail = new OrderDetail();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            BeanUtils.copyProperties(cart, orderDetail);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            orderDetail.setOrderId(order.getId());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            orderDetailList.add(orderDetail);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //向明细表插入n条数据</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        orderDetailMapper.insertBatch(orderDetailList);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //清理购物车中的数据</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        shoppingCartMapper.deleteByUserId(userId);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //封装返回结果</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        OrderSubmitVO orderSubmitVO = OrderSubmitVO.builder()</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                .id(order.getId())</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                .orderNumber(order.getNumber())</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                .orderAmount(order.getAmount())</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                .orderTime(order.getOrderTime())</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return orderSubmitVO;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="226-mapper层">2.2.6 Mapper层<a href="#226-mapper层" class="hash-link" aria-label="Direct link to 2.2.6 Mapper层" title="Direct link to 2.2.6 Mapper层">​</a></h4>
<p><strong>创建OrderMapper接口和对应的xml映射文件：</strong></p>
<p>OrderMapper.java</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.mapper;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Mapper</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public interface OrderMapper {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 插入订单数据</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param order</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    void insert(Orders order);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>OrderMapper.xml</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token prolog" style="color:hsl(230, 4%, 64%)">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token doctype punctuation" style="color:hsl(119, 34%, 47%)">&lt;!</span><span class="token doctype doctype-tag" style="color:hsl(230, 8%, 24%)">DOCTYPE</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype name" style="color:hsl(230, 8%, 24%)">mapper</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype name" style="color:hsl(230, 8%, 24%)">PUBLIC</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype string" style="color:hsl(119, 34%, 47%)">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype string" style="color:hsl(119, 34%, 47%)">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">mapper</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">namespace</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">com.sky.mapper.OrderMapper</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">insert</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">insert</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">parameterType</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">Orders</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">useGeneratedKeys</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">true</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">keyProperty</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">id</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        insert into orders</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        (number, status, user_id, address_book_id, order_time, checkout_time, pay_method, pay_status, amount, remark,</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">         phone, address, consignee, estimated_delivery_time, delivery_status, pack_amount, tableware_number,</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">         tableware_status)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        values (#{number}, #{status}, #{userId}, #{addressBookId}, #{orderTime}, #{checkoutTime}, #{payMethod},</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                #{payStatus}, #{amount}, #{remark}, #{phone}, #{address}, #{consignee},</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                #{estimatedDeliveryTime}, #{deliveryStatus}, #{packAmount}, #{tablewareNumber}, #{tablewareStatus})</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">insert</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">mapper</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>创建OrderDetailMapper接口和对应的xml映射文件：</strong></p>
<p>OrderDetailMapper.java</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.mapper;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.entity.OrderDetail;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.util.List;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Mapper</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public interface OrderDetailMapper {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 批量插入订单明细数据</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param orderDetails</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    void insertBatch(List&lt;OrderDetail&gt; orderDetails);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>OrderDetailMapper.xml</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token prolog" style="color:hsl(230, 4%, 64%)">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token doctype punctuation" style="color:hsl(119, 34%, 47%)">&lt;!</span><span class="token doctype doctype-tag" style="color:hsl(230, 8%, 24%)">DOCTYPE</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype name" style="color:hsl(230, 8%, 24%)">mapper</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype name" style="color:hsl(230, 8%, 24%)">PUBLIC</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype string" style="color:hsl(119, 34%, 47%)">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype string" style="color:hsl(119, 34%, 47%)">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">mapper</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">namespace</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">com.sky.mapper.OrderDetailMapper</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">insert</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">insertBatch</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">parameterType</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">list</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        insert into order_detail</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        (name, order_id, dish_id, setmeal_id, dish_flavor, number, amount, image)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        values</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">foreach</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">collection</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">orderDetails</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">item</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">od</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">separator</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">,</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            (#{od.name},#{od.orderId},#{od.dishId},#{od.setmealId},#{od.dishFlavor},</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">             #{od.number},#{od.amount},#{od.image})</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">foreach</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">insert</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">mapper</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-功能测试">2.3 功能测试<a href="#23-功能测试" class="hash-link" aria-label="Direct link to 2.3 功能测试" title="Direct link to 2.3 功能测试">​</a></h3>
<p>登录小程序，完成下单操作</p>
<p>下单操作时，同时会删除购物车中的数据</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214214128415-650d36964a5c981432193307d730c3d3.png" width="483" height="783" class="img_ev3q"></p>
<p><strong>查看shopping_cart表：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214214642428-5a0bc03bd10096a7ca5e91c60b6da2a1.png" width="1529" height="85" class="img_ev3q"></p>
<p><strong>去结算--&gt;去支付</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214214808218-7bbf7c291ab11ecb82c4208858b76524.png" width="476" height="750" class="img_ev3q"></p>
<p><strong>查看orders表：</strong></p>
<p><img decoding="async" loading="lazy" alt="image-20221214215116451" src="/assets/images/image-20221214215116451-a45166c7b7262361280b1a717b0f8082.png" width="1856" height="58" class="img_ev3q"></p>
<p><strong>查看order_detail表：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214215250553-65731fc10ad88042d5e9a42ed7bb0d51.png" width="1742" height="82" class="img_ev3q"></p>
<p><strong>同时，购物车表中数据删除：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214215428516-e5a4e3cf11f2eb8e8809da3abb923d10.png" width="1209" height="56" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="24-代码提交">2.4 代码提交<a href="#24-代码提交" class="hash-link" aria-label="Direct link to 2.4 代码提交" title="Direct link to 2.4 代码提交">​</a></h3>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214215650664-5720855d857339a084f3ad0c8bad876d.png" width="1075" height="1001" class="img_ev3q"></p>
<p>后续步骤和其它功能代码提交一致，不再赘述。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-订单支付">3. 订单支付<a href="#3-订单支付" class="hash-link" aria-label="Direct link to 3. 订单支付" title="Direct link to 3. 订单支付">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-微信支付介绍">3.1 微信支付介绍<a href="#31-微信支付介绍" class="hash-link" aria-label="Direct link to 3.1 微信支付介绍" title="Direct link to 3.1 微信支付介绍">​</a></h3>
<p>前面的课程已经实现了用户下单，那接下来就是订单支付，就是完成付款功能。支付大家应该都不陌生了，在现实生活中经常购买商品并且使用支付功能来付款，在付款的时候可能使用比较多的就是微信支付和支付宝支付了。在苍穹外卖项目中，选择的就是<strong>微信支付</strong>这种支付方式。</p>
<p>要实现微信支付就需要注册微信支付的一个商户号，这个商户号是必须要有一家企业并且有正规的营业执照。只有具备了这些资质之后，才可以去注册商户号，才能开通支付权限。</p>
<p>个人不具备这种资质，所以我们在学习微信支付时，最重要的是了解微信支付的流程，并且能够阅读微信官方提供的接口文档，能够和第三方支付平台对接起来就可以了。</p>
<p><strong>微信支付产品：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214223302651-849d75f15c524593faeb53629324855e.png" width="1064" height="517" class="img_ev3q"></p>
<p>本项目选择<strong>小程序支付</strong></p>
<p>参考：<a href="https://pay.weixin.qq.com/static/product/product_index.shtml" target="_blank" rel="noopener noreferrer">https://pay.weixin.qq.com/static/product/product_index.shtml</a></p>
<p><strong>微信支付接入流程：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214223509246-37b145f6847716e18b8fbd1a2bbdafb4.png" width="1368" height="462" class="img_ev3q"></p>
<p><strong>微信小程序支付时序图：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214223910840-0eaed8055cc2312e432411947fc4eeeb.png" width="771" height="764" class="img_ev3q"></p>
<p><strong>微信支付相关接口：</strong></p>
<p>**JSAPI下单：**商户系统调用该接口在微信支付服务后台生成预支付交易单(对应时序图的第5步)</p>
<p><img decoding="async" loading="lazy" alt="image-20221214224409174" src="/assets/images/image-20221214224409174-07f495da3223b3344ab7a004bf60681f.png" width="1748" height="620" class="img_ev3q"></p>
<p>**微信小程序调起支付：**通过JSAPI下单接口获取到发起支付的必要参数prepay_id，然后使用微信支付提供的小程序方法调起小程序支付(对应时序图的第10步)</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221214224551220-9262e856d8dbdb46691e185246db0373.png" width="1612" height="661" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-微信支付准备工作">3.2 微信支付准备工作<a href="#32-微信支付准备工作" class="hash-link" aria-label="Direct link to 3.2 微信支付准备工作" title="Direct link to 3.2 微信支付准备工作">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="321-如何保证数据安全">3.2.1 如何保证数据安全？<a href="#321-如何保证数据安全" class="hash-link" aria-label="Direct link to 3.2.1 如何保证数据安全？" title="Direct link to 3.2.1 如何保证数据安全？">​</a></h4>
<p>完成微信支付有两个关键的步骤：</p>
<p><strong>第一个</strong>就是需要在商户系统当中调用微信后台的一个下单接口，就是生成预支付交易单。</p>
<p><strong>第二个</strong>就是支付成功之后微信后台会给推送消息。</p>
<p>这两个接口数据的安全性，要求其实是非常高的。</p>
<p>**解决：**微信提供的方式就是对数据进行加密、解密、签名多种方式。要完成数据加密解密，需要提前准备相应的一些文件，其实就是一些证书。</p>
<p><strong>获取微信支付平台证书、商户私钥文件：</strong></p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="747" height="96" class="img_ev3q"></p>
<p>在后绪程序开发过程中，就会使用到这两个文件，需要提前把这两个文件准备好。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="322-如何调用到商户系统">3.2.2 如何调用到商户系统？<a href="#322-如何调用到商户系统" class="hash-link" aria-label="Direct link to 3.2.2 如何调用到商户系统？" title="Direct link to 3.2.2 如何调用到商户系统？">​</a></h4>
<p>微信后台会调用到商户系统给推送支付的结果，在这里我们就会遇到一个问题，就是微信后台怎么就能调用到我们这个商户系统呢？因为这个调用过程，其实本质上也是一个HTTP请求。</p>
<p>目前，商户系统它的ip地址就是当前自己电脑的ip地址，只是一个局域网内的ip地址，微信后台无法调用到。</p>
<p><strong>解决：<strong>内网穿透。通过</strong>cpolar软件</strong>可以获得一个临时域名，而这个临时域名是一个公网ip，这样，微信后台就可以请求到商户系统了。</p>
<p><strong>cpolar软件的使用：</strong></p>
<p><strong>1). 下载与安装</strong></p>
<p>下载地址：<a href="https://dashboard.cpolar.com/get-started" target="_blank" rel="noopener noreferrer">https://dashboard.cpolar.com/get-started</a></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221215184407217-6edbdd8748df8e90b2b13f53ca4e084c.png" width="536" height="383" class="img_ev3q"></p>
<p>在资料中已提供，可无需下载。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="1030" height="81" class="img_ev3q"></p>
<p>安装过程中，一直下一步即可，不再演示。</p>
<p><strong>2). cpolar指定authtoken</strong></p>
<p>复制authtoken：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221215184746092-f7c0ff47b2aa64ca2ea75ea2993a8ed1.png" width="1706" height="629" class="img_ev3q"></p>
<p>执行命令：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221215185152869-4ca22973629c215c80ee51822d6fbd48.png" width="1159" height="529" class="img_ev3q"></p>
<p><strong>3). 获取临时域名</strong></p>
<p>执行命令：</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="534" height="158" class="img_ev3q"></p>
<p>获取域名：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221215185833157-9080935b5532444706668039edc2f636.png" width="988" height="284" class="img_ev3q"></p>
<p><strong>4). 验证临时域名有效性</strong></p>
<p><strong>访问接口文档</strong></p>
<p>使用localhost:8080访问</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221215190440717-d2e43daa2142bae05103290ac7e711c0.png" width="1767" height="960" class="img_ev3q"></p>
<p>使用临时域名访问</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221215190525166-e16724be6e02d644ee3e9d3157392d82.png" width="1777" height="957" class="img_ev3q"></p>
<p>证明临时域名生效。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-代码导入">3.3 代码导入<a href="#33-代码导入" class="hash-link" aria-label="Direct link to 3.3 代码导入" title="Direct link to 3.3 代码导入">​</a></h3>
<p>导入资料中的微信支付功能代码即可</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221215192120424-3fe1553ba47f7cbdc7040481a1659798.png" width="441" height="310" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="331-微信支付相关配置">3.3.1 微信支付相关配置<a href="#331-微信支付相关配置" class="hash-link" aria-label="Direct link to 3.3.1 微信支付相关配置" title="Direct link to 3.3.1 微信支付相关配置">​</a></h4>
<p>application-dev.yml</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key atrule" style="color:hsl(35, 99%, 36%)">sky</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">wechat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">appid</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> wxcd2e39f677fd30ba</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">secret</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> 84fbfdf5ea288f0c432d829599083637</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">mchid</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1561414331</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">mchSerialNo</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> 4B3B3DC35414AD50B1B755BAF8DE9CC7CF407606</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">privateKeyFilePath</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> D</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">\apiclient_key.pem</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">apiV3Key</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> CZBK51236435wxpay435434323FFDuv3</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">weChatPayCertFilePath</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> D</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">\wechatpay_166D96F876F45C7D07CE98952A96EC980368ACFC.pem</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">notifyUrl</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">//www.weixin.qq.com/wxpay/pay.php</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">refundNotifyUrl</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">//www.weixin.qq.com/wxpay/pay.php</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>application.yml</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key atrule" style="color:hsl(35, 99%, 36%)">sky</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">wechat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">appid</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain">sky.wechat.appid</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">secret</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain">sky.wechat.secret</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">mchid</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain">sky.wechat.mchid</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">mchSerialNo</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain">sky.wechat.mchSerialNo</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">privateKeyFilePath</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain">sky.wechat.privateKeyFilePath</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">apiV3Key</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain">sky.wechat.apiV3Key</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">weChatPayCertFilePath</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain">sky.wechat.weChatPayCertFilePath</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">notifyUrl</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain">sky.wechat.notifyUrl</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">refundNotifyUrl</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain">sky.wechat.refundNotifyUrl</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>WeChatProperties.java：读取配置(已定义)</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.properties;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import lombok.Data;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.beans.factory.annotation.Value;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.boot.context.properties.ConfigurationProperties;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@ConfigurationProperties(prefix = &quot;sky.wechat&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public class WeChatProperties {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private String appid; //小程序的appid</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private String secret; //小程序的秘钥</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private String mchid; //商户号</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private String mchSerialNo; //商户API证书的证书序列号</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private String privateKeyFilePath; //商户私钥文件</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private String apiV3Key; //证书解密的密钥</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private String weChatPayCertFilePath; //平台证书</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private String notifyUrl; //支付成功的回调地址</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private String refundNotifyUrl; //退款成功的回调地址</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="332-mapper层">3.3.2 Mapper层<a href="#332-mapper层" class="hash-link" aria-label="Direct link to 3.3.2 Mapper层" title="Direct link to 3.3.2 Mapper层">​</a></h4>
<p><strong>在OrderMapper.java中添加getByNumberAndUserId和update两个方法</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 根据订单号和用户id查询订单</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param orderNumber</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param userId</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Select(&quot;select * from orders where number = #{orderNumber} and user_id= #{userId}&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    Orders getByNumberAndUserId(String orderNumber, Long userId);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 修改订单信息</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param orders</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    void update(Orders orders);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>在OrderMapper.xml中添加</strong></p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">update</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">update</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">parameterType</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">com.sky.entity.Orders</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        update orders</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">set</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">cancelReason != null and cancelReason!=&#x27;&#x27; </span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                cancel_reason=#{cancelReason},</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">rejectionReason != null and rejectionReason!=&#x27;&#x27; </span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                rejection_reason=#{rejectionReason},</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">cancelTime != null</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                cancel_time=#{cancelTime},</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">payStatus != null</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                pay_status=#{payStatus},</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">payMethod != null</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                pay_method=#{payMethod},</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">checkoutTime != null</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                checkout_time=#{checkoutTime},</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">status != null</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                status = #{status},</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">deliveryTime != null</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                delivery_time = #{deliveryTime}</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">set</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        where id = #{id}</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">update</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="333-service层">3.3.3 Service层<a href="#333-service层" class="hash-link" aria-label="Direct link to 3.3.3 Service层" title="Direct link to 3.3.3 Service层">​</a></h4>
<p><strong>在OrderService.java中添加payment和paySuccess两个方法定义</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 订单支付</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param ordersPaymentDTO</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    OrderPaymentVO payment(OrdersPaymentDTO ordersPaymentDTO) throws Exception;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 支付成功，修改订单状态</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param outTradeNo</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    void paySuccess(String outTradeNo);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>在OrderServiceImpl.java中实现payment和paySuccess两个方法</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 	@Autowired</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private UserMapper userMapper;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	@Autowired</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private WeChatPayUtil weChatPayUtil;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 订单支付</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param ordersPaymentDTO</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public OrderPaymentVO payment(OrdersPaymentDTO ordersPaymentDTO) throws Exception {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // 当前登录用户id</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        Long userId = BaseContext.getCurrentId();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        User user = userMapper.getById(userId);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //调用微信支付接口，生成预支付交易单</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        JSONObject jsonObject = weChatPayUtil.pay(</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                ordersPaymentDTO.getOrderNumber(), //商户订单号</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                new BigDecimal(0.01), //支付金额，单位 元</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                &quot;苍穹外卖订单&quot;, //商品描述</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                user.getOpenid() //微信用户的openid</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        );</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        if (jsonObject.getString(&quot;code&quot;) != null &amp;&amp; jsonObject.getString(&quot;code&quot;).equals(&quot;ORDERPAID&quot;)) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            throw new OrderBusinessException(&quot;该订单已支付&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        OrderPaymentVO vo = jsonObject.toJavaObject(OrderPaymentVO.class);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        vo.setPackageStr(jsonObject.getString(&quot;package&quot;));</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return vo;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 支付成功，修改订单状态</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param outTradeNo</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void paySuccess(String outTradeNo) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // 当前登录用户id</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        Long userId = BaseContext.getCurrentId();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // 根据订单号查询当前用户的订单</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        Orders ordersDB = orderMapper.getByNumberAndUserId(outTradeNo, userId);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // 根据订单id更新订单的状态、支付方式、支付状态、结账时间</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        Orders orders = Orders.builder()</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                .id(ordersDB.getId())</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                .status(Orders.TO_BE_CONFIRMED)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                .payStatus(Orders.PAID)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                .checkoutTime(LocalDateTime.now())</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        orderMapper.update(orders);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="334-controller层">3.3.4 Controller层<a href="#334-controller层" class="hash-link" aria-label="Direct link to 3.3.4 Controller层" title="Direct link to 3.3.4 Controller层">​</a></h4>
<p><strong>在OrderController.java中添加payment方法</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> 	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 订单支付</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param ordersPaymentDTO</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @PutMapping(&quot;/payment&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;订单支付&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result&lt;OrderPaymentVO&gt; payment(@RequestBody OrdersPaymentDTO ordersPaymentDTO) throws Exception {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        log.info(&quot;订单支付：{}&quot;, ordersPaymentDTO);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        OrderPaymentVO orderPaymentVO = orderService.payment(ordersPaymentDTO);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        log.info(&quot;生成预支付交易单：{}&quot;, orderPaymentVO);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success(orderPaymentVO);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>PayNotifyController.java</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.controller.notify;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.alibaba.druid.support.json.JSONUtils;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.alibaba.fastjson.JSON;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.alibaba.fastjson.JSONObject;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.annotation.IgnoreToken;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.properties.WeChatProperties;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.service.OrderService;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.wechat.pay.contrib.apache.httpclient.util.AesUtil;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import lombok.extern.slf4j.Slf4j;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.apache.http.entity.ContentType;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.beans.factory.annotation.Autowired;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.web.bind.annotation.RequestMapping;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.web.bind.annotation.RestController;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import javax.servlet.http.HttpServletRequest;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import javax.servlet.http.HttpServletResponse;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.io.BufferedReader;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.nio.charset.StandardCharsets;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.util.HashMap;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> * 支付回调相关接口</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@RequestMapping(&quot;/notify&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public class PayNotifyController {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private OrderService orderService;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private WeChatProperties weChatProperties;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 支付成功回调</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param request</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @RequestMapping(&quot;/paySuccess&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void paySuccessNotify(HttpServletRequest request, HttpServletResponse response) throws Exception {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //读取数据</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        String body = readData(request);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        log.info(&quot;支付成功回调：{}&quot;, body);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //数据解密</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        String plainText = decryptData(body);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        log.info(&quot;解密后的文本：{}&quot;, plainText);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        JSONObject jsonObject = JSON.parseObject(plainText);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        String outTradeNo = jsonObject.getString(&quot;out_trade_no&quot;);//商户平台订单号</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        String transactionId = jsonObject.getString(&quot;transaction_id&quot;);//微信支付交易号</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        log.info(&quot;商户平台订单号：{}&quot;, outTradeNo);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        log.info(&quot;微信支付交易号：{}&quot;, transactionId);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //业务处理，修改订单状态、来单提醒</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        orderService.paySuccess(outTradeNo);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //给微信响应</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        responseToWeixin(response);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 读取数据</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param request</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @throws Exception</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private String readData(HttpServletRequest request) throws Exception {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        BufferedReader reader = request.getReader();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        StringBuilder result = new StringBuilder();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        String line = null;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        while ((line = reader.readLine()) != null) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            if (result.length() &gt; 0) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                result.append(&quot;\n&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            result.append(line);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return result.toString();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 数据解密</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param body</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @throws Exception</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private String decryptData(String body) throws Exception {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        JSONObject resultObject = JSON.parseObject(body);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        JSONObject resource = resultObject.getJSONObject(&quot;resource&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        String ciphertext = resource.getString(&quot;ciphertext&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        String nonce = resource.getString(&quot;nonce&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        String associatedData = resource.getString(&quot;associated_data&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        AesUtil aesUtil = new AesUtil(weChatProperties.getApiV3Key().getBytes(StandardCharsets.UTF_8));</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //密文解密</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        String plainText = aesUtil.decryptToString(associatedData.getBytes(StandardCharsets.UTF_8),</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                nonce.getBytes(StandardCharsets.UTF_8),</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                ciphertext);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return plainText;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 给微信响应</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param response</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private void responseToWeixin(HttpServletResponse response) throws Exception{</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        response.setStatus(200);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        HashMap&lt;Object, Object&gt; map = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        map.put(&quot;code&quot;, &quot;SUCCESS&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        map.put(&quot;message&quot;, &quot;SUCCESS&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        response.setHeader(&quot;Content-type&quot;, ContentType.APPLICATION_JSON.toString());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        response.getOutputStream().write(JSONUtils.toJSONString(map).getBytes(StandardCharsets.UTF_8));</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        response.flushBuffer();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="34-功能测试">3.4 功能测试<a href="#34-功能测试" class="hash-link" aria-label="Direct link to 3.4 功能测试" title="Direct link to 3.4 功能测试">​</a></h3>
<p>测试过程中，可通过断点方式查看后台每一步执行情况。</p>
<p><strong>下单：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221215205122716-7ad43228f64ee1a4f3967b902bbc06a8.png" width="278" height="471" class="img_ev3q"></p>
<p><strong>去支付：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221215205308701-73ca88c1bcb83b20698cfee6f53090cc.png" width="276" height="467" class="img_ev3q"></p>
<p><strong>确认支付：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221215205434552-1bfb548cd1389548feabb09f3857d9b6.png" width="279" height="480" class="img_ev3q"></p>
<p>进行扫码支付即可。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="35-代码提交">3.5 代码提交<a href="#35-代码提交" class="hash-link" aria-label="Direct link to 3.5 代码提交" title="Direct link to 3.5 代码提交">​</a></h3>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221215205746248-c10e732590f5ef18689700f2ec35467f.png" width="1072" height="1003" class="img_ev3q"></p>
<p>后续步骤和其它功能代码提交一致，不再赘述。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#课程内容" class="table-of-contents__link toc-highlight">课程内容</a></li><li><a href="#1-导入地址簿功能代码" class="table-of-contents__link toc-highlight">1. 导入地址簿功能代码</a><ul><li><a href="#11-需求分析和设计" class="table-of-contents__link toc-highlight">1.1 需求分析和设计</a></li><li><a href="#12-代码导入" class="table-of-contents__link toc-highlight">1.2 代码导入</a></li><li><a href="#13-功能测试" class="table-of-contents__link toc-highlight">1.3 功能测试</a></li><li><a href="#14-代码提交" class="table-of-contents__link toc-highlight">1.4 代码提交</a></li></ul></li><li><a href="#2-用户下单" class="table-of-contents__link toc-highlight">2. 用户下单</a><ul><li><a href="#21-需求分析和设计" class="table-of-contents__link toc-highlight">2.1 需求分析和设计</a></li><li><a href="#22-代码开发" class="table-of-contents__link toc-highlight">2.2 代码开发</a></li><li><a href="#23-功能测试" class="table-of-contents__link toc-highlight">2.3 功能测试</a></li><li><a href="#24-代码提交" class="table-of-contents__link toc-highlight">2.4 代码提交</a></li></ul></li><li><a href="#3-订单支付" class="table-of-contents__link toc-highlight">3. 订单支付</a><ul><li><a href="#31-微信支付介绍" class="table-of-contents__link toc-highlight">3.1 微信支付介绍</a></li><li><a href="#32-微信支付准备工作" class="table-of-contents__link toc-highlight">3.2 微信支付准备工作</a></li><li><a href="#33-代码导入" class="table-of-contents__link toc-highlight">3.3 代码导入</a></li><li><a href="#34-功能测试" class="table-of-contents__link toc-highlight">3.4 功能测试</a></li><li><a href="#35-代码提交" class="table-of-contents__link toc-highlight">3.5 代码提交</a></li></ul></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>