<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-码农/苍穹外卖/苍穹外卖-day10" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">苍穹外卖-day10 | Coisini</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://doc.minddiy.top/码农/苍穹外卖/苍穹外卖-day10/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="苍穹外卖-day10 | Coisini"><meta data-rh="true" name="description" content="课程内容"><meta data-rh="true" property="og:description" content="课程内容"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://doc.minddiy.top/码农/苍穹外卖/苍穹外卖-day10/"><link data-rh="true" rel="alternate" href="https://doc.minddiy.top/码农/苍穹外卖/苍穹外卖-day10/" hreflang="en"><link data-rh="true" rel="alternate" href="https://doc.minddiy.top/码农/苍穹外卖/苍穹外卖-day10/" hreflang="x-default"><meta name="google-site-verification" content="1FUPX6Qo4y3ecU623ShEurhgnjhSTjK49rRMhEDlzFA">
<link rel="stylesheet" href="/katex/katex.min.css">
<script src="/js/matomo.js" async defer="defer"></script><link rel="stylesheet" href="/assets/css/styles.79037026.css">
<script src="/assets/js/runtime~main.468f2b27.js" defer="defer"></script>
<script src="/assets/js/main.4763ab3e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Coisini</b></a></div><div class="navbar__items navbar__items--right"><a href="https://minddiy.top" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Main site<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>苍穹外卖-day10</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="课程内容">课程内容<a href="#课程内容" class="hash-link" aria-label="Direct link to 课程内容" title="Direct link to 课程内容">​</a></h2>
<ul>
<li>Spring Task</li>
<li>订单状态定时处理</li>
<li>WebSocket</li>
<li>来单提醒</li>
<li>客户催单</li>
</ul>
<p>功能实现：<strong>订单状态定时处理</strong>、<strong>来单提醒</strong>和<strong>客户催单</strong></p>
<p><strong>订单状态定时处理：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221218204021760-86bcac7d550c9807a037dc8cf135bd66.png" width="1691" height="747" class="img_ev3q"></p>
<p><strong>来单提醒：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221218204119663-52a77200df33ab3ed0aeacc4059393ba.png" width="1506" height="818" class="img_ev3q"></p>
<p><strong>客户催单：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221218204202847-c3cab91cc8a7224e77600d46a0a24ace.png" width="1498" height="811" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-spring-task">1. Spring Task<a href="#1-spring-task" class="hash-link" aria-label="Direct link to 1. Spring Task" title="Direct link to 1. Spring Task">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-介绍">1.1 介绍<a href="#11-介绍" class="hash-link" aria-label="Direct link to 1.1 介绍" title="Direct link to 1.1 介绍">​</a></h3>
<p><strong>Spring Task</strong> 是Spring框架提供的任务调度工具，可以按照约定的时间自动执行某个代码逻辑。</p>
<p>**定位：**定时任务框架</p>
<p>**作用：**定时自动执行某段Java代码</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221218183054818-2508d6cb11225449fa5b6fb722519b57.png" width="134" height="226" class="img_ev3q"></p>
<p><strong>应用场景：</strong></p>
<p>1). 信用卡每月还款提醒</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221218183213088-076812522dd22984526d268e55944150.png" width="425" height="291" class="img_ev3q"></p>
<p>2). 银行贷款每月还款提醒</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221218183410430-92de540461297517f959c905698ba216.png" width="455" height="440" class="img_ev3q"></p>
<p>3). 火车票售票系统处理未支付订单</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221218183614351-94bad7e3b7db822733f8d09234530867.png" width="446" height="755" class="img_ev3q"></p>
<p>4). 入职纪念日为用户发送通知</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221218183655186-11cbe2757bc4465a8a7bf2ad0bed45b7.png" width="645" height="770" class="img_ev3q"></p>
<p>**强调：**只要是需要定时处理的场景都可以使用Spring Task</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-cron表达式">1.2 cron表达式<a href="#12-cron表达式" class="hash-link" aria-label="Direct link to 1.2 cron表达式" title="Direct link to 1.2 cron表达式">​</a></h3>
<p><strong>cron表达式</strong>其实就是一个字符串，通过cron表达式可以<strong>定义任务触发的时间</strong></p>
<p>**构成规则：**分为6或7个域，由空格分隔开，每个域代表一个含义</p>
<p>每个域的含义分别为：秒、分钟、小时、日、月、周、年(可选)</p>
<p><strong>举例：</strong></p>
<p>2022年10月12日上午9点整 对应的cron表达式为：<strong>0 0 9 12 10 ? 2022</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221218184412491-441bf2bcdfde3c7a905c08f3bb92d9d6.png" width="1055" height="134" class="img_ev3q"></p>
<p><strong>说明：<strong>一般</strong>日</strong>和<strong>周</strong>的值不同时设置，其中一个设置，另一个用？表示。</p>
<p>**比如：**描述2月份的最后一天，最后一天具体是几号呢？可能是28号，也有可能是29号，所以就不能写具体数字。</p>
<p>为了描述这些信息，提供一些特殊的字符。这些具体的细节，我们就不用自己去手写，因为这个cron表达式，它其实有在线生成器。</p>
<p>cron表达式在线生成器：<a href="https://cron.qqe2.com/" target="_blank" rel="noopener noreferrer">https://cron.qqe2.com/</a></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221218184959888-c52e964e46a2ccb8e75abc7d15efea7b.png" width="1451" height="653" class="img_ev3q"></p>
<p>可以直接在这个网站上面，只要根据自己的要求去生成corn表达式即可。所以一般就不用自己去编写这个表达式。</p>
<p><strong>通配符：</strong></p>
<p>* 表示所有值；</p>
<p>? 表示未说明的值，即不关心它为何值；</p>
<p>- 表示一个指定的范围；</p>
<p>, 表示附加一个可能值；</p>
<p>/ 符号前表示开始时间，符号后表示每次递增的值；</p>
<p><strong>cron表达式案例：</strong></p>
<p>*/5 * * * * ? 每隔5秒执行一次</p>
<p>0 */1 * * * ? 每隔1分钟执行一次</p>
<p>0 0 5-15 * * ? 每天5-15点整点触发</p>
<p>0 0/3 * * * ? 每三分钟触发一次</p>
<p>0 0-5 14 * * ? 在每天下午2点到下午2:05期间的每1分钟触发</p>
<p>0 0/5 14 * * ? 在每天下午2点到下午2:55期间的每5分钟触发</p>
<p>0 0/5 14,18 * * ? 在每天下午2点到2:55期间和下午6点到6:55期间的每5分钟触发</p>
<p>0 0/30 9-17 * * ? 朝九晚五工作时间内每半小时</p>
<p>0 0 10,14,16 * * ? 每天上午10点，下午2点，4点</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-入门案例">1.3 入门案例<a href="#13-入门案例" class="hash-link" aria-label="Direct link to 1.3 入门案例" title="Direct link to 1.3 入门案例">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="131-spring-task使用步骤">1.3.1 Spring Task使用步骤<a href="#131-spring-task使用步骤" class="hash-link" aria-label="Direct link to 1.3.1 Spring Task使用步骤" title="Direct link to 1.3.1 Spring Task使用步骤">​</a></h4>
<p>1). 导入maven坐标 spring-context（已存在）</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221218193251182-0784b68a5eeced5814eb060b35b38a56.png" width="692" height="392" class="img_ev3q"></p>
<p>2). 启动类添加注解 @EnableScheduling 开启任务调度</p>
<p>3). 自定义定时任务类</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="132-代码开发">1.3.2 代码开发<a href="#132-代码开发" class="hash-link" aria-label="Direct link to 1.3.2 代码开发" title="Direct link to 1.3.2 代码开发">​</a></h4>
<p><strong>编写定时任务类：</strong></p>
<p>进入sky-server模块中</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.task;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import lombok.extern.slf4j.Slf4j;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.scheduling.annotation.Scheduled;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.util.Date;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> * 自定义定时任务类</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public class MyTask {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 定时任务 每隔5秒触发一次</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Scheduled(cron = &quot;0/5 * * * * ?&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void executeTask(){</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        log.info(&quot;定时任务开始执行：{}&quot;,new Date());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>开启任务调度：</strong></p>
<p>启动类添加注解 @EnableScheduling</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import lombok.extern.slf4j.Slf4j;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.boot.SpringApplication;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.cache.annotation.EnableCaching;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.scheduling.annotation.EnableScheduling;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.transaction.annotation.EnableTransactionManagement;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@EnableTransactionManagement //开启注解方式的事务管理</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@EnableCaching</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@EnableScheduling</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public class SkyApplication {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        SpringApplication.run(SkyApplication.class, args);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        log.info(&quot;server started&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="133-功能测试">1.3.3 功能测试<a href="#133-功能测试" class="hash-link" aria-label="Direct link to 1.3.3 功能测试" title="Direct link to 1.3.3 功能测试">​</a></h4>
<p>启动服务，查看日志</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221218194511420-beeb18dc45d58ca5bb3b10410a304443.png" width="1346" height="124" class="img_ev3q"></p>
<p>每隔5秒执行一次。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2订单状态定时处理">2.订单状态定时处理<a href="#2订单状态定时处理" class="hash-link" aria-label="Direct link to 2.订单状态定时处理" title="Direct link to 2.订单状态定时处理">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-需求分析">2.1 需求分析<a href="#21-需求分析" class="hash-link" aria-label="Direct link to 2.1 需求分析" title="Direct link to 2.1 需求分析">​</a></h3>
<p>用户下单后可能存在的情况：</p>
<ul>
<li>下单后未支付，订单一直处于**“待支付”**状态</li>
<li>用户收货后管理端未点击完成按钮，订单一直处于**“派送中”**状态</li>
</ul>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221218194939516-e488663b20554f31de075084a1019dab.png" width="328" height="663" class="img_ev3q"></p>
<p>支付超时的订单如何处理？                                                       派送中的订单一直不点击完成如何处理？</p>
<p>对于上面两种情况需要通过<strong>定时任务</strong>来修改订单状态，具体逻辑为：</p>
<ul>
<li>通过定时任务每分钟检查一次是否存在支付超时订单（下单后超过15分钟仍未支付则判定为支付超时订单），如果存在则修改订单状态为“已取消”</li>
<li>通过定时任务每天凌晨1点检查一次是否存在“派送中”的订单，如果存在则修改订单状态为“已完成”</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-代码开发">2.2 代码开发<a href="#22-代码开发" class="hash-link" aria-label="Direct link to 2.2 代码开发" title="Direct link to 2.2 代码开发">​</a></h3>
<p><strong>1). 自定义定时任务类OrderTask（待完善）：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.task;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> * 自定义定时任务，实现订单状态定时处理</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public class OrderTask {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private OrderMapper orderMapper;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 处理支付超时订单</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Scheduled(cron = &quot;0 * * * * ?&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void processTimeoutOrder(){</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        log.info(&quot;处理支付超时订单：{}&quot;, new Date());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 处理“派送中”状态的订单</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Scheduled(cron = &quot;0 0 1 * * ?&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void processDeliveryOrder(){</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        log.info(&quot;处理派送中订单：{}&quot;, new Date());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>2). 在OrderMapper接口中扩展方法:</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 根据状态和下单时间查询订单</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param status</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param orderTime</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Select(&quot;select * from orders where status = #{status} and order_time &lt; #{orderTime}&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    List&lt;Orders&gt; getByStatusAndOrdertimeLT(Integer status, LocalDateTime orderTime);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>3). 完善定时任务类的processTimeoutOrder方法：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 处理支付超时订单</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Scheduled(cron = &quot;0 * * * * ?&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void processTimeoutOrder(){</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        log.info(&quot;处理支付超时订单：{}&quot;, new Date());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        LocalDateTime time = LocalDateTime.now().plusMinutes(-15);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // select * from orders where status = 1 and order_time &lt; 当前时间-15分钟</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        List&lt;Orders&gt; ordersList = orderMapper.getByStatusAndOrdertimeLT(Orders.PENDING_PAYMENT, time);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        if(ordersList != null &amp;&amp; ordersList.size() &gt; 0){</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            ordersList.forEach(order -&gt; {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                order.setStatus(Orders.CANCELLED);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                order.setCancelReason(&quot;支付超时，自动取消&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                order.setCancelTime(LocalDateTime.now());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                orderMapper.update(order);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            });</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>4). 完善定时任务类的processDeliveryOrder方法：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 处理“派送中”状态的订单</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Scheduled(cron = &quot;0 0 1 * * ?&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void processDeliveryOrder(){</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        log.info(&quot;处理派送中订单：{}&quot;, new Date());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // select * from orders where status = 4 and order_time &lt; 当前时间-1小时</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        LocalDateTime time = LocalDateTime.now().plusMinutes(-60);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        List&lt;Orders&gt; ordersList = orderMapper.getByStatusAndOrdertimeLT(Orders.DELIVERY_IN_PROGRESS, time);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        if(ordersList != null &amp;&amp; ordersList.size() &gt; 0){</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            ordersList.forEach(order -&gt; {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                order.setStatus(Orders.COMPLETED);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                orderMapper.update(order);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            });</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-功能测试">2.3 功能测试<a href="#23-功能测试" class="hash-link" aria-label="Direct link to 2.3 功能测试" title="Direct link to 2.3 功能测试">​</a></h3>
<p>可以通过如下方式进行测试：</p>
<ul>
<li>查看控制台sql</li>
<li>查看数据库中数据变化</li>
</ul>
<p><strong>支付超时的订单测试：</strong></p>
<p><strong>1). 查看订单表</strong></p>
<p>有一条订单，状态为1。订单状态 1待付款 2待接单 3已接单 4派送中 5已完成 6已取消</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221218202334773-bd3782f061ec79d176d49973bcb3cc17.png" width="1596" height="83" class="img_ev3q"></p>
<p><strong>2). 开启定时任务</strong></p>
<p>启动服务，观察控制台日志。处理支付超时订单任务每隔1分钟执行一次。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221218203045089-809e5e4c0704010d9be54efbd0b25b86.png" width="1705" height="209" class="img_ev3q"></p>
<p><strong>3). 再次查看订单表</strong></p>
<p>状态已更改为6，已取消。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221218203146535-9a4b4513006b87d5aba9940c8f3ea503.png" width="1595" height="79" class="img_ev3q"></p>
<p>证明定时任务已生效。</p>
<p><strong>处理“派送中”状态的订单任务</strong>测试自已完成，测试步骤和上述一致。可适当修改cron表达式，改变任务执行频率，方便测试。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-websocket">3. WebSocket<a href="#3-websocket" class="hash-link" aria-label="Direct link to 3. WebSocket" title="Direct link to 3. WebSocket">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-介绍">3.1 介绍<a href="#31-介绍" class="hash-link" aria-label="Direct link to 3.1 介绍" title="Direct link to 3.1 介绍">​</a></h3>
<p>WebSocket 是基于 TCP 的一种新的<strong>网络协议</strong>。它实现了浏览器与服务器全双工通信——浏览器和服务器只需要完成一次握手，两  者之间就可以创建<strong>持久性</strong>的连接， 并进行<strong>双向</strong>数据传输。</p>
<p><strong>HTTP协议和WebSocket协议对比：</strong></p>
<ul>
<li>HTTP是<strong>短连接</strong></li>
<li>WebSocket是<strong>长连接</strong></li>
<li>HTTP通信是<strong>单向</strong>的，基于请求响应模式</li>
<li>WebSocket支持<strong>双向</strong>通信</li>
<li>HTTP和WebSocket底层都是TCP连接</li>
</ul>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222184340172-a951000796d71e173d873d1d5b629cd4.png" width="348" height="597" class="img_ev3q"></p>
<p>**思考：**既然WebSocket支持双向通信，功能看似比HTTP强大，那么我们是不是可以基于WebSocket开发所有的业务功能？</p>
<p><strong>WebSocket缺点：</strong></p>
<p>服务器长期维护长连接需要一定的成本
各个浏览器支持程度不一
WebSocket 是长连接，受网络限制比较大，需要处理好重连</p>
<p>**结论：**WebSocket并不能完全取代HTTP，它只适合在特定的场景下使用</p>
<p><strong>WebSocket应用场景：</strong></p>
<p>1). 视频弹幕</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222184616570-21d5700d1358c57324d676cbf5a42940.png" width="954" height="533" class="img_ev3q"></p>
<p>2). 网页聊天</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222184641675-65e501e009cf43f09475551af98ccc3e.png" width="1115" height="533" class="img_ev3q"></p>
<p>3). 体育实况更新</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222184714092-4d8eca227c689d750b5709f10a8643de.png" width="1123" height="711" class="img_ev3q"></p>
<p>4). 股票基金报价实时更新</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222184742094-1982f6514865381cf08493d63bf43745.png" width="1362" height="716" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-入门案例">3.2 入门案例<a href="#32-入门 案例" class="hash-link" aria-label="Direct link to 3.2 入门案例" title="Direct link to 3.2 入门案例">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="321-案例分析">3.2.1 案例分析<a href="#321-案例分析" class="hash-link" aria-label="Direct link to 3.2.1 案例分析" title="Direct link to 3.2.1 案例分析">​</a></h4>
<p>**需求：**实现浏览器与服务器全双工通信。浏览器既可以向服务器发送消息，服务器也可主动向浏览器推送消息。</p>
<p><strong>效果展示：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222190401414-7f1841286b68c10673b125f5d5a93af2.png" width="1479" height="704" class="img_ev3q"></p>
<p><strong>实现步骤：</strong></p>
<p>1). 直接使用websocket.html页面作为WebSocket客户端</p>
<p>2). 导入WebSocket的maven坐标</p>
<p>3). 导入WebSocket服务端组件WebSocketServer，用于和客户端通信</p>
<p>4). 导入配置类WebSocketConfiguration，注册WebSocket的服务端组件</p>
<p>5). 导入定时任务类WebSocketTask，定时向客户端推送数据</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="322-代码开发">3.2.2 代码开发<a href="#322-代码开发" class="hash-link" aria-label="Direct link to 3.2.2 代码开发" title="Direct link to 3.2.2 代码开发">​</a></h4>
<p>1). 定义websocket.html页面(资料中已提供)</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token doctype punctuation" style="color:hsl(119, 34%, 47%)">&lt;!</span><span class="token doctype doctype-tag" style="color:hsl(230, 8%, 24%)">DOCTYPE</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype name" style="color:hsl(230, 8%, 24%)">HTML</span><span class="token doctype punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">html</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">head</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">meta</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">charset</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">UTF-8</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">title</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain">WebSocket Demo</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">title</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">head</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">body</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">input</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">text</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">type</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">text</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">button</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag special-attr attr-name" style="color:hsl(35, 99%, 36%)">onclick</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag special-attr attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag special-attr attr-value value javascript language-javascript function" style="color:hsl(221, 87%, 60%)">send</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token tag special-attr attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain">发送消息</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">button</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">button</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag special-attr attr-name" style="color:hsl(35, 99%, 36%)">onclick</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag special-attr attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag special-attr attr-value value javascript language-javascript function" style="color:hsl(221, 87%, 60%)">closeWebSocket</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token tag special-attr attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain">关闭连接</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">button</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">message</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">div</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">body</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">script</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">type</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">text/javascript</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript keyword" style="color:hsl(301, 63%, 40%)">var</span><span class="token script language-javascript"> websocket </span><span class="token script language-javascript operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword null nil" style="color:hsl(301, 63%, 40%)">null</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript keyword" style="color:hsl(301, 63%, 40%)">var</span><span class="token script language-javascript"> clientId </span><span class="token script language-javascript operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript known-class-name class-name" style="color:hsl(35, 99%, 36%)">Math</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token script language-javascript method function property-access" style="color:hsl(221, 87%, 60%)">random</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token script language-javascript method function property-access" style="color:hsl(221, 87%, 60%)">toString</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript number" style="color:hsl(35, 99%, 36%)">36</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token script language-javascript method function property-access" style="color:hsl(221, 87%, 60%)">substr</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript number" style="color:hsl(35, 99%, 36%)">2</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript comment" style="color:hsl(230, 4%, 64%)">//判断当前浏览器是否支持WebSocket</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript keyword control-flow" style="color:hsl(301, 63%, 40%)">if</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript string" style="color:hsl(119, 34%, 47%)">&#x27;WebSocket&#x27;</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:hsl(221, 87%, 60%)">window</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">        </span><span class="token script language-javascript comment" style="color:hsl(230, 4%, 64%)">//连接WebSocket节点</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">        websocket </span><span class="token script language-javascript operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword" style="color:hsl(301, 63%, 40%)">new</span><span class="token script language-javascript"> </span><span class="token script language-javascript class-name" style="color:hsl(35, 99%, 36%)">WebSocket</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript string" style="color:hsl(119, 34%, 47%)">&quot;ws://localhost:8080/ws/&quot;</span><span class="token script language-javascript operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token script language-javascript">clientId</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript keyword control-flow" style="color:hsl(301, 63%, 40%)">else</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">        </span><span class="token script language-javascript function" style="color:hsl(221, 87%, 60%)">alert</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript string" style="color:hsl(119, 34%, 47%)">&#x27;Not support websocket&#x27;</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript comment" style="color:hsl(230, 4%, 64%)">//连接发生错误的回调方法</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    websocket</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token script language-javascript method-variable function-variable method function property-access" style="color:hsl(221, 87%, 60%)">onerror</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">        </span><span class="token script language-javascript function" style="color:hsl(221, 87%, 60%)">setMessageInnerHTML</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript string" style="color:hsl(119, 34%, 47%)">&quot;error&quot;</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript comment" style="color:hsl(230, 4%, 64%)">//连接成功建立的回调方法</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    websocket</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token script language-javascript method-variable function-variable method function property-access" style="color:hsl(221, 87%, 60%)">onopen</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">        </span><span class="token script language-javascript function" style="color:hsl(221, 87%, 60%)">setMessageInnerHTML</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript string" style="color:hsl(119, 34%, 47%)">&quot;连接成功&quot;</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript comment" style="color:hsl(230, 4%, 64%)">//接收到消息的回调方法</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    websocket</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token script language-javascript method-variable function-variable method function property-access" style="color:hsl(221, 87%, 60%)">onmessage</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript parameter">event</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">        </span><span class="token script language-javascript function" style="color:hsl(221, 87%, 60%)">setMessageInnerHTML</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript">event</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token script language-javascript property-access">data</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript comment" style="color:hsl(230, 4%, 64%)">//连接关闭的回调方法</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    websocket</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token script language-javascript method-variable function-variable method function property-access" style="color:hsl(221, 87%, 60%)">onclose</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">        </span><span class="token script language-javascript function" style="color:hsl(221, 87%, 60%)">setMessageInnerHTML</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript string" style="color:hsl(119, 34%, 47%)">&quot;close&quot;</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript comment" style="color:hsl(230, 4%, 64%)">//监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript dom variable" style="color:hsl(221, 87%, 60%)">window</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token script language-javascript method-variable function-variable method function property-access" style="color:hsl(221, 87%, 60%)">onbeforeunload</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">        websocket</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token script language-javascript method function property-access" style="color:hsl(221, 87%, 60%)">close</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript comment" style="color:hsl(230, 4%, 64%)">//将消息显示在网页上</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token script language-javascript"> </span><span class="token script language-javascript function" style="color:hsl(221, 87%, 60%)">setMessageInnerHTML</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript parameter">innerHTML</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">        </span><span class="token script language-javascript dom variable" style="color:hsl(221, 87%, 60%)">document</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token script language-javascript method function property-access" style="color:hsl(221, 87%, 60%)">getElementById</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript string" style="color:hsl(119, 34%, 47%)">&#x27;message&#x27;</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token script language-javascript property-access">innerHTML</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:hsl(221, 87%, 60%)">+=</span><span class="token script language-javascript"> innerHTML </span><span class="token script language-javascript operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style="color:hsl(119, 34%, 47%)">&#x27;&lt;br/&gt;&#x27;</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript comment" style="color:hsl(230, 4%, 64%)">//发送消息</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token script language-javascript"> </span><span class="token script language-javascript function" style="color:hsl(221, 87%, 60%)">send</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">        </span><span class="token script language-javascript keyword" style="color:hsl(301, 63%, 40%)">var</span><span class="token script language-javascript"> message </span><span class="token script language-javascript operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:hsl(221, 87%, 60%)">document</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token script language-javascript method function property-access" style="color:hsl(221, 87%, 60%)">getElementById</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript string" style="color:hsl(119, 34%, 47%)">&#x27;text&#x27;</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token script language-javascript property-access">value</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">        websocket</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token script language-javascript method function property-access" style="color:hsl(221, 87%, 60%)">send</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript">message</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">	</span><span class="token script language-javascript comment" style="color:hsl(230, 4%, 64%)">//关闭连接</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript keyword" style="color:hsl(301, 63%, 40%)">function</span><span class="token script language-javascript"> </span><span class="token script language-javascript function" style="color:hsl(221, 87%, 60%)">closeWebSocket</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">        websocket</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token script language-javascript method function property-access" style="color:hsl(221, 87%, 60%)">close</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token script language-javascript"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">script</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">html</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>2). 导入maven坐标</p>
<p>在sky-server模块pom.xml中已定义</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">dependency</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">groupId</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">groupId</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">artifactId</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain">spring-boot-starter-websocket</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">artifactId</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">dependency</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>3). 定义WebSocket服务端组件(资料中已提供)</p>
<p>直接导入到sky-server模块即可</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.websocket;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import javax.websocket.OnClose;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import javax.websocket.OnMessage;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import javax.websocket.OnOpen;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import javax.websocket.Session;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import javax.websocket.server.PathParam;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import javax.websocket.server.ServerEndpoint;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.util.Collection;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.util.HashMap;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.util.Map;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> * WebSocket服务</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@ServerEndpoint(&quot;/ws/{sid}&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public class WebSocketServer {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    //存放会话对象</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private static Map&lt;String, Session&gt; sessionMap = new HashMap();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 连接建立成功调用的方法</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @OnOpen</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void onOpen(Session session, @PathParam(&quot;sid&quot;) String sid) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        System.out.println(&quot;客户端：&quot; + sid + &quot;建立连接&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        sessionMap.put(sid, session);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 收到客户端消息后调用的方法</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param message 客户端发送过来的消息</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @OnMessage</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void onMessage(String message, @PathParam(&quot;sid&quot;) String sid) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        System.out.println(&quot;收到来自客户端：&quot; + sid + &quot;的信息:&quot; + message);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 连接关闭调用的方法</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param sid</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @OnClose</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void onClose(@PathParam(&quot;sid&quot;) String sid) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        System.out.println(&quot;连接断  开:&quot; + sid);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        sessionMap.remove(sid);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 群发</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param message</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void sendToAllClient(String message) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        Collection&lt;Session&gt; sessions = sessionMap.values();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        for (Session session : sessions) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                //服务器向客户端发送消息</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                session.getBasicRemote().sendText(message);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            } catch (Exception e) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                e.printStackTrace();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>4). 定义配置类，注册WebSocket的服务端组件(从资料中直接导入即可)</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.config;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.context.annotation.Bean;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.context.annotation.Configuration;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.web.socket.server.standard.ServerEndpointExporter;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> * WebSocket配置类，用于注册WebSocket的Bean</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public class WebSocketConfiguration {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public ServerEndpointExporter serverEndpointExporter() {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return new ServerEndpointExporter();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>5). 定义定时任务类，定时向客户端推送数据(从资料中直接导入即可)</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.task;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.websocket.WebSocketServer;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.beans.factory.annotation.Autowired;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.scheduling.annotation.Scheduled;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.time.LocalDateTime;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.time.format.DateTimeFormatter;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public class WebSocketTask {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private WebSocketServer webSocketServer;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 通过WebSocket每隔5秒向客户端发送消息</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Scheduled(cron = &quot;0/5 * * * * ?&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void sendMessageToClient() {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        webSocketServer.sendToAllClient(&quot;这是来自服务端的消息：&quot; + DateTimeFormatter.ofPattern(&quot;HH:mm:ss&quot;).format(LocalDateTime.now()));</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="323-功能测试">3.2.3 功能测试<a href="#323-功能测试" class="hash-link" aria-label="Direct link to 3.2.3 功能测试" title="Direct link to 3.2.3 功能测试">​</a></h4>
<p>启动服务，打开websocket.html页面</p>
<p><strong>浏览器向服务器发送数据：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222192759049-58ebe3525966136bb9b5926bb4a63ad5.png" width="1887" height="603" class="img_ev3q"></p>
<p><strong>服务器向浏览器间隔5秒推送数据：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222192926954-5b6dedb6a9b0194b8964c814200dfa5b.png" width="581" height="756" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-来单提醒">4. 来单提醒<a href="#4-来单提醒" class="hash-link" aria-label="Direct link to 4. 来单提醒" title="Direct link to 4. 来单提醒">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-需求分析和设计">4.1 需求分析和设计<a href="#41-需求分析和设计" class="hash-link" aria-label="Direct link to 4.1 需求分析和设计" title="Direct link to 4.1 需求分析和设计">​</a></h3>
<p>用户下单并且支付成功后，需要第一时间通知外卖商家。通知的形式有如下两种：</p>
<ul>
<li>语音播报  <img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAKB0lEQVR4nOWb628U1xmHn9mZnZmdHdtrUiXkYiEoNiQkiDZRVNTkYxI+tCRUVI6IqKio8lc1alQrUaOgINGSpqnUNgoKigWNya6vmGATamxZNdh7nd2dmX5YzvHsZbze8SWs+kPjZWfPnHPe95zz3kfxfd/n/xixH3oCPzS0H3oCnSJswyqKEqm/rtoBgvh0epx0elze9zwvlDHt0DUMCBIvsLi0BECpVMJ13UhM6AoGtCIeYO8TTwCQy+UiM2FXZUCrybU7u2HEv/DCEQAmJycxTRNN04jH46iq2tGcdm0HCELW1rKk0+OsrWUB5KpttHLff3+37vvg4I8BGB8fp1qt4rruo30ExMTm5+eZm5/Dx2Nufk7+VqlUWjLB932qVZf7D+7j4+HjYZo6pmly7949XNdFURRisRixWCySJtjxI7C+hSdwfbfpd9d1KRaLWJZFPB5vei4zMVHXfnBwENd1WV5eRlEU4vE4hmGg63rH2x92mAGCiLGxb0PbCAZomoaqqnVELC4ugre+K44dOwrUtr4gPpFIYFkWhmGgqmrHu2DHjoAg/vo3Y7i+1/IS7crlMtVqVR4D8ezevXtlW0H8jRs3UBQFVVUxTZNkMkkikUDToq3ljuwASfz1sU21byUIq9Uqmqbx4k+OyXutiLcsC13XHx0ZIIi4dv16pOeC31dWVnjw4AGFQgHP8yTxuq5jWVYo8cG+2jFl246AWMFqtcrotet4Pm2vjSCku5ALsVgMTdMwDINkMolt203nPriLFhbu1d0LU5HbsgNE58vL/+X27dvb0SWxWAzDMLAsC6gdiVgsVif0NE1DUZQ64kZHr8n/3737H15++SUcx5FCtnFHbJkBUs1lMhQKha12B6yvvq7r2LZNPB7HdV1isZhUe0LoifG/Hh0N7S+Xy5FIJFpqii0xQAx+9Wr44FEhzrthGMTjcSkDxLEAWMtmGc9MhvZx/PjLtXZra/i+36RmYQsMEMR/dfXrqF20RdDKa0TYuL09vTz//LPyezqdRtd1HMchkUg0+QuRGCCIv/LV1SiPd4TGMyvG9h7aEQL7Bp5hYGBAfr9x4wZQkyXimVaCUDKgU0fiypWdJ34jHDv6AmNjaY4ePUJvb6+8LwhXFEUeo6Cn2FIIBolfXV1rO/i36XDTdqchnCfbtnnlleMA5PN5ZmdngXXChdrUdZ1EIiG3fxMDBPFffHFldymJCMGA5eVlstms9CSDKy6MJcMwME1TOktCbQahAayurgLdER0PagJN02Q8UDhHQk2KS2z9MEdJA7h//4F0Th51KIqCpmkkEgk8z5MSXay6aZpytTVNkxokzCTWADz5pzsgGKCqqjwCggHC4mtHuOwLwPd8fJqDFY8iBEEiAGIYBkBdVKgTr/ChPenhdQf9wDoTWll20Fny5KEd4NMtQrAVbt26teHvmqazb99ASzdZGkLdIgQb8dnnf99Uu8npKU68/hrlclkKR0VRAqZwl9EvV7PDeQc9w1gsJixB8Lv0CJw48RoTE9OsZbOhbX70WD8HD9ZyCblcDlhXmzUG0OxcPOrwfV+G05977tCmnkmn09IqFHFIEVVoH6N6RLGwsEA2m6VcLrd16ET0KBgiqxlCnt91QlCYxML89TwPz1sPtTe2BWSUKegZagD79+9jenpml0nYOkRixPd9NE3DdTc2ZjRNwzTNujyC5vs+uq53nRAM5gfE52Z2QDwel1akoiholUoFXdd58+QvNjVwuVzm8l8/215qIkI4RkKiQ3srsNFcjgGsrKxw586dTQ2q6zqn3jxZ079bvbaAoCALxgGEF9h4BfMLdVHhoD09OTkpc3RhUFWVI0eOcOrUST65eHFrVESEyCf+5fJlTrxxAstKyPudOkMxIRlF2EhIyTBOKopCJpMB4FenTuG5RL62gkuXLuO58Omnn3HhwkXm79xpmSFqB01RFJmAUFW1LlPbiGD6a2pqisOHD3P69Ck+vvDJ1qjpADLC2yC0R0evMTp6jaeefoqfH/9ZXduNdoTi14DneXXlJmGDe55HpVKhWCxSLBYZGhoC4KOPL3RMzPCvT1MoFFhaWiKVStHT09MybheESJAAzM3fCc0IGXGdt946KecddjQUUSobjJ2HbR9xv1qtUiwWyefzFAoFBgcHAfjb55/z4H77qLLA8HDnDBAFFUL9QU0zXbx4KXSMUqm0cVgc1rdJWJo5iKAqURSF2dlZ9u/fzxuvv8709AzfjH2zSRZEx9LSEtlslscff5z+/n6Gh08D8KePPmpqm8vlQqtINswMbbQSuq7Xpa7m5uZ48sknOXRoiKeffoZLl/4clbYNEYz367rO4uIid+/eJZVKMTAwwNvDwwB8+eUVXn31FQCyDz3FVhGkSPUBYuWFKWrbNrZts7i4yMLCArZtcebMMOuRprArGkRQ1LZtWSKTy+XIZDJMPCyqEsSn02nK5TKO41CtVqW1KPuKPAvqQ9RiN+RyOWZmZhgaGuLMmbcZ+eDDyP2HHUFh+goV7jgOpVKJcrlMpVIhk8lIWRasH2jV35YrRBprdnp6ejAMg6mpKQDOvnMmkiUoJjsy8iEjIx823W8cs6+vj76+Pnp6eqQ9IyxA4TG2EoLbUiITzOWLCVmWxfT0dI0JZ8/gt/jXDpNT07LtH0c+kGMJNS12oGma2LbdxAhxNMUxaZUb3LYaoSATLMvCtm0sy2JmpuZm/+bsO3iuV3e1w7OHD9W1f//9kdqkY7E6JohUmWmaWJZFb28vfX19pFIpUqkUvb290gXeMQYEJyMsy56eHpLJJDdv3gTg3Lmz7HksBSA/v/vuu6Z+fN+XBJ58s95L/cc//yV3QbA+OJgcFaZ9MpkkmUzKYuoN8gLbh2CkxrKsOlvh4MGDnPzlL5vaBz8FPM+jVCqxp7+fAwcOcPNWjYm35+ZYWbnPnj39FItFGd1t7EdV1c2bwttDej2CfkOpVCKfz5PP53EcB9M066KzyWSS/v5+6Y8AVCoVcrmctA7fe+/9uv7Pnz8HgOM40iaJUii5Y6WywZ0QtBUSiQSO40gDKqzOXzy79PCtkPPnz9UJ0N+/9wcADMOgUqlEnueOl8sHbYWgVDZNU8bnhIQOmtjBilARrPnd+d/WCcVr1/8N1F6ZaRfHCMOuvC8QtBVs25aqqq+vb0MJLRhnWZYswHz33fPy95de/CkAhUIBx3EivTy1YzKgFYRccF1XTlaosFbFzqJtuVwml8uRzWY5cOBAXZuJiQkSiYTU/a10/UbY1XeGZEa2RWl7S1+94Si4rsvs7CyGYeB5Hqurqy1VYifY9RcnO5XUQQNLJD/y+Tzlcln+FlZMuRl0xZujQZNXeHOqqsr6YWH7R3llZldlwFYhwnaO4+A4jmSAqAgT9kAn6CoGiKmKM+95Xt07BRDhiHUTAwSivIAZhv8Bv15utLd+o9IAAAAASUVORK5CYII=" width="64" height="64" class="img_ev3q"></li>
<li>弹出提示框</li>
</ul>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222194450142-bddcf31d16016d6c7fa7723dadea53f2.png" width="1080" height="574" class="img_ev3q"></p>
<p><strong>设计思路：</strong></p>
<ul>
<li>通过WebSocket实现管理端页面和服务端保持长连接状态</li>
<li>当客户支付后，调用WebSocket的相关API实现服务端向客户端推送消息</li>
<li>客户端浏览器解析服务端推送的消息，判断是来单提醒还是客户催单，进行相应的消息提示和语音播报</li>
<li>约定服务端发送给客户端浏览器的数据格式为JSON，字段包括：type，orderId，content
<ul>
<li>type 为消息类型，1为来单提醒 2为客户催单</li>
<li>orderId 为订单id</li>
<li>content 为消息内容</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-代码开发">4.2 代码开发<a href="#42-代码开发" class="hash-link" aria-label="Direct link to 4.2 代码开发" title="Direct link to 4.2 代码开发">​</a></h3>
<p><strong>在OrderServiceImpl中注入WebSocketServer对象，修改paySuccess方法，加入如下代码：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	@Autowired</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private WebSocketServer webSocketServer;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 支付成功，修改订单状态</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param outTradeNo</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void paySuccess(String outTradeNo) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // 当前登录用户id</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        Long userId = BaseContext.getCurrentId();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // 根据订单号查询当前用户的订单</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        Orders ordersDB = orderMapper.getByNumberAndUserId(outTradeNo, userId);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // 根据订单id更新订单的状态、支付方式、支付状态、结账时间</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        Orders orders = Orders.builder()</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                .id(ordersDB.getId())</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                .status(Orders.TO_BE_CONFIRMED)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                .payStatus(Orders.PAID)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                .checkoutTime(LocalDateTime.now())</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        orderMapper.update(orders);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		//////////////////////////////////////////////</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        Map map = new HashMap();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        map.put(&quot;type&quot;, 1);//消息类型，1表示来单提醒</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        map.put(&quot;orderId&quot;, orders.getId());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        map.put(&quot;content&quot;, &quot;订单号：&quot; + outTradeNo);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //通过WebSocket实现来单提醒，向客户端浏览器推送消息</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        webSocketServer.sendToAllClient(JSON.toJSONString(map));</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        ///////////////////////////////////////////////////</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-功能测试">4.3 功能测试<a href="#43-功能测试" class="hash-link" aria-label="Direct link to 4.3 功能测试" title="Direct link to 4.3 功能测试">​</a></h3>
<p>可以通过如下方式进行测试：</p>
<ul>
<li>查看浏览器调试工具数据交互过程</li>
<li>前后端联调</li>
</ul>
<p><strong>1). 登录管理端后台</strong></p>
<p>登录成功后，浏览器与服务器建立长连接</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222200842731-6771648093b0bda3d0f2e443fc0f6260.png" width="1890" height="789" class="img_ev3q"></p>
<p>查看控制台日志</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222200941497-8e4903485a2e3cb60353ab698f2a3b72.png" width="1598" height="354" class="img_ev3q"></p>
<p><strong>2). 小程序端下单支付</strong></p>
<p>修改回调地址，利用内网穿透获取域名</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222201350616-0f9ee1ab6af67158e0de69f927f2aa80.png" width="935" height="430" class="img_ev3q"></p>
<p>下单支付</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222201718622-52fb147859b74f601ea96ece257d5ca2.png" width="378" height="628" class="img_ev3q"></p>
<p><strong>3). 查看来单提醒</strong></p>
<p>支付成功后，后台收到来单提醒，并有语音播报</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222202310953-fc49e8b03813f7a3a3fe5b3b00b5c985.png" width="1814" height="698" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="44-代码提交">4.4 代码提交<a href="#44-代码提交" class="hash-link" aria-label="Direct link to 4.4 代码提交" title="Direct link to 4.4 代码提交">​</a></h3>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222202632141-4aedf73dfa896fb3d5bebcb7099e18ce.png" width="1078" height="1003" class="img_ev3q"></p>
<p>后续步骤和其它功能代码提交一致，不再赘述。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-客户催单">5. 客户催单<a href="#5-客户催单" class="hash-link" aria-label="Direct link to 5. 客户催单" title="Direct link to 5. 客户催单">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-需求分析和设计">5.1 需求分析和设计<a href="#51-需求分析和设计" class="hash-link" aria-label="Direct link to 5.1 需求分析和设计" title="Direct link to 5.1 需求分析和设计">​</a></h3>
<p>用户在小程序中点击催单按钮后，需要第一时间通知外卖商家。通知的形式有如下两种：</p>
<ul>
<li>语音播报 <img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAKB0lEQVR4nOWb628U1xmHn9mZnZmdHdtrUiXkYiEoNiQkiDZRVNTkYxI+tCRUVI6IqKio8lc1alQrUaOgINGSpqnUNgoKigWNya6vmGATamxZNdh7nd2dmX5YzvHsZbze8SWs+kPjZWfPnHPe95zz3kfxfd/n/xixH3oCPzS0H3oCnSJswyqKEqm/rtoBgvh0epx0elze9zwvlDHt0DUMCBIvsLi0BECpVMJ13UhM6AoGtCIeYO8TTwCQy+UiM2FXZUCrybU7u2HEv/DCEQAmJycxTRNN04jH46iq2tGcdm0HCELW1rKk0+OsrWUB5KpttHLff3+37vvg4I8BGB8fp1qt4rruo30ExMTm5+eZm5/Dx2Nufk7+VqlUWjLB932qVZf7D+7j4+HjYZo6pmly7949XNdFURRisRixWCySJtjxI7C+hSdwfbfpd9d1KRaLWJZFPB5vei4zMVHXfnBwENd1WV5eRlEU4vE4hmGg63rH2x92mAGCiLGxb0PbCAZomoaqqnVELC4ugre+K44dOwrUtr4gPpFIYFkWhmGgqmrHu2DHjoAg/vo3Y7i+1/IS7crlMtVqVR4D8ezevXtlW0H8jRs3UBQFVVUxTZNkMkkikUDToq3ljuwASfz1sU21byUIq9Uqmqbx4k+OyXutiLcsC13XHx0ZIIi4dv16pOeC31dWVnjw4AGFQgHP8yTxuq5jWVYo8cG+2jFl246AWMFqtcrotet4Pm2vjSCku5ALsVgMTdMwDINkMolt203nPriLFhbu1d0LU5HbsgNE58vL/+X27dvb0SWxWAzDMLAsC6gdiVgsVif0NE1DUZQ64kZHr8n/3737H15++SUcx5FCtnFHbJkBUs1lMhQKha12B6yvvq7r2LZNPB7HdV1isZhUe0LoifG/Hh0N7S+Xy5FIJFpqii0xQAx+9Wr44FEhzrthGMTjcSkDxLEAWMtmGc9MhvZx/PjLtXZra/i+36RmYQsMEMR/dfXrqF20RdDKa0TYuL09vTz//LPyezqdRtd1HMchkUg0+QuRGCCIv/LV1SiPd4TGMyvG9h7aEQL7Bp5hYGBAfr9x4wZQkyXimVaCUDKgU0fiypWdJ34jHDv6AmNjaY4ePUJvb6+8LwhXFEUeo6Cn2FIIBolfXV1rO/i36XDTdqchnCfbtnnlleMA5PN5ZmdngXXChdrUdZ1EIiG3fxMDBPFffHFldymJCMGA5eVlstms9CSDKy6MJcMwME1TOktCbQahAayurgLdER0PagJN02Q8UDhHQk2KS2z9MEdJA7h//4F0Th51KIqCpmkkEgk8z5MSXay6aZpytTVNkxokzCTWADz5pzsgGKCqqjwCggHC4mtHuOwLwPd8fJqDFY8iBEEiAGIYBkBdVKgTr/ChPenhdQf9wDoTWll20Fny5KEd4NMtQrAVbt26teHvmqazb99ASzdZGkLdIgQb8dnnf99Uu8npKU68/hrlclkKR0VRAqZwl9EvV7PDeQc9w1gsJixB8Lv0CJw48RoTE9OsZbOhbX70WD8HD9ZyCblcDlhXmzUG0OxcPOrwfV+G05977tCmnkmn09IqFHFIEVVoH6N6RLGwsEA2m6VcLrd16ET0KBgiqxlCnt91QlCYxML89TwPz1sPtTe2BWSUKegZagD79+9jenpml0nYOkRixPd9NE3DdTc2ZjRNwzTNujyC5vs+uq53nRAM5gfE52Z2QDwel1akoiholUoFXdd58+QvNjVwuVzm8l8/215qIkI4RkKiQ3srsNFcjgGsrKxw586dTQ2q6zqn3jxZ079bvbaAoCALxgGEF9h4BfMLdVHhoD09OTkpc3RhUFWVI0eOcOrUST65eHFrVESEyCf+5fJlTrxxAstKyPudOkMxIRlF2EhIyTBOKopCJpMB4FenTuG5RL62gkuXLuO58Omnn3HhwkXm79xpmSFqB01RFJmAUFW1LlPbiGD6a2pqisOHD3P69Ck+vvDJ1qjpADLC2yC0R0evMTp6jaeefoqfH/9ZXduNdoTi14DneXXlJmGDe55HpVKhWCxSLBYZGhoC4KOPL3RMzPCvT1MoFFhaWiKVStHT09MybheESJAAzM3fCc0IGXGdt946KecddjQUUSobjJ2HbR9xv1qtUiwWyefzFAoFBgcHAfjb55/z4H77qLLA8HDnDBAFFUL9QU0zXbx4KXSMUqm0cVgc1rdJWJo5iKAqURSF2dlZ9u/fzxuvv8709AzfjH2zSRZEx9LSEtlslscff5z+/n6Gh08D8KePPmpqm8vlQqtINswMbbQSuq7Xpa7m5uZ48sknOXRoiKeffoZLl/4clbYNEYz367rO4uIid+/eJZVKMTAwwNvDwwB8+eUVXn31FQCyDz3FVhGkSPUBYuWFKWrbNrZts7i4yMLCArZtcebMMOuRprArGkRQ1LZtWSKTy+XIZDJMPCyqEsSn02nK5TKO41CtVqW1KPuKPAvqQ9RiN+RyOWZmZhgaGuLMmbcZ+eDDyP2HHUFh+goV7jgOpVKJcrlMpVIhk8lIWRasH2jV35YrRBprdnp6ejAMg6mpKQDOvnMmkiUoJjsy8iEjIx823W8cs6+vj76+Pnp6eqQ9IyxA4TG2EoLbUiITzOWLCVmWxfT0dI0JZ8/gt/jXDpNT07LtH0c+kGMJNS12oGma2LbdxAhxNMUxaZUb3LYaoSATLMvCtm0sy2JmpuZm/+bsO3iuV3e1w7OHD9W1f//9kdqkY7E6JohUmWmaWJZFb28vfX19pFIpUqkUvb290gXeMQYEJyMsy56eHpLJJDdv3gTg3Lmz7HksBSA/v/vuu6Z+fN+XBJ58s95L/cc//yV3QbA+OJgcFaZ9MpkkmUzKYuoN8gLbh2CkxrKsOlvh4MGDnPzlL5vaBz8FPM+jVCqxp7+fAwcOcPNWjYm35+ZYWbnPnj39FItFGd1t7EdV1c2bwttDej2CfkOpVCKfz5PP53EcB9M066KzyWSS/v5+6Y8AVCoVcrmctA7fe+/9uv7Pnz8HgOM40iaJUii5Y6WywZ0QtBUSiQSO40gDKqzOXzy79PCtkPPnz9UJ0N+/9wcADMOgUqlEnueOl8sHbYWgVDZNU8bnhIQOmtjBilARrPnd+d/WCcVr1/8N1F6ZaRfHCMOuvC8QtBVs25aqqq+vb0MJLRhnWZYswHz33fPy95de/CkAhUIBx3EivTy1YzKgFYRccF1XTlaosFbFzqJtuVwml8uRzWY5cOBAXZuJiQkSiYTU/a10/UbY1XeGZEa2RWl7S1+94Si4rsvs7CyGYeB5Hqurqy1VYifY9RcnO5XUQQNLJD/y+Tzlcln+FlZMuRl0xZujQZNXeHOqqsr6YWH7R3llZldlwFYhwnaO4+A4jmSAqAgT9kAn6CoGiKmKM+95Xt07BRDhiHUTAwSivIAZhv8Bv15utLd+o9IAAAAASUVORK5CYII=" width="64" height="64" class="img_ev3q"></li>
<li>弹出提示框</li>
</ul>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222203345829-10bd1b851ac9655c6bb2bccb872555bf.png" width="1098" height="583" class="img_ev3q"></p>
<p><strong>设计思路：</strong></p>
<ul>
<li>通过WebSocket实现管理端页面和服务端保持长连接状态</li>
<li>当用户点击催单按钮后，调用WebSocket的相关API实现服务端向客户端推送消息</li>
<li>客户端浏览器解析服务端推送的消息，判断是来单提醒还是客户催单，进行相应的消息提示和语音播报
约定服务端发送给客户端浏览器的数据格式为JSON，字段包括：type，orderId，content
<ul>
<li>type 为消息类型，1为来单提醒 2为客户催单</li>
<li>orderId 为订单id</li>
<li>content 为消息内容</li>
</ul>
</li>
</ul>
<p>当用户点击催单按钮时，向服务端发送请求。</p>
<p><strong>接口设计(催单)：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222204415339-f3b7824db030f4c9cdeef06dd437a277.png" width="435" height="532" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-代码开发">5.2 代码开发<a href="#52-代码开发" class="hash-link" aria-label="Direct link to 5.2 代码开发" title="Direct link to 5.2 代码开发">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="521-controller层">5.2.1 Controller层<a href="#521-controller层" class="hash-link" aria-label="Direct link to 5.2.1 Controller层" title="Direct link to 5.2.1 Controller层">​</a></h4>
<p><strong>根据用户催单的接口定义，在user/OrderController中创建催单方法：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 用户催单</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param id</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @GetMapping(&quot;/reminder/{id}&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;用户催单&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result reminder(@PathVariable(&quot;id&quot;) Long id) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        orderService.reminder(id);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="522-service层接口">5.2.2 Service层接口<a href="#522-service层接口" class="hash-link" aria-label="Direct link to 5.2.2 Service层接口" title="Direct link to 5.2.2 Service层接口">​</a></h4>
<p><strong>在OrderService接口中声明reminder方法：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 用户催单</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param id</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    void reminder(Long id);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="523-service层实现类">5.2.3 Service层实现类<a href="#523-service层实现类" class="hash-link" aria-label="Direct link to 5.2.3 Service层实现类" title="Direct link to 5.2.3 Service层实现类">​</a></h4>
<p><strong>在OrderServiceImpl中实现reminder方法：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 用户催单</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param id</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void reminder(Long id) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // 查询订单是否存在</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        Orders orders = orderMapper.getById(id);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        if (orders == null) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            throw new OrderBusinessException(MessageConstant.ORDER_NOT_FOUND);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //基于WebSocket实现催单</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        Map map = new HashMap();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        map.put(&quot;type&quot;, 2);//2代表用户催单</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        map.put(&quot;orderId&quot;, id);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        map.put(&quot;content&quot;, &quot;订单号：&quot; + orders.getNumber());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        webSocketServer.sendToAllClient(JSON.toJSONString(map));</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>5.2.4 Mapper层</p>
<p><strong>在OrderMapper中添加getById：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 根据id查询订单</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param id</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Select(&quot;select * from orders where id=#{id}&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    Orders getById(Long id);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="53-功能测试">5.3 功能测试<a href="#53-功能测试" class="hash-link" aria-label="Direct link to 5.3 功能测试" title="Direct link to 5.3 功能测试">​</a></h3>
<p>可以通过如下方式进行测试：</p>
<ul>
<li>查看浏览器调试工具数据交互过程</li>
<li>前后端联调</li>
</ul>
<p><strong>1). 登录管理端后台</strong></p>
<p>登录成功后，浏览器与服务器建立长连接</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222200842731-6771648093b0bda3d0f2e443fc0f6260.png" width="1890" height="789" class="img_ev3q"></p>
<p>查看控制台日志</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222200941497-8e4903485a2e3cb60353ab698f2a3b72.png" width="1598" height="354" class="img_ev3q"></p>
<p><strong>2). 用户进行催单</strong></p>
<p>用户可在订单列表或者订单详情，进行催单</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222210932942-2611e851341b4cbb976620f4acad979d.png" width="375" height="511" class="img_ev3q"></p>
<p><strong>3). 查看催单提醒</strong></p>
<p>既有催单弹窗，同时语音播报</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222211238000-d7c55f701aa19944f5acfed002c31c14.png" width="1792" height="760" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="54-代码提交">5.4 代码提交<a href="#54-代码提交" class="hash-link" aria-label="Direct link to 5.4 代码提交" title="Direct link to 5.4 代码提交">​</a></h3>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221222211740927-005cfc55de534aa17da141d37123f17c.png" width="1068" height="999" class="img_ev3q"></p>
<p>后续步骤和其它功能代码提交一致，不再赘述。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#课程内容" class="table-of-contents__link toc-highlight">课程内容</a></li><li><a href="#1-spring-task" class="table-of-contents__link toc-highlight">1. Spring Task</a><ul><li><a href="#11-介绍" class="table-of-contents__link toc-highlight">1.1 介绍</a></li><li><a href="#12-cron表达式" class="table-of-contents__link toc-highlight">1.2 cron表达式</a></li><li><a href="#13-入门案例" class="table-of-contents__link toc-highlight">1.3 入门案例</a></li></ul></li><li><a href="#2订单状态定时处理" class="table-of-contents__link toc-highlight">2.订单状态定时处理</a><ul><li><a href="#21-需求分析" class="table-of-contents__link toc-highlight">2.1 需求分析</a></li><li><a href="#22-代码开发" class="table-of-contents__link toc-highlight">2.2 代码开发</a></li><li><a href="#23-功能测试" class="table-of-contents__link toc-highlight">2.3 功能测试</a></li></ul></li><li><a href="#3-websocket" class="table-of-contents__link toc-highlight">3. WebSocket</a><ul><li><a href="#31-介绍" class="table-of-contents__link toc-highlight">3.1 介绍</a></li><li><a href="#32-入门案例" class="table-of-contents__link toc-highlight">3.2 入门案例</a></li></ul></li><li><a href="#4-来单提醒" class="table-of-contents__link toc-highlight">4. 来单提醒</a><ul><li><a href="#41-需求分析和设计" class="table-of-contents__link toc-highlight">4.1 需求分析和设计</a></li><li><a href="#42-代码开发" class="table-of-contents__link toc-highlight">4.2 代码开发</a></li><li><a href="#43-功能测试" class="table-of-contents__link toc-highlight">4.3 功能测试</a></li><li><a href="#44-代码提交" class="table-of-contents__link toc-highlight">4.4 代码提交</a></li></ul></li><li><a href="#5-客户催单" class="table-of-contents__link toc-highlight">5. 客户催单</a><ul><li><a href="#51-需求分析和设计" class="table-of-contents__link toc-highlight">5.1 需求分析和设计</a></li><li><a href="#52-代码开发" class="table-of-contents__link toc-highlight">5.2 代码开发</a></li><li><a href="#53-功能测试" class="table-of-contents__link toc-highlight">5.3 功能测试</a></li><li><a href="#54-代码提交" class="table-of-contents__link toc-highlight">5.4 代码提交</a></li></ul></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>