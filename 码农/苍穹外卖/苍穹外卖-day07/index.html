<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-码农/苍穹外卖/苍穹外卖-day07" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">苍穹外卖-day07 | Coisini</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://doc.minddiy.top/码农/苍穹外卖/苍穹外卖-day07/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="苍穹外卖-day07 | Coisini"><meta data-rh="true" name="description" content="课程内容"><meta data-rh="true" property="og:description" content="课程内容"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://doc.minddiy.top/码农/苍穹外卖/苍穹外卖-day07/"><link data-rh="true" rel="alternate" href="https://doc.minddiy.top/码农/苍穹外卖/苍穹外卖-day07/" hreflang="en"><link data-rh="true" rel="alternate" href="https://doc.minddiy.top/码农/苍穹外卖/苍穹外卖-day07/" hreflang="x-default"><meta name="google-site-verification" content="1FUPX6Qo4y3ecU623ShEurhgnjhSTjK49rRMhEDlzFA">
<link rel="stylesheet" href="/katex/katex.min.css">
<script src="/js/matomo.js" async defer="defer"></script><link rel="stylesheet" href="/assets/css/styles.79037026.css">
<script src="/assets/js/runtime~main.468f2b27.js" defer="defer"></script>
<script src="/assets/js/main.4763ab3e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Coisini</b></a></div><div class="navbar__items navbar__items--right"><a href="https://minddiy.top" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Main site<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>苍穹外卖-day07</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="课程内容">课程内容<a href="#课程内容" class="hash-link" aria-label="Direct link to 课程内容" title="Direct link to 课程内容">​</a></h2>
<ul>
<li>缓存菜品</li>
<li>缓存套餐</li>
<li>添加购物车</li>
<li>查看购物车</li>
<li>清空购物车</li>
</ul>
<p>功能实现：<strong>缓存商品</strong>、<strong>购物车</strong></p>
<p><strong>效果图：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221208175444066-79db4decf0e7db55cacaf2aebb22095c.png" width="431" height="763" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-缓存菜品">1. 缓存菜品<a href="#1-缓存菜品" class="hash-link" aria-label="Direct link to 1. 缓存菜品" title="Direct link to 1. 缓存菜品">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-问题说明">1.1 问题说明<a href="#11-问题说明" class="hash-link" aria-label="Direct link to 1.1 问题说明" title="Direct link to 1.1 问题说明">​</a></h3>
<p>用户端小程序展示的菜品数据都是通过查询数据库获得，如果用户端访问量比较大，数据库访问压力随之增大。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221208180228667-84593a8d0a5144fa02d163c0b6f27e16.png" width="1608" height="532" class="img_ev3q"></p>
<p>**结果：**系统响应慢、用户体验差</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-实现思路">1.2 实现思路<a href="#12-实现思路" class="hash-link" aria-label="Direct link to 1.2 实现思路" title="Direct link to 1.2 实现思路">​</a></h3>
<p>通过Redis来缓存菜品数据，减少数据库查询操作。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221208180818572-10366724e604cb147724532691bc33d8.png" width="1773" height="502" class="img_ev3q"></p>
<p><strong>缓存逻辑分析：</strong></p>
<ul>
<li>每个分类下的菜品保存一份缓存数据</li>
<li>数据库中菜品数据有变更时清理缓存数据</li>
</ul>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221208181007639-0f8b0f897619870187950aab14bd2d78.png" width="606" height="364" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-代码开发">1.3 代码开发<a href="#13-代码开发" class="hash-link" aria-label="Direct link to 1.3 代码开发" title="Direct link to 1.3 代码开发">​</a></h3>
<p><strong>修改用户端接口 DishController 的 list 方法，加入缓存处理逻辑：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	@Autowired</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private RedisTemplate redisTemplate;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 根据分类id查询菜品</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param categoryId</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @GetMapping(&quot;/list&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;根据分类id查询菜品&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result&lt;List&lt;DishVO&gt;&gt; list(Long categoryId) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //构造redis中的key，规则：dish_分类id</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        String key = &quot;dish_&quot; + categoryId;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //查询redis中是否存在菜品数据</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        List&lt;DishVO&gt; list = (List&lt;DishVO&gt;) redisTemplate.opsForValue().get(key);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        if(list != null &amp;&amp; list.size() &gt; 0){</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            //如果存在，直接返回，无须查询数据库</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            return Result.success(list);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		////////////////////////////////////////////////////////</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        Dish dish = new Dish();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        dish.setCategoryId(categoryId);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        dish.setStatus(StatusConstant.ENABLE);//查询起售中的菜品</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //如果不存在，查询数据库，将查询到的数据放入redis中</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        list = dishService.listWithFlavor(dish);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        ////////////////////////////////////////////////////////</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        redisTemplate.opsForValue().set(key, list);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success(list);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>为了保证<strong>数据库</strong>和<strong>Redis</strong>中的数据保持一致，修改<strong>管理端接口 DishController</strong> 的相关方法，加入清理缓存逻辑。</p>
<p>需要改造的方法：</p>
<ul>
<li>新增菜品</li>
<li>修改菜品</li>
<li>批量删除菜品</li>
<li>起售、停售菜品</li>
</ul>
<p><strong>抽取清理缓存的方法：</strong></p>
<p>在管理端DishController中添加</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	@Autowired</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private RedisTemplate redisTemplate;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 清理缓存数据</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param pattern</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private void cleanCache(String pattern){</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        Set keys = redisTemplate.keys(pattern);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        redisTemplate.delete(keys);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>调用清理缓存的方法，保证数据一致性：</strong></p>
<p><strong>1). 新增菜品优化</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 新增菜品</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param dishDTO</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @PostMapping</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;新增菜品&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result save(@RequestBody DishDTO dishDTO) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        log.info(&quot;新增菜品：{}&quot;, dishDTO);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        dishService.saveWithFlavor(dishDTO);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //清理缓存数据</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        String key = &quot;dish_&quot; + dishDTO.getCategoryId();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cleanCache(key);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>2). 菜品批量删除优化</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 菜品批量删除</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param ids</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @DeleteMapping</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;菜品批量删除&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result delete(@RequestParam List&lt;Long&gt; ids) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        log.info(&quot;菜品批量删除：{}&quot;, ids);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        dishService.deleteBatch(ids);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //将所有的菜品缓存数据清理掉，所有以dish_开头的key</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cleanCache(&quot;dish_*&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>3). 修改菜品优化</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 修改菜品</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param dishDTO</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @PutMapping</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;修改菜品&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result update(@RequestBody DishDTO dishDTO) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        log.info(&quot;修改菜品：{}&quot;, dishDTO);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        dishService.updateWithFlavor(dishDTO);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //将所有的菜品缓存数据清理掉，所有以dish_开头的key</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cleanCache(&quot;dish_*&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>4). 菜品起售停售优化</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 菜品起售停售</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param status</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param id</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @PostMapping(&quot;/status/{status}&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;菜品起售停售&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result&lt;String&gt; startOrStop(@PathVariable Integer status, Long id) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        dishService.startOrStop(status, id);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //将所有的菜品缓存数据清理掉，所有以dish_开头的key</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cleanCache(&quot;dish_*&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="14-功能测试">1.4 功能测试<a href="#14-功能测试" class="hash-link" aria-label="Direct link to 1.4 功能测试" title="Direct link to 1.4 功能测试">​</a></h3>
<p>可以通过如下方式进行测试：</p>
<ul>
<li>查看控制台sql</li>
<li>前后端联调</li>
<li>查看Redis中的缓存数据</li>
</ul>
<p>以<strong>加入缓存</strong>、<strong>菜品修改</strong>两个功能测试为例，通过前后端联调方式，查看控制台sql的打印和Redis中的缓存数据变化。</p>
<p><strong>1). 加入缓存</strong></p>
<p>当第一次查询某个分类的菜品时，会从数据为中进行查询，同时将查询的结果存储到Redis中，在后绪的访问，若查询相同分类的菜品时，直接从Redis缓存中查询，不再查询数据库。</p>
<p>**登录小程序：**选择蜀味牛蛙(id=17)</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210174656770-d3f6b44a1d2a64f3b8ba318d449a4e84.png" width="481" height="750" class="img_ev3q"></p>
<p>**查看控制台sql：**有查询语句，说明是从数据库中进行查询</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210174839028-2865fe764e52865ebc9a75af23c3596f.png" width="1388" height="429" class="img_ev3q"></p>
<p>**查看Redis中的缓存数据：**说明缓存成功</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210175055282-36448e8e7f3b9fa6bcde9bfca006f019.png" width="1877" height="904" class="img_ev3q"></p>
<p>**再次访问：**选择蜀味牛蛙(id=17)</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210175438411-f897ba7816bafa50e8a0495a1deae49d.png" width="1394" height="514" class="img_ev3q"></p>
<p>说明是从Redis中查询的数据。</p>
<p><strong>2). 菜品修改</strong></p>
<p>当在后台修改菜品数据时，为了保证Redis缓存中的数据和数据库中的数据时刻保持一致，当修改后，需要清空对应的缓存数据。用户再次访问时，还是先从数据库中查询，同时再把查询的结果存储到Redis中，这样，就能保证缓存和数据库的数据保持一致。</p>
<p>**进入后台：**修改蜀味牛蛙分类下的任意一个菜品，当前分类的菜品数据已在Redis中缓存</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210180624453-26f613e7b34f50846885afd38896e92c.png" width="1887" height="862" class="img_ev3q"></p>
<p><strong>修改：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210180900924-0b0f2dea942e0ba3a8bfc126f2a21d89.png" width="1758" height="768" class="img_ev3q"></p>
<p>**查看Redis中的缓存数据：**说明修改时，已清空缓存</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210181142408-b84a9526cb4de25641a7f593a9cd0101.png" width="1892" height="980" class="img_ev3q"></p>
<p>用户再次访问同一个菜品分类时，需要先查询数据  库，再把结果同步到Redis中，保证了两者数据一致性。</p>
<p>其它功能测试步骤基本一致，自已测试即可。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="15-代码提交">1.5 代码提交<a href="#15-代码提交" class="hash-link" aria-label="Direct link to 1.5 代码提交" title="Direct link to 1.5 代码提交">​</a></h3>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210202804407-5924c7d2b0ac68f2301192818b05316e.png" width="1080" height="999" class="img_ev3q"></p>
<p>后续步骤和其它功能代码提交一致，不再赘述。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-缓存套餐">2. 缓存套餐<a href="#2-缓存套餐" class="hash-link" aria-label="Direct link to 2. 缓存套餐" title="Direct link to 2. 缓存套餐">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-spring-cache">2.1 Spring Cache<a href="#21-spring-cache" class="hash-link" aria-label="Direct link to 2.1 Spring Cache" title="Direct link to 2.1 Spring Cache">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="211-介绍">2.1.1 介绍<a href="#211-介绍" class="hash-link" aria-label="Direct link to 2.1.1 介绍" title="Direct link to 2.1.1 介绍">​</a></h4>
<p>Spring Cache 是一个框架，实现了基于注解的缓存功能，只需要简单地加一个注解，就能实现缓存功能。</p>
<p>Spring Cache 提供了一层抽象，底层可以切换不同的缓存实现，例如：</p>
<ul>
<li>EHCache</li>
<li>Caffeine</li>
<li>Redis(常用)</li>
</ul>
<p><strong>起步依赖：</strong></p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">dependency</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">groupId</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">groupId</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">artifactId</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain">spring-boot-starter-cache</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">artifactId</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain">  		            		       	 </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">version</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain">2.7.3</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">version</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">dependency</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="212-常用注解">2.1.2 常用注解<a href="#212-常用注解" class="hash-link" aria-label="Direct link to 2.1.2 常用注解" title="Direct link to 2.1.2 常用注解">​</a></h4>
<p>在SpringCache中提供了很多缓存操作的注解，常见的是以下的几个：</p>

























<table><thead><tr><th><strong>注解</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>@EnableCaching</td><td>开启缓存注解功能，通常加在启动类上</td></tr><tr><td>@Cacheable</td><td>在方法执行前先查询缓存中是否有数据，如果有数据，则直接返回缓存数据；如果没有缓存数据，调用方法并将方法返回值放到缓存中</td></tr><tr><td>@CachePut</td><td>将方法的返回值放到缓存中</td></tr><tr><td>@CacheEvict</td><td>将一条或多条数据从缓存中删除</td></tr></tbody></table>
<p>在spring boot项目中，使用缓存技术只需在项目中导入相关缓存技术的依  赖包，并在启动类上使用@EnableCaching开启缓存支持即可。</p>
<p>例如，使用Redis作为缓存技术，只需要导入Spring data Redis的maven坐标即可。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="213-入门案例">2.1.3 入门案例<a href="#213-入门案例" class="hash-link" aria-label="Direct link to 2.1.3 入门案例" title="Direct link to 2.1.3 入门案例">​</a></h4>
<p><strong>1). 环境准备</strong></p>
<p>**导入基础工程:**底层已使用Redis缓存实现</p>
<p>基础环境的代码，在我们今天的资料中已经准备好了， 大家只需要将这个工程导入进来就可以了。导入进来的工程结构如下：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210183942040-4a0a6af0d16da6699a884e52ca4fe530.png" width="507" height="670" class="img_ev3q"></p>
<p><strong>数据库准备:</strong></p>
<p>创建名为spring_cache_demo数据库，将springcachedemo.sql脚本直接导入数据库中。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210184346304-0d0c90023c9542e44ffc1427889e2da6.png" width="1396" height="115" class="img_ev3q"></p>
<p><strong>引导类上加@EnableCaching:</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.itheima;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import lombok.extern.slf4j.Slf4j;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.boot.SpringApplication;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.cache.annotation.EnableCaching;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@EnableCaching//开启缓存注解功能</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public class CacheDemoApplication {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        SpringApplication.run(CacheDemoApplication.class,args);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        log.info(&quot;项目启动成功...&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>2). @CachePut注解</strong></p>
<p><strong>@CachePut 说明：</strong></p>
<p>​	作用: 将方法返回值，放入缓存</p>
<p>​	value: 缓存的名称, 每个缓存名称下面可以有很多key</p>
<p>​	key: 缓存的key  ----------&gt; 支持Spring的表达式语言SPEL语法</p>
<p><strong>在save方法上加注解@CachePut</strong></p>
<p>当前UserController的save方法是用来保存用户信息的，我们希望在该用户信息保存到数据库的同时，也往缓存中缓存一份数据，我们可以在save方法上加上注解 @CachePut，用法如下：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	* CachePut：将方法返回值放入缓存</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	* value：缓存的名称，每个缓存名称下面可以有多个key</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	* key：缓存的key</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	*/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	@PostMapping</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @CachePut(value = &quot;userCache&quot;, key = &quot;#user.id&quot;)//key的生成：userCache::1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public User save(@RequestBody User user){</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        userMapper.insert(user);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return user;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>**说明：**key的写法如下</p>
<p>#user.id : #user指的是方法形参的名称, id指的是user的id属性 , 也就是使用user的id属性作为key ;</p>
<p>#result.id : #result代表方法返回值，该表达式 代表以返回对象的id属性作为key ；</p>
<p>#p0.id：#p0指的是方法中的第一个参数，id指的是第一个参数的id属性,也就是使用第一个参数的id属性作为key ;</p>
<p>#a0.id：#a0指的是方法中的第一个参数，id指的是第一个参数的id属性,也就是使用第一个参数的id属性作为key ;</p>
<p>#root.args[0].id:#root.args[0]指的是方法中的第一个参数，id指的是第一个参数的id属性,也就是使用第一个参数</p>
<p>的id属性作为key ;</p>
<p><strong>启动服务,通过swagger接口文档测试，访问UserController的save()方法</strong></p>
<p>因为id是自增，所以不需要设置id属性</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210191702887-234e076f58f82f6a86d3801dfb5e2c87.png" width="1884" height="835" class="img_ev3q"></p>
<p><strong>查看user表中的数据</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210192325931-20ef1c1b969f460cba10a802dbdaa2dc.png" width="336" height="85" class="img_ev3q"></p>
<p><strong>查看Redis中的数据</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210192418204-a8f8633ee82d11670a184c5d20b39bd0.png" width="1887" height="835" class="img_ev3q"></p>
<p><strong>3). @Cacheable注解</strong></p>
<p><strong>@Cacheable 说明:</strong></p>
<p>​	作用: 在方法执行前，spring先查看缓存中是否有数据，如果有数据，则直接返回缓存数据；若没有数据，调用方法并将方法返回值放到缓存中</p>
<p>​	value: 缓存的名称，每个缓存名称下面可以有多个key</p>
<p>​	key: 缓存的key  ----------&gt; 支持Spring的表达式语言SPEL语法</p>
<p><strong>在getById上加注解@Cacheable</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	* Cacheable：在方法执行前spring先查看缓存中是否有数据，如果有数据，则直接返回缓存数据；若没有数据，	  *调用方法并将方法返回值放到缓存中</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	* value：缓存的名称，每个缓存名称下面可以有多个key</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	* key：缓存的key</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	*/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	@GetMapping</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Cacheable(cacheNames = &quot;userCache&quot;,key=&quot;#id&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public User getById(Long id){</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        User user = userMapper.getById(id);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return user;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>重启服务,通过swagger接口文档测试，访问UserController的getById()方法</strong></p>
<p>第一次访问，会请求我们controller的方法，查询数据库。后面再查询相同的id，就直接从Redis中查询数据，不  用再查询数据库了，就说明缓存生效了。</p>
<p>提前在redis中手动删除掉id=1的用户数据</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210193834150-c41a3cc05ee9df45662622f21d0a8c64.png" width="1902" height="822" class="img_ev3q"></p>
<p>**查看控制台sql语句：**说明从数据库查询的用户数据</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210193948896-c791380754ad7254efca8cee754676ae.png" width="1016" height="106" class="img_ev3q"></p>
<p>**查看Redis中的缓存数据：**说明已成功缓存</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210194112334-bf1192d747b6ad97f7e85a585814755d.png" width="1889" height="932" class="img_ev3q"></p>
<p>再次查询相同id的数据时，直接从redis中直接获取，不再查询数据库。</p>
<p><strong>4). @CacheEvict注解</strong></p>
<p><strong>@CacheEvict 说明：</strong></p>
<p>​	作用: 清理指定缓存</p>
<p>​	value: 缓存的名称，每个缓存名称下面可以有多个key</p>
<p>​	key: 缓存的key  ----------&gt; 支持Spring的表达式语言SPEL语法</p>
<p><strong>在 delete 方法上加注解@CacheEvict</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	@DeleteMapping</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @CacheEvict(cacheNames = &quot;userCache&quot;,key = &quot;#id&quot;)//删除某个key对应的缓存数据</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void deleteById(Long id){</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        userMapper.deleteById(id);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	@DeleteMapping(&quot;/delAll&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @CacheEvict(cacheNames = &quot;userCache&quot;,allEntries = true)//删除userCache下所有的缓存数据</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void deleteAll(){</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        userMapper.deleteAll();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>重启服务,通过swagger接口文档测试，访问UserController的deleteAll()方法</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210195254874-37204ee093645f9501f563f64b694dac.png" width="1899" height="803" class="img_ev3q"></p>
<p>**查看user表：**数据清空</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="338" height="54" class="img_ev3q"></p>
<p><strong>查询Redis缓存数据</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210195500014-572f03c1cdfae0f0c3db415ca26875e7.png" width="1885" height="904" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-实现思路">2.2 实现思路<a href="#22-实现思路" class="hash-link" aria-label="Direct link to 2.2 实现思路" title="Direct link to 2.2 实现思路">​</a></h3>
<p><strong>实现步骤：</strong></p>
<p>1). 导入Spring Cache和Redis相关maven坐标</p>
<p>2). 在启动类上加入@EnableCaching注解，开启缓存注解功能</p>
<p>3). 在用户端接口SetmealController的 list 方法上加入@Cacheable注解</p>
<p>4). 在管理端接口SetmealController的 save、delete、update、startOrStop等方法上加入CacheEvict注解</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-代码开发">2.3 代码开发<a href="#23-代码开发" class="hash-link" aria-label="Direct link to 2.3 代码开发" title="Direct link to 2.3 代码开发">​</a></h3>
<p>按照上述实现步骤：</p>
<p><strong>1). 导入Spring Cache和Redis相关maven坐标(已实现)</strong></p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">dependency</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">groupId</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">groupId</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">artifactId</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain">spring-boot-starter-data-redis</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">artifactId</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">dependency</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">dependency</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">groupId</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">groupId</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">artifactId</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain">spring-boot-starter-cache</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">artifactId</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">dependency</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>2). 在启动类上加入@EnableCaching注解，开启缓存注解功能</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import lombok.extern.slf4j.Slf4j;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.boot.SpringApplication;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.cache.annotation.EnableCaching;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.transaction.annotation.EnableTransactionManagement;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@EnableTransactionManagement //开启注解方式的事务管理</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@EnableCaching</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public class SkyApplication {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        SpringApplication.run(SkyApplication.class, args);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        log.info(&quot;server started&quot;);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>3). 在用户端接口SetmealController的 list 方法上加入@Cacheable注解</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 条件查询</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param categoryId</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @GetMapping(&quot;/list&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;根据分类id查询套餐&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Cacheable(cacheNames = &quot;setmealCache&quot;,key = &quot;#categoryId&quot;) //key: setmealCache::100</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result&lt;List&lt;Setmeal&gt;&gt; list(Long categoryId) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        Setmeal setmeal = new Setmeal();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        setmeal.setCategoryId(categoryId);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        setmeal.setStatus(StatusConstant.ENABLE);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        List&lt;Setmeal&gt; list = setmealService.list(setmeal);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success(list);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>4). 在管理端接口SetmealController的 save、delete、update、startOrStop等方法上加入CacheEvict注解</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 新增套餐</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param setmealDTO</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @PostMapping</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;新增套餐&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @CacheEvict(cacheNames = &quot;setmealCache&quot;,key = &quot;#setmealDTO.categoryId&quot;)//key: setmealCache::100</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result save(@RequestBody SetmealDTO setmealDTO) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        setmealService.saveWithDish(setmealDTO);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 批量删除套餐</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param ids</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @DeleteMapping</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;批量删除套餐&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @CacheEvict(cacheNames = &quot;setmealCache&quot;,allEntries = true)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result delete(@RequestParam List&lt;Long&gt; ids) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        setmealService.deleteBatch(ids);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 修改套餐</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param setmealDTO</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @PutMapping</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;修改套餐&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @CacheEvict(cacheNames = &quot;setmealCache&quot;,allEntries = true)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result update(@RequestBody SetmealDTO setmealDTO) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        setmealService.update(setmealDTO);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 套餐起售停售</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param status</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param id</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @PostMapping(&quot;/status/{status}&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;套餐起售停售&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @CacheEvict(cacheNames = &quot;setmealCache&quot;,allEntries = true)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result startOrStop(@PathVariable Integer status, Long id) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        setmealService.startOrStop(status, id);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="24-功能测试">2.4 功能测试<a href="#24-功能测试" class="hash-link" aria-label="Direct link to 2.4 功能测试" title="Direct link to 2.4 功能测试">​</a></h3>
<p>通过前后端联调方式来进行测试，同时观察redis中缓存的套餐数据。和<strong>缓存菜品</strong>功能测试基本一致，不再赘述。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="25-代码提交">2.5 代码提交<a href="#25-代码提交" class="hash-link" aria-label="Direct link to 2.5 代码提交" title="Direct link to 2.5 代码提交">​</a></h3>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210203035708-f3c0507253911b920b9a30ec1c9faa74.png" width="1071" height="998" class="img_ev3q"></p>
<p>后续步骤和其它功能代码提交一致，不再赘述。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-添加购物车">3. 添加购物车<a href="#3-添加购物车" class="hash-link" aria-label="Direct link to 3. 添加购物车" title="Direct link to 3. 添加购物车">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-需求分析和设计">3.1 需求分析和设计<a href="#31-需求分析和设计" class="hash-link" aria-label="Direct link to 3.1 需求分析和设计" title="Direct link to 3.1 需求分析和设计">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="311-产品原型">3.1.1 产品原型<a href="#311-产品原型" class="hash-link" aria-label="Direct link to 3.1.1 产品原型" title="Direct link to 3.1.1 产品原型">​</a></h4>
<p>用户可以将菜品或者套餐添加到购物车。对于菜品来说，如果设置了口味信息，则需要选择规格后才能加入购物车;对于套餐来说，可以直接点击<img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAcCAYAAACK7SRjAAADwUlEQVRIic2Wy28bVRTGf/fOeGzHjzhRY6dFNCVNRWkkooBCxasCBCu6RIKyAJU1fwkrFogNK8QKJCRUhJRWqlQqAVJ5NTQUqkATtSCHpHH8HI/ndVncsfFjnAqJBWd57rnfPee733x3hFJK0R9KAVFKSA4MFUZ1AhAjy+ZIplsYNKH2JVRWwf4J3DIoH8wpSJ2AyTMw9RKk5wGp+xnCF4Odh+DX4N5nsPMh2L9AaEPogAqiiQyQCZBpSD4AU2eh9CakF0AYXdhhcAXN61B+H/YvgrsNyjuYFgwwMpBdhiNvw/RZkClNrRARLcqHxrdQfg/2V8Gr3Ae0GwH4dah/BUFVUznzOkgLNFmA/StsfwCVi/8CuI8B5UPrBvz5LlQ+7y1JgipUvoDqZfDjgVUXJBLPkL6iZAj2Td1k+1YE3lyD/UtaDcTtAj8QbG6nuLGZodIwtaBiu/Cg+SPsfgIqQNK4Bs6t8ZcnoONKrq4X+Phqka2dFBjxpQAENahdAWcLSWtNy29cKPACwdZOipt3Muw3Ewcgo/nv3IXGNUyc37WO+9dVJNmoQyuhUNEhUiqwAB8Iga78u1SpEPwq2OuYeLv6tH4mDFjfzPDznQyOK7FdyW/lNHZHcnltij/uJZEC5mYcluab5NLB4KihDW4Zk6A9zALChOu3s3x0pcReXdNgSIUUiks/TLP6/TQTVsALS1WOH2mTywR6ih5IAGEbsyv4XtfokRfnWrx2ZgfbMXBcyXcbOf6qJnh8oc78bBspFQuH22SSQ8CgDU9amJjTwN2IPB1hIFheaLL8cBME2A2Ddz59kKaT4+WVPZ5bqerycGDbP+2JFCSKSJLHQCYHlqVQeqMHuOB4EgVIqfACofNe5GUjIcCchPQjSLJLYObiqnq1CUNRKrjMFR19eaKPwpF6E6zDkH8Ck9zpyKz2RlQDgAIrEfDMqRqLR1scKzoxVPSFkYX8k5A+iUlmCSafB2dT22xMWIbi0fmWbjXUUo61AGFC5hQcehWEicSa1T6cfwqMfDwzEWj3g4n3FgGph7Tl5laArs9llqF0HiafHXvAgSEMSJ+A0lswc66X1o+FkYLCi3osmdLm7+2Ok8Ngt3ICJk5C6Q0ongOz0HuJomcuMgfVAXsDKhdg7wI4t6M3tKMvW0TDCks3kSjpaQ+9AvnTYBToNxox8msB2ng6W1D/GurfQHsD/EhNRg6SRyH7GOSfholFsGb11MNzxYKjtCRURztm6KJvVEWdmyCSYKQ130rE3vIY8P8m7vNL9T8G/xthHIZ+H/LkbgAAAABJRU5ErkJggg==" width="23" height="28" class="img_ev3q"></p>
<p><strong>效果图：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210203822817-2601148ca833a399e8734a969f66e0d0.png" width="1372" height="695" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="312-接口设计">3.1.2 接口设计<a href="#312-接口设计" class="hash-link" aria-label="Direct link to 3.1.2 接口设计" title="Direct link to 3.1.2 接口设计">​</a></h4>
<p>通过上述原型图，设计出对应的添加购物车接口。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221208184342490-9d38de3e6398a5cd81862fe67a40f1e2.png" width="597" height="721" class="img_ev3q"></p>
<p>**说明：**添加购物车时，有可能添加菜品，也有可能添加套餐。故传入参数要么是菜品id，要么是套餐id。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="313-表设计">3.1.3 表设计<a href="#313-表设计" class="hash-link" aria-label="Direct link to 3.1.3 表设计" title="Direct link to 3.1.3 表设计">​</a></h4>
<p>用户的购物车数据，也是需要保存在数据库中的，购物车对应的数据表为shopping_cart表，具体表结构如下：</p>







































































<table><thead><tr><th><strong>字段名</strong></th><th><strong>数据类型</strong></th><th><strong>说明</strong></th><th><strong>备注</strong></th></tr></thead><tbody><tr><td>id</td><td>bigint</td><td>主键</td><td>自增</td></tr><tr><td>name</td><td>varchar(32)</td><td>商品名称</td><td>冗余字段</td></tr><tr><td>image</td><td>varchar(255)</td><td>商品图片路径</td><td>冗余字段</td></tr><tr><td>user_id</td><td>bigint</td><td>用户id</td><td>逻辑外键</td></tr><tr><td>dish_id</td><td>bigint</td><td>菜品id</td><td>逻辑外键</td></tr><tr><td>setmeal_id</td><td>bigint</td><td>套餐id</td><td>逻辑外键</td></tr><tr><td>dish_flavor</td><td>varchar(50)</td><td>菜品口味</td><td></td></tr><tr><td>number</td><td>int</td><td>商品数量</td><td></td></tr><tr><td>amount</td><td>decimal(10,2)</td><td>商品单价</td><td>冗余字段</td></tr><tr><td>create_time</td><td>datetime</td><td>创建时间</td><td></td></tr></tbody></table>
<p><strong>说明：</strong></p>
<ul>
<li>购物车数据是关联用户的，在表结构中，我们需要记录，每一个用户的购物车数据是哪些</li>
<li>菜品列表展示出来的既有套餐，又有菜品，如果用户选择的是套餐，就保存套餐ID(setmeal_id)，如果用户选择的是菜品，就保存菜品ID(dish_id)</li>
<li>对同一个菜品/套餐，如果选择多份不需要添加多条记录，增加数量number即可</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-代码开发">3.2 代码开发<a href="#32-代码开发" class="hash-link" aria-label="Direct link to 3.2 代码开发" title="Direct link to 3.2 代码开发">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="321-dto设计">3.2.1 DTO设计<a href="#321-dto设计" class="hash-link" aria-label="Direct link to 3.2.1 DTO设计" title="Direct link to 3.2.1 DTO设计">​</a></h4>
<p><strong>根据添加购物车接口的参数设计DTO：</strong></p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221208184938195-3b7eac0ca899750ca2481a7b9d0a1177.png" width="754" height="318" class="img_ev3q"></p>
<p>在sky-pojo模块，ShoppingCartDTO.java已定义</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.dto;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import lombok.Data;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.io.Serializable;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public class ShoppingCartDTO implements Serializable {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private Long dishId;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private Long setmealId;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private String dishFlavor;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="322-controller层">3.2.2 Controller层<a href="#322-controller层" class="hash-link" aria-label="Direct link to 3.2.2 Controller层" title="Direct link to 3.2.2 Controller层">​</a></h4>
<p><strong>根据添加购物车接口创建ShoppingCartController：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.controller.user;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.dto.ShoppingCartDTO;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.result.Result;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import io.swagger.annotations.Api;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import io.swagger.annotations.ApiOperation;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import lombok.extern.slf4j.Slf4j;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.beans.factory.annotation.Autowired;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.web.bind.annotation.PostMapping;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.web.bind.annotation.RequestBody;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.web.bind.annotation.RequestMapping;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.web.bind.annotation.RestController;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> * 购物车</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@RequestMapping(&quot;/user/shoppingCart&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Api(tags = &quot;C端-购物车接口&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public class ShoppingCartController {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private ShoppingCartService shoppingCartService;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 添加购物车</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param shoppingCartDTO</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @PostMapping(&quot;/add&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;添加购物车&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result&lt;String&gt; add(@RequestBody ShoppingCartDTO shoppingCartDTO){</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        log.info(&quot;添加购物车：{}&quot;, shoppingCartDTO);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        shoppingCartService.addShoppingCart(shoppingCartDTO);//后绪步骤实现</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="323-service层接口">3.2.3 Service层接口<a href="#323-service层接口" class="hash-link" aria-label="Direct link to 3.2.3 Service层接口" title="Direct link to 3.2.3 Service层接口">​</a></h4>
<p><strong>创建ShoppingCartService接口：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.service;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.dto.ShoppingCartDTO;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.entity.ShoppingCart;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.util.List;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public interface ShoppingCartService {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 添加购物车</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param shoppingCartDTO</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    void addShoppingCart(ShoppingCartDTO shoppingCartDTO);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="324-service层实现类">3.2.4 Service层实现类<a href="#324-service层实现类" class="hash-link" aria-label="Direct link to 3.2.4 Service层实现类" title="Direct link to 3.2.4 Service层实现类">​</a></h4>
<p><strong>创建ShoppingCartServiceImpl实现类，并实现add方法：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.service.impl;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.context.BaseContext;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.dto.ShoppingCartDTO;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.entity.Dish;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.entity.Setmeal;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.entity.ShoppingCart;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.mapper.DishMapper;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.mapper.SetmealMapper;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.service.ShoppingCartService;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.beans.BeanUtils;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.beans.factory.annotation.Autowired;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.springframework.stereotype.Service;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.time.LocalDateTime;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.util.List;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public class ShoppingCartServiceImpl implements ShoppingCartService {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private ShoppingCartMapper shoppingCartMapper;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private DishMapper dishMapper;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    private SetmealMapper setmealMapper;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 添加购物车</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param shoppingCartDTO</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void addShoppingCart(ShoppingCartDTO shoppingCartDTO) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        ShoppingCart shoppingCart = new ShoppingCart();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        BeanUtils.copyProperties(shoppingCartDTO, shoppingCart);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //只能查询自己的购物车数据</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        shoppingCart.setUserId(BaseContext.getCurrentId());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        //判断当前商品是否在购物车中</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        List&lt;ShoppingCart&gt; shoppingCartList = shoppingCartMapper.list(shoppingCart);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        if (shoppingCartList != null &amp;&amp; shoppingCartList.size() == 1) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            //如果已经存在，就更新数量，数量加1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            shoppingCart = shoppingCartList.get(0);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            shoppingCart.setNumber(shoppingCart.getNumber() + 1);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            shoppingCartMapper.updateNumberById(shoppingCart);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            //如果不存在，插入数据，数量就是1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            //判断当前添加到购物车的是菜品还是套餐</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Long dishId = shoppingCartDTO.getDishId();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            if (dishId != null) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                //添加到购物车的是菜品</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                Dish dish = dishMapper.getById(dishId);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                shoppingCart.setName(dish.getName());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                shoppingCart.setImage(dish.getImage());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                shoppingCart.setAmount(dish.getPrice());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                //添加到购物车的是套餐</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                Setmeal setmeal = setmealMapper.getById(shoppingCartDTO.getSetmealId());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                shoppingCart.setName(setmeal.getName());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                shoppingCart.setImage(setmeal.getImage());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                shoppingCart.setAmount(setmeal.getPrice());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            shoppingCart.setNumber(1);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            shoppingCart.setCreateTime(LocalDateTime.now());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            shoppingCartMapper.insert(shoppingCart);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="325-mapper层">3.2.5 Mapper层<a href="#325-mapper层" class="hash-link" aria-label="Direct link to 3.2.5 Mapper层" title="Direct link to 3.2.5 Mapper层">​</a></h4>
<p><strong>创建ShoppingCartMapper接口:</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">package com.sky.mapper;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import com.sky.entity.ShoppingCart;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.apache.ibatis.annotations.Delete;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.apache.ibatis.annotations.Insert;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.apache.ibatis.annotations.Mapper;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import org.apache.ibatis.annotations.Update;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">import java.util.List;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@Mapper</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">public interface ShoppingCartMapper {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 条件查询</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param shoppingCart</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    List&lt;ShoppingCart&gt; list(ShoppingCart shoppingCart);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 更新商品数量</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param shoppingCart</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Update(&quot;update shopping_cart set number = #{number} where id = #{id}&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    void updateNumberById(ShoppingCart shoppingCart);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 插入购物车数据</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param shoppingCart</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Insert(&quot;insert into shopping_cart (name, user_id, dish_id, setmeal_id, dish_flavor, number, amount, image, create_time) &quot; +</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            &quot; values (#{name},#{userId},#{dishId},#{setmealId},#{dishFlavor},#{number},#{amount},#{image},#{createTime})&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    void insert(ShoppingCart shoppingCart);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>创建ShoppingCartMapper.xml：</strong></p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token prolog" style="color:hsl(230, 4%, 64%)">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token doctype punctuation" style="color:hsl(119, 34%, 47%)">&lt;!</span><span class="token doctype doctype-tag" style="color:hsl(230, 8%, 24%)">DOCTYPE</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype name" style="color:hsl(230, 8%, 24%)">mapper</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype name" style="color:hsl(230, 8%, 24%)">PUBLIC</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype string" style="color:hsl(119, 34%, 47%)">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype string" style="color:hsl(119, 34%, 47%)">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="token doctype" style="color:hsl(230, 8%, 24%)"> </span><span class="token doctype punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">mapper</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">namespace</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">com.sky.mapper.ShoppingCartMapper</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">select</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">list</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">parameterType</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">ShoppingCart</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">resultType</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">ShoppingCart</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        select * from shopping_cart</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">where</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">userId != null</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                and user_id = #{userId}</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">dishId != null</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                and dish_id = #{dishId}</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">setmealId != null</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                and setmeal_id = #{setmealId}</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag" style="color:hsl(5, 74%, 59%)"> </span><span class="token tag attr-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token tag attr-value punctuation attr-equals" style="color:hsl(119, 34%, 47%)">=</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag attr-value" style="color:hsl(119, 34%, 47%)">dishFlavor != null</span><span class="token tag attr-value punctuation" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                and dish_flavor = #{dishFlavor}</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">if</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">where</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        order by create_time desc</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">select</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&lt;/</span><span class="token tag" style="color:hsl(5, 74%, 59%)">mapper</span><span class="token tag punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-功能测试">3.3 功能测试<a href="#33-功能测试" class="hash-link" aria-label="Direct link to 3.3 功能测试" title="Direct link to 3.3 功能测试">​</a></h3>
<p>进入小程序，添加菜品</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210210338094-f02aaa95106399e2274ad3674e1b2f5f.png" width="473" height="791" class="img_ev3q"></p>
<p>加入购物车，查询数据库</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210210643308-cb338ebd7c34c4bf28af9cdd0b3c73bc.png" width="1595" height="83" class="img_ev3q"></p>
<p>因为现在没有实现查看购物车功能，所以只能在表中进行查看。</p>
<p>在前后联调时，后台可通断点方式启动，查看运行的每一步。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="34-代码提交">3.4 代码提交<a href="#34-代码提交" class="hash-link" aria-label="Direct link to 3.4 代码提交" title="Direct link to 3.4 代码提交">​</a></h3>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210211145602-5100dba6432b0432499661f0dedad894.png" width="1078" height="998" class="img_ev3q"></p>
<p>后续步骤和其它功能代码提交一致，不再赘述。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-查看购物车">4. 查看购物车<a href="#4-查看购物车" class="hash-link" aria-label="Direct link to 4. 查看购物车" title="Direct link to 4. 查看购物车">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-需求分析和设计">4.1 需求分析和设计<a href="#41-需求分析和设计" class="hash-link" aria-label="Direct link to 4.1 需求分析和设计" title="Direct link to 4.1 需求分析和设计">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="411-产品原型">4.1.1 产品原型<a href="#411-产品原型" class="hash-link" aria-label="Direct link to 4.1.1 产品原型" title="Direct link to 4.1.1 产品原型">​</a></h4>
<p>当用户添加完菜品和套餐后，可进入到购物车中，查看购物中的菜品和套餐。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221208190038058-5b483f4517a90a506254ccc07e937092.png" width="415" height="737" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="412-接口设计">4.1.2 接口设计<a href="#412-接口设计" class="hash-link" aria-label="Direct link to 4.1.2 接口设计" title="Direct link to 4.1.2 接口设计">​</a></h4>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221208190052467-268ef5d52eb8cde4371d4c9af570661f.png" width="558" height="298" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-代码开发">4.2 代码开发<a href="#42-代码开发" class="hash-link" aria-label="Direct link to 4.2 代码开发" title="Direct link to 4.2 代码开发">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="421-controller层">4.2.1 Controller层<a href="#421-controller层" class="hash-link" aria-label="Direct link to 4.2.1 Controller层" title="Direct link to 4.2.1 Controller层">​</a></h4>
<p><strong>在ShoppingCartController中创建查看购物车的方法：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 查看购物车</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @GetMapping(&quot;/list&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;查看购物车&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result&lt;List&lt;ShoppingCart&gt;&gt; list(){</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success(shoppingCartService.showShoppingCart());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="422-service层接口">4.2.2 Service层接口<a href="#422-service层接口" class="hash-link" aria-label="Direct link to 4.2.2 Service层接口" title="Direct link to 4.2.2 Service层接口">​</a></h4>
<p><strong>在ShoppingCartService接口中声明查看购物车的方法：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 查看购物车</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    List&lt;ShoppingCart&gt; showShoppingCart();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="423-service层实现类">4.2.3 Service层实现类<a href="#423-service层实现类" class="hash-link" aria-label="Direct link to 4.2.3 Service层实现类" title="Direct link to 4.2.3 Service层实现类">​</a></h4>
<p><strong>在ShoppingCartServiceImpl中实现查看购物车的方法：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 查看购物车</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public List&lt;ShoppingCart&gt; showShoppingCart() {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return shoppingCartMapper.list(ShoppingCart.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                                       builder().</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                                       userId(BaseContext.getCurrentId()).</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                                       build());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-功能测试">4.3 功能测试<a href="#43-功能测试" class="hash-link" aria-label="Direct link to 4.3 功能测试" title="Direct link to 4.3 功能测试">​</a></h3>
<p>当进入小程序时，就会发起查看购物车的请求</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210213347557-104f92c83338837d70425817bde86985.png" width="481" height="794" class="img_ev3q"></p>
<p>点击购物车图标</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210213438878-b488fb0d217eeb56f7490a31dfa730b4.png" width="472" height="503" class="img_ev3q"></p>
<p>测试成功。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="44-代码提交">4.4 代码提交<a href="#44-代码提交" class="hash-link" aria-label="Direct link to 4.4 代码提交" title="Direct link to 4.4 代码提交">​</a></h3>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210213555667-0a52d1bd39f251bafa4bb624101ca993.png" width="1079" height="1001" class="img_ev3q"></p>
<p>后续步骤和其它功能代码提交一致，不再赘述。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-清空购物车">5. 清空购物车<a href="#5-清空购物车" class="hash-link" aria-label="Direct link to 5. 清空购物车" title="Direct link to 5. 清空购物车">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-需求分析和设计">5.1 需求分析和设计<a href="#51-需求分析和设计" class="hash-link" aria-label="Direct link to 5.1 需求分析和设计" title="Direct link to 5.1 需求分析和设计">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="511-产品原型">5.1.1 产品原型<a href="#511-产品原型" class="hash-link" aria-label="Direct link to 5.1.1 产品原型" title="Direct link to 5.1.1 产品原型">​</a></h4>
<p>当点击清空按钮时，会把购物车中的数据全部清空。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210213703715-99ab3f79be44c46efa2a364db2ecb899.png" width="1039" height="748" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="512-接口设计">5.1.2 接口设计<a href="#512-接口设计" class="hash-link" aria-label="Direct link to 5.1.2 接口设计" title="Direct link to 5.1.2 接口设计">​</a></h4>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221208191606894-d8cf1bdef2ea29fb3a1d71316604390c.png" width="692" height="682" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-代码开发">5.2 代码开发<a href="#52-代码开发" class="hash-link" aria-label="Direct link to 5.2 代码开发" title="Direct link to 5.2 代码开发">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="521-controller层">5.2.1 Controller层<a href="#521-controller层" class="hash-link" aria-label="Direct link to 5.2.1 Controller层" title="Direct link to 5.2.1 Controller层">​</a></h4>
<p><strong>在ShoppingCartController中创建清空购物车的方法：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 清空购物车商品</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @DeleteMapping(&quot;/clean&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @ApiOperation(&quot;清空购物车商品&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public Result&lt;String&gt; clean(){</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        shoppingCartService.cleanShoppingCart();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        return Result.success();</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="522-service层接口">5.2.2 Service层接口<a href="#522-service层接口" class="hash-link" aria-label="Direct link to 5.2.2 Service层接口" title="Direct link to 5.2.2 Service层接口">​</a></h4>
<p><strong>在ShoppingCartService接口中声明清空购物车的方法：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 清空购物车商品</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    void cleanShoppingCart();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="523-service层实现类">5.2.3 Service层实现类<a href="#523-service层实现类" class="hash-link" aria-label="Direct link to 5.2.3 Service层实现类" title="Direct link to 5.2.3 Service层实现类">​</a></h4>
<p><strong>在ShoppingCartServiceImpl中实现清空购物车的方法：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 清空购物车商品</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    public void cleanShoppingCart() {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        shoppingCartMapper.deleteByUserId(BaseContext.getCurrentId());</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="524-mapper层">5.2.4 Mapper层<a href="#524-mapper层" class="hash-link" aria-label="Direct link to 5.2.4 Mapper层" title="Direct link to 5.2.4 Mapper层">​</a></h4>
<p><strong>在ShoppingCartMapper接口中创建删除购物车数据的方法：</strong></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	/**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * 根据用户id删除购物车数据</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     *</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     * @param userId</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     */</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    @Delete(&quot;delete from shopping_cart where user_id = #{userId}&quot;)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    void deleteByUserId(Long userId);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="53-功能测试">5.3 功能测试<a href="#53-功能测试" class="hash-link" aria-label="Direct link to 5.3 功能测试" title="Direct link to 5.3 功能测试">​</a></h3>
<p>进入到购物车页面</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210214710863-fdf1679273a015604df9b5efc35c2fa0.png" width="482" height="795" class="img_ev3q"></p>
<p>点击清空</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210214914092-0385d8e693a1bcd12e5509b874c345b9.png" width="474" height="796" class="img_ev3q"></p>
<p>查看数据库中的数据</p>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210214950261-e3d301fdd4bace1c2e3437d4402ba1b9.png" width="1109" height="60" class="img_ev3q"></p>
<p>说明当前用户的购物车数据已全部删除。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="54-代码提交">5.4 代码提交<a href="#54-代码提交" class="hash-link" aria-label="Direct link to 5.4 代码提交" title="Direct link to 5.4 代码提交">​</a></h3>
<p><img decoding="async" loading="lazy" src="/assets/images/image-20221210215130746-d92003caee30e2fd7c10cc8993cb2b28.png" width="1084" height="1008" class="img_ev3q"></p>
<p>后续步骤和其它功能代码提交一致，不再赘述。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#课程内容" class="table-of-contents__link toc-highlight">课程内容</a></li><li><a href="#1-缓存菜品" class="table-of-contents__link toc-highlight">1. 缓存菜品</a><ul><li><a href="#11-问题说明" class="table-of-contents__link toc-highlight">1.1 问题说明</a></li><li><a href="#12-实现思路" class="table-of-contents__link toc-highlight">1.2 实现思路</a></li><li><a href="#13-代码开发" class="table-of-contents__link toc-highlight">1.3 代码开发</a></li><li><a href="#14-功能测试" class="table-of-contents__link toc-highlight">1.4 功能测试</a></li><li><a href="#15-代码提交" class="table-of-contents__link toc-highlight">1.5 代码提交</a></li></ul></li><li><a href="#2-缓存套餐" class="table-of-contents__link toc-highlight">2. 缓存套餐</a><ul><li><a href="#21-spring-cache" class="table-of-contents__link toc-highlight">2.1 Spring Cache</a></li><li><a href="#22-实现思路" class="table-of-contents__link toc-highlight">2.2 实现思路</a></li><li><a href="#23-代码开发" class="table-of-contents__link toc-highlight">2.3 代码开发</a></li><li><a href="#24-功能测试" class="table-of-contents__link toc-highlight">2.4 功能测试</a></li><li><a href="#25-代码提交" class="table-of-contents__link toc-highlight">2.5 代码提交</a></li></ul></li><li><a href="#3-添加购物车" class="table-of-contents__link toc-highlight">3. 添加购物车</a><ul><li><a href="#31-需求分析和设计" class="table-of-contents__link toc-highlight">3.1 需求分析和设计</a></li><li><a href="#32-代码开发" class="table-of-contents__link toc-highlight">3.2 代码开发</a></li><li><a href="#33-功能测试" class="table-of-contents__link toc-highlight">3.3 功能测试</a></li><li><a href="#34-代码提交" class="table-of-contents__link toc-highlight">3.4 代码提交</a></li></ul></li><li><a href="#4-查看购物车" class="table-of-contents__link toc-highlight">4. 查看购物车</a><ul><li><a href="#41-需求分析和设计" class="table-of-contents__link toc-highlight">4.1 需求分析和设计</a></li><li><a href="#42-代码开发" class="table-of-contents__link toc-highlight">4.2 代码开发</a></li><li><a href="#43-功能测试" class="table-of-contents__link toc-highlight">4.3 功能测试</a></li><li><a href="#44-代码提交" class="table-of-contents__link toc-highlight">4.4 代码提交</a></li></ul></li><li><a href="#5-清空购物车" class="table-of-contents__link toc-highlight">5. 清空购物车</a><ul><li><a href="#51-需求分析和设计" class="table-of-contents__link toc-highlight">5.1 需求分析和设计</a></li><li><a href="#52-代码开发" class="table-of-contents__link toc-highlight">5.2 代码开发</a></li><li><a href="#53-功能测试" class="table-of-contents__link toc-highlight">5.3 功能测试</a></li><li><a href="#54-代码提交" class="table-of-contents__link toc-highlight">5.4 代码提交</a></li></ul></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>