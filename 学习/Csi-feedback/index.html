<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-学习/Csi-feedback" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Csi-feedback | Coisini</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://doc.minddiy.top/学习/Csi-feedback/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Csi-feedback | Coisini"><meta data-rh="true" name="description" content="这个代码仿真实现了CsiNet,CsiCNNTransformerNet,CsiTransformerNet,CS_Net"><meta data-rh="true" property="og:description" content="这个代码仿真实现了CsiNet,CsiCNNTransformerNet,CsiTransformerNet,CS_Net"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://doc.minddiy.top/学习/Csi-feedback/"><link data-rh="true" rel="alternate" href="https://doc.minddiy.top/学习/Csi-feedback/" hreflang="en"><link data-rh="true" rel="alternate" href="https://doc.minddiy.top/学习/Csi-feedback/" hreflang="x-default"><meta name="google-site-verification" content="1FUPX6Qo4y3ecU623ShEurhgnjhSTjK49rRMhEDlzFA">
<link rel="stylesheet" href="/katex/katex.min.css">
<script src="/js/matomo.js" async defer="defer"></script><link rel="stylesheet" href="/assets/css/styles.79037026.css">
<script src="/assets/js/runtime~main.468f2b27.js" defer="defer"></script>
<script src="/assets/js/main.4763ab3e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Chialisp Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Coisini</b></a></div><div class="navbar__items navbar__items--right"><a href="https://minddiy.top" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Main site<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/分享/">分享</a><button aria-label="Expand sidebar category &#x27;分享&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/读书笔记/">读书笔记</a><button aria-label="Expand sidebar category &#x27;读书笔记&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/技巧/">技巧</a><button aria-label="Expand sidebar category &#x27;技巧&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/数学/">数学</a><button aria-label="Expand sidebar category &#x27;数学&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/思考/">思考</a><button aria-label="Expand sidebar category &#x27;思考&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/学习/">学习</a><button aria-label="Collapse sidebar category &#x27;学习&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/周报/">周报</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/学习/我的八股/">我的八股</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/学习/工程矩阵/工程矩阵笔记/">工程矩阵</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/学习/DOA估计/">DOA估计</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/学习/克拉美-罗界/">Cramer-Rao Lower Bound</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/学习/Csi-feedback/">Csi-feedback</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/学习/通信笔记/">通信笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/学习/DFT/">DFT</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/学习/信息论基础/">信息论基础知识</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/码农/">码农</a><button aria-label="Expand sidebar category &#x27;码农&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/毛选/">毛选</a><button aria-label="Expand sidebar category &#x27;毛选&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/学习/"><span itemprop="name">学习</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Csi-feedback</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Csi-feedback</h1></header>
<blockquote>
<p>这个代码仿真实现了Csi_Net,Csi_CNN_Transformer_Net,Csi_Transformer_Net,CS_Net</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="load-data-and-pre-processing-data">load data and pre-processing data<a href="#load-data-and-pre-processing-data" class="hash-link" aria-label="Direct link to load data and pre-processing data" title="Direct link to load data and pre-processing data">​</a></h2>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> h5py</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> torch</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">utils</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">data </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> Dataset</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">img_height </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">img_width </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">img_channels </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">DatasetFolder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">Dataset</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> matData</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">matdata </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> matData</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__len__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">matdata</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__getitem__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> index</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">matdata</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">index</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">load_data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        file_path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        shuffle </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">False</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        train_test_ratio</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0.8</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        batch_size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        num_workers</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        pin_memory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        drop_last</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;loading data...&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    mat </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> h5py</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">File</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;Hdata.mat&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;r&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    data </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">transpose</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">mat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;H_train&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    data </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">astype</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;float32&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    data </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">reshape</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> img_channels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> img_height</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> img_width</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Use only 1/40 of the data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    num_samples </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    reduced_size </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> num_samples </span><span class="token operator" style="color:hsl(221, 87%, 60%)">//</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">40</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    data </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">reduced_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> shuffle</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        data_copy </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">copy</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        data_transpose </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> data_copy</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">transpose</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">random</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">shuffle</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">data_transpose</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        data_shuffle </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> data_transpose</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">transpose</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    partition </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">int</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> train_test_ratio</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    x_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x_test </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">partition</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">partition</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    x_train_shuffle</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x_test_shuffle </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> data_shuffle</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">partition</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> data_shuffle</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">partition</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># dataLoader for training</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    train_dataset </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> DatasetFolder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    train_loader </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">utils</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">DataLoader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">train_dataset</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> batch_size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">batch_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                                               shuffle</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> num_workers</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">num_workers</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                                               pin_memory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">pin_memory</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> drop_last</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">drop_last</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># dataLoader for validating</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    test_dataset </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> DatasetFolder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    test_loader </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">utils</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">DataLoader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">test_dataset</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> batch_size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">batch_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                                              shuffle</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">False</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> num_workers</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">num_workers</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> pin_memory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">pin_memory</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> shuffle</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        train_shuffle_dataset </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> DatasetFolder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_train_shuffle</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        train_shuffle_loader </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">utils</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">DataLoader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">train_shuffle_dataset</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> batch_size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">batch_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                                                  shuffle</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">False</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> num_workers</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">num_workers</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> pin_memory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">pin_memory</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        test_shuffle_dataset </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> DatasetFolder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_test_shuffle</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        test_shuffle_loader </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">utils</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">DataLoader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">test_shuffle_dataset</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> batch_size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">batch_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                                                          shuffle</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">False</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> num_workers</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">num_workers</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> pin_memory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">pin_memory</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> train_loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> test_loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> train_dataset</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> test_dataset</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain">                train_shuffle_loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> test_shuffle_loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> train_shuffle_dataset</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> test_shuffle_dataset</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> train_loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> test_loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> train_dataset</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> test_dataset</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="loss">loss<a href="#loss" class="hash-link" aria-label="Direct link to loss" title="Direct link to loss">​</a></h2>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">nn </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> nn</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">NMSE</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x_hat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    x_real </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">reshape</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    x_imag </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">reshape</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    x_hat_real </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">reshape</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_hat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_hat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    x_hat_imag </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">reshape</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_hat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_hat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    x_C </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> x_real </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.5</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1j</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_imag </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    x_hat_C </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> x_hat_real </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.5</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1j</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_hat_imag </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    power </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">abs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_C</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">**</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> axis</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    mse </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">abs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_C </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> x_hat_C</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">**</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> axis</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    nmse </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">mean</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">mse </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> power</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> nmse</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">NMSE_cuda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x_hat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    x_real </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    x_imag </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    x_hat_real </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> x_hat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">contiguous</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_hat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    x_hat_imag </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> x_hat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">contiguous</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_hat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    power </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_real </span><span class="token operator" style="color:hsl(221, 87%, 60%)">**</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> x_imag </span><span class="token operator" style="color:hsl(221, 87%, 60%)">**</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> axis</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    mse </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_real </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> x_hat_real</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">**</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_imag </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> x_hat_imag</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">**</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> axis</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    nmse </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> mse </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> power</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> nmse</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">NMSELoss</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Module</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> reduction</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;sum&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">super</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">NMSELoss</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">reduction </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> reduction</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">forward</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x_hat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        nmse </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> NMSE_cuda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x_hat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">reduction </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;mean&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            nmse </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">mean</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">nmse</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            nmse </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">nmse</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> nmse</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rho</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x_hat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    x_real </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    x_imag </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    x_hat_real </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> x_hat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">contiguous</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_hat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    x_hat_imag </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> x_hat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">contiguous</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_hat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cos </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">CosineSimilarity</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">dim</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> eps</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    out_real </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> cos</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_real</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain">x_hat_real</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    out_imag </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> cos</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_imag</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x_hat_imag</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    result_real </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> out_real</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">out_real</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    reault_imag </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> out_imag</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">out_imag</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.5</span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">result_real </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> reault_imag</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">CosSimilarity</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Module</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> reduction</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;sum&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">super</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">CosSimilarity</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">reduction </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> reduction</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">forward</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x_hat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cos </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> rho</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x_hat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># if self.reduction == &#x27;mean&#x27;:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)">#     cos = torch.mean(cos)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># else:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)">#     cos = torch.sum(cos)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> cos</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="modules">Modules<a href="#modules" class="hash-link" aria-label="Direct link to Modules" title="Direct link to Modules">​</a></h2>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">functional </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> F</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> collections </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> OrderedDict</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">conv3x3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">in_planes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> out_planes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> stride</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">&quot;&quot;&quot;3x3 convolution with padding&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Conv2d</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">in_planes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> out_planes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> kernel_size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> stride</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">stride</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                     padding</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> bias</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">ConvBN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Sequential</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> in_planes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> out_planes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> kernel_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> stride</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> groups</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">not</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">isinstance</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">kernel_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">int</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            padding </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">i </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">//</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> i </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> kernel_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            padding </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">kernel_size </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">//</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">super</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">ConvBN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">OrderedDict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;conv&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Conv2d</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">in_planes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> out_planes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> kernel_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> stride</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                               padding</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">padding</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> groups</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">groups</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> bias</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">False</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;bn&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">BatchNorm2d</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">out_planes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;LeakyReLU&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">LeakyReLU</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">negative_slope</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0.3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> inplace</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">False</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">ConvBN_linear</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Sequential</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> in_planes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> out_planes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> kernel_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> stride</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> groups</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">not</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">isinstance</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">kernel_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">int</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            padding </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">i </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">//</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> i </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> kernel_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            padding </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">kernel_size </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">//</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">super</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">ConvBN_linear</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">OrderedDict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;conv&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Conv2d</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">in_planes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> out_planes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> kernel_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> stride</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                               padding</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">padding</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> groups</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">groups</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> bias</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">False</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;bn&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">BatchNorm2d</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">out_planes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">ResBlock</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Module</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> ch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> nblocks</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> shortcut</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">super</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">shortcut </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> shortcut</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">module_list </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ModuleList</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> i </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">range</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">nblocks</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            resblock_one </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ModuleList</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            resblock_one</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">ConvBN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">ch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            resblock_one</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">ConvBN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            resblock_one</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">ConvBN_linear</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> ch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">module_list</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">resblock_one</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">forward</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> module </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">module_list</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            h </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> x</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> res </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> module</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                h </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> res</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">h</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            x </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> x </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> h </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">shortcut </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"> h</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> x</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">PatchEmbed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Module</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> H</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> W</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> patch_size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> in_chans</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> embed_dim</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">super</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        num_patches </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> H </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> W </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> patch_size </span><span class="token operator" style="color:hsl(221, 87%, 60%)">**</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">img_size </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">H</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> W</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">patch_size </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">patch_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> patch_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">num_patches </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> num_patches</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">proj </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Conv2d</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">in_chans</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> embed_dim</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> kernel_size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">patch_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> stride</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">patch_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">forward</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        x </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">proj</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">flatten</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">transpose</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> x</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">FixedPositionalEncoding</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Module</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> embedding_dim</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> max_length</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">5000</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">super</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">FixedPositionalEncoding</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        pe </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">zeros</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">max_length</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> embedding_dim</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        position </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">arange</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> max_length</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> dtype</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">float</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">unsqueeze</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        div_term </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">exp</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">arange</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> embedding_dim</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">float</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain">torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">log</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">tensor</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">10000.0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> embedding_dim</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        pe</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">sin</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">position </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> div_term</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        pe</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">cos</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">position </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> div_term</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        pe </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> pe</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">unsqueeze</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">transpose</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">register_buffer</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;pe&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> pe</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">forward</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        x </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> x </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">pe</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> x</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">TransformerEncoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Module</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> embed_dim</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> num_heads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> dropout</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> feedforward_dim</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">super</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">attn </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">MultiheadAttention</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">embed_dim</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> num_heads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> dropout</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">dropout</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">linear_1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Linear</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">embed_dim</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> feedforward_dim</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">linear_2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Linear</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feedforward_dim</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> embed_dim</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">layernorm_1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">LayerNorm</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">embed_dim</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">layernorm_2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">LayerNorm</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">embed_dim</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">forward</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x_in</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        attn_out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> _ </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">attn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_in</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x_in</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x_in</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        x </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">layernorm_1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_in </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> attn_out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        ff_out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">linear_2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">functional</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">relu</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">linear_1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        x </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">layernorm_2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> ff_out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> x</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">Csi_Encoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Module</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">super</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">Csi_Encoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">convban </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Sequential</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">OrderedDict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;conv3x3_bn&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> ConvBN_linear</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">fc </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Linear</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">2048</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">int</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">forward</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x_in</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        x_in </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> x_in</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">convban</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_in</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">fc</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> out</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">Csi_Decoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Module</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">super</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">Csi_Decoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">feedback_bits </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> feedback_bits</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">fc </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Linear</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">int</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1024</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        decoder </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> OrderedDict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;decoder1&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain">ResBlock</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;LeakyReLU&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">LeakyReLU</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">negative_slope</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0.3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> inplace</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">False</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;decoder2&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain">ResBlock</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">decoder_feature </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Sequential</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">decoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">out_cov </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> ConvBN_linear</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">sig </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Sigmoid</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">forward</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> x</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">fc</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">decoder_feature</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">out_cov</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">sig</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> out</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">Csi_Attention_Encoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Module</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">super</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">Csi_Attention_Encoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># with positional encoding</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># self.patch_embedding = nn.Sequential(OrderedDict([</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)">#     (&quot;patch_embedding&quot;, PatchEmbed(H=16, W=32, patch_size=4, in_chans=2, embed_dim=32))</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># ]))</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># self.positional_encoding = nn.Sequential(OrderedDict([</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)">#     (&quot;positional_encoding&quot;, FixedPositionalEncoding(32,32))</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># ]))</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># self.transformer_layer =  nn.Sequential(OrderedDict([</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)">#     (&quot;transformer_encoder1&quot;, TransformerEncoder(32,8,0,512)) # after [32, 512, 32]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># ])) # for added positional encoding</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># without positional encoding</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">conv_layer </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> ConvBN_linear</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">transformer_layer </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Sequential</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">OrderedDict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;transformer_encoder1&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> TransformerEncoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">64</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">512</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># without positional encoding</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">fc </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Linear</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">2048</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">int</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">forward</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x_in</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># with pos encoding</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)">##x_in = self.patch_embedding(x_in)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)">##x_in = self.positional_encoding(x_in)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># without pos encoding</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        x_in </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> x_in</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        x_in </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">conv_layer</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_in</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        x_in </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> x_in</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">64</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">transformer_layer</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x_in</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)">#out = out.contiguous().view(32,-1) with pos encoding</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">contiguous</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2048</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># without pos encoding</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">fc</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> out</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">Csi_Attention_Decoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Module</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">super</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">Csi_Attention_Decoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">feedback_bits </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> feedback_bits</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">fc </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Linear</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">int</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2048</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        decoder </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> OrderedDict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;transformer_decoder1&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain">TransformerEncoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">64</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain">feedforward_dim</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">128</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">decoder_feature </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Sequential</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">decoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">conv_linear </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> ConvBN_linear</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">sig </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Sigmoid</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">forward</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> x</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">fc</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">64</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">decoder_feature</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">conv_linear</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">sig</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> out</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">Csi_Net</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Module</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">super</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">Csi_Net</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">encoder </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> Csi_Encoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">decoder </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> Csi_Decoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">forward</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        feature </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">encoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">decoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feature</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> out</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">Csi_Transformer_Net</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Module</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">super</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">Csi_Transformer_Net</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">encoder </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> Csi_Attention_Encoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">decoder </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> Csi_Attention_Decoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">forward</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        feature </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">encoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">decoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feature</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> out</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">CS_Net</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Module</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">super</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">CS_Net</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">A </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">random</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">uniform</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">low</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token number" style="color:hsl(35, 99%, 36%)">0.5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> high</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0.5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">1024</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">A </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">from_numpy</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">A</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">A </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">A</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">float</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">decoder </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> Csi_Decoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">forward</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        x </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> x @ self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">A</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">decoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> out</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">Csi_CNN_Transformer_Net</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">nn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">Module</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">super</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">Csi_CNN_Transformer_Net</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">encoder </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> Csi_Encoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">decoder </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> Csi_Attention_Decoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">forward</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        feature </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">encoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        out </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">decoder</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feature</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="image-segmentation">image segmentation<a href="#image-segmentation" class="hash-link" aria-label="Direct link to image segmentation" title="Direct link to image segmentation">​</a></h2>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> matplotlib </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> plt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> random</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> time</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> matplotlib</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">pyplot </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> plt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">gpu_list </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;0&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">os</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;CUDA_VISIBLE_DEVICES&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> gpu_list</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">seed_everything</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">seed</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">42</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    random</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    os</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;PYTHONHASHSEED&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">random</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">manual_seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">cuda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">manual_seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">backends</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">cudnn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">deterministic </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">channel_visualization</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">image</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    fig</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> ax </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> plt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">subplots</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ax</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">imshow</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">image</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> cmap</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">plt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">cm</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">gray</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> interpolation</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;nearest&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> origin</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;upper&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ax</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">spines</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;left&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">set_position</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;outward&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">10</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ax</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">spines</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;bottom&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">set_position</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;outward&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">10</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ax</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">spines</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;right&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">set_visible</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">False</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ax</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">spines</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;top&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">set_visible</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">False</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ax</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">yaxis</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">set_ticks_position</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;left&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ax</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">xaxis</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">set_ticks_position</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;bottom&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    plt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">show</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">SEED </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">42</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;seeding everything...&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">seed_everything</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">SEED</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;initializing parameters...&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">model_trainer</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                 epochs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                 net</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                 feedbackbits</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">128</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                 batch_size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                 learning_rate</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1e-3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                 lr_decay_freq</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">30</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                 lr_decay</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0.1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                 best_loss</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">100</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                 num_workers</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                 print_freq</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">100</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                 train_test_ratio</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0.8</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">epochs </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> epochs</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">batch_size </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> batch_size</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">learning_rate </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> learning_rate</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">lr_decay_freq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> lr_decay_freq</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">lr_decay </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> lr_decay</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">best_loss </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> best_loss</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">num_workers </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> num_workers</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">print_freq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> print_freq</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">train_test_ratio </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> train_test_ratio</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># parameters for data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">feedback_bits </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> feedbackbits</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">img_height </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">img_width </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">img_channels </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">model </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">eval</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">net</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">feedback_bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">x_label </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">y_label </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ys_label </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">t_label </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># if len(gpu_list.split(&#x27;,&#x27;)) &gt; 1:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)">#     self.model = torch.nn.DataParallel(self.model).cuda()  # model.module</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># else:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)">#     self.model = self.model.cuda()</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">model </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">model</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">criterion </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> NMSELoss</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">reduction</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;mean&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># nn.MSELoss()</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">criterion_test </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> NMSELoss</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">reduction</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;sum&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># self.criterion_rho = CosSimilarity(reduction=&#x27;mean&#x27;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># self.criterion_test_rho = CosSimilarity(reduction=&#x27;sum&#x27;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">optimizer </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">optim</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">AdamW</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">model</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">parameters</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> lr</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">learning_rate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># train_loader, test_loader, train_dataset, test_dataset, \</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># train_shuffle_loader, test_shuffle_loader, train_shuffle_dataset, test_shuffle_dataset</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">train_loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">test_loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">train_dataset</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">test_dataset</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">train_shuffle_loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">test_shuffle_loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">train_shuffle_dataset</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">test_shuffle_dataset </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">             load_data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;data/&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain">shuffle </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">model_save</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> model_path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;Saving the entire model...&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">save</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">model</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> model_path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f&#x27;Model saved to </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">model_path</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;Model saved!&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">best_loss </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">average_loss</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">model_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> epoch </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">range</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">epochs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;========================&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;lr:%.4e&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">%</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">optimizer</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">param_groups</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;lr&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># train model</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">model</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">   </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># decay lr</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> epoch </span><span class="token operator" style="color:hsl(221, 87%, 60%)">%</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">lr_decay_freq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">and</span><span class="token plain"> epoch </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">optimizer</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">param_groups</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;lr&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">optimizer</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">param_groups</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;lr&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">lr_decay</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># training...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">input</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">enumerate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">train_loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># input = input.cuda()  # input [batch=32,2,16,32]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                output </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">model</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                loss </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">criterion</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">output</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                loss</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">backward</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">optimizer</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">step</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">optimizer</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">zero_grad</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> i </span><span class="token operator" style="color:hsl(221, 87%, 60%)">%</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">print_freq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;Epoch: [{0}][{1}/{2}]\t&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                          </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;Loss {loss:.4f}\t&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">format</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                        epoch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">train_loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> loss</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">loss</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">item</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">model</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">eval</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># evaluating...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">total_loss </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">total_rho </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            start </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">time</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">with</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">no_grad</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">input</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">enumerate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">test_loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># input = input.cuda()</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                    output </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">model</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                    self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">total_loss </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">criterion_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">output</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">item</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># self.total_rho += self.criterion_rho(output,input).item()</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                    </span><span class="token comment" style="color:hsl(230, 4%, 64%)">#print(rho(output,input), type(rho(output,input)))</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                    self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">total_rho </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">rho</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">output</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                end </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> time</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">time</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                t </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> end </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> start</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">average_loss </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">total_loss </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">test_dataset</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">average_rho </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">total_rho </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">list</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">enumerate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">test_loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">x_label</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">epoch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">y_label</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">average_loss</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">t_label</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;NMSE %.4f ρ %.3f time %.3f&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">%</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">average_loss</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">average_rho</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">input</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">enumerate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">test_loader</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># visualize one sample</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> i </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># set shuffle = False to ensure the same sample each time</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                ones </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ones</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                image1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                image1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> ones </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> image1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                image1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> image1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">numpy</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                channel_visualization</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">image1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># input = input.cuda()</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                output </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">model</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                output </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> output</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">cpu</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                image2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> output</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">view</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                image2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> ones </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> image2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                image2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> image2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">detach</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">numpy</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                channel_visualization</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">image2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">x_label</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">y_label</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">t_label</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">t_label</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># , self.ys_label</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">seeding everything...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">initializing parameters...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="train">train<a href="#train" class="hash-link" aria-label="Direct link to train" title="Direct link to train">​</a></h2>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> matplotlib</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">pyplot </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> plt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> h5py</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> torch</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">nn </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> nn</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> random</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># gpu_list = &#x27;0&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># os.environ[&quot;CUDA_VISIBLE_DEVICES&quot;] = gpu_list</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">seed_everything</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">seed</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">42</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    random</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    os</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;PYTHONHASHSEED&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">random</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">manual_seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">cuda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">manual_seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    torch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">backends</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">cudnn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">deterministic </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">SEED </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">42</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">seed_everything</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">SEED</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># bits = 256</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bits </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">128</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># bits = 64</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># bits = 32</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="csi_net">Csi_Net<a href="#csi_net" class="hash-link" aria-label="Direct link to Csi_Net" title="Direct link to Csi_Net">​</a></h2>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;=&quot;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token number" style="color:hsl(35, 99%, 36%)">30</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;Encoder: CNN; Decoder: CNN&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;compressed codeword bits: {}&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">format</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">agent3 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> model_trainer</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">epochs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">40</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> net</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;Csi_Net&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain">feedbackbits</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">x3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> agent3_NMSE</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> t3 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> agent3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">model_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;Csi_Net&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">agent3_NMSE</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;average time used is:&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> t3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">plt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> agent3_NMSE</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> label</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;cnn&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 保存模型</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">model_path </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f&#x27;models/Csi_Net_model_</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">bits</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">.pth&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">agent3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">model_save</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">model_path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">==============================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Encoder: CNN; Decoder: CNN</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">compressed codeword bits: 128</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">loading data...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [0][0/200]	Loss 14.1170	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [0][100/200]	Loss 1.6231	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 1.3334 ρ 0.058 time 1.204</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [1][0/200]	Loss 1.2072	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [1][100/200]	Loss 1.3410	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 1.1423 ρ 0.174 time 0.573</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [2][0/200]	Loss 1.1115	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [2][100/200]	Loss 1.1585	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 1.0452 ρ 0.293 time 0.535</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [3][0/200]	Loss 1.0717	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [3][100/200]	Loss 0.9346	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.8754 ρ 0.463 time 1.153</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [4][0/200]	Loss 0.8362	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [4][100/200]	Loss 0.6380	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.6576 ρ 0.614 time 0.521</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [5][0/200]	Loss 0.6203	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [5][100/200]	Loss 0.5353	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.5380 ρ 0.693 time 0.568</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [6][0/200]	Loss 0.5071	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [6][100/200]	Loss 0.5355	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.4787 ρ 0.733 time 0.545</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [7][0/200]	Loss 0.4867	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [7][100/200]	Loss 0.4088	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.4406 ρ 0.759 time 0.640</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [8][0/200]	Loss 0.4613	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [8][100/200]	Loss 0.4002	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.4013 ρ 0.782 time 0.528</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [9][0/200]	Loss 0.3757	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [9][100/200]	Loss 0.3755	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3983 ρ 0.787 time 0.537</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [10][0/200]	Loss 0.3914	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [10][100/200]	Loss 0.4193	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.4489 ρ 0.762 time 0.529</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [11][0/200]	Loss 0.4755	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [11][100/200]	Loss 0.3684	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3594 ρ 0.809 time 0.515</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [12][0/200]	Loss 0.3788	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [12][100/200]	Loss 0.3704	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3356 ρ 0.820 time 0.580</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [13][0/200]	Loss 0.3617	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [13][100/200]	Loss 0.3398	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3221 ρ 0.827 time 0.750</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [14][0/200]	Loss 0.3272	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [14][100/200]	Loss 0.4293	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3350 ρ 0.820 time 0.525</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [15][0/200]	Loss 0.3543	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [15][100/200]	Loss 0.3455	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3119 ρ 0.835 time 0.516</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [16][0/200]	Loss 0.2992	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [16][100/200]	Loss 0.9529	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.2986 ρ 0.840 time 0.599</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [17][0/200]	Loss 0.2856	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [17][100/200]	Loss 0.3119	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.2954 ρ 0.843 time 0.573</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [18][0/200]	Loss 0.2677	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [18][100/200]	Loss 0.2961	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.2801 ρ 0.850 time 0.847</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [19][0/200]	Loss 0.2459	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [19][100/200]	Loss 0.2546	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.2758 ρ 0.852 time 0.615</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [20][0/200]	Loss 0.2563	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [20][100/200]	Loss 0.2762	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.2699 ρ 0.855 time 0.553</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [21][0/200]	Loss 0.2847	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [21][100/200]	Loss 0.2760	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.2617 ρ 0.859 time 0.501</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [22][0/200]	Loss 0.2808	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [22][100/200]	Loss 0.2431	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.2645 ρ 0.856 time 1.056</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [23][0/200]	Loss 0.2779	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [23][100/200]	Loss 0.2001	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.2553 ρ 0.863 time 1.128</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [24][0/200]	Loss 0.2286	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [24][100/200]	Loss 0.2272	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.2539 ρ 0.864 time 0.647</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [25][0/200]	Loss 0.2420	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [25][100/200]	Loss 0.2283	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.2385 ρ 0.871 time 0.533</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [26][0/200]	Loss 0.1934	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [26][100/200]	Loss 0.2241	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.2377 ρ 0.871 time 0.531</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [27][0/200]	Loss 0.2343	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [27][100/200]	Loss 0.2251	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.2111 ρ 0.884 time 0.531</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [28][0/200]	Loss 0.1790	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [28][100/200]	Loss 0.1600	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.2141 ρ 0.883 time 0.520</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [29][0/200]	Loss 0.1748	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [29][100/200]	Loss 0.1895	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.2047 ρ 0.888 time 0.562</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [30][0/200]	Loss 0.1748	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [30][100/200]	Loss 0.1557	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.1984 ρ 0.892 time 0.519</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [31][0/200]	Loss 0.1814	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [31][100/200]	Loss 0.2022	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.1978 ρ 0.892 time 0.544</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [32][0/200]	Loss 0.1897	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [32][100/200]	Loss 0.1875	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.1973 ρ 0.893 time 0.514</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [33][0/200]	Loss 0.1683	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [33][100/200]	Loss 0.1652	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.1970 ρ 0.893 time 0.532</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [34][0/200]	Loss 0.2179	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [34][100/200]	Loss 0.1884	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.1967 ρ 0.893 time 0.513</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [35][0/200]	Loss 0.1835	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [35][100/200]	Loss 0.1834	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.1962 ρ 0.893 time 0.618</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [36][0/200]	Loss 0.1966	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [36][100/200]	Loss 0.1879	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.1959 ρ 0.893 time 0.558</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [37][0/200]	Loss 0.1554	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [37][100/200]	Loss 0.2014	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.1955 ρ 0.894 time 0.532</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [38][0/200]	Loss 0.1609	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [38][100/200]	Loss 0.1458	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.1952 ρ 0.894 time 0.611</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [39][0/200]	Loss 0.1746	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [39][100/200]	Loss 0.2031	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.1949 ρ 0.894 time 0.560</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="png" src="/assets/images/main_11_1-3014337ea8968e4a00699b98a915ddd1.png" width="430" height="427" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="png" src="/assets/images/main_11_2-c6eedac20c3cc2c9a4c6ee6d956f7164.png" width="430" height="427" class="img_ev3q"></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Csi_Net</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[1.3333566904067993, 1.1422800970077516, 1.0451844179630279, 0.8753661751747132, 0.6575556528568268, 0.5379940551519394, 0.4787355536222458, 0.4405597126483917, 0.40132262706756594, 0.39827447295188906, 0.4489418357610703, 0.3594482445716858, 0.33555667102336884, 0.322117959856987, 0.3350206232070923, 0.31192928612232207, 0.29864764750003814, 0.29539691090583803, 0.2801084813475609, 0.27577628135681154, 0.2699457517266273, 0.2617357462644577, 0.264499531686306, 0.2552609643340111, 0.2539336371421814, 0.2384874066710472, 0.237672161757946, 0.211108820438385, 0.2141134124994278, 0.20471315175294877, 0.1983871877193451, 0.1978167027235031, 0.19734854340553284, 0.19701571255922318, 0.1967495545744896, 0.1962449449300766, 0.19589142352342606, 0.1955234381556511, 0.19522991210222243, 0.1948663568496704]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">average time used is: 0.6228328704833984</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Saving the entire model...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Model saved to models/Csi_Net_model_128.pth</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Model saved!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="png" src="/assets/images/main_11_4-0889c4796fbec85f60624d0950022c21.png" width="547" height="413" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="csi_transformer_net">Csi_Transformer_Net<a href="#csi_transformer_net" class="hash-link" aria-label="Direct link to Csi_Transformer_Net" title="Direct link to Csi_Transformer_Net">​</a></h2>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;=&quot;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token number" style="color:hsl(35, 99%, 36%)">30</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;Encoder: transformer; Decoder: transformer&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;compressed codeword bits: {}&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">format</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">agent1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> model_trainer</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">epochs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">40</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> net</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;Csi_Transformer_Net&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain">feedbackbits</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">x1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> agent1_NMSE</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> t1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> agent1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">model_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;Csi_Transformer_Net&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">agent1_NMSE</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;average time used is:&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> t1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">plt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> agent1_NMSE</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> label</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;Csi_Transformer_Net&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 保存模型</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">model_path </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f&#x27;models/Csi_Transformer_Net_model_</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">bits</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">.pth&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">agent1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">model_save</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">model_path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">==============================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Encoder: transformer; Decoder: transformer</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">compressed codeword bits: 128</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">loading data...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [0][0/200]	Loss 16.8835	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [0][100/200]	Loss 2.8815	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 1.9566 ρ 0.061 time 1.629</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [1][0/200]	Loss 1.9483	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [1][100/200]	Loss 1.5439	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 1.3547 ρ 0.370 time 1.601</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [2][0/200]	Loss 1.3673	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [2][100/200]	Loss 1.2373	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 1.1730 ρ 0.497 time 1.647</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [3][0/200]	Loss 1.0943	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [3][100/200]	Loss 1.0867	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 1.0903 ρ 0.565 time 1.658</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [4][0/200]	Loss 1.0267	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [4][100/200]	Loss 1.0023	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 1.0311 ρ 0.614 time 0.919</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [5][0/200]	Loss 1.0738	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [5][100/200]	Loss 0.9662	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.9886 ρ 0.622 time 0.737</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [6][0/200]	Loss 0.9682	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [6][100/200]	Loss 0.9577	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.9677 ρ 0.648 time 0.792</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [7][0/200]	Loss 0.8769	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [7][100/200]	Loss 0.9669	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.9511 ρ 0.663 time 0.759</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [8][0/200]	Loss 0.9183	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [8][100/200]	Loss 0.8877	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.9386 ρ 0.662 time 0.894</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [9][0/200]	Loss 0.9066	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [9][100/200]	Loss 0.8874	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.7703 ρ 0.700 time 0.754</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [10][0/200]	Loss 0.7551	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [10][100/200]	Loss 0.6318	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.6484 ρ 0.733 time 0.902</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [11][0/200]	Loss 0.6150	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [11][100/200]	Loss 0.6004	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.5911 ρ 0.756 time 0.774</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [12][0/200]	Loss 0.5684	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [12][100/200]	Loss 0.5429	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.5425 ρ 0.755 time 0.776</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [13][0/200]	Loss 0.5027	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [13][100/200]	Loss 0.5482	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.5385 ρ 0.757 time 0.773</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [14][0/200]	Loss 0.5368	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [14][100/200]	Loss 0.4899	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.5361 ρ 0.760 time 0.761</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [15][0/200]	Loss 0.5421	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [15][100/200]	Loss 0.5330	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.5345 ρ 0.762 time 0.777</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [16][0/200]	Loss 0.4967	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [16][100/200]	Loss 0.5264	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.5326 ρ 0.759 time 0.809</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [17][0/200]	Loss 0.5447	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [17][100/200]	Loss 0.5212	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.5316 ρ 0.767 time 0.911</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [18][0/200]	Loss 0.4953	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [18][100/200]	Loss 0.5240	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.5301 ρ 0.761 time 0.918</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [19][0/200]	Loss 0.4699	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [19][100/200]	Loss 0.5144	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.5300 ρ 0.760 time 0.775</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [20][0/200]	Loss 0.5295	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [20][100/200]	Loss 0.5224	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.5300 ρ 0.761 time 0.792</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [21][0/200]	Loss 0.4950	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [21][100/200]	Loss 0.5359	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.5283 ρ 0.764 time 0.821</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [22][0/200]	Loss 0.5202	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [22][100/200]	Loss 0.5535	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.5279 ρ 0.765 time 0.844</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [23][0/200]	Loss 0.5108	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [23][100/200]	Loss 0.5283	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.5328 ρ 0.750 time 0.785</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [24][0/200]	Loss 0.5188	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [24][100/200]	Loss 0.4741	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.5282 ρ 0.761 time 0.776</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [25][0/200]	Loss 0.4862	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [25][100/200]	Loss 0.4990	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.5272 ρ 0.761 time 1.599</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [26][0/200]	Loss 0.4873	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [26][100/200]	Loss 0.4856	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.5251 ρ 0.764 time 1.647</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [27][0/200]	Loss 0.4745	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [27][100/200]	Loss 0.5390	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.5240 ρ 0.765 time 1.595</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [28][0/200]	Loss 0.4830	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [28][100/200]	Loss 0.3965	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.4337 ρ 0.792 time 1.619</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [29][0/200]	Loss 0.4264	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [29][100/200]	Loss 0.4338	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.4340 ρ 0.784 time 1.655</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [30][0/200]	Loss 0.4309	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [30][100/200]	Loss 0.4537	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.4268 ρ 0.795 time 1.595</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [31][0/200]	Loss 0.4027	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [31][100/200]	Loss 0.4340	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.4264 ρ 0.796 time 1.602</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [32][0/200]	Loss 0.4187	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [32][100/200]	Loss 0.3953	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.4264 ρ 0.794 time 1.624</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [33][0/200]	Loss 0.4534	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [33][100/200]	Loss 0.3923	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.4260 ρ 0.797 time 1.643</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [34][0/200]	Loss 0.3964	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [34][100/200]	Loss 0.4492	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.4259 ρ 0.797 time 1.596</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [35][0/200]	Loss 0.4250	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [35][100/200]	Loss 0.4602	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.4257 ρ 0.797 time 1.619</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [36][0/200]	Loss 0.3898	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [36][100/200]	Loss 0.3978	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.4255 ρ 0.796 time 1.591</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [37][0/200]	Loss 0.3960	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [37][100/200]	Loss 0.3914	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.4252 ρ 0.798 time 1.620</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [38][0/200]	Loss 0.4531	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [38][100/200]	Loss 0.4079	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3436 ρ 0.836 time 1.630</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [39][0/200]	Loss 0.3105	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [39][100/200]	Loss 0.3446	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3365 ρ 0.839 time 1.663</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="png" src="/assets/images/main_13_1-3014337ea8968e4a00699b98a915ddd1.png" width="430" height="427" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="png" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAa4AAAGrCAYAAACYOHMpAAAAOXRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjkuMSwgaHR0cHM6Ly9tYXRwbG90bGliLm9yZy/TGe4hAAAACXBIWXMAAA9hAAAPYQGoP6dpAAAmH0lEQVR4nO3de2zV9f3H8VcpPadA24Pl0ssoyEVBRDBDrI3KEDouSwgKf+AlGTgCgRUzqE7t4n0zZSzztlT4Yw5mIqIuotFEnFYpcSs4qgSvDZAqOGiZZO2BQk9L+/39YTi/VSied3u+nH5On4/kJPacj5/z+V7OeXF6Tl8nxfM8TwAAOKJfohcAAIAFwQUAcArBBQBwCsEFAHAKwQUAcArBBQBwCsEFAHAKwQUAcEqvCy7P8xQOh8XfRQMAzqd/ohfwfSdOnFAoFFJTU5OysrJM/+8f//hH0/j29vaYx/bv3+t2lS86OjpiHtvW1maa27K/razHxzLeum7LfunXz/Zvx7S0NNN4y3b6+Y9Fy3nlt5SUFF/Gdme8hfX4WMb7uW6r0tLSHxzj2yuuiooKXXrppUpPT1dhYaE+/PBDv+4KANCH+BJcL730kkpLS/Xwww/ro48+0pQpUzRnzhwdO3bMj7sDAPQhvgTXE088oeXLl+vOO+/UxIkTtXHjRg0cOFB/+ctf/Lg7AEAfEvfgam1tVU1NjYqLi///Tvr1U3Fxsaqrq+N9dwCAPibunzj49ttv1d7erpycnE7X5+Tk6MsvvzxnfCQSUSQSif4cDofjvSQAQBJJ+Mfhy8vLFQqFopeCgoJELwkA0IvFPbiGDh2q1NRUNTQ0dLq+oaFBubm554wvKytTU1NT9HL48OF4LwkAkETiHlyBQEBTp05VZWVl9LqOjg5VVlaqqKjonPHBYFBZWVmdLgAAdMWXv6otLS3VkiVLdM011+jaa6/VU089pebmZt15551+3B0AoA/xJbgWL16s//znP3rooYdUX1+vq6++Wtu3bz/nAxsAAFj51mO0evVqrV692q/pz6u1tdU03lK387+ffMR3rDUxftZmWetwLOeKta4oNTXVNN7CWrNlGd+b6oosa/FzbvScH/s74Z8qBADAguACADiF4AIAOIXgAgA4heACADiF4AIAOIXgAgA4heACADiF4AIAOIXgAgA4xb8OngRIS0szjbdU+Vjn7i0stVaSv1U7Vu3t7b7Nbdkv1gon6z63sO5zy3hrtZV1vIVlH/amOikrP+f3cx9a+DE3r7gAAE4huAAATiG4AABOIbgAAE4huAAATiG4AABOIbgAAE4huAAATiG4AABOIbgAAE4huAAATkmqrkI/u+3OnDljGt9bOsisLPswEomY5rZ0xElSenp6zGOtvXmW7bSuu62tLeax4XDYNLe1MzMzMzPmsf37254OLMffeq5YznHr8bFsp9/9jX53Ifol0X2PvOICADiF4AIAOIXgAgA4heACADiF4AIAOIXgAgA4heACADiF4AIAOIXgAgA4heACADglqSqfrNUiftbKWNbiZ+2LtYLGsp3W+iHrdlpqgvzch5YKJ8nfOinr+NbWVtN4C8s+T01NNc1t3U4LS32bdR3W7bSwnuO95TnIj4o6XnEBAJxCcAEAnEJwAQCcQnABAJxCcAEAnEJwAQCcQnABAJxCcAEAnEJwAQCcQnABAJxCcAEAnJJUXYVWln4ua1+dpbPM2uVl6R/sTR1k1vGWfejndvrZU+lnl6SVn114fvJzHda5rcfTMr+lA9PKz8eyH8eHV1wAAKfEPbgeeeQRpaSkdLpMmDAh3ncDAOijfPlV4ZVXXql33333/++kf5/+jSQAII58SZT+/fsrNzfXj6kBAH2cL+9x7d+/X/n5+RozZozuuOMOHTp0qMuxkUhE4XC40wUAgK7EPbgKCwu1efNmbd++XRs2bFBdXZ1uvPFGnThx4rzjy8vLFQqFopeCgoJ4LwkAkERSPJ8/09rY2KhRo0bpiSee0LJly865PRKJdPqK9nA4rIKCAjU1NSkrK8t0X+vWrTONt3y0mI/Dn8u67t70UW4Llz8O7+fHlnvLPu8tH8uX/D1X+srH4cvKyn5wjO+fmhg8eLAuv/xyHThw4Ly3B4NBBYNBv5cBAEgSvv8d18mTJ3Xw4EHl5eX5fVcAgD4g7sF1zz33qKqqSl999ZX++c9/6pZbblFqaqpuu+22eN8VAKAPivuvCr/55hvddtttOn78uIYNG6YbbrhBu3bt0rBhw+J9V+ew/p7W8rtXP3+d6ef7HJb32qxzW/8+r6sP6HQlPT3dl7HWtVjf3xwyZEjMYzMzM01znzlzxjS+ubk55rGtra2muS2PH+t5aHksW99Xsjze/Kxwkvx9L9zynpifz0F+/B1v3GfcunVrvKcEACCKrkIAgFMILgCAUwguAIBTCC4AgFMILgCAUwguAIBTCC4AgFMILgCAUwguAIBTCC4AgFN8/1qT3szSK9bS0mKa29LPZe1as/SbWTvILP1m//s9arEYMGCAabxl/kAgYJrbcjwff/xx09wbN26Meeydd95pmtvKUsH28ssvm+a29CxedtllprlDoVDMY63nuOXYW7sh09LSTOMtz0HW5wnL2q19nJZ1Wx+bseAVFwDAKQQXAMApBBcAwCkEFwDAKQQXAMApBBcAwCkEFwDAKQQXAMApBBcAwCkEFwDAKSmepbvjIgiHwwqFQmpqalJWVpbp/12/fr1Pq7JVnPitX7/Y/71hqYeyslbtWMdbWLfTsg+tdTitra0xj7WeV9bxlu20VvNYxlvriiznirWWyc/z0LqdlvGWY9mdtVj4+Xx49913/+AYXnEBAJxCcAEAnEJwAQCcQnABAJxCcAEAnEJwAQCcQnABAJxCcAEAnEJwAQCcQnABAJxCcAEAnNI/0QuIJ7973ywsPWHWdVi61qxz+7luP1nXYum387PzzTq3n52M1n3Y0tIS89iysjLT3JbeUWv3oGWf+9k9KNn2uZ8di67NzSsuAIBTCC4AgFMILgCAUwguAIBTCC4AgFMILgCAUwguAIBTCC4AgFMILgCAUwguAIBTCC4AgFOSqqvQ2uNm6dBqb283ze1nj59lbmt3mqXbrn9/2+lj3YeW45OWlmaau6mpKeaxbW1tprknTpwY89iCggLT3CdPnjSN/+qrr2Ie29jYaJrbYt26dabx1nPFL373cfaWvk8/nyesz8sx3X/cZwQAwEfm4Nq5c6fmz5+v/Px8paSk6LXXXut0u+d5euihh5SXl6cBAwaouLhY+/fvj9d6AQB9nDm4mpubNWXKFFVUVJz39vXr1+uZZ57Rxo0btXv3bg0aNEhz5swxfQUCAABdMb/HNW/ePM2bN++8t3mep6eeekoPPPCAFixYIEl6/vnnlZOTo9dee0233nprz1YLAOjz4voeV11dnerr61VcXBy9LhQKqbCwUNXV1ef9fyKRiMLhcKcLAABdiWtw1dfXS5JycnI6XZ+TkxO97fvKy8sVCoWiF+unrAAAfUvCP1VYVlampqam6OXw4cOJXhIAoBeLa3Dl5uZKkhoaGjpd39DQEL3t+4LBoLKysjpdAADoSlyDa/To0crNzVVlZWX0unA4rN27d6uoqCiedwUA6KPMnyo8efKkDhw4EP25rq5Oe/fuVXZ2tkaOHKk1a9bod7/7nS677DKNHj1aDz74oPLz83XzzTfHc90AgD7KHFx79uzRTTfdFP25tLRUkrRkyRJt3rxZ9957r5qbm7VixQo1Njbqhhtu0Pbt25Wenh6/VXfBUhEk2epWAoGAaW5LhYq13sYy3lrlYhlv3d/W6hdLjZN1LZa5MzIyTHMfOXLEl3VI0tdff20a/8UXX8Q81roPu/r1//l8/wNbP8RyHp45c8Y0t6XCy/r4sfJzfsvzm/XYW1jqoWJlDq4ZM2ZccIekpKToscce02OPPdajhQEAcD4J/1QhAAAWBBcAwCkEFwDAKQQXAMApBBcAwCkEFwDAKQQXAMApBBcAwCkEFwDAKQQXAMAp5sqn3szaiWXp57J2eVk6yKzrtnT+WbvQ/Owss2ptbfVlrGTvTbQYOHBgzGOPHz9umjsYDJrGX3nllTGPtXZmWs6V06dPm+a29A9a+x4tjzfreWJ9/FjGW7oHJdtj37oPLWvxo4+RV1wAAKcQXAAApxBcAACnEFwAAKcQXAAApxBcAACnEFwAAKcQXAAApxBcAACnEFwAAKckVeVTW1ubabyl+sVaW2Kpz7HObalbsdbEWPaJnxVbVoFAwDTesnbrPrTUG/ldyWU5D3vTuWI5nn5UCp1lfU7pTdVwfu4X67kSb7ziAgA4heACADiF4AIAOIXgAgA4heACADiF4AIAOIXgAgA4heACADiF4AIAOIXgAgA4heACADglqboK+/e3bY6ffVvWXjGL1NTUmMdat9HSb2bp5OvOWgYMGBDzWEsnnySdOXPGNL63zG059pJtn1vPWcvjzdqbZ+kItB57C+u6rcfHwroWP5+DLGvx43mWV1wAAKcQXAAApxBcAACnEFwAAKcQXAAApxBcAACnEFwAAKcQXAAApxBcAACnEFwAAKckVeWTpSZG8rc6yVK30tHRYZrbup0Wlhofa6WMtZqnpaUl5rHWui+LIUOG+DZ3dXW1afzhw4dN46dMmRLz2J/85CemuYPBYMxj6+vrTXMfOnQo5rGRSMQ0t6VKLBAImOa2nuOWx7K1TspyfKyPH0utmeVxHCtecQEAnEJwAQCcYg6unTt3av78+crPz1dKSopee+21TrcvXbpUKSkpnS5z586N13oBAH2cObiam5s1ZcoUVVRUdDlm7ty5Onr0aPTy4osv9miRAACcZX5He968eZo3b94FxwSDQeXm5nZ7UQAAdMWX97h27Nih4cOHa/z48Vq1apWOHz/e5dhIJKJwONzpAgBAV+IeXHPnztXzzz+vyspK/f73v1dVVZXmzZvX5cdEy8vLFQqFopeCgoJ4LwkAkETi/scvt956a/S/r7rqKk2ePFljx47Vjh07NGvWrHPGl5WVqbS0NPpzOBwmvAAAXfL94/BjxozR0KFDdeDAgfPeHgwGlZWV1ekCAEBXfA+ub775RsePH1deXp7fdwUA6APMvyo8efJkp1dPdXV12rt3r7Kzs5Wdna1HH31UixYtUm5urg4ePKh7771X48aN05w5c+K6cABA32QOrj179uimm26K/nz2/aklS5Zow4YN2rdvn/7617+qsbFR+fn5mj17tn7729+aerO6y9rllZKSEvNYa1ehpbPMzx5EK0sHmWWsZF+3pT/N2vdoWfuRI0dMc1uMGTPGNH7ChAmm8ZZ9/sUXX5jmtu5zC8uxtz7uLfvE2j1o5WfHZmtrqy9jrfx4vjLvtRkzZlzwifbtt9/u0YIAALgQugoBAE4huAAATiG4AABOIbgAAE4huAAATiG4AABOIbgAAE4huAAATiG4AABOIbgAAE7xrygrAay9YpaOM+vcfvYgWsb3lj45yd5ZZlm7dTv97Hv0c27reehnZ6afekuPaG/i5zlu2d9WfpxXvOICADiF4AIAOIXgAgA4heACADiF4AIAOIXgAgA4heACADiF4AIAOIXgAgA4heACADglqSqfrBVEFmlpaabxrlWodIefFU5WwWDQNN6yduu6T58+7dvc1vPQMt7Pc9a6nZa1WNft53noJ+t29pbaOT/OK15xAQCcQnABAJxCcAEAnEJwAQCcQnABAJxCcAEAnEJwAQCcQnABAJxCcAEAnEJwAQCcQnABAJySVF2FZ86cMY1PTU2NeWxra6tpbksXnp8dce3t7b7NHQgETOP97IizHp9IJBLz2JaWFtPc48aNi3nsxIkTTXM3Njaaxn/44Ycxj62vrzfNPXDgQF/GSlJ6erppvF96Ux+nqyzPs7HiFRcAwCkEFwDAKQQXAMApBBcAwCkEFwDAKQQXAMApBBcAwCkEFwDAKQQXAMApBBcAwClJVfnkJz9qS87yPM803s9aGUtF1OnTp01zW+tzLFVY1vqpzMxMX9YhSZ988knMY2tqakxzDxo0yDQ+IyMj5rEjRowwzW1hPfZ+Pt4s57iflWmS7dxKS0vzbR1tbW2+ze3HPuQVFwDAKabgKi8v17Rp05SZmanhw4fr5ptvVm1tbacxLS0tKikp0ZAhQ5SRkaFFixapoaEhrosGAPRdpuCqqqpSSUmJdu3apXfeeUdtbW2aPXu2mpubo2PWrl2rN954Q6+88oqqqqp05MgRLVy4MO4LBwD0Tab3uLZv397p582bN2v48OGqqanR9OnT1dTUpOeee05btmzRzJkzJUmbNm3SFVdcoV27dum6666L38oBAH1Sj97jampqkiRlZ2dL+u6N5ra2NhUXF0fHTJgwQSNHjlR1dXVP7goAAEk9+FRhR0eH1qxZo+uvv16TJk2S9N0X0QUCAQ0ePLjT2JycnC6/pC4SiXT6Ur9wONzdJQEA+oBuv+IqKSnRp59+qq1bt/ZoAeXl5QqFQtFLQUFBj+YDACS3bgXX6tWr9eabb+r999/v9Lcfubm5am1tPefrxRsaGpSbm3veucrKytTU1BS9HD58uDtLAgD0Eabg8jxPq1ev1rZt2/Tee+9p9OjRnW6fOnWq0tLSVFlZGb2utrZWhw4dUlFR0XnnDAaDysrK6nQBAKArpve4SkpKtGXLFr3++uvKzMyMvm8VCoU0YMAAhUIhLVu2TKWlpcrOzlZWVpbuuusuFRUV8YlCAEBcmIJrw4YNkqQZM2Z0un7Tpk1aunSpJOnJJ59Uv379tGjRIkUiEc2ZM0fPPvtsXBYLAIApuGLp1EtPT1dFRYUqKiq6vajusnbKWToCe1OfoLX3rbfM7WfvW2trq2m8pQvP2oM4ZMiQmMdazxNrh5/lMWE99pa1W7fTz8ePhZ/728r6+HF1H8aCrkIAgFMILgCAUwguAIBTCC4AgFMILgCAUwguAIBTCC4AgFMILgCAUwguAIBTCC4AgFO6/UWSycBScXPmzBkfV2JjqXKx1sRYxlurkPr3t51ulrVYK7mCwWDMY9va2kxzW74M1Xp8MjIyTOMHDBgQ81hr5ZOl3qg3Vab5qTdVPllYj71lvPXYx3T/cZ8RAAAfEVwAAKcQXAAApxBcAACnEFwAAKcQXAAApxBcAACnEFwAAKcQXAAApxBcAACnEFwAAKckVVehtSfM0qFl6XyTbF1r1l42S3deWlqaaW5LF56l70+SWlpaTOMt3YbWY2/Zh6mpqaa5rX2CFmPGjDGNHzRoUMxjjx07Zpr722+/jXmstWfP2mvpF+t5ZV23n32Pln1ufQ6yrNvagxjTnHGfEQAAHxFcAACnEFwAAKcQXAAApxBcAACnEFwAAKcQXAAApxBcAACnEFwAAKcQXAAAp/SOXpUE8bNuxc9KFEuNk3XuM2fO+DJWsu9DC2s1j2W8de5LLrkk5rHWfdjQ0GAab1m7tdoqMzMz5rHWyidrBZFfrMfe+nizzG+tWLOcW34+Nql8AgD0eQQXAMApBBcAwCkEFwDAKQQXAMApBBcAwCkEFwDAKQQXAMApBBcAwCkEFwDAKQQXAMApSdVVaO1as/RzWTvl/OzC6y0di37OLdk6zqxz+9nN1tra2ivWYZ3fz7VYuwetx7O3zG3dh5b94ufcvemxGdP9x31GAAB8ZAqu8vJyTZs2TZmZmRo+fLhuvvlm1dbWdhozY8YMpaSkdLqsXLkyrosGAPRdpuCqqqpSSUmJdu3apXfeeUdtbW2aPXu2mpubO41bvny5jh49Gr2sX78+rosGAPRdpve4tm/f3unnzZs3a/jw4aqpqdH06dOj1w8cOFC5ubnxWSEAAP+jR+9xNTU1SZKys7M7Xf/CCy9o6NChmjRpksrKynTq1Kku54hEIgqHw50uAAB0pdufKuzo6NCaNWt0/fXXa9KkSdHrb7/9do0aNUr5+fnat2+f7rvvPtXW1urVV1897zzl5eV69NFHu7sMAEAf0+3gKikp0aeffqoPPvig0/UrVqyI/vdVV12lvLw8zZo1SwcPHtTYsWPPmaesrEylpaXRn8PhsAoKCrq7LABAkutWcK1evVpvvvmmdu7cqREjRlxwbGFhoSTpwIED5w2uYDCoYDDYnWUAAPogU3B5nqe77rpL27Zt044dOzR69Ogf/H/27t0rScrLy+vWAgEA+F+m4CopKdGWLVv0+uuvKzMzU/X19ZKkUCikAQMG6ODBg9qyZYt+9rOfaciQIdq3b5/Wrl2r6dOna/Lkyb5sAACgbzEF14YNGyR990fG/2vTpk1aunSpAoGA3n33XT311FNqbm5WQUGBFi1apAceeCBuCwYA9G3mXxVeSEFBgaqqqnq0oJ7ws2vNz34zq/79Yz9s1n1iGe9nx6KVpR/QyvoerJ99j9bOTGtHoEV7e3vMY63baekdtc7tZ8+eZZ9YWY+ln88TFn6cg3QVAgCcQnABAJxCcAEAnEJwAQCcQnABAJxCcAEAnEJwAQCcQnABAJxCcAEAnEJwAQCc0u3v4+qNrNUiflYQtbW1xTzWz9ofP2uZrHNbanwk2/FMS0szzZ2RkRHz2GPHjpnmrqysjHlsJBIxzX3NNdeYxl999dUxj7XWSV3om82/r7m52TS35dyyVBtJtsem9TnFz1om6+PHejxdwisuAIBTCC4AgFMILgCAUwguAIBTCC4AgFMILgCAUwguAIBTCC4AgFMILgCAUwguAIBTCC4AgFOSqqvQ2llm6RWz9glau/Ms+vWL/d8b1nX72Z1m3SeWHr+TJ0+a5m5sbIx57KBBg0xz33bbbabxFk1NTabx//73v2Mea338BAKBmMcOGDDANLelZ8/SPWhl3SfW/k7Lc5C1e9DyPGEZK9m20/ocFAtecQEAnEJwAQCcQnABAJxCcAEAnEJwAQCcQnABAJxCcAEAnEJwAQCcQnABAJxCcAEAnJJUlU/WShQ/a0usFSoWflZVWWqWrPU2lrmtrHVSlroq6z601En5eZ5IUjAYjHmsdTstVUt+VgpZWbbT8ljrDj/qkLozt3Udfj4HxYJXXAAApxBcAACnEFwAAKcQXAAApxBcAACnEFwAAKcQXAAApxBcAACnEFwAAKcQXAAApxBcAACnJFVXobWvrr29Peaxlm47v1l63yx9cpK/HXEtLS2m8ZmZmTGP7d/fdir/97//jXmstWcvFArFPNZ6zjY3N5vGnzx5Muax1u1MT0+Peaz1vPKzC8/Pc9zabWgZb1235dyyPn4s+9zaIRsLXnEBAJxiCq4NGzZo8uTJysrKUlZWloqKivTWW29Fb29paVFJSYmGDBmijIwMLVq0SA0NDXFfNACg7zIF14gRI7Ru3TrV1NRoz549mjlzphYsWKDPPvtMkrR27Vq98cYbeuWVV1RVVaUjR45o4cKFviwcANA3mX6xOX/+/E4/P/7449qwYYN27dqlESNG6LnnntOWLVs0c+ZMSdKmTZt0xRVXaNeuXbruuuvit2oAQJ/V7fe42tvbtXXrVjU3N6uoqEg1NTVqa2tTcXFxdMyECRM0cuRIVVdXdzlPJBJROBzudAEAoCvm4Prkk0+UkZGhYDColStXatu2bZo4caLq6+sVCAQ0ePDgTuNzcnJUX1/f5Xzl5eUKhULRS0FBgXkjAAB9hzm4xo8fr71792r37t1atWqVlixZos8//7zbCygrK1NTU1P0cvjw4W7PBQBIfua/4woEAho3bpwkaerUqfrXv/6lp59+WosXL1Zra6saGxs7vepqaGhQbm5ul/MFg0EFg0H7ygEAfVKP/46ro6NDkUhEU6dOVVpamiorK6O31dbW6tChQyoqKurp3QAAIMn4iqusrEzz5s3TyJEjdeLECW3ZskU7duzQ22+/rVAopGXLlqm0tFTZ2dnKysrSXXfdpaKiIj5RCACIG1NwHTt2TD//+c919OhRhUIhTZ48WW+//bZ++tOfSpKefPJJ9evXT4sWLVIkEtGcOXP07LPP+rLw82ltbTWNt9Q4nT592jS3tcrHwlLNY63DsVTQWGuwrJVCluMZiURMc1vqc6xzT5s2Leaxl19+uWlu63vAW7dujXms9b3q7OzsmMde6O2C8xk6dGjMY63nuKV6zFILJ9mrkyyPCevclrVbz3E/q6piYdoTzz333AVvT09PV0VFhSoqKnq0KAAAukJXIQDAKQQXAMApBBcAwCkEFwDAKQQXAMApBBcAwCkEFwDAKQQXAMApBBcAwCkEFwDAKSmetejLZ+FwWKFQSE1NTcrKykr0cgAAvUyvCy7P83TixAllZmb6Us4IAHBbrwsuAAAuhPe4AABOIbgAAE4huAAATiG4AABOIbgAAE4huAAATiG4AABOIbgAAE4huAAATiG4AABO6Z/oBcTL2Y5DAIDbfqirNmmC68SJEwqFQoleBgCgh37o20GSpmS3q1dc4XBYBQUFOnz4cFJ/TQrbmTz6wjZKbGeyied29plXXCkpKRfcWVlZWUl90pzFdiaPvrCNEtuZbC7GdvLhDACAUwguAIBTkj64gsGgHn74YQWDwUQvxVdsZ/LoC9sosZ3J5mJuZ9J8OAMA0Dck/SsuAEByIbgAAE4huAAATiG4AABOSfrgqqio0KWXXqr09HQVFhbqww8/TPSS4uaRRx5RSkpKp8uECRMSvawe27lzp+bPn6/8/HylpKTotdde63S753l66KGHlJeXpwEDBqi4uFj79+9PzGJ74Ie2c+nSpecc37lz5yZmsd1UXl6uadOmKTMzU8OHD9fNN9+s2traTmNaWlpUUlKiIUOGKCMjQ4sWLVJDQ0OCVtw9sWznjBkzzjmeK1euTNCKu2fDhg2aPHly9I+Mi4qK9NZbb0Vvv1jHMqmD66WXXlJpaakefvhhffTRR5oyZYrmzJmjY8eOJXppcXPllVfq6NGj0csHH3yQ6CX1WHNzs6ZMmaKKiorz3r5+/Xo988wz2rhxo3bv3q1BgwZpzpw5amlpucgr7Zkf2k5Jmjt3bqfj++KLL17EFfZcVVWVSkpKtGvXLr3zzjtqa2vT7Nmz1dzcHB2zdu1avfHGG3rllVdUVVWlI0eOaOHChQlctV0s2ylJy5cv73Q8169fn6AVd8+IESO0bt061dTUaM+ePZo5c6YWLFigzz77TNJFPJZeErv22mu9kpKS6M/t7e1efn6+V15ensBVxc/DDz/sTZkyJdHL8JUkb9u2bdGfOzo6vNzcXO8Pf/hD9LrGxkYvGAx6L774YgJWGB/f307P87wlS5Z4CxYsSMh6/HLs2DFPkldVVeV53nfHLi0tzXvllVeiY7744gtPklddXZ2oZfbY97fT8zzvJz/5iferX/0qcYvyySWXXOL9+c9/vqjHMmlfcbW2tqqmpkbFxcXR6/r166fi4mJVV1cncGXxtX//fuXn52vMmDG64447dOjQoUQvyVd1dXWqr6/vdFxDoZAKCwuT6rietWPHDg0fPlzjx4/XqlWrdPz48UQvqUeampokSdnZ2ZKkmpoatbW1dTqeEyZM0MiRI50+nt/fzrNeeOEFDR06VJMmTVJZWZlOnTqViOXFRXt7u7Zu3arm5mYVFRVd1GOZNCW73/ftt9+qvb1dOTk5na7PycnRl19+maBVxVdhYaE2b96s8ePH6+jRo3r00Ud144036tNPP1VmZmail+eL+vp6STrvcT17W7KYO3euFi5cqNGjR+vgwYP6zW9+o3nz5qm6ulqpqamJXp5ZR0eH1qxZo+uvv16TJk2S9N3xDAQCGjx4cKexLh/P822nJN1+++0aNWqU8vPztW/fPt13332qra3Vq6++msDV2n3yyScqKipSS0uLMjIytG3bNk2cOFF79+69aMcyaYOrL5g3b170vydPnqzCwkKNGjVKL7/8spYtW5bAlSEebr311uh/X3XVVZo8ebLGjh2rHTt2aNasWQlcWfeUlJTo008/TYr3YS+kq+1csWJF9L+vuuoq5eXladasWTp48KDGjh17sZfZbePHj9fevXvV1NSkv/3tb1qyZImqqqou6hqS9leFQ4cOVWpq6jmfaGloaFBubm6CVuWvwYMH6/LLL9eBAwcSvRTfnD12fem4njVmzBgNHTrUyeO7evVqvfnmm3r//fc1YsSI6PW5ublqbW1VY2Njp/GuHs+utvN8CgsLJcm54xkIBDRu3DhNnTpV5eXlmjJlip5++umLeiyTNrgCgYCmTp2qysrK6HUdHR2qrKxUUVFRAlfmn5MnT+rgwYPKy8tL9FJ8M3r0aOXm5nY6ruFwWLt3707a43rWN998o+PHjzt1fD3P0+rVq7Vt2za99957Gj16dKfbp06dqrS0tE7Hs7a2VocOHXLqeP7Qdp7P3r17Jcmp43k+HR0dikQiF/dYxvWjHr3M1q1bvWAw6G3evNn7/PPPvRUrVniDBw/26uvrE720uLj77ru9HTt2eHV1dd4//vEPr7i42Bs6dKh37NixRC+tR06cOOF9/PHH3scff+xJ8p544gnv448/9r7++mvP8zxv3bp13uDBg73XX3/d27dvn7dgwQJv9OjR3unTpxO8cpsLbeeJEye8e+65x6uurvbq6uq8d9991/vxj3/sXXbZZV5LS0uilx6zVatWeaFQyNuxY4d39OjR6OXUqVPRMStXrvRGjhzpvffee96ePXu8oqIir6ioKIGrtvuh7Txw4ID32GOPeXv27PHq6uq8119/3RszZow3ffr0BK/c5v777/eqqqq8uro6b9++fd7999/vpaSkeH//+989z7t4xzKpg8vzPO9Pf/qTN3LkSC8QCHjXXnutt2vXrkQvKW4WL17s5eXleYFAwPvRj37kLV682Dtw4ECil9Vj77//vifpnMuSJUs8z/vuI/EPPvigl5OT4wWDQW/WrFlebW1tYhfdDRfazlOnTnmzZ8/2hg0b5qWlpXmjRo3yli9f7tw/us63fZK8TZs2RcecPn3a++Uvf+ldcskl3sCBA71bbrnFO3r0aOIW3Q0/tJ2HDh3ypk+f7mVnZ3vBYNAbN26c9+tf/9prampK7MKNfvGLX3ijRo3yAoGAN2zYMG/WrFnR0PK8i3cs+VoTAIBTkvY9LgBAciK4AABOIbgAAE4huAAATiG4AABOIbgAAE4huAAATiG4AABOIbgAAE4huAAATiG4AABOIbgAAE75P0XyZEUfd9GWAAAAAElFTkSuQmCC" width="430" height="427" class="img_ev3q"></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Csi_Transformer_Net</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[1.9566105437278747, 1.3546967101097107, 1.1729794073104858, 1.0902969622612, 1.0310835707187653, 0.9886464655399323, 0.967725396156311, 0.9511337721347809, 0.9386063098907471, 0.7703430867195129, 0.6483797013759613, 0.5910915243625641, 0.5425180727243424, 0.5384866672754288, 0.536125123500824, 0.5344688516855239, 0.5326178723573685, 0.5316342955827713, 0.5301343083381653, 0.5299815499782562, 0.5299837756156921, 0.5282985603809357, 0.5278837376832962, 0.5328169310092926, 0.5282338237762452, 0.527239038348198, 0.5250765424966812, 0.523982360959053, 0.4337254935503006, 0.4340094310045242, 0.4267952162027359, 0.42642789661884306, 0.4263604950904846, 0.426031568646431, 0.4258938354253769, 0.4257040703296661, 0.4255121678113937, 0.42521106243133544, 0.34364676058292387, 0.3364664989709854]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">average time used is: 1.1970998823642731</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Saving the entire model...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Model saved to models/Csi_Transformer_Net_model_128.pth</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Model saved!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="png" src="/assets/images/main_13_4-5399f794d5d7c1b9c630897fad7d5c35.png" width="547" height="413" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="csi_cnn_transformer_net">Csi_CNN_Transformer_Net<a href="#csi_cnn_transformer_net" class="hash-link" aria-label="Direct link to Csi_CNN_Transformer_Net" title="Direct link to Csi_CNN_Transformer_Net">​</a></h2>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;=&quot;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token number" style="color:hsl(35, 99%, 36%)">30</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;Encoder: CNN; Decoder: transformer&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;compressed codeword bits: {}&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">format</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">agent2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> model_trainer</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">epochs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">40</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> net</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;Csi_CNN_Transformer_Net&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain">feedbackbits</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">bits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">x2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> agent2_NMSE</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> t2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> agent2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">model_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;Csi_CNN_Transformer_Net&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">agent2_NMSE</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;average time used is:&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> t2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">plt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> agent2_NMSE</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> label</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;Csi_CNN_Transformer_Net&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">plt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">show</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 保存模型</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">model_path </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f&#x27;models/Csi_CNN_Transformer_Net_model_</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">bits</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">.pth&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">agent2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">model_save</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">model_path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">==============================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Encoder: CNN; Decoder: transformer</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">compressed codeword bits: 128</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">loading data...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [0][0/200]	Loss 16.7723	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [0][100/200]	Loss 2.7850	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 1.7937 ρ 0.337 time 0.447</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [1][0/200]	Loss 1.8238	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [1][100/200]	Loss 1.4794	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 1.3830 ρ 0.503 time 0.437</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [2][0/200]	Loss 1.2672	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [2][100/200]	Loss 1.2981	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 1.2839 ρ 0.556 time 0.449</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [3][0/200]	Loss 1.1113	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [3][100/200]	Loss 1.1200	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 1.1895 ρ 0.638 time 0.518</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [4][0/200]	Loss 1.1125	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [4][100/200]	Loss 1.1114	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.8790 ρ 0.593 time 0.876</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [5][0/200]	Loss 0.8571	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [5][100/200]	Loss 0.6774	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 1.9164 ρ 0.755 time 0.913</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [6][0/200]	Loss 0.6592	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [6][100/200]	Loss 0.5653	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.5816 ρ 0.758 time 0.912</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [7][0/200]	Loss 0.5619	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [7][100/200]	Loss 0.5827	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.6244 ρ 0.668 time 0.936</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [8][0/200]	Loss 0.5068	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [8][100/200]	Loss 0.5359	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.4789 ρ 0.800 time 0.916</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [9][0/200]	Loss 0.4513	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [9][100/200]	Loss 0.4735	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.8477 ρ 0.827 time 0.963</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [10][0/200]	Loss 0.4208	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [10][100/200]	Loss 0.4186	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.4033 ρ 0.837 time 0.928</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [11][0/200]	Loss 0.3055	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [11][100/200]	Loss 0.3709	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3582 ρ 0.810 time 0.934</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [12][0/200]	Loss 0.3048	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [12][100/200]	Loss 0.3369	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3576 ρ 0.809 time 0.922</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [13][0/200]	Loss 0.3596	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [13][100/200]	Loss 0.3335	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3518 ρ 0.817 time 0.906</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [14][0/200]	Loss 0.3324	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [14][100/200]	Loss 0.3278	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3506 ρ 0.827 time 0.891</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [15][0/200]	Loss 0.3422	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [15][100/200]	Loss 0.3615	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3930 ρ 0.776 time 0.901</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [16][0/200]	Loss 0.3087	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [16][100/200]	Loss 0.3223	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.4655 ρ 0.850 time 0.909</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [17][0/200]	Loss 0.3008	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [17][100/200]	Loss 0.3295	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3486 ρ 0.829 time 0.983</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [18][0/200]	Loss 0.3196	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [18][100/200]	Loss 0.3202	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3803 ρ 0.785 time 0.866</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [19][0/200]	Loss 0.3409	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [19][100/200]	Loss 0.3137	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3677 ρ 0.841 time 0.924</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [20][0/200]	Loss 0.3369	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [20][100/200]	Loss 0.3256	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3596 ρ 0.802 time 0.866</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [21][0/200]	Loss 0.3814	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [21][100/200]	Loss 0.3145	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3564 ρ 0.838 time 0.468</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [22][0/200]	Loss 0.3593	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [22][100/200]	Loss 0.3371	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3445 ρ 0.820 time 0.553</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [23][0/200]	Loss 0.3151	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [23][100/200]	Loss 0.3410	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3434 ρ 0.824 time 0.917</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [24][0/200]	Loss 0.3600	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [24][100/200]	Loss 0.3348	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.5701 ρ 0.855 time 0.927</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [25][0/200]	Loss 0.3392	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [25][100/200]	Loss 0.2966	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3758 ρ 0.846 time 0.916</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [26][0/200]	Loss 0.3510	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [26][100/200]	Loss 0.3204	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3577 ρ 0.802 time 0.917</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [27][0/200]	Loss 0.3344	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [27][100/200]	Loss 0.3121	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.4332 ρ 0.853 time 0.930</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [28][0/200]	Loss 0.3257	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [28][100/200]	Loss 0.3527	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3482 ρ 0.841 time 0.907</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [29][0/200]	Loss 0.3031	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [29][100/200]	Loss 0.3429	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3503 ρ 0.808 time 0.913</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-03</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [30][0/200]	Loss 0.3269	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [30][100/200]	Loss 0.3412	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3313 ρ 0.830 time 0.920</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [31][0/200]	Loss 0.3079	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [31][100/200]	Loss 0.3284	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3356 ρ 0.841 time 0.924</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [32][0/200]	Loss 0.3316	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [32][100/200]	Loss 0.3002	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3334 ρ 0.824 time 0.919</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [33][0/200]	Loss 0.3063	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [33][100/200]	Loss 0.2999	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3316 ρ 0.838 time 0.920</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [34][0/200]	Loss 0.3269	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [34][100/200]	Loss 0.3275	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3298 ρ 0.831 time 0.918</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [35][0/200]	Loss 0.3314	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [35][100/200]	Loss 0.3247	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3295 ρ 0.834 time 0.921</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [36][0/200]	Loss 0.2935	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [36][100/200]	Loss 0.3160	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3294 ρ 0.835 time 0.922</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [37][0/200]	Loss 0.2945	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [37][100/200]	Loss 0.3379	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3291 ρ 0.835 time 0.917</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [38][0/200]	Loss 0.2834	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [38][100/200]	Loss 0.3184	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3293 ρ 0.830 time 0.907</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">========================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lr:1.0000e-04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [39][0/200]	Loss 0.3403	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Epoch: [39][100/200]	Loss 0.3393	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">NMSE 0.3288 ρ 0.831 time 0.896</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="png" src="/assets/images/main_15_1-3014337ea8968e4a00699b98a915ddd1.png" width="430" height="427" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="png" src="/assets/images/main_15_2-4958dd6c675697e763dc0d106e1c7ea0.png" width="430" height="427" class="img_ev3q"></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Csi_CNN_Transformer_Net</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[1.7936574721336365, 1.3829833745956421, 1.283927230834961, 1.1894978594779968, 0.8790475904941559, 1.9164495015144347, 0.5816227388381958, 0.6243553447723389, 0.4789328819513321, 0.8476968479156494, 0.4033376920223236, 0.3581970351934433, 0.3575852298736572, 0.3518389576673508, 0.350602548122406, 0.3930432403087616, 0.46549117743968965, 0.3486467313766479, 0.3802634757757187, 0.36765024840831756, 0.3596446371078491, 0.35639182686805726, 0.34447405755519866, 0.34342944622039795, 0.5701418870687485, 0.3757738322019577, 0.35769821345806124, 0.4331714022159576, 0.34818855822086336, 0.35026067614555356, 0.3313265132904053, 0.3355947732925415, 0.33339386343955996, 0.33157447040081023, 0.3298351740837097, 0.3294666814804077, 0.32943468272686005, 0.32912233233451843, 0.3293388104438782, 0.3288260215520859]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">average time used is: 0.850273048877716</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="png" src="/assets/images/main_15_4-e2c3b2e15b67743de49c5fb4422461a8.png" width="547" height="413" class="img_ev3q"></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Saving the entire model...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Model saved to models/Csi_CNN_Transformer_Net_model_128.pth</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Model saved!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> matplotlib</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">pyplot </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> plt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 假设你有三个网络的损失函数结果</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 创建一个图形</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">plt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">figure</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">figsize</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">6</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 绘制第一个网络的损失函数曲线</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">plt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> agent1_NMSE</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> label</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;Csi_Transformer_Net&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> marker</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;o&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 绘制第二个网络的损失函数曲线</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">plt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> agent2_NMSE</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> label</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;Csi_CNN_Transformer_Net&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> marker</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;s&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 绘制第三个网络的损失函数曲线</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">plt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">x3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> agent3_NMSE</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> label</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;Csi_Net&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> marker</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;^&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># plt.plot(x3, (np.array(agent3_NMSE) - 0.2) * 2 / 2.6 + 0.5, label=&quot;Csi_Net&quot;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 设置标题、坐标轴标签和图例</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">plt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">xlabel</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;Epochs&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">plt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ylabel</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;NMSE&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">plt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">legend</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 显示图形</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">plt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">show</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>​<br>
<img decoding="async" loading="lazy" alt="png" src="/assets/images/main_16_0-af52807ae412e19a41fcf46baeff2e68.png" width="700" height="525" class="img_ev3q">
​</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cs_net">CS_Net<a href="#cs_net" class="hash-link" aria-label="Direct link to CS_Net" title="Direct link to CS_Net">​</a></h2>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># print(&quot;=&quot;*30)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># print(&quot;Encoder: Random Projection; Decoder: CNN&quot;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># print(&quot;compressed codeword bits: {}&quot;.format(bits))</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># agent4 = model_trainer(epochs=40, net=&quot;CS_Net&quot;,feedbackbits=bits)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># x4, agent4_NMSE= agent4.model_train()</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># print(&quot;CS_Net&quot;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># print(agent4_NMSE)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># plt.plot(x4, agent4_NMSE, label=&quot;CS_Net&quot;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># # 保存模型</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># model_path = f&#x27;models/CS_Net_model_{bits}.pth&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># agent4.model_save(model_path)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/学习/克拉美-罗界/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Cramer-Rao Lower Bound</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/学习/通信笔记/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">通信笔记</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#load-data-and-pre-processing-data" class="table-of-contents__link toc-highlight">load data and pre-processing data</a></li><li><a href="#loss" class="table-of-contents__link toc-highlight">loss</a></li><li><a href="#modules" class="table-of-contents__link toc-highlight">Modules</a></li><li><a href="#image-segmentation" class="table-of-contents__link toc-highlight">image segmentation</a></li><li><a href="#train" class="table-of-contents__link toc-highlight">train</a></li><li><a href="#csi_net" class="table-of-contents__link toc-highlight">Csi_Net</a></li><li><a href="#csi_transformer_net" class="table-of-contents__link toc-highlight">Csi_Transformer_Net</a></li><li><a href="#csi_cnn_transformer_net" class="table-of-contents__link toc-highlight">Csi_CNN_Transformer_Net</a></li><li><a href="#cs_net" class="table-of-contents__link toc-highlight">CS_Net</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>