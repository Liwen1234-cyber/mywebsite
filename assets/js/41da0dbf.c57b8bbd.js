"use strict";(self.webpackChunkmybase=self.webpackChunkmybase||[]).push([[62727],{15101:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"\u7801\u519c/redis/Redis\u5b9e\u6218\u7bc7","title":"\u5b9e\u6218\u7bc7Redis","description":"\u7b14\u8bb0\u539f\u4ef6\u6765\u81ea\u9ed1\u9a6cB\u7ad9\u89c6\u9891\u914d\u5957\u7b14\u8bb0\uff0c\u7ecf\u8fc7\u81ea\u5df1\u52a0\u5de5\u4fee\u6539\u6dfb\u52a0\u7b49","source":"@site/docs/\u7801\u519c/redis/Redis\u5b9e\u6218\u7bc7.md","sourceDirName":"\u7801\u519c/redis","slug":"/\u7801\u519c/redis/Redis\u5b9e\u6218\u7bc7","permalink":"/\u7801\u519c/redis/Redis\u5b9e\u6218\u7bc7","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{}}');var r=s(74848),l=s(28453);const t={},d="\u5b9e\u6218\u7bc7Redis",c={},o=[{value:"1.1\u3001\u5bfc\u5165\u9ed1\u9a6c\u70b9\u8bc4\u9879\u76ee",id:"11\u5bfc\u5165\u9ed1\u9a6c\u70b9\u8bc4\u9879\u76ee",level:2},{value:"1.1.1 \u3001\u5bfc\u5165SQL",id:"111-\u5bfc\u5165sql",level:3},{value:"1.1.2\u3001\u6709\u5173\u5f53\u524d\u6a21\u578b",id:"112\u6709\u5173\u5f53\u524d\u6a21\u578b",level:3},{value:"1.1.3\u3001\u5bfc\u5165\u540e\u7aef\u9879\u76ee",id:"113\u5bfc\u5165\u540e\u7aef\u9879\u76ee",level:3},{value:"1.1.4\u3001\u5bfc\u5165\u524d\u7aef\u5de5\u7a0b",id:"114\u5bfc\u5165\u524d\u7aef\u5de5\u7a0b",level:3},{value:"1.1.5 \u8fd0\u884c\u524d\u7aef\u9879\u76ee",id:"115-\u8fd0\u884c\u524d\u7aef\u9879\u76ee",level:3},{value:"1.2 \u3001\u57fa\u4e8eSession\u5b9e\u73b0\u767b\u5f55\u6d41\u7a0b",id:"12-\u57fa\u4e8esession\u5b9e\u73b0\u767b\u5f55\u6d41\u7a0b",level:2},{value:"1.3 \u3001\u5b9e\u73b0\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u529f\u80fd",id:"13-\u5b9e\u73b0\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u529f\u80fd",level:2},{value:"1.4\u3001\u5b9e\u73b0\u767b\u5f55\u62e6\u622a\u529f\u80fd",id:"14\u5b9e\u73b0\u767b\u5f55\u62e6\u622a\u529f\u80fd",level:2},{value:"1.5\u3001\u9690\u85cf\u7528\u6237\u654f\u611f\u4fe1\u606f",id:"15\u9690\u85cf\u7528\u6237\u654f\u611f\u4fe1\u606f",level:2},{value:"1.6\u3001session\u5171\u4eab\u95ee\u9898",id:"16session\u5171\u4eab\u95ee\u9898",level:2},{value:"1.7 Redis\u4ee3\u66ffsession\u7684\u4e1a\u52a1\u6d41\u7a0b",id:"17-redis\u4ee3\u66ffsession\u7684\u4e1a\u52a1\u6d41\u7a0b",level:2},{value:"1.7.1\u3001\u8bbe\u8ba1key\u7684\u7ed3\u6784",id:"171\u8bbe\u8ba1key\u7684\u7ed3\u6784",level:3},{value:"1.7.2\u3001\u8bbe\u8ba1key\u7684\u5177\u4f53\u7ec6\u8282",id:"172\u8bbe\u8ba1key\u7684\u5177\u4f53\u7ec6\u8282",level:3},{value:"1.7.3\u3001\u6574\u4f53\u8bbf\u95ee\u6d41\u7a0b",id:"173\u6574\u4f53\u8bbf\u95ee\u6d41\u7a0b",level:3},{value:"1.8 \u57fa\u4e8eRedis\u5b9e\u73b0\u77ed\u4fe1\u767b\u5f55",id:"18-\u57fa\u4e8eredis\u5b9e\u73b0\u77ed\u4fe1\u767b\u5f55",level:2},{value:"1.9 \u89e3\u51b3\u72b6\u6001\u767b\u5f55\u5237\u65b0\u95ee\u9898",id:"19-\u89e3\u51b3\u72b6\u6001\u767b\u5f55\u5237\u65b0\u95ee\u9898",level:2},{value:"1.9.1 \u521d\u59cb\u65b9\u6848\u601d\u8def\u603b\u7ed3\uff1a",id:"191-\u521d\u59cb\u65b9\u6848\u601d\u8def\u603b\u7ed3",level:3},{value:"1.9.2 \u4f18\u5316\u65b9\u6848",id:"192-\u4f18\u5316\u65b9\u6848",level:3},{value:"1.9.3 \u4ee3\u7801",id:"193-\u4ee3\u7801",level:3},{value:"2.1 \u4ec0\u4e48\u662f\u7f13\u5b58?",id:"21-\u4ec0\u4e48\u662f\u7f13\u5b58",level:2},{value:"2.1.1 \u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u7f13\u5b58",id:"211-\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u7f13\u5b58",level:3},{value:"2.1.2 \u5982\u4f55\u4f7f\u7528\u7f13\u5b58",id:"212-\u5982\u4f55\u4f7f\u7528\u7f13\u5b58",level:3},{value:"2.2 \u6dfb\u52a0\u5546\u6237\u7f13\u5b58",id:"22-\u6dfb\u52a0\u5546\u6237\u7f13\u5b58",level:2},{value:"2.2.1\u3001\u7f13\u5b58\u6a21\u578b\u548c\u601d\u8def",id:"221\u7f13\u5b58\u6a21\u578b\u548c\u601d\u8def",level:3},{value:"2.1.2\u3001\u4ee3\u7801\u5982\u4e0b",id:"212\u4ee3\u7801\u5982\u4e0b",level:3},{value:"2.3 \u7f13\u5b58\u66f4\u65b0\u7b56\u7565",id:"23-\u7f13\u5b58\u66f4\u65b0\u7b56\u7565",level:2},{value:"2.3.1 \u3001\u6570\u636e\u5e93\u7f13\u5b58\u4e0d\u4e00\u81f4\u76843\u79cd\u89e3\u51b3\u65b9\u6848\uff1a",id:"231-\u6570\u636e\u5e93\u7f13\u5b58\u4e0d\u4e00\u81f4\u76843\u79cd\u89e3\u51b3\u65b9\u6848",level:3},{value:"2.3.2 \u3001\u6570\u636e\u5e93\u548c\u7f13\u5b58\u4e0d\u4e00\u81f4\u91c7\u7528\u4ec0\u4e48\u65b9\u6848",id:"232-\u6570\u636e\u5e93\u548c\u7f13\u5b58\u4e0d\u4e00\u81f4\u91c7\u7528\u4ec0\u4e48\u65b9\u6848",level:3},{value:"2.3.3\u3001\u7b56\u7565\u603b\u7ed3",id:"233\u7b56\u7565\u603b\u7ed3",level:3},{value:"2.4 \u5b9e\u73b0\u5546\u94fa\u548c\u7f13\u5b58\u4e0e\u6570\u636e\u5e93<strong>\u53cc\u5199\u4e00\u81f4</strong>",id:"24-\u5b9e\u73b0\u5546\u94fa\u548c\u7f13\u5b58\u4e0e\u6570\u636e\u5e93\u53cc\u5199\u4e00\u81f4",level:2},{value:"2.5 <strong>\u7f13\u5b58\u7a7f\u900f</strong>\u95ee\u9898\u7684\u89e3\u51b3\u601d\u8def",id:"25-\u7f13\u5b58\u7a7f\u900f\u95ee\u9898\u7684\u89e3\u51b3\u601d\u8def",level:2},{value:"2.6 \u5229\u7528\u8fd4\u56de\u7a7a\u503c\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\u95ee\u9898",id:"26-\u5229\u7528\u8fd4\u56de\u7a7a\u503c\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\u95ee\u9898",level:2},{value:"2.7 \u5229\u7528<strong>\u5e03\u9686\u8fc7\u6ee4\u5668</strong>\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\u95ee\u9898",id:"27-\u5229\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\u95ee\u9898",level:2},{value:"2.7 <strong>\u7f13\u5b58\u96ea\u5d29</strong>\u95ee\u9898\u53ca\u89e3\u51b3\u601d\u8def",id:"27-\u7f13\u5b58\u96ea\u5d29\u95ee\u9898\u53ca\u89e3\u51b3\u601d\u8def",level:2},{value:"2.8 <strong>\u7f13\u5b58\u51fb\u7a7f</strong>\u95ee\u9898\u53ca\u89e3\u51b3\u601d\u8def",id:"28-\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898\u53ca\u89e3\u51b3\u601d\u8def",level:2},{value:"2.9 \u5229\u7528\u4e92\u65a5\u9501\u89e3\u51b3\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898",id:"29-\u5229\u7528\u4e92\u65a5\u9501\u89e3\u51b3\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898",level:2},{value:"2.10 \u5229\u7528\u903b\u8f91\u8fc7\u671f\u89e3\u51b3\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898",id:"210-\u5229\u7528\u903b\u8f91\u8fc7\u671f\u89e3\u51b3\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898",level:2},{value:"2.11\u3001\u5c01\u88c5Redis\u5de5\u5177\u7c7b",id:"211\u5c01\u88c5redis\u5de5\u5177\u7c7b",level:2},{value:"3.1 -<strong>\u5168\u5c40\u552f\u4e00ID</strong>",id:"31--\u5168\u5c40\u552f\u4e00id",level:2},{value:"3.2 -Redis\u5b9e\u73b0\u5168\u5c40\u552f\u4e00Id",id:"32--redis\u5b9e\u73b0\u5168\u5c40\u552f\u4e00id",level:2},{value:"3.3 \u6dfb\u52a0\u4f18\u60e0\u5377",id:"33-\u6dfb\u52a0\u4f18\u60e0\u5377",level:2},{value:"3.4 \u5b9e\u73b0\u79d2\u6740\u4e0b\u5355",id:"34-\u5b9e\u73b0\u79d2\u6740\u4e0b\u5355",level:2},{value:"3.5 <strong>\u5e93\u5b58\u8d85\u5356</strong>\u95ee\u9898\u5206\u6790",id:"35-\u5e93\u5b58\u8d85\u5356\u95ee\u9898\u5206\u6790",level:2},{value:"3.6 \u4e50\u89c2\u9501\u89e3\u51b3\u8d85\u5356\u95ee\u9898",id:"36-\u4e50\u89c2\u9501\u89e3\u51b3\u8d85\u5356\u95ee\u9898",level:2},{value:"3.6 \u5355\u673a\u4f18\u60e0\u5238\u79d2\u6740-<strong>\u4e00\u4eba\u4e00\u5355</strong>",id:"36-\u5355\u673a\u4f18\u60e0\u5238\u79d2\u6740-\u4e00\u4eba\u4e00\u5355",level:2},{value:"3.7 \u96c6\u7fa4\u73af\u5883\u4e0b\u7684\u5e76\u53d1\u95ee\u9898",id:"37-\u96c6\u7fa4\u73af\u5883\u4e0b\u7684\u5e76\u53d1\u95ee\u9898",level:2},{value:"4.1 \u3001\u57fa\u672c\u539f\u7406\u548c\u5b9e\u73b0\u65b9\u5f0f\u5bf9\u6bd4",id:"41-\u57fa\u672c\u539f\u7406\u548c\u5b9e\u73b0\u65b9\u5f0f\u5bf9\u6bd4",level:2},{value:"4.2 \u3001Redis\u5206\u5e03\u5f0f\u9501\u7684\u5b9e\u73b0\u6838\u5fc3\u601d\u8def",id:"42-redis\u5206\u5e03\u5f0f\u9501\u7684\u5b9e\u73b0\u6838\u5fc3\u601d\u8def",level:2},{value:"4.3 \u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u7248\u672c\u4e00",id:"43-\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u7248\u672c\u4e00",level:2},{value:"4.4 Redis\u5206\u5e03\u5f0f\u9501<strong>\u8bef\u5220</strong>\u60c5\u51b5\u8bf4\u660e",id:"44-redis\u5206\u5e03\u5f0f\u9501\u8bef\u5220\u60c5\u51b5\u8bf4\u660e",level:2},{value:"4.5 \u89e3\u51b3Redis\u5206\u5e03\u5f0f\u9501\u8bef\u5220\u95ee\u9898",id:"45-\u89e3\u51b3redis\u5206\u5e03\u5f0f\u9501\u8bef\u5220\u95ee\u9898",level:2},{value:"4.6 \u5206\u5e03\u5f0f\u9501\u7684\u539f\u5b50\u6027\u95ee\u9898",id:"46-\u5206\u5e03\u5f0f\u9501\u7684\u539f\u5b50\u6027\u95ee\u9898",level:2},{value:"4.7 <strong>Lua\u811a\u672c</strong>\u89e3\u51b3\u591a\u6761\u547d\u4ee4\u539f\u5b50\u6027\u95ee\u9898",id:"47-lua\u811a\u672c\u89e3\u51b3\u591a\u6761\u547d\u4ee4\u539f\u5b50\u6027\u95ee\u9898",level:2},{value:"4.8 \u5229\u7528Java\u4ee3\u7801\u8c03\u7528Lua\u811a\u672c\u6539\u9020\u5206\u5e03\u5f0f\u9501",id:"48-\u5229\u7528java\u4ee3\u7801\u8c03\u7528lua\u811a\u672c\u6539\u9020\u5206\u5e03\u5f0f\u9501",level:2},{value:"\u5c0f\u603b\u7ed3",id:"\u5c0f\u603b\u7ed3",level:2},{value:"5.1 \u5206\u5e03\u5f0f\u9501-redission\u529f\u80fd\u4ecb\u7ecd",id:"51-\u5206\u5e03\u5f0f\u9501-redission\u529f\u80fd\u4ecb\u7ecd",level:2},{value:"5.2 \u5206\u5e03\u5f0f\u9501-Redisson\u5feb\u901f\u5165\u95e8",id:"52-\u5206\u5e03\u5f0f\u9501-redisson\u5feb\u901f\u5165\u95e8",level:2},{value:"5.3 \u5206\u5e03\u5f0f\u9501-redission\u53ef\u91cd\u5165\u9501\u539f\u7406",id:"53-\u5206\u5e03\u5f0f\u9501-redission\u53ef\u91cd\u5165\u9501\u539f\u7406",level:2},{value:"5.4 \u5206\u5e03\u5f0f\u9501-redission\u9501\u91cd\u8bd5\u548cWatchDog\u673a\u5236",id:"54-\u5206\u5e03\u5f0f\u9501-redission\u9501\u91cd\u8bd5\u548cwatchdog\u673a\u5236",level:2},{value:"5.5 \u5206\u5e03\u5f0f\u9501-redission\u9501\u7684MutiLock\u539f\u7406",id:"55-\u5206\u5e03\u5f0f\u9501-redission\u9501\u7684mutilock\u539f\u7406",level:2},{value:"5.6 \u5206\u5e03\u5f0f\u9501-redission\u9501\u7684\u7ea2\u9501RedLock",id:"56-\u5206\u5e03\u5f0f\u9501-redission\u9501\u7684\u7ea2\u9501redlock",level:2},{value:"5.7 \u5206\u5e03\u5f0f\u9501-\u89e3\u9501\u5f02\u5e38\u95ee\u9898",id:"57-\u5206\u5e03\u5f0f\u9501-\u89e3\u9501\u5f02\u5e38\u95ee\u9898",level:2},{value:"\u5c0f\u603b\u7ed3",id:"\u5c0f\u603b\u7ed3-1",level:2},{value:"6.1 \u79d2\u6740\u4f18\u5316-\u5f02\u6b65\u79d2\u6740\u601d\u8def",id:"61-\u79d2\u6740\u4f18\u5316-\u5f02\u6b65\u79d2\u6740\u601d\u8def",level:2},{value:"6.2 \u79d2\u6740\u4f18\u5316-Redis\u5b8c\u6210\u79d2\u6740\u8d44\u683c\u5224\u65ad",id:"62-\u79d2\u6740\u4f18\u5316-redis\u5b8c\u6210\u79d2\u6740\u8d44\u683c\u5224\u65ad",level:2},{value:"6.3 \u79d2\u6740\u4f18\u5316-\u57fa\u4e8e\u963b\u585e\u961f\u5217\u5b9e\u73b0\u79d2\u6740\u4f18\u5316",id:"63-\u79d2\u6740\u4f18\u5316-\u57fa\u4e8e\u963b\u585e\u961f\u5217\u5b9e\u73b0\u79d2\u6740\u4f18\u5316",level:2},{value:"7.1 Redis\u6d88\u606f\u961f\u5217-\u8ba4\u8bc6\u6d88\u606f\u961f\u5217",id:"71-redis\u6d88\u606f\u961f\u5217-\u8ba4\u8bc6\u6d88\u606f\u961f\u5217",level:2},{value:"7.2 Redis\u6d88\u606f\u961f\u5217-\u57fa\u4e8eList\u5b9e\u73b0\u6d88\u606f\u961f\u5217",id:"72-redis\u6d88\u606f\u961f\u5217-\u57fa\u4e8elist\u5b9e\u73b0\u6d88\u606f\u961f\u5217",level:2},{value:"7.3 Redis\u6d88\u606f\u961f\u5217-\u57fa\u4e8ePubSub\u7684\u6d88\u606f\u961f\u5217",id:"73-redis\u6d88\u606f\u961f\u5217-\u57fa\u4e8epubsub\u7684\u6d88\u606f\u961f\u5217",level:2},{value:"7.4 Redis\u6d88\u606f\u961f\u5217-\u57fa\u4e8eStream\u7684\u6d88\u606f\u961f\u5217",id:"74-redis\u6d88\u606f\u961f\u5217-\u57fa\u4e8estream\u7684\u6d88\u606f\u961f\u5217",level:2},{value:"7.5 Redis\u6d88\u606f\u961f\u5217-\u57fa\u4e8eStream\u7684\u6d88\u606f\u961f\u5217-\u6d88\u8d39\u8005\u7ec4",id:"75-redis\u6d88\u606f\u961f\u5217-\u57fa\u4e8estream\u7684\u6d88\u606f\u961f\u5217-\u6d88\u8d39\u8005\u7ec4",level:2},{value:"7.6 \u57fa\u4e8eRedis\u7684Stream\u7ed3\u6784\u4f5c\u4e3a\u6d88\u606f\u961f\u5217\uff0c\u5b9e\u73b0\u5f02\u6b65\u79d2\u6740\u4e0b\u5355",id:"76-\u57fa\u4e8eredis\u7684stream\u7ed3\u6784\u4f5c\u4e3a\u6d88\u606f\u961f\u5217\u5b9e\u73b0\u5f02\u6b65\u79d2\u6740\u4e0b\u5355",level:2},{value:"8.1\u3001\u8fbe\u4eba\u63a2\u5e97-\u53d1\u5e03\u63a2\u5e97\u7b14\u8bb0",id:"81\u8fbe\u4eba\u63a2\u5e97-\u53d1\u5e03\u63a2\u5e97\u7b14\u8bb0",level:2},{value:"8.2 \u8fbe\u4eba\u63a2\u5e97-\u67e5\u770b\u63a2\u5e97\u7b14\u8bb0",id:"82-\u8fbe\u4eba\u63a2\u5e97-\u67e5\u770b\u63a2\u5e97\u7b14\u8bb0",level:2},{value:"8.3 \u8fbe\u4eba\u63a2\u5e97-\u70b9\u8d5e\u529f\u80fd",id:"83-\u8fbe\u4eba\u63a2\u5e97-\u70b9\u8d5e\u529f\u80fd",level:2},{value:"8.4 \u8fbe\u4eba\u63a2\u5e97-\u70b9\u8d5e\u6392\u884c\u699c",id:"84-\u8fbe\u4eba\u63a2\u5e97-\u70b9\u8d5e\u6392\u884c\u699c",level:2},{value:"9.1 \u597d\u53cb\u5173\u6ce8-\u5173\u6ce8\u548c\u53d6\u6d88\u5173\u6ce8",id:"91-\u597d\u53cb\u5173\u6ce8-\u5173\u6ce8\u548c\u53d6\u6d88\u5173\u6ce8",level:2},{value:"9.2 \u597d\u53cb\u5173\u6ce8-\u5171\u540c\u5173\u6ce8",id:"92-\u597d\u53cb\u5173\u6ce8-\u5171\u540c\u5173\u6ce8",level:2},{value:"9.3 \u597d\u53cb\u5173\u6ce8-Feed\u6d41\u5b9e\u73b0\u65b9\u6848",id:"93-\u597d\u53cb\u5173\u6ce8-feed\u6d41\u5b9e\u73b0\u65b9\u6848",level:2},{value:"9.4 \u597d\u53cb\u5173\u6ce8-\u63a8\u9001\u5230\u7c89\u4e1d\u6536\u4ef6\u7bb1",id:"94-\u597d\u53cb\u5173\u6ce8-\u63a8\u9001\u5230\u7c89\u4e1d\u6536\u4ef6\u7bb1",level:2},{value:"9.5\u597d\u53cb\u5173\u6ce8-Feed\u6d41\u5b9e\u73b0\u6eda\u52a8\u5206\u9875\u67e5\u8be2\u6536\u90ae\u7bb1",id:"95\u597d\u53cb\u5173\u6ce8-feed\u6d41\u5b9e\u73b0\u6eda\u52a8\u5206\u9875\u67e5\u8be2\u6536\u90ae\u7bb1",level:2},{value:"10.1\u3001\u9644\u8fd1\u5546\u6237-GEO\u6570\u636e\u7ed3\u6784\u7684\u57fa\u672c\u7528\u6cd5",id:"101\u9644\u8fd1\u5546\u6237-geo\u6570\u636e\u7ed3\u6784\u7684\u57fa\u672c\u7528\u6cd5",level:2},{value:"10.2\u3001 \u9644\u8fd1\u5546\u6237-\u5bfc\u5165\u5e97\u94fa\u6570\u636e\u5230GEO",id:"102-\u9644\u8fd1\u5546\u6237-\u5bfc\u5165\u5e97\u94fa\u6570\u636e\u5230geo",level:2},{value:"10.3 \u9644\u8fd1\u5546\u6237-\u5b9e\u73b0\u9644\u8fd1\u5546\u6237\u529f\u80fd",id:"103-\u9644\u8fd1\u5546\u6237-\u5b9e\u73b0\u9644\u8fd1\u5546\u6237\u529f\u80fd",level:2},{value:"11.1\u3001\u7528\u6237\u7b7e\u5230-BitMap\u529f\u80fd\u6f14\u793a",id:"111\u7528\u6237\u7b7e\u5230-bitmap\u529f\u80fd\u6f14\u793a",level:2},{value:"11.2 \u3001\u7528\u6237\u7b7e\u5230-\u5b9e\u73b0\u7b7e\u5230\u529f\u80fd",id:"112-\u7528\u6237\u7b7e\u5230-\u5b9e\u73b0\u7b7e\u5230\u529f\u80fd",level:2},{value:"11.3 \u7528\u6237\u7b7e\u5230-\u7b7e\u5230\u7edf\u8ba1",id:"113-\u7528\u6237\u7b7e\u5230-\u7b7e\u5230\u7edf\u8ba1",level:2},{value:"11.4 \u989d\u5916\u52a0\u9910-\u5173\u4e8e\u4f7f\u7528bitmap\u6765\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\u7684\u65b9\u6848",id:"114-\u989d\u5916\u52a0\u9910-\u5173\u4e8e\u4f7f\u7528bitmap\u6765\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\u7684\u65b9\u6848",level:2},{value:"12.1 \u3001UV\u7edf\u8ba1-HyperLogLog",id:"121-uv\u7edf\u8ba1-hyperloglog",level:2},{value:"12.2 UV\u7edf\u8ba1-\u6d4b\u8bd5\u767e\u4e07\u6570\u636e\u7684\u7edf\u8ba1",id:"122-uv\u7edf\u8ba1-\u6d4b\u8bd5\u767e\u4e07\u6570\u636e\u7684\u7edf\u8ba1",level:2}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",del:"del",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"\u5b9e\u6218\u7bc7redis",children:"\u5b9e\u6218\u7bc7Redis"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\u7b14\u8bb0\u539f\u4ef6\u6765\u81ea\u9ed1\u9a6cB\u7ad9\u89c6\u9891\u914d\u5957\u7b14\u8bb0\uff0c\u7ecf\u8fc7\u81ea\u5df1\u52a0\u5de5\u4fee\u6539\u6dfb\u52a0\u7b49"}),"\n"]}),"\n",(0,r.jsx)(n.h1,{id:"\u5f00\u7bc7\u5bfc\u8bfb",children:"\u5f00\u7bc7\u5bfc\u8bfb"}),"\n",(0,r.jsx)(n.p,{children:"\u4eb2\u7231\u7684\u5c0f\u4f19\u4f34\u4eec\u5927\u5bb6\u597d\uff0c\u9a6c\u4e0a\u54b1\u4eec\u5c31\u5f00\u59cb\u5b9e\u6218\u7bc7\u7684\u5185\u5bb9\u4e86\uff0c\u76f8\u4fe1\u901a\u8fc7\u672c\u7ae0\u7684\u5b66\u4e60\uff0c\u5c0f\u4f19\u4f34\u4eec\u5c31\u80fd\u7406\u89e3\u5404\u79cdredis\u7684\u4f7f\u7528\u5566\uff0c\u63a5\u4e0b\u6765\u54b1\u4eec\u6765\u4e00\u8d77\u770b\u770b\u5b9e\u6218\u7bc7\u6211\u4eec\u8981\u5b66\u4e60\u4e00\u4e9b\u4ec0\u4e48\u6837\u7684\u5185\u5bb9"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u77ed\u4fe1\u767b\u5f55"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u4e00\u5757\u6211\u4eec\u4f1a\u4f7f\u7528redis\u5171\u4eabsession\u6765\u5b9e\u73b0"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5546\u6237\u67e5\u8be2\u7f13\u5b58"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u901a\u8fc7\u672c\u7ae0\u8282\uff0c\u6211\u4eec\u4f1a\u7406\u89e3\u7f13\u5b58\u51fb\u7a7f\uff0c\u7f13\u5b58\u7a7f\u900f\uff0c\u7f13\u5b58\u96ea\u5d29\u7b49\u95ee\u9898\uff0c\u8ba9\u5c0f\u4f19\u4f34\u7684\u5bf9\u4e8e\u8fd9\u4e9b\u6982\u5ff5\u7684\u7406\u89e3\u4e0d\u4ec5\u4ec5\u662f\u505c\u7559\u5728\u6982\u5ff5\u4e0a\uff0c\u66f4\u662f\u80fd\u5728\u4ee3\u7801\u4e2d\u770b\u5230\u5bf9\u5e94\u7684\u5185\u5bb9"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4f18\u60e0\u5377\u79d2\u6740"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u901a\u8fc7\u672c\u7ae0\u8282\uff0c\u6211\u4eec\u53ef\u4ee5\u5b66\u4f1aRedis\u7684\u8ba1\u6570\u5668\u529f\u80fd\uff0c \u7ed3\u5408Lua\u5b8c\u6210\u9ad8\u6027\u80fd\u7684redis\u64cd\u4f5c\uff0c\u540c\u65f6\u5b66\u4f1aRedis\u5206\u5e03\u5f0f\u9501\u7684\u539f\u7406\uff0c\u5305\u62ecRedis\u7684\u4e09\u79cd\u6d88\u606f\u961f\u5217"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u9644\u8fd1\u7684\u5546\u6237"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u5229\u7528Redis\u7684GEOHash\u6765\u5b8c\u6210\u5bf9\u4e8e\u5730\u7406\u5750\u6807\u7684\u64cd\u4f5c"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"UV\u7edf\u8ba1"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u4e3b\u8981\u662f\u4f7f\u7528Redis\u6765\u5b8c\u6210\u7edf\u8ba1\u529f\u80fd"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u7528\u6237\u7b7e\u5230"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528Redis\u7684BitMap\u6570\u636e\u7edf\u8ba1\u529f\u80fd"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u597d\u53cb\u5173\u6ce8"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u57fa\u4e8eSet\u96c6\u5408\u7684\u5173\u6ce8\u3001\u53d6\u6d88\u5173\u6ce8\uff0c\u5171\u540c\u5173\u6ce8\u7b49\u7b49\u529f\u80fd\uff0c\u8fd9\u4e00\u5757\u77e5\u8bc6\u54b1\u4eec\u4e4b\u524d\u5c31\u8bb2\u8fc7\uff0c\u8fd9\u6b21\u6211\u4eec\u5728\u9879\u76ee\u4e2d\u6765\u4f7f\u7528\u4e00\u4e0b"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6253\u4eba\u63a2\u5e97"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u57fa\u4e8eList\u6765\u5b8c\u6210\u70b9\u8d5e\u5217\u8868\u7684\u64cd\u4f5c\uff0c\u540c\u65f6\u57fa\u4e8eSortedSet\u6765\u5b8c\u6210\u70b9\u8d5e\u7684\u6392\u884c\u699c\u529f\u80fd"}),"\n",(0,r.jsx)(n.p,{children:"\u4ee5\u4e0a\u8fd9\u4e9b\u5185\u5bb9\u54b1\u4eec\u7edf\u7edf\u90fd\u4f1a\u7ed9\u5c0f\u4f19\u4f34\u4eec\u8bb2\u89e3\u6e05\u695a\uff0c\u8ba9\u5927\u5bb6\u5145\u5206\u7406\u89e3\u5982\u4f55\u4f7f\u7528Redis"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653056228879",src:s(56721).A+"",width:"1147",height:"601"})}),"\n",(0,r.jsx)(n.h1,{id:"1\u77ed\u4fe1\u767b\u5f55",children:"1\u3001\u77ed\u4fe1\u767b\u5f55"}),"\n",(0,r.jsx)(n.h2,{id:"11\u5bfc\u5165\u9ed1\u9a6c\u70b9\u8bc4\u9879\u76ee",children:"1.1\u3001\u5bfc\u5165\u9ed1\u9a6c\u70b9\u8bc4\u9879\u76ee"}),"\n",(0,r.jsx)(n.h3,{id:"111-\u5bfc\u5165sql",children:"1.1.1 \u3001\u5bfc\u5165SQL"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653057872536",src:s(31011).A+"",width:"1117",height:"536"})}),"\n",(0,r.jsx)(n.h3,{id:"112\u6709\u5173\u5f53\u524d\u6a21\u578b",children:"1.1.2\u3001\u6709\u5173\u5f53\u524d\u6a21\u578b"}),"\n",(0,r.jsx)(n.p,{children:"\u624b\u673a\u6216\u8005app\u7aef\u53d1\u8d77\u8bf7\u6c42\uff0c\u8bf7\u6c42\u6211\u4eec\u7684nginx\u670d\u52a1\u5668\uff0cnginx\u57fa\u4e8e\u4e03\u5c42\u6a21\u578b\u8d70\u7684\u4e8bHTTP\u534f\u8bae\uff0c\u53ef\u4ee5\u5b9e\u73b0\u57fa\u4e8eLua\u76f4\u63a5\u7ed5\u5f00tomcat\u8bbf\u95eeredis\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u9759\u6001\u8d44\u6e90\u670d\u52a1\u5668\uff0c\u8f7b\u677e\u625b\u4e0b\u4e0a\u4e07\u5e76\u53d1\uff0c \u8d1f\u8f7d\u5747\u8861\u5230\u4e0b\u6e38tomcat\u670d\u52a1\u5668\uff0c\u6253\u6563\u6d41\u91cf\uff0c\u6211\u4eec\u90fd\u77e5\u9053\u4e00\u53f04\u68388G\u7684tomcat\uff0c\u5728\u4f18\u5316\u548c\u5904\u7406\u7b80\u5355\u4e1a\u52a1\u7684\u52a0\u6301\u4e0b\uff0c\u5927\u4e0d\u4e86\u5c31\u5904\u74061000\u5de6\u53f3\u7684\u5e76\u53d1\uff0c \u7ecf\u8fc7nginx\u7684\u8d1f\u8f7d\u5747\u8861\u5206\u6d41\u540e\uff0c\u5229\u7528\u96c6\u7fa4\u652f\u6491\u8d77\u6574\u4e2a\u9879\u76ee\uff0c\u540c\u65f6nginx\u5728\u90e8\u7f72\u4e86\u524d\u7aef\u9879\u76ee\u540e\uff0c\u66f4\u662f\u53ef\u4ee5\u505a\u5230\u52a8\u9759\u5206\u79bb\uff0c\u8fdb\u4e00\u6b65\u964d\u4f4etomcat\u670d\u52a1\u7684\u538b\u529b\uff0c\u8fd9\u4e9b\u529f\u80fd\u90fd\u5f97\u9760nginx\u8d77\u4f5c\u7528\uff0c\u6240\u4ee5nginx\u662f\u6574\u4e2a\u9879\u76ee\u4e2d\u91cd\u8981\u7684\u4e00\u73af\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u5728tomcat\u652f\u6491\u8d77\u5e76\u53d1\u6d41\u91cf\u540e\uff0c\u6211\u4eec\u5982\u679c\u8ba9tomcat\u76f4\u63a5\u53bb\u8bbf\u95eeMysql\uff0c\u6839\u636e\u7ecf\u9a8cMysql\u4f01\u4e1a\u7ea7\u670d\u52a1\u5668\u53ea\u8981\u4e0a\u70b9\u5e76\u53d1\uff0c\u4e00\u822c\u662f16\u621632 \u6838\u5fc3cpu\uff0c32 \u621664G\u5185\u5b58\uff0c\u50cf\u4f01\u4e1a\u7ea7mysql\u52a0\u4e0a\u56fa\u6001\u786c\u76d8\u80fd\u591f\u652f\u6491\u7684\u5e76\u53d1\uff0c\u5927\u6982\u5c31\u662f4000\u8d77~7000\u5de6\u53f3\uff0c\u4e0a\u4e07\u5e76\u53d1\uff0c \u77ac\u95f4\u5c31\u4f1a\u8ba9Mysql\u670d\u52a1\u5668\u7684cpu\uff0c\u786c\u76d8\u5168\u90e8\u6253\u6ee1\uff0c\u5bb9\u6613\u5d29\u6e83\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u9ad8\u5e76\u53d1\u573a\u666f\u4e0b\uff0c\u4f1a\u9009\u62e9\u4f7f\u7528mysql\u96c6\u7fa4\uff0c\u540c\u65f6\u4e3a\u4e86\u8fdb\u4e00\u6b65\u964d\u4f4eMysql\u7684\u538b\u529b\uff0c\u540c\u65f6\u589e\u52a0\u8bbf\u95ee\u7684\u6027\u80fd\uff0c\u6211\u4eec\u4e5f\u4f1a\u52a0\u5165Redis\uff0c\u540c\u65f6\u4f7f\u7528Redis\u96c6\u7fa4\u4f7f\u5f97Redis\u5bf9\u5916\u63d0\u4f9b\u66f4\u597d\u7684\u670d\u52a1\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653059409865",src:s(47622).A+"",width:"1172",height:"481"})}),"\n",(0,r.jsx)(n.h3,{id:"113\u5bfc\u5165\u540e\u7aef\u9879\u76ee",children:"1.1.3\u3001\u5bfc\u5165\u540e\u7aef\u9879\u76ee"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u8d44\u6599\u4e2d\u63d0\u4f9b\u4e86\u4e00\u4e2a\u9879\u76ee\u6e90\u7801\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653060237073",src:s(60336).A+"",width:"1147",height:"569"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"http://localhost:8081/shop-type/list",children:"http://localhost:8081/shop-type/list"})}),"\n",(0,r.jsx)(n.h3,{id:"114\u5bfc\u5165\u524d\u7aef\u5de5\u7a0b",children:"1.1.4\u3001\u5bfc\u5165\u524d\u7aef\u5de5\u7a0b"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653060337562",src:s(99104).A+"",width:"900",height:"554"})}),"\n",(0,r.jsx)(n.h3,{id:"115-\u8fd0\u884c\u524d\u7aef\u9879\u76ee",children:"1.1.5 \u8fd0\u884c\u524d\u7aef\u9879\u76ee"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653060588190",src:s(44843).A+"",width:"1126",height:"555"})}),"\n",(0,r.jsx)(n.h2,{id:"12-\u57fa\u4e8esession\u5b9e\u73b0\u767b\u5f55\u6d41\u7a0b",children:"1.2 \u3001\u57fa\u4e8eSession\u5b9e\u73b0\u767b\u5f55\u6d41\u7a0b"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u53d1\u9001\u9a8c\u8bc1\u7801\uff1a"})}),"\n",(0,r.jsx)(n.p,{children:"\u7528\u6237\u5728\u63d0\u4ea4\u624b\u673a\u53f7\u540e\uff0c\u4f1a\u6821\u9a8c\u624b\u673a\u53f7\u662f\u5426\u5408\u6cd5\uff0c\u5982\u679c\u4e0d\u5408\u6cd5\uff0c\u5219\u8981\u6c42\u7528\u6237\u91cd\u65b0\u8f93\u5165\u624b\u673a\u53f7"}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u624b\u673a\u53f7\u5408\u6cd5\uff0c\u540e\u53f0\u6b64\u65f6\u751f\u6210\u5bf9\u5e94\u7684\u9a8c\u8bc1\u7801\uff0c\u540c\u65f6\u5c06\u9a8c\u8bc1\u7801\u8fdb\u884c\u4fdd\u5b58\uff0c\u7136\u540e\u518d\u901a\u8fc7\u77ed\u4fe1\u7684\u65b9\u5f0f\u5c06\u9a8c\u8bc1\u7801\u53d1\u9001\u7ed9\u7528\u6237"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u77ed\u4fe1\u9a8c\u8bc1\u7801\u767b\u5f55\u3001\u6ce8\u518c\uff1a"})}),"\n",(0,r.jsx)(n.p,{children:"\u7528\u6237\u5c06\u9a8c\u8bc1\u7801\u548c\u624b\u673a\u53f7\u8fdb\u884c\u8f93\u5165\uff0c\u540e\u53f0\u4ecesession\u4e2d\u62ff\u5230\u5f53\u524d\u9a8c\u8bc1\u7801\uff0c\u7136\u540e\u548c\u7528\u6237\u8f93\u5165\u7684\u9a8c\u8bc1\u7801\u8fdb\u884c\u6821\u9a8c\uff0c\u5982\u679c\u4e0d\u4e00\u81f4\uff0c\u5219\u65e0\u6cd5\u901a\u8fc7\u6821\u9a8c\uff0c\u5982\u679c\u4e00\u81f4\uff0c\u5219\u540e\u53f0\u6839\u636e\u624b\u673a\u53f7\u67e5\u8be2\u7528\u6237\uff0c\u5982\u679c\u7528\u6237\u4e0d\u5b58\u5728\uff0c\u5219\u4e3a\u7528\u6237\u521b\u5efa\u8d26\u53f7\u4fe1\u606f\uff0c\u4fdd\u5b58\u5230\u6570\u636e\u5e93\uff0c\u65e0\u8bba\u662f\u5426\u5b58\u5728\uff0c\u90fd\u4f1a\u5c06\u7528\u6237\u4fe1\u606f\u4fdd\u5b58\u5230session\u4e2d\uff0c\u65b9\u4fbf\u540e\u7eed\u83b7\u5f97\u5f53\u524d\u767b\u5f55\u4fe1\u606f"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u6821\u9a8c\u767b\u5f55\u72b6\u6001:"})}),"\n",(0,r.jsx)(n.p,{children:"\u7528\u6237\u5728\u8bf7\u6c42\u65f6\u5019\uff0c\u4f1a\u4ececookie\u4e2d\u643a\u5e26\u8005JsessionId\u5230\u540e\u53f0\uff0c\u540e\u53f0\u901a\u8fc7JsessionId\u4ecesession\u4e2d\u62ff\u5230\u7528\u6237\u4fe1\u606f\uff0c\u5982\u679c\u6ca1\u6709session\u4fe1\u606f\uff0c\u5219\u8fdb\u884c\u62e6\u622a\uff0c\u5982\u679c\u6709session\u4fe1\u606f\uff0c\u5219\u5c06\u7528\u6237\u4fe1\u606f\u4fdd\u5b58\u5230threadLocal\u4e2d\uff0c\u5e76\u4e14\u653e\u884c"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653066208144",src:s(42015).A+"",width:"1188",height:"534"})}),"\n",(0,r.jsx)(n.h2,{id:"13-\u5b9e\u73b0\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u529f\u80fd",children:"1.3 \u3001\u5b9e\u73b0\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u529f\u80fd"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u9875\u9762\u6d41\u7a0b"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653067054461",src:s(91903).A+"",width:"1738",height:"816"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u5177\u4f53\u4ee3\u7801\u5982\u4e0b"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u8d34\u5fc3\u5c0f\u63d0\u793a\uff1a"})}),"\n",(0,r.jsx)(n.p,{children:"\u5177\u4f53\u903b\u8f91\u4e0a\u6587\u5df2\u7ecf\u5206\u6790\uff0c\u6211\u4eec\u4ec5\u4ec5\u53ea\u9700\u8981\u6309\u7167\u63d0\u793a\u7684\u903b\u8f91\u5199\u51fa\u4ee3\u7801\u5373\u53ef\u3002"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u53d1\u9001\u9a8c\u8bc1\u7801"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'    @Override\n    public Result sendCode(String phone, HttpSession session) {\n        // 1.\u6821\u9a8c\u624b\u673a\u53f7\n        if (RegexUtils.isPhoneInvalid(phone)) {\n            // 2.\u5982\u679c\u4e0d\u7b26\u5408\uff0c\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\n            return Result.fail("\u624b\u673a\u53f7\u683c\u5f0f\u9519\u8bef\uff01");\n        }\n        // 3.\u7b26\u5408\uff0c\u751f\u6210\u9a8c\u8bc1\u7801\n        String code = RandomUtil.randomNumbers(6);\n\n        // 4.\u4fdd\u5b58\u9a8c\u8bc1\u7801\u5230 session\n        session.setAttribute("code",code);\n        // 5.\u53d1\u9001\u9a8c\u8bc1\u7801\n        log.debug("\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u6210\u529f\uff0c\u9a8c\u8bc1\u7801\uff1a{}", code);\n        // \u8fd4\u56deok\n        return Result.ok(code);\n    }\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u767b\u5f55"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'    @Override\n    public Result login(LoginFormDTO loginForm, HttpSession session) {\n        // 1.\u6821\u9a8c\u624b\u673a\u53f7\n        String phone = loginForm.getPhone();\n        if (RegexUtils.isPhoneInvalid(phone)) {\n            // 2.\u5982\u679c\u4e0d\u7b26\u5408\uff0c\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\n            return Result.fail("\u624b\u673a\u53f7\u683c\u5f0f\u9519\u8bef\uff01");\n        }\n        // 3.\u6821\u9a8c\u9a8c\u8bc1\u7801\n        Object cacheCode = session.getAttribute("code");\n        String code = loginForm.getCode();\n        if(cacheCode == null || !cacheCode.toString().equals(code)){\n             //3.\u4e0d\u4e00\u81f4\uff0c\u62a5\u9519\n            return Result.fail("\u9a8c\u8bc1\u7801\u9519\u8bef");\n        }\n        //\u4e00\u81f4\uff0c\u6839\u636e\u624b\u673a\u53f7\u67e5\u8be2\u7528\u6237\n        User user = query().eq("phone", phone).one();\n\n        //5.\u5224\u65ad\u7528\u6237\u662f\u5426\u5b58\u5728\n        if(user == null){\n            //\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\n            user =  createUserWithPhone(phone);\n        }\n        //7.\u4fdd\u5b58\u7528\u6237\u4fe1\u606f\u5230session\u4e2d\n        session.setAttribute("user",user);\n\n        return Result.ok();\n    }\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"private User createUserWithPhone(String phone) {\n    User user = new User();\n    user.setPhone(phone);\n    user.setNickName(SystemConstants.USER_NICK_NAME_PREFIX + RandomUtil.randomString(10));\n    this.save(user);\n    return user;\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"14\u5b9e\u73b0\u767b\u5f55\u62e6\u622a\u529f\u80fd",children:"1.4\u3001\u5b9e\u73b0\u767b\u5f55\u62e6\u622a\u529f\u80fd"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u6e29\u99a8\u5c0f\u8d34\u58eb\uff1atomcat\u7684\u8fd0\u884c\u539f\u7406"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653068196656",src:s(3605).A+"",width:"1070",height:"630"})}),"\n",(0,r.jsx)(n.p,{children:"\u5f53\u7528\u6237\u53d1\u8d77\u8bf7\u6c42\u65f6\uff0c\u4f1a\u8bbf\u95ee\u6211\u4eec\u50cftomcat\u6ce8\u518c\u7684\u7aef\u53e3\uff0c\u4efb\u4f55\u7a0b\u5e8f\u60f3\u8981\u8fd0\u884c\uff0c\u90fd\u9700\u8981\u6709\u4e00\u4e2a\u7ebf\u7a0b\u5bf9\u5f53\u524d\u7aef\u53e3\u53f7\u8fdb\u884c\u76d1\u542c\uff0ctomcat\u4e5f\u4e0d\u4f8b\u5916\uff0c\u5f53\u76d1\u542c\u7ebf\u7a0b\u77e5\u9053\u7528\u6237\u60f3\u8981\u548ctomcat\u8fde\u63a5\u8fde\u63a5\u65f6\uff0c\u90a3\u4f1a\u7531\u76d1\u542c\u7ebf\u7a0b\u521b\u5efasocket\u8fde\u63a5\uff0csocket\u90fd\u662f\u6210\u5bf9\u51fa\u73b0\u7684\uff0c\u7528\u6237\u901a\u8fc7socket\u50cf\u4e92\u76f8\u4f20\u9012\u6570\u636e\uff0c\u5f53tomcat\u7aef\u7684socket\u63a5\u53d7\u5230\u6570\u636e\u540e\uff0c\u6b64\u65f6\u76d1\u542c\u7ebf\u7a0b\u4f1a\u4ecetomcat\u7684\u7ebf\u7a0b\u6c60\u4e2d\u53d6\u51fa\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u7528\u6237\u8bf7\u6c42\uff0c\u5728\u6211\u4eec\u7684\u670d\u52a1\u90e8\u7f72\u5230tomcat\u540e\uff0c\u7ebf\u7a0b\u4f1a\u627e\u5230\u7528\u6237\u60f3\u8981\u8bbf\u95ee\u7684\u5de5\u7a0b\uff0c\u7136\u540e\u7528\u8fd9\u4e2a\u7ebf\u7a0b\u8f6c\u53d1\u5230\u5de5\u7a0b\u4e2d\u7684controller\uff0cservice\uff0cdao\u4e2d\uff0c\u5e76\u4e14\u8bbf\u95ee\u5bf9\u5e94\u7684DB\uff0c\u5728\u7528\u6237\u6267\u884c\u5b8c\u8bf7\u6c42\u540e\uff0c\u518d\u7edf\u4e00\u8fd4\u56de\uff0c\u518d\u627e\u5230tomcat\u7aef\u7684socket\uff0c\u518d\u5c06\u6570\u636e\u5199\u56de\u5230\u7528\u6237\u7aef\u7684socket\uff0c\u5b8c\u6210\u8bf7\u6c42\u548c\u54cd\u5e94"}),"\n",(0,r.jsx)(n.p,{children:"\u901a\u8fc7\u4ee5\u4e0a\u8bb2\u89e3\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u77e5 \u6bcf\u4e2a\u7528\u6237\u5176\u5b9e\u5bf9\u5e94\u90fd\u662f\u53bb\u627etomcat\u7ebf\u7a0b\u6c60\u4e2d\u7684\u4e00\u4e2a\u7ebf\u7a0b\u6765\u5b8c\u6210\u5de5\u4f5c\u7684\uff0c \u4f7f\u7528\u5b8c\u6210\u540e\u518d\u8fdb\u884c\u56de\u6536\uff0c\u65e2\u7136\u6bcf\u4e2a\u8bf7\u6c42\u90fd\u662f\u72ec\u7acb\u7684\uff0c\u6240\u4ee5\u5728\u6bcf\u4e2a\u7528\u6237\u53bb\u8bbf\u95ee\u6211\u4eec\u7684\u5de5\u7a0b\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528threadlocal\u6765\u505a\u5230\u7ebf\u7a0b\u9694\u79bb\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u64cd\u4f5c\u81ea\u5df1\u7684\u4e00\u4efd\u6570\u636e"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u6e29\u99a8\u5c0f\u8d34\u58eb\uff1a\u5173\u4e8ethreadlocal"})}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u5c0f\u4f19\u4f34\u4eec\u770b\u8fc7threadLocal\u7684\u6e90\u7801\uff0c\u4f60\u4f1a\u53d1\u73b0\u5728threadLocal\u4e2d\uff0c\u65e0\u8bba\u662f\u4ed6\u7684put\u65b9\u6cd5\u548c\u4ed6\u7684get\u65b9\u6cd5\uff0c \u90fd\u662f\u5148\u4ece\u83b7\u5f97\u5f53\u524d\u7528\u6237\u7684\u7ebf\u7a0b\uff0c\u7136\u540e\u4ece\u7ebf\u7a0b\u4e2d\u53d6\u51fa\u7ebf\u7a0b\u7684\u6210\u5458\u53d8\u91cfmap\uff0c\u53ea\u8981\u7ebf\u7a0b\u4e0d\u4e00\u6837\uff0cmap\u5c31\u4e0d\u4e00\u6837\uff0c\u6240\u4ee5\u53ef\u4ee5\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u6765\u505a\u5230\u7ebf\u7a0b\u9694\u79bb"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653068874258",src:s(54548).A+"",width:"1789",height:"917"})}),"\n",(0,r.jsx)(n.p,{children:"\u62e6\u622a\u5668\u4ee3\u7801"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Java",children:'public class LoginInterceptor implements HandlerInterceptor {\n\n    @Override\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n       //1.\u83b7\u53d6session\n        HttpSession session = request.getSession();\n        //2.\u83b7\u53d6session\u4e2d\u7684\u7528\u6237\n        Object user = session.getAttribute("user");\n        //3.\u5224\u65ad\u7528\u6237\u662f\u5426\u5b58\u5728\n        if(user == null){\n              //4.\u4e0d\u5b58\u5728\uff0c\u62e6\u622a\uff0c\u8fd4\u56de401\u72b6\u6001\u7801\n              response.setStatus(401);\n              return false;\n        }\n        //5.\u5b58\u5728\uff0c\u4fdd\u5b58\u7528\u6237\u4fe1\u606f\u5230Threadlocal\n        UserHolder.saveUser((User)user);\n        //6.\u653e\u884c\n        return true;\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u8ba9\u62e6\u622a\u5668\u751f\u6548"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Configuration\npublic class MvcConfig implements WebMvcConfigurer {\n\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        // \u767b\u5f55\u62e6\u622a\u5668\n        registry.addInterceptor(new LoginInterceptor())\n                .excludePathPatterns(\n                        "/shop/**",\n                        "/voucher/**",\n                        "/shop-type/**",\n                        "/upload/**",\n                        "/blog/hot",\n                        "/user/code",\n                        "/user/login"\n                );\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"15\u9690\u85cf\u7528\u6237\u654f\u611f\u4fe1\u606f",children:"1.5\u3001\u9690\u85cf\u7528\u6237\u654f\u611f\u4fe1\u606f"}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u901a\u8fc7\u6d4f\u89c8\u5668\u89c2\u5bdf\u5230\u6b64\u65f6\u7528\u6237\u7684\u5168\u90e8\u4fe1\u606f\u90fd\u5728\uff0c\u8fd9\u6837\u6781\u4e3a\u4e0d\u9760\u8c31\uff0c\u6240\u4ee5\u6211\u4eec\u5e94\u5f53\u5728\u8fd4\u56de\u7528\u6237\u4fe1\u606f\u4e4b\u524d\uff0c\u5c06\u7528\u6237\u7684\u654f\u611f\u4fe1\u606f\u8fdb\u884c\u9690\u85cf\uff0c\u91c7\u7528\u7684\u6838\u5fc3\u601d\u8def\u5c31\u662f\u4e66\u5199\u4e00\u4e2aUserDto\u5bf9\u8c61\uff0c\u8fd9\u4e2aUserDto\u5bf9\u8c61\u5c31\u6ca1\u6709\u654f\u611f\u4fe1\u606f\u4e86\uff0c\u6211\u4eec\u5728\u8fd4\u56de\u524d\uff0c\u5c06\u6709\u7528\u6237\u654f\u611f\u4fe1\u606f\u7684User\u5bf9\u8c61\u8f6c\u5316\u6210\u6ca1\u6709\u654f\u611f\u4fe1\u606f\u7684UserDto\u5bf9\u8c61\uff0c\u90a3\u4e48\u5c31\u80fd\u591f\u907f\u514d\u8fd9\u4e2a\u5c34\u5c2c\u7684\u95ee\u9898\u4e86"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u5728\u767b\u5f55\u65b9\u6cd5\u5904\u4fee\u6539"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'//7.\u4fdd\u5b58\u7528\u6237\u4fe1\u606f\u5230session\u4e2d\nsession.setAttribute("user", BeanUtils.copyProperties(user,UserDTO.class));\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u5728\u62e6\u622a\u5668\u5904\uff1a"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"//5.\u5b58\u5728\uff0c\u4fdd\u5b58\u7528\u6237\u4fe1\u606f\u5230Threadlocal\nUserHolder.saveUser((UserDTO) user);\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u5728UserHolder\u5904\uff1a\u5c06user\u5bf9\u8c61\u6362\u6210UserDTO"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"public class UserHolder {\n    private static final ThreadLocal<UserDTO> tl = new ThreadLocal<>();\n\n    public static void saveUser(UserDTO user){\n        tl.set(user);\n    }\n\n    public static UserDTO getUser(){\n        return tl.get();\n    }\n\n    public static void removeUser(){\n        tl.remove();\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"16session\u5171\u4eab\u95ee\u9898",children:"1.6\u3001session\u5171\u4eab\u95ee\u9898"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u6838\u5fc3\u601d\u8def\u5206\u6790\uff1a"})}),"\n",(0,r.jsxs)(n.p,{children:["tomcat\u670d\u52a1\u5668",(0,r.jsx)(n.strong,{children:"session\u4e0d\u5171\u4eab"})]}),"\n",(0,r.jsx)(n.p,{children:"**\u6bcf\u4e2atomcat\u4e2d\u90fd\u6709\u4e00\u4efd\u5c5e\u4e8e\u81ea\u5df1\u7684session,**\u5047\u8bbe\u7528\u6237\u7b2c\u4e00\u6b21\u8bbf\u95ee\u7b2c\u4e00\u53f0tomcat\uff0c\u5e76\u4e14\u628a\u81ea\u5df1\u7684\u4fe1\u606f\u5b58\u653e\u5230\u7b2c\u4e00\u53f0\u670d\u52a1\u5668\u7684session\u4e2d\uff0c\u4f46\u662f\u7b2c\u4e8c\u6b21\u8fd9\u4e2a\u7528\u6237\u8bbf\u95ee\u5230\u4e86\u7b2c\u4e8c\u53f0tomcat\uff0c\u90a3\u4e48\u5728\u7b2c\u4e8c\u53f0\u670d\u52a1\u5668\u4e0a\uff0c\u80af\u5b9a\u6ca1\u6709\u7b2c\u4e00\u53f0\u670d\u52a1\u5668\u5b58\u653e\u7684session\uff0c\u6240\u4ee5\u6b64\u65f6 \u6574\u4e2a\u767b\u5f55\u62e6\u622a\u529f\u80fd\u5c31\u4f1a\u51fa\u73b0\u95ee\u9898\uff0c\u6211\u4eec\u80fd\u5982\u4f55\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f\u65e9\u671f\u7684\u65b9\u6848\u662fsession\u62f7\u8d1d\uff0c\u5c31\u662f\u8bf4\u867d\u7136\u6bcf\u4e2atomcat\u4e0a\u90fd\u6709\u4e0d\u540c\u7684session\uff0c\u4f46\u662f\u6bcf\u5f53\u4efb\u610f\u4e00\u53f0\u670d\u52a1\u5668\u7684session\u4fee\u6539\u65f6\uff0c\u90fd\u4f1a\u540c\u6b65\u7ed9\u5176\u4ed6\u7684Tomcat\u670d\u52a1\u5668\u7684session\uff0c\u8fd9\u6837\u7684\u8bdd\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0session\u7684\u5171\u4eab\u4e86"}),"\n",(0,r.jsx)(n.p,{children:"\u4f46\u662f\u8fd9\u79cd\u65b9\u6848\u5177\u6709\u4e24\u4e2a\u5927\u95ee\u9898"}),"\n",(0,r.jsx)(n.p,{children:"1\u3001\u6bcf\u53f0\u670d\u52a1\u5668\u4e2d\u90fd\u6709\u5b8c\u6574\u7684\u4e00\u4efdsession\u6570\u636e\uff0c\u670d\u52a1\u5668\u538b\u529b\u8fc7\u5927\u3002"}),"\n",(0,r.jsx)(n.p,{children:"2\u3001session\u62f7\u8d1d\u6570\u636e\u65f6\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u5ef6\u8fdf"}),"\n",(0,r.jsx)(n.p,{children:"\u6240\u4ee5\u54b1\u4eec\u540e\u6765\u91c7\u7528\u7684\u65b9\u6848\u90fd\u662f\u57fa\u4e8eredis\u6765\u5b8c\u6210\uff0c\u6211\u4eec\u628asession\u6362\u6210redis\uff0credis\u6570\u636e\u672c\u8eab\u5c31\u662f\u5171\u4eab\u7684\uff0c\u5c31\u53ef\u4ee5\u907f\u514dsession\u5171\u4eab\u7684\u95ee\u9898\u4e86"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653069893050",src:s(85436).A+"",width:"1624",height:"708"})}),"\n",(0,r.jsx)(n.h2,{id:"17-redis\u4ee3\u66ffsession\u7684\u4e1a\u52a1\u6d41\u7a0b",children:"1.7 Redis\u4ee3\u66ffsession\u7684\u4e1a\u52a1\u6d41\u7a0b"}),"\n",(0,r.jsx)(n.h3,{id:"171\u8bbe\u8ba1key\u7684\u7ed3\u6784",children:"1.7.1\u3001\u8bbe\u8ba1key\u7684\u7ed3\u6784"}),"\n",(0,r.jsx)(n.p,{children:"\u9996\u5148\u6211\u4eec\u8981\u601d\u8003\u4e00\u4e0b\u5229\u7528redis\u6765\u5b58\u50a8\u6570\u636e\uff0c\u90a3\u4e48\u5230\u5e95\u4f7f\u7528\u54ea\u79cd\u7ed3\u6784\u5462\uff1f\u7531\u4e8e\u5b58\u5165\u7684\u6570\u636e\u6bd4\u8f83\u7b80\u5355\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u4f7f\u7528String\uff0c\u6216\u8005\u662f\u4f7f\u7528\u54c8\u5e0c\uff0c\u5982\u4e0b\u56fe\uff0c\u5982\u679c\u4f7f\u7528String\uff0c\u540c\u5b66\u4eec\u6ce8\u610f\u4ed6\u7684value\uff0c\u7528\u591a\u5360\u7528\u4e00\u70b9\u7a7a\u95f4\uff0c\u5982\u679c\u4f7f\u7528\u54c8\u5e0c\uff0c\u5219\u4ed6\u7684value\u4e2d\u53ea\u4f1a\u5b58\u50a8\u4ed6\u6570\u636e\u672c\u8eab\uff0c\u5982\u679c\u4e0d\u662f\u7279\u522b\u5728\u610f\u5185\u5b58\uff0c\u5176\u5b9e\u4f7f\u7528String\u5c31\u53ef\u4ee5\u5566\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653319261433",src:s(53908).A+"",width:"1197",height:"770"})}),"\n",(0,r.jsx)(n.h3,{id:"172\u8bbe\u8ba1key\u7684\u5177\u4f53\u7ec6\u8282",children:"1.7.2\u3001\u8bbe\u8ba1key\u7684\u5177\u4f53\u7ec6\u8282"}),"\n",(0,r.jsx)(n.p,{children:"\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528String\u7ed3\u6784\uff0c\u5c31\u662f\u4e00\u4e2a\u7b80\u5355\u7684key\uff0cvalue\u952e\u503c\u5bf9\u7684\u65b9\u5f0f\uff0c\u4f46\u662f\u5173\u4e8ekey\u7684\u5904\u7406\uff0csession\u4ed6\u662f\u6bcf\u4e2a\u7528\u6237\u90fd\u6709\u81ea\u5df1\u7684session\uff0c\u4f46\u662fredis\u7684key\u662f\u5171\u4eab\u7684\uff0c\u54b1\u4eec\u5c31\u4e0d\u80fd\u4f7f\u7528code\u4e86"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u8bbe\u8ba1\u8fd9\u4e2akey\u7684\u65f6\u5019\uff0c\u6211\u4eec\u4e4b\u524d\u8bb2\u8fc7\u9700\u8981\u6ee1\u8db3\u4e24\u70b9"}),"\n",(0,r.jsx)(n.p,{children:"1\u3001key\u8981\u5177\u6709\u552f\u4e00\u6027"}),"\n",(0,r.jsx)(n.p,{children:"2\u3001key\u8981\u65b9\u4fbf\u643a\u5e26"}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u6211\u4eec\u91c7\u7528phone\uff1a\u624b\u673a\u53f7\u8fd9\u4e2a\u7684\u6570\u636e\u6765\u5b58\u50a8\u5f53\u7136\u662f\u53ef\u4ee5\u7684\uff0c\u4f46\u662f\u5982\u679c\u628a\u8fd9\u6837\u7684\u654f\u611f\u6570\u636e\u5b58\u50a8\u5230redis\u4e2d\u5e76\u4e14\u4ece\u9875\u9762\u4e2d\u5e26\u8fc7\u6765\u6bd5\u7adf\u4e0d\u592a\u5408\u9002\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u540e\u53f0\u751f\u6210\u4e00\u4e2a\u968f\u673a\u4e32token\uff0c\u7136\u540e\u8ba9\u524d\u7aef\u5e26\u6765\u8fd9\u4e2atoken\u5c31\u80fd\u5b8c\u6210\u6211\u4eec\u7684\u6574\u4f53\u903b\u8f91\u4e86"}),"\n",(0,r.jsx)(n.h3,{id:"173\u6574\u4f53\u8bbf\u95ee\u6d41\u7a0b",children:"1.7.3\u3001\u6574\u4f53\u8bbf\u95ee\u6d41\u7a0b"}),"\n",(0,r.jsx)(n.p,{children:"\u5f53\u6ce8\u518c\u5b8c\u6210\u540e\uff0c\u7528\u6237\u53bb\u767b\u5f55\u4f1a\u53bb\u6821\u9a8c\u7528\u6237\u63d0\u4ea4\u7684\u624b\u673a\u53f7\u548c\u9a8c\u8bc1\u7801\uff0c\u662f\u5426\u4e00\u81f4\uff0c\u5982\u679c\u4e00\u81f4\uff0c\u5219\u6839\u636e\u624b\u673a\u53f7\u67e5\u8be2\u7528\u6237\u4fe1\u606f\uff0c\u4e0d\u5b58\u5728\u5219\u65b0\u5efa\uff0c\u6700\u540e\u5c06\u7528\u6237\u6570\u636e\u4fdd\u5b58\u5230redis\uff0c\u5e76\u4e14\u751f\u6210token\u4f5c\u4e3aredis\u7684key\uff0c\u5f53\u6211\u4eec\u6821\u9a8c\u7528\u6237\u662f\u5426\u767b\u5f55\u65f6\uff0c\u4f1a\u53bb\u643a\u5e26\u7740token\u8fdb\u884c\u8bbf\u95ee\uff0c\u4eceredis\u4e2d\u53d6\u51fatoken\u5bf9\u5e94\u7684value\uff0c\u5224\u65ad\u662f\u5426\u5b58\u5728\u8fd9\u4e2a\u6570\u636e\uff0c\u5982\u679c\u6ca1\u6709\u5219\u62e6\u622a\uff0c\u5982\u679c\u5b58\u5728\u5219\u5c06\u5176\u4fdd\u5b58\u5230threadLocal\u4e2d\uff0c\u5e76\u4e14\u653e\u884c\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653319474181",src:s(29362).A+"",width:"1487",height:"781"})}),"\n",(0,r.jsx)(n.h2,{id:"18-\u57fa\u4e8eredis\u5b9e\u73b0\u77ed\u4fe1\u767b\u5f55",children:"1.8 \u57fa\u4e8eRedis\u5b9e\u73b0\u77ed\u4fe1\u767b\u5f55"}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u91cc\u5177\u4f53\u903b\u8f91\u5c31\u4e0d\u5206\u6790\u4e86\uff0c\u4e4b\u524d\u54b1\u4eec\u5df2\u7ecf\u91cd\u70b9\u5206\u6790\u8fc7\u8fd9\u4e2a\u903b\u8f91\u5566\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"UserServiceImpl\u4ee3\u7801"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Override\npublic Result sendCode(String phone, HttpSession session) {\n    //1 \u6821\u9a8c\u624b\u673a\u53f7\n    if (RegexUtils.isPhoneInvalid(phone)) {\n        return Result.fail("\u624b\u673a\u53f7\u683c\u5f0f\u9519\u8bef\uff01");\n    }\n    //2 \u7b26\u5408\uff0c\u751f\u6210\u9a8c\u8bc1\u7801\n    String code = RandomUtil.randomNumbers(6);\n    //3 \u4fdd\u5b58\u9a8c\u8bc1\u7801\u5230Redis\n    stringRedisTemplate.opsForValue().set(RedisConstants.LOGIN_CODE_KEY + phone, code, RedisConstants.LOGIN_CODE_TTL, TimeUnit.MINUTES);\n    //4 TODO \u53d1\u9001\u9a8c\u8bc1\u7801\uff08\u4f7f\u7528\u963f\u91cc\u4e91\u7b49\uff09\uff0c\u8fd9\u91cc\u53ea\u7b80\u5355\u6253\u5370\n    log.debug("\u53d1\u9001\u77ed\u4fe1\u9a8c\u8bc1\u7801\u6210\u529f\uff0c\u9a8c\u8bc1\u7801\uff1a{}", code);\n    //5 \u8fd4\u56deOK\n    return Result.ok();\n}\n\n@Override\npublic Result login(LoginFormDTO loginForm, HttpSession session) {\n    // 1.\u6821\u9a8c\u624b\u673a\u53f7\n    String phone = loginForm.getPhone();\n    if (RegexUtils.isPhoneInvalid(phone)) {\n        // 2.\u5982\u679c\u4e0d\u7b26\u5408\uff0c\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\n        return Result.fail("\u624b\u673a\u53f7\u683c\u5f0f\u9519\u8bef\uff01");\n    }\n    // 3.\u4eceredis\u83b7\u53d6\u9a8c\u8bc1\u7801\u5e76\u6821\u9a8c\n    String cacheCode = stringRedisTemplate.opsForValue().get(LOGIN_CODE_KEY + phone);\n    String code = loginForm.getCode();\n    if (cacheCode == null || !cacheCode.equals(code)) {\n        // \u4e0d\u4e00\u81f4\uff0c\u62a5\u9519\n        return Result.fail("\u9a8c\u8bc1\u7801\u9519\u8bef");\n    }\n\n    // 4.\u4e00\u81f4\uff0c\u6839\u636e\u624b\u673a\u53f7\u67e5\u8be2\u7528\u6237 select * from tb_user where phone = ?\n    User user = query().eq("phone", phone).one();\n\n    // 5.\u5224\u65ad\u7528\u6237\u662f\u5426\u5b58\u5728\n    if (user == null) {\n        // 6.\u4e0d\u5b58\u5728\uff0c\u521b\u5efa\u65b0\u7528\u6237\u5e76\u4fdd\u5b58\n        user = createUserWithPhone(phone);\n    }\n\n    // 7.\u4fdd\u5b58\u7528\u6237\u4fe1\u606f\u5230 redis\u4e2d\n    // 7.1.\u968f\u673a\u751f\u6210token\uff0c\u4f5c\u4e3a\u767b\u5f55\u4ee4\u724c\n    String token = UUID.randomUUID().toString(true);\n    // 7.2.\u5c06User\u5bf9\u8c61\u8f6c\u4e3aHashMap\u5b58\u50a8\n    UserDTO userDTO = BeanUtil.copyProperties(user, UserDTO.class);\n    Map<String, Object> userMap = BeanUtil.beanToMap(userDTO, new HashMap<>(),\n            CopyOptions.create()\n                    .setIgnoreNullValue(true)\n                    .setFieldValueEditor((fieldName, fieldValue) -> fieldValue.toString()));\n    // 7.3.\u5b58\u50a8\n    String tokenKey = LOGIN_USER_KEY + token;\n    stringRedisTemplate.opsForHash().putAll(tokenKey, userMap);\n    // 7.4.\u8bbe\u7f6etoken\u6709\u6548\u671f\n    stringRedisTemplate.expire(tokenKey, LOGIN_USER_TTL, TimeUnit.MINUTES);\n\n    // 8.\u8fd4\u56detoken\n    return Result.ok(token);\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"19-\u89e3\u51b3\u72b6\u6001\u767b\u5f55\u5237\u65b0\u95ee\u9898",children:"1.9 \u89e3\u51b3\u72b6\u6001\u767b\u5f55\u5237\u65b0\u95ee\u9898"}),"\n",(0,r.jsx)(n.h3,{id:"191-\u521d\u59cb\u65b9\u6848\u601d\u8def\u603b\u7ed3",children:"1.9.1 \u521d\u59cb\u65b9\u6848\u601d\u8def\u603b\u7ed3\uff1a"}),"\n",(0,r.jsxs)(n.p,{children:["\u5728\u8fd9\u4e2a\u65b9\u6848\u4e2d\uff0c\u4ed6\u786e\u5b9e\u53ef\u4ee5\u4f7f\u7528\u5bf9\u5e94\u8def\u5f84\u7684\u62e6\u622a\uff0c\u540c\u65f6\u5237\u65b0\u767b\u5f55token\u4ee4\u724c\u7684\u5b58\u6d3b\u65f6\u95f4\uff0c\u4f46\u662f\u73b0\u5728\u8fd9\u4e2a\u62e6\u622a\u5668\u4ed6",(0,r.jsx)(n.strong,{children:"\u53ea\u662f\u62e6\u622a\u9700\u8981\u88ab\u62e6\u622a\u7684\u8def\u5f84"}),"\uff0c\u5047\u8bbe\u5f53\u524d\u7528\u6237\u8bbf\u95ee\u4e86\u4e00\u4e9b\u4e0d\u9700\u8981\u62e6\u622a\u7684\u8def\u5f84\uff0c\u90a3\u4e48\u8fd9\u4e2a\u62e6\u622a\u5668\u5c31\u4e0d\u4f1a\u751f\u6548\uff0c\u6240\u4ee5\u6b64\u65f6\u4ee4\u724c\u5237\u65b0\u7684\u52a8\u4f5c\u5b9e\u9645\u4e0a\u5c31\u4e0d\u4f1a\u6267\u884c\uff0c\u6240\u4ee5\u8fd9\u4e2a\u65b9\u6848\u4ed6\u662f\u5b58\u5728\u95ee\u9898\u7684"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653320822964",src:s(89494).A+"",width:"1280",height:"719"})}),"\n",(0,r.jsx)(n.h3,{id:"192-\u4f18\u5316\u65b9\u6848",children:"1.9.2 \u4f18\u5316\u65b9\u6848"}),"\n",(0,r.jsx)(n.p,{children:"\u65e2\u7136\u4e4b\u524d\u7684\u62e6\u622a\u5668\u65e0\u6cd5\u5bf9\u4e0d\u9700\u8981\u62e6\u622a\u7684\u8def\u5f84\u751f\u6548\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a\u62e6\u622a\u5668\uff0c\u5728\u7b2c\u4e00\u4e2a\u62e6\u622a\u5668\u4e2d\u62e6\u622a\u6240\u6709\u7684\u8def\u5f84\uff0c\u628a\u7b2c\u4e8c\u4e2a\u62e6\u622a\u5668\u505a\u7684\u4e8b\u60c5\u653e\u5165\u5230\u7b2c\u4e00\u4e2a\u62e6\u622a\u5668\u4e2d\uff0c\u540c\u65f6\u5237\u65b0\u4ee4\u724c\uff0c\u56e0\u4e3a\u7b2c\u4e00\u4e2a\u62e6\u622a\u5668\u6709\u4e86threadLocal\u7684\u6570\u636e\uff0c\u6240\u4ee5\u6b64\u65f6\u7b2c\u4e8c\u4e2a\u62e6\u622a\u5668\u53ea\u9700\u8981\u5224\u65ad\u62e6\u622a\u5668\u4e2d\u7684user\u5bf9\u8c61\u662f\u5426\u5b58\u5728\u5373\u53ef\uff0c\u5b8c\u6210\u6574\u4f53\u5237\u65b0\u529f\u80fd\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653320764547",src:s(78404).A+"",width:"1562",height:"778"})}),"\n",(0,r.jsx)(n.h3,{id:"193-\u4ee3\u7801",children:"1.9.3 \u4ee3\u7801"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"RefreshTokenInterceptor"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'public class RefreshTokenInterceptor implements HandlerInterceptor {\n\n    private StringRedisTemplate stringRedisTemplate;\n\n    public RefreshTokenInterceptor(StringRedisTemplate stringRedisTemplate) {\n        this.stringRedisTemplate = stringRedisTemplate;\n    }\n\n    @Override\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n        // 1.\u83b7\u53d6\u8bf7\u6c42\u5934\u4e2d\u7684token\n        String token = request.getHeader("authorization");\n        if (StrUtil.isBlank(token)) {\n            return true;\n        }\n        // 2.\u57fa\u4e8eTOKEN\u83b7\u53d6redis\u4e2d\u7684\u7528\u6237\n        String key  = LOGIN_USER_KEY + token;\n        Map<Object, Object> userMap = stringRedisTemplate.opsForHash().entries(key);\n        // 3.\u5224\u65ad\u7528\u6237\u662f\u5426\u5b58\u5728\n        if (userMap.isEmpty()) {\n            return true;\n        }\n        // 5.\u5c06\u67e5\u8be2\u5230\u7684hash\u6570\u636e\u8f6c\u4e3aUserDTO\n        UserDTO userDTO = BeanUtil.fillBeanWithMap(userMap, new UserDTO(), false);\n        // 6.\u5b58\u5728\uff0c\u4fdd\u5b58\u7528\u6237\u4fe1\u606f\u5230 ThreadLocal\n        UserHolder.saveUser(userDTO);\n        // 7.\u5237\u65b0token\u6709\u6548\u671f\n        stringRedisTemplate.expire(key, LOGIN_USER_TTL, TimeUnit.MINUTES);\n        // 8.\u653e\u884c\n        return true;\n    }\n\n    @Override\n    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {\n        // \u79fb\u9664\u7528\u6237\n        UserHolder.removeUser();\n    }\n}\n\t\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"LoginInterceptor"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"public class LoginInterceptor implements HandlerInterceptor {\n\n    @Override\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n        // 1.\u5224\u65ad\u662f\u5426\u9700\u8981\u62e6\u622a\uff08ThreadLocal\u4e2d\u662f\u5426\u6709\u7528\u6237\uff09\n        if (UserHolder.getUser() == null) {\n            // \u6ca1\u6709\uff0c\u9700\u8981\u62e6\u622a\uff0c\u8bbe\u7f6e\u72b6\u6001\u7801\n            response.setStatus(401);\n            // \u62e6\u622a\n            return false;\n        }\n        // \u6709\u7528\u6237\uff0c\u5219\u653e\u884c\n        return true;\n    }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"MvcConfig"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Configuration\npublic class MvcConfig implements WebMvcConfigurer {\n\n    @Resource\n    private StringRedisTemplate stringRedisTemplate;\n\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        // \u767b\u5f55\u62e6\u622a\u5668\n        registry.addInterceptor(new LoginInterceptor())\n                .excludePathPatterns(\n                        "/shop/**",\n                        "/voucher/**",\n                        "/shop-type/**",\n                        "/upload/**",\n                        "/blog/hot",\n                        "/user/code",\n                        "/user/login"\n                ).order(1);\n        // token\u5237\u65b0\u7684\u62e6\u622a\u5668\n        registry.addInterceptor(new RefreshTokenInterceptor(stringRedisTemplate)).addPathPatterns("/**").order(0);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h1,{id:"2\u5546\u6237\u67e5\u8be2\u7f13\u5b58",children:"2\u3001\u5546\u6237\u67e5\u8be2\u7f13\u5b58"}),"\n",(0,r.jsx)(n.h2,{id:"21-\u4ec0\u4e48\u662f\u7f13\u5b58",children:"2.1 \u4ec0\u4e48\u662f\u7f13\u5b58?"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u524d\u8a00"}),":",(0,r.jsx)(n.strong,{children:"\u4ec0\u4e48\u662f\u7f13\u5b58?"})]}),"\n",(0,r.jsxs)(n.p,{children:["\u5c31\u50cf\u81ea\u884c\u8f66,\u8d8a\u91ce\u8f66\u7684\u907f\u9707\u5668",(0,r.jsx)(n.img,{src:s(9866).A+"",width:"400",height:"225"})]}),"\n",(0,r.jsxs)(n.p,{children:['\u4e3e\u4e2a\u4f8b\u5b50:\u8d8a\u91ce\u8f66,\u5c71\u5730\u81ea\u884c\u8f66,\u90fd\u62e5\u6709"\u907f\u9707\u5668",',(0,r.jsx)(n.strong,{children:"\u9632\u6b62"}),'\u8f66\u4f53\u52a0\u901f\u540e\u56e0\u60ef\u6027,\u5728\u9177\u4f3c"U"\u5b57\u6bcd\u7684\u5730\u5f62\u4e0a\u98de\u8dc3,\u786c\u7740\u9646\u5bfc\u81f4\u7684',(0,r.jsx)(n.strong,{children:"\u635f\u5bb3"}),",\u50cf\u4e2a\u5f39\u7c27\u4e00\u6837;"]}),"\n",(0,r.jsx)(n.p,{children:'\u540c\u6837,\u5b9e\u9645\u5f00\u53d1\u4e2d,\u7cfb\u7edf\u4e5f\u9700\u8981"\u907f\u9707\u5668",\u9632\u6b62\u8fc7\u9ad8\u7684\u6570\u636e\u8bbf\u95ee\u731b\u51b2\u7cfb\u7edf,\u5bfc\u81f4\u5176\u64cd\u4f5c\u7ebf\u7a0b\u65e0\u6cd5\u53ca\u65f6\u5904\u7406\u4fe1\u606f\u800c\u762b\u75ea;'}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\u5bf9\u4f01\u4e1a\u8bb2,\u5bf9\u4ea7\u54c1\u53e3\u7891,\u7528\u6237\u8bc4\u4ef7\u90fd\u662f\u81f4\u547d\u7684;\u6240\u4ee5\u4f01\u4e1a\u975e\u5e38\u91cd\u89c6\u7f13\u5b58\u6280\u672f;"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.strong,{children:["\u7f13\u5b58(",(0,r.jsx)(n.strong,{children:"Cache),\u5c31\u662f\u6570\u636e\u4ea4\u6362\u7684"}),"\u7f13\u51b2\u533a"]}),",\u4fd7\u79f0\u7684\u7f13\u5b58\u5c31\u662f",(0,r.jsx)(n.strong,{children:"\u7f13\u51b2\u533a\u5185\u7684\u6570\u636e"}),",\u4e00\u822c\u4ece\u6570\u636e\u5e93\u4e2d\u83b7\u53d6,\u5b58\u50a8\u4e8e\u672c\u5730\u4ee3\u7801(\u4f8b\u5982:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"\u4f8b1:Static final ConcurrentHashMap<K,V> map = new ConcurrentHashMap<>(); \u672c\u5730\u7528\u4e8e\u9ad8\u5e76\u53d1\n\n\u4f8b2:static final Cache<K,V> USER_CACHE = CacheBuilder.newBuilder().build(); \u7528\u4e8eredis\u7b49\u7f13\u5b58\n\n\u4f8b3:Static final Map<K,V> map =  new HashMap(); \u672c\u5730\u7f13\u5b58\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u7531\u4e8e\u5176\u88ab",(0,r.jsx)(n.strong,{children:"Static"}),"\u4fee\u9970,\u6240\u4ee5\u968f\u7740\u7c7b\u7684\u52a0\u8f7d\u800c\u88ab\u52a0\u8f7d\u5230",(0,r.jsx)(n.strong,{children:"\u5185\u5b58\u4e4b\u4e2d"}),",\u4f5c\u4e3a\u672c\u5730\u7f13\u5b58,\u7531\u4e8e\u5176\u53c8\u88ab",(0,r.jsx)(n.strong,{children:"final"}),"\u4fee\u9970,\u6240\u4ee5\u5176\u5f15\u7528(\u4f8b3:map)\u548c\u5bf9\u8c61(\u4f8b3:new HashMap())\u4e4b\u95f4\u7684\u5173\u7cfb\u662f\u56fa\u5b9a\u7684,\u4e0d\u80fd\u6539\u53d8,\u56e0\u6b64\u4e0d\u7528\u62c5\u5fc3\u8d4b\u503c(=)\u5bfc\u81f4\u7f13\u5b58\u5931\u6548;"]}),"\n",(0,r.jsx)(n.h3,{id:"211-\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u7f13\u5b58",children:"2.1.1 \u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u7f13\u5b58"}),"\n",(0,r.jsxs)(n.p,{children:["\u4e00\u53e5\u8bdd:\u56e0\u4e3a",(0,r.jsx)(n.strong,{children:"\u901f\u5ea6\u5feb,\u597d\u7528"})]}),"\n",(0,r.jsxs)(n.p,{children:["\u7f13\u5b58\u6570\u636e\u5b58\u50a8\u4e8e\u4ee3\u7801\u4e2d,\u800c\u4ee3\u7801\u8fd0\u884c\u5728\u5185\u5b58\u4e2d,\u5185\u5b58\u7684\u8bfb\u5199\u6027\u80fd\u8fdc\u9ad8\u4e8e\u78c1\u76d8,\u7f13\u5b58\u53ef\u4ee5\u5927\u5927\u964d\u4f4e",(0,r.jsx)(n.strong,{children:"\u7528\u6237\u8bbf\u95ee\u5e76\u53d1\u91cf\u5e26\u6765\u7684"}),"\u670d\u52a1\u5668\u8bfb\u5199\u538b\u529b"]}),"\n",(0,r.jsx)(n.p,{children:'\u5b9e\u9645\u5f00\u53d1\u8fc7\u7a0b\u4e2d,\u4f01\u4e1a\u7684\u6570\u636e\u91cf,\u5c11\u5219\u51e0\u5341\u4e07,\u591a\u5219\u51e0\u5343\u4e07,\u8fd9\u4e48\u5927\u6570\u636e\u91cf,\u5982\u679c\u6ca1\u6709\u7f13\u5b58\u6765\u4f5c\u4e3a"\u907f\u9707\u5668",\u7cfb\u7edf\u662f\u51e0\u4e4e\u6491\u4e0d\u4f4f\u7684,\u6240\u4ee5\u4f01\u4e1a\u4f1a\u5927\u91cf\u8fd0\u7528\u5230\u7f13\u5b58\u6280\u672f;'}),"\n",(0,r.jsx)(n.p,{children:"\u4f46\u662f\u7f13\u5b58\u4e5f\u4f1a\u589e\u52a0\u4ee3\u7801\u590d\u6742\u5ea6\u548c\u8fd0\u8425\u7684\u6210\u672c:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:s(77629).A+"",width:"1341",height:"518"})}),"\n",(0,r.jsx)(n.h3,{id:"212-\u5982\u4f55\u4f7f\u7528\u7f13\u5b58",children:"2.1.2 \u5982\u4f55\u4f7f\u7528\u7f13\u5b58"}),"\n",(0,r.jsx)(n.p,{children:"\u5b9e\u9645\u5f00\u53d1\u4e2d,\u4f1a\u6784\u7b51\u591a\u7ea7\u7f13\u5b58\u6765\u4f7f\u7cfb\u7edf\u8fd0\u884c\u901f\u5ea6\u8fdb\u4e00\u6b65\u63d0\u5347,\u4f8b\u5982:\u672c\u5730\u7f13\u5b58\u4e0eredis\u4e2d\u7684\u7f13\u5b58\u5e76\u53d1\u4f7f\u7528"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u6d4f\u89c8\u5668\u7f13\u5b58"}),"\uff1a\u4e3b\u8981\u662f\u5b58\u5728\u4e8e\u6d4f\u89c8\u5668\u7aef\u7684\u7f13\u5b58"]}),"\n",(0,r.jsx)(n.p,{children:"**\u5e94\u7528\u5c42\u7f13\u5b58\uff1a**\u53ef\u4ee5\u5206\u4e3atomcat\u672c\u5730\u7f13\u5b58\uff0c\u6bd4\u5982\u4e4b\u524d\u63d0\u5230\u7684map\uff0c\u6216\u8005\u662f\u4f7f\u7528redis\u4f5c\u4e3a\u7f13\u5b58"}),"\n",(0,r.jsx)(n.p,{children:"**\u6570\u636e\u5e93\u7f13\u5b58\uff1a**\u5728\u6570\u636e\u5e93\u4e2d\u6709\u4e00\u7247\u7a7a\u95f4\u662f buffer pool\uff0c\u589e\u6539\u67e5\u6570\u636e\u90fd\u4f1a\u5148\u52a0\u8f7d\u5230mysql\u7684\u7f13\u5b58\u4e2d"}),"\n",(0,r.jsx)(n.p,{children:"**CPU\u7f13\u5b58\uff1a**\u5f53\u4ee3\u8ba1\u7b97\u673a\u6700\u5927\u7684\u95ee\u9898\u662f cpu\u6027\u80fd\u63d0\u5347\u4e86\uff0c\u4f46\u5185\u5b58\u8bfb\u5199\u901f\u5ea6\u6ca1\u6709\u8ddf\u4e0a\uff0c\u6240\u4ee5\u4e3a\u4e86\u9002\u5e94\u5f53\u4e0b\u7684\u60c5\u51b5\uff0c\u589e\u52a0\u4e86cpu\u7684L1\uff0cL2\uff0cL3\u7ea7\u7684\u7f13\u5b58"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:s(77737).A+"",width:"1349",height:"545"})}),"\n",(0,r.jsx)(n.h2,{id:"22-\u6dfb\u52a0\u5546\u6237\u7f13\u5b58",children:"2.2 \u6dfb\u52a0\u5546\u6237\u7f13\u5b58"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u6211\u4eec\u67e5\u8be2\u5546\u6237\u4fe1\u606f\u65f6\uff0c\u6211\u4eec\u662f\u76f4\u63a5\u64cd\u4f5c\u4ece\u6570\u636e\u5e93\u4e2d\u53bb\u8fdb\u884c\u67e5\u8be2\u7684\uff0c\u5927\u81f4\u903b\u8f91\u662f\u8fd9\u6837\uff0c\u76f4\u63a5\u67e5\u8be2\u6570\u636e\u5e93\u90a3\u80af\u5b9a\u6162\u54af\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u589e\u52a0\u7f13\u5b58"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'@GetMapping("/{id}")\npublic Result queryShopById(@PathVariable("id") Long id) {\n    //\u8fd9\u91cc\u662f\u76f4\u63a5\u67e5\u8be2\u6570\u636e\u5e93\n    return shopService.queryById(id);\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"221\u7f13\u5b58\u6a21\u578b\u548c\u601d\u8def",children:"2.2.1\u3001\u7f13\u5b58\u6a21\u578b\u548c\u601d\u8def"}),"\n",(0,r.jsx)(n.p,{children:"\u6807\u51c6\u7684\u64cd\u4f5c\u65b9\u5f0f\u5c31\u662f\u67e5\u8be2\u6570\u636e\u5e93\u4e4b\u524d\u5148\u67e5\u8be2\u7f13\u5b58\uff0c\u5982\u679c\u7f13\u5b58\u6570\u636e\u5b58\u5728\uff0c\u5219\u76f4\u63a5\u4ece\u7f13\u5b58\u4e2d\u8fd4\u56de\uff0c\u5982\u679c\u7f13\u5b58\u6570\u636e\u4e0d\u5b58\u5728\uff0c\u518d\u67e5\u8be2\u6570\u636e\u5e93\uff0c\u7136\u540e\u5c06\u6570\u636e\u5b58\u5165redis\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653322097736",src:s(34267).A+"",width:"1514",height:"768"})}),"\n",(0,r.jsx)(n.h3,{id:"212\u4ee3\u7801\u5982\u4e0b",children:"2.1.2\u3001\u4ee3\u7801\u5982\u4e0b"}),"\n",(0,r.jsx)(n.p,{children:"\u4ee3\u7801\u601d\u8def\uff1a\u5982\u679c\u7f13\u5b58\u6709\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\uff0c\u5982\u679c\u7f13\u5b58\u4e0d\u5b58\u5728\uff0c\u5219\u67e5\u8be2\u6570\u636e\u5e93\uff0c\u7136\u540e\u5b58\u5165redis\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Override\npublic Result queryById(Long id) {\n    String key = RedisConstants.CACHE_SHOP_KEY + id;\n    //1 \u4eceredis\u67e5\u8be2\u5546\u94fa\u7f13\u5b58\n    String shopJson = stringRedisTemplate.opsForValue().get(key);\n    //2 \u5224\u65ad\u662f\u5426\u5b58\u5728\n    if (StrUtil.isNotBlank(shopJson)) {\n        //3 \u5b58\u5728\uff0c\u76f4\u63a5\u8fd4\u56de\n        Shop shop = JSONUtil.toBean(shopJson, Shop.class);\n        return Result.ok(shop);\n    }\n    //4 \u4e0d\u5b58\u5728\uff0c\u6839\u636eid\u67e5\u8be2\u6570\u636e\u5e93\n    Shop shop = this.getById(id);\n    //5 \u6570\u636e\u5e93\u4e0d\u5b58\u5728\uff0c\u8fd4\u56de\u9519\u8bef\n    if (shop == null){\n        return Result.fail("\u5e97\u94fa\u4e0d\u5b58\u5728\uff01");\n    }\n    //6 \u5b58\u5728\uff0c\u5199\u5165redis\n    stringRedisTemplate.opsForValue().set(key,JSONUtil.toJsonStr(shop));//\u540e\u9762\u8fd8\u4f1a\u6dfb\u52a0\u8fc7\u671f\u65f6\u95f4\n    //7 \u5b58\u5728\uff0c\u8fd4\u56de\u6570\u636e\n    return Result.ok(shop);\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u5c0f\u6d4b\u8bd5\uff1a\u81ea\u5df1\u5b8c\u6210shop-type\u7684\u4ee3\u7801\uff1a\uff08\u4f7f\u7528list\uff09"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Override\n    public Result queryList() {\n        String key = RedisConstants.CACHE_TYPE_KEY;\n        List<ShopType> typeList = stringRedisTemplate.opsForList().range(key, 0, -1)\n                .stream().map(type -> JSONUtil.toBean(type, ShopType.class)).collect(Collectors.toList());\n        if (!typeList.isEmpty()) {\n            return Result.ok(typeList);\n        }\n        \n        //redis\u4e2d\u4e0d\u5b58\u5728\n        List<ShopType> list = this.query().orderByAsc("sort").list();\n        if (list.isEmpty()) {\n            return Result.fail("\u6ca1\u6709\u5546\u6237\u7c7b\u522b\uff01");\n        }\n        List<String> listJson = list.stream().map(JSONUtil::toJsonStr).collect(Collectors.toList());\n        stringRedisTemplate.opsForList().leftPushAll(key,listJson);\n        return Result.ok(list);\n    }\n'})}),"\n",(0,r.jsx)(n.h2,{id:"23-\u7f13\u5b58\u66f4\u65b0\u7b56\u7565",children:"2.3 \u7f13\u5b58\u66f4\u65b0\u7b56\u7565"}),"\n",(0,r.jsx)(n.p,{children:"\u7f13\u5b58\u66f4\u65b0\u662fredis\u4e3a\u4e86\u8282\u7ea6\u5185\u5b58\u800c\u8bbe\u8ba1\u51fa\u6765\u7684\u4e00\u4e2a\u4e1c\u897f\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u5185\u5b58\u6570\u636e\u5b9d\u8d35\uff0c\u5f53\u6211\u4eec\u5411redis\u63d2\u5165\u592a\u591a\u6570\u636e\uff0c\u6b64\u65f6\u5c31\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u8fc7\u591a\uff0c\u6240\u4ee5redis\u4f1a\u5bf9\u90e8\u5206\u6570\u636e\u8fdb\u884c\u66f4\u65b0\uff0c\u6216\u8005\u628a\u4ed6\u53eb\u4e3a\u6dd8\u6c70\u66f4\u5408\u9002\u3002"}),"\n",(0,r.jsx)(n.p,{children:"**\u5185\u5b58\u6dd8\u6c70\uff1a**redis\u81ea\u52a8\u8fdb\u884c\uff0c\u5f53redis\u5185\u5b58\u8fbe\u5230\u54b1\u4eec\u8bbe\u5b9a\u7684max-memery\u7684\u65f6\u5019\uff0c\u4f1a\u81ea\u52a8\u89e6\u53d1\u6dd8\u6c70\u673a\u5236\uff0c\u6dd8\u6c70\u6389\u4e00\u4e9b\u4e0d\u91cd\u8981\u7684\u6570\u636e(\u53ef\u4ee5\u81ea\u5df1\u8bbe\u7f6e\u7b56\u7565\u65b9\u5f0f)"}),"\n",(0,r.jsx)(n.p,{children:"**\u8d85\u65f6\u5254\u9664\uff1a**\u5f53\u6211\u4eec\u7ed9redis\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4ttl\u4e4b\u540e\uff0credis\u4f1a\u5c06\u8d85\u65f6\u7684\u6570\u636e\u8fdb\u884c\u5220\u9664\uff0c\u65b9\u4fbf\u54b1\u4eec\u7ee7\u7eed\u4f7f\u7528\u7f13\u5b58"}),"\n",(0,r.jsx)(n.p,{children:"**\u4e3b\u52a8\u66f4\u65b0\uff1a**\u6211\u4eec\u53ef\u4ee5\u624b\u52a8\u8c03\u7528\u65b9\u6cd5\u628a\u7f13\u5b58\u5220\u6389\uff0c\u901a\u5e38\u7528\u4e8e\u89e3\u51b3\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e0d\u4e00\u81f4\u95ee\u9898"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653322506393",src:s(23709).A+"",width:"1564",height:"729"})}),"\n",(0,r.jsx)(n.h3,{id:"231-\u6570\u636e\u5e93\u7f13\u5b58\u4e0d\u4e00\u81f4\u76843\u79cd\u89e3\u51b3\u65b9\u6848",children:"2.3.1 \u3001\u6570\u636e\u5e93\u7f13\u5b58\u4e0d\u4e00\u81f4\u76843\u79cd\u89e3\u51b3\u65b9\u6848\uff1a"}),"\n",(0,r.jsxs)(n.p,{children:["\u7531\u4e8e\u6211\u4eec\u7684",(0,r.jsx)(n.strong,{children:"\u7f13\u5b58\u7684\u6570\u636e\u6e90\u6765\u81ea\u4e8e\u6570\u636e\u5e93"}),",\u800c\u6570\u636e\u5e93\u7684",(0,r.jsx)(n.strong,{children:"\u6570\u636e\u662f\u4f1a\u53d1\u751f\u53d8\u5316\u7684"}),",\u56e0\u6b64,\u5982\u679c\u5f53\u6570\u636e\u5e93\u4e2d",(0,r.jsx)(n.strong,{children:"\u6570\u636e\u53d1\u751f\u53d8\u5316,\u800c\u7f13\u5b58\u5374\u6ca1\u6709\u540c\u6b65"}),",\u6b64\u65f6\u5c31\u4f1a\u6709",(0,r.jsx)(n.strong,{children:"\u4e00\u81f4\u6027\u95ee\u9898\u5b58\u5728"}),",\u5176\u540e\u679c\u662f:"]}),"\n",(0,r.jsx)(n.p,{children:"\u7528\u6237\u4f7f\u7528\u7f13\u5b58\u4e2d\u7684\u8fc7\u65f6\u6570\u636e,\u5c31\u4f1a\u4ea7\u751f\u7c7b\u4f3c\u591a\u7ebf\u7a0b\u6570\u636e\u5b89\u5168\u95ee\u9898,\u4ece\u800c\u5f71\u54cd\u4e1a\u52a1,\u4ea7\u54c1\u53e3\u7891\u7b49;\u600e\u4e48\u89e3\u51b3\u5462\uff1f\u6709\u5982\u4e0b\u51e0\u79cd\u65b9\u6848"}),"\n",(0,r.jsx)(n.p,{children:"Cache Aside Pattern \u4eba\u5de5\u7f16\u7801\u65b9\u5f0f\uff1a\u7f13\u5b58\u8c03\u7528\u8005\u5728\u66f4\u65b0\u5b8c\u6570\u636e\u5e93\u540e\u518d\u53bb\u66f4\u65b0\u7f13\u5b58\uff0c\u4e5f\u79f0\u4e4b\u4e3a\u53cc\u5199\u65b9\u6848"}),"\n",(0,r.jsx)(n.p,{children:"Read/Write Through Pattern : \u7531\u7cfb\u7edf\u672c\u8eab\u5b8c\u6210\uff0c\u6570\u636e\u5e93\u4e0e\u7f13\u5b58\u7684\u95ee\u9898\u4ea4\u7531\u7cfb\u7edf\u672c\u8eab\u53bb\u5904\u7406"}),"\n",(0,r.jsx)(n.p,{children:"Write Behind Caching Pattern \uff1a\u8c03\u7528\u8005\u53ea\u64cd\u4f5c\u7f13\u5b58\uff0c\u5176\u4ed6\u7ebf\u7a0b\u53bb\u5f02\u6b65\u5904\u7406\u6570\u636e\u5e93\uff0c\u5b9e\u73b0\u6700\u7ec8\u4e00\u81f4"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653322857620",src:s(93475).A+"",width:"1547",height:"550"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\u4ee5\u4e0b\u90e8\u5206\u622a\u53d6\u81eaJavaGuide\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"1 Cache Aside Pattern\uff08\u65c1\u8def\u7f13\u5b58\u6a21\u5f0f\uff09"})})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Cache Aside Pattern \u662f\u6211\u4eec\u5e73\u65f6\u4f7f\u7528\u6bd4\u8f83\u591a\u7684\u4e00\u4e2a\u7f13\u5b58\u8bfb\u5199\u6a21\u5f0f\uff0c\u6bd4\u8f83\u9002\u5408\u8bfb\u8bf7\u6c42\u6bd4\u8f83\u591a\u7684\u573a\u666f\u3002"})}),"\n",(0,r.jsx)(n.p,{children:"Cache Aside Pattern \u4e2d\u670d\u52a1\u7aef\u9700\u8981\u540c\u65f6\u7ef4\u7cfb db \u548c cache\uff0c\u5e76\u4e14\u662f\u4ee5 db \u7684\u7ed3\u679c\u4e3a\u51c6\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u8fd9\u4e2a\u7b56\u7565\u6a21\u5f0f\u4e0b\u7684\u7f13\u5b58\u8bfb\u5199\u6b65\u9aa4\u3002"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u5199"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5148\u66f4\u65b0 db"}),"\n",(0,r.jsx)(n.li,{children:"\u7136\u540e\u76f4\u63a5\u5220\u9664 cache \u3002"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u7b80\u5355\u753b\u4e86\u4e00\u5f20\u56fe\u5e2e\u52a9\u5927\u5bb6\u7406\u89e3\u5199\u7684\u6b65\u9aa4\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:s(41544).A+"",width:"417",height:"249"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u8bfb"})," :"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4ece cache \u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u8bfb\u53d6\u5230\u5c31\u76f4\u63a5\u8fd4\u56de"}),"\n",(0,r.jsx)(n.li,{children:"cache \u4e2d\u8bfb\u53d6\u4e0d\u5230\u7684\u8bdd\uff0c\u5c31\u4ece db \u4e2d\u8bfb\u53d6\u6570\u636e\u8fd4\u56de"}),"\n",(0,r.jsx)(n.li,{children:"\u518d\u628a\u6570\u636e\u653e\u5230 cache \u4e2d\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u7b80\u5355\u753b\u4e86\u4e00\u5f20\u56fe\u5e2e\u52a9\u5927\u5bb6\u7406\u89e3\u8bfb\u7684\u6b65\u9aa4\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:s(289).A+"",width:"736",height:"249"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"2 Read/Write Through Pattern\uff08\u8bfb\u5199\u7a7f\u900f\uff09"})})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Read/Write Through Pattern \u4e2d\u670d\u52a1\u7aef\u628a cache \u89c6\u4e3a\u4e3b\u8981\u6570\u636e\u5b58\u50a8\uff0c\u4ece\u4e2d\u8bfb\u53d6\u6570\u636e\u5e76\u5c06\u6570\u636e\u5199\u5165\u5176\u4e2d\u3002cache \u670d\u52a1\u8d1f\u8d23\u5c06\u6b64\u6570\u636e\u8bfb\u53d6\u548c\u5199\u5165 db\uff0c\u4ece\u800c\u51cf\u8f7b\u4e86\u5e94\u7528\u7a0b\u5e8f\u7684\u804c\u8d23\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u79cd\u7f13\u5b58\u8bfb\u5199\u7b56\u7565\u5c0f\u4f19\u4f34\u4eec\u5e94\u8be5\u4e5f\u53d1\u73b0\u4e86\u5728\u5e73\u65f6\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u975e\u5e38\u5c11\u89c1\u3002\u629b\u53bb\u6027\u80fd\u65b9\u9762\u7684\u5f71\u54cd\uff0c\u5927\u6982\u7387\u662f\u56e0\u4e3a\u6211\u4eec\u7ecf\u5e38\u4f7f\u7528\u7684\u5206\u5e03\u5f0f\u7f13\u5b58 Redis \u5e76\u6ca1\u6709\u63d0\u4f9b cache \u5c06\u6570\u636e\u5199\u5165 db \u7684\u529f\u80fd\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u5199\uff08Write Through\uff09\uff1a"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5148\u67e5 cache\uff0ccache \u4e2d\u4e0d\u5b58\u5728\uff0c\u76f4\u63a5\u66f4\u65b0 db\u3002"}),"\n",(0,r.jsxs)(n.li,{children:["cache \u4e2d\u5b58\u5728\uff0c\u5219\u5148\u66f4\u65b0 cache\uff0c\u7136\u540e cache \u670d\u52a1\u81ea\u5df1\u66f4\u65b0 db\uff08",(0,r.jsx)(n.strong,{children:"\u540c\u6b65\u66f4\u65b0 cache \u548c db"}),"\uff09\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u7b80\u5355\u753b\u4e86\u4e00\u5f20\u56fe\u5e2e\u52a9\u5927\u5bb6\u7406\u89e3\u5199\u7684\u6b65\u9aa4\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:s(95678).A+"",width:"637",height:"201"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u8bfb(Read Through)\uff1a"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4ece cache \u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u8bfb\u53d6\u5230\u5c31\u76f4\u63a5\u8fd4\u56de \u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u8bfb\u53d6\u4e0d\u5230\u7684\u8bdd\uff0c\u5148\u4ece db \u52a0\u8f7d\uff0c\u5199\u5165\u5230 cache \u540e\u8fd4\u56de\u54cd\u5e94\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u7b80\u5355\u753b\u4e86\u4e00\u5f20\u56fe\u5e2e\u52a9\u5927\u5bb6\u7406\u89e3\u8bfb\u7684\u6b65\u9aa4\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:s(45451).A+"",width:"637",height:"129"})}),"\n",(0,r.jsx)(n.p,{children:"Read-Through Pattern \u5b9e\u9645\u53ea\u662f\u5728 Cache-Aside Pattern \u4e4b\u4e0a\u8fdb\u884c\u4e86\u5c01\u88c5\u3002\u5728 Cache-Aside Pattern \u4e0b\uff0c\u53d1\u751f\u8bfb\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u5982\u679c cache \u4e2d\u4e0d\u5b58\u5728\u5bf9\u5e94\u7684\u6570\u636e\uff0c\u662f\u7531\u5ba2\u6237\u7aef\u81ea\u5df1\u8d1f\u8d23\u628a\u6570\u636e\u5199\u5165 cache\uff0c\u800c Read Through Pattern \u5219\u662f cache \u670d\u52a1\u81ea\u5df1\u6765\u5199\u5165\u7f13\u5b58\u7684\uff0c\u8fd9\u5bf9\u5ba2\u6237\u7aef\u662f\u900f\u660e\u7684\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u548c Cache Aside Pattern \u4e00\u6837\uff0c Read-Through Pattern \u4e5f\u6709\u9996\u6b21\u8bf7\u6c42\u6570\u636e\u4e00\u5b9a\u4e0d\u518d cache \u7684\u95ee\u9898\uff0c\u5bf9\u4e8e\u70ed\u70b9\u6570\u636e\u53ef\u4ee5\u63d0\u524d\u653e\u5165\u7f13\u5b58\u4e2d\u3002"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"3 Write Behind Pattern\uff08\u5f02\u6b65\u7f13\u5b58\u5199\u5165\uff09"})})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Write Behind Pattern \u548c Read/Write Through Pattern \u5f88\u76f8\u4f3c\uff0c\u4e24\u8005\u90fd\u662f\u7531 cache \u670d\u52a1\u6765\u8d1f\u8d23 cache \u548c db \u7684\u8bfb\u5199\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u4f46\u662f\uff0c\u4e24\u4e2a\u53c8\u6709\u5f88\u5927\u7684\u4e0d\u540c\uff1a",(0,r.jsx)(n.strong,{children:"Read/Write Through \u662f\u540c\u6b65\u66f4\u65b0 cache \u548c db\uff0c\u800c Write Behind \u5219\u662f\u53ea\u66f4\u65b0\u7f13\u5b58\uff0c\u4e0d\u76f4\u63a5\u66f4\u65b0 db\uff0c\u800c\u662f\u6539\u4e3a\u5f02\u6b65\u6279\u91cf\u7684\u65b9\u5f0f\u6765\u66f4\u65b0 db\u3002"})]}),"\n",(0,r.jsx)(n.p,{children:"\u5f88\u660e\u663e\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5bf9\u6570\u636e\u4e00\u81f4\u6027\u5e26\u6765\u4e86\u66f4\u5927\u7684\u6311\u6218\uff0c\u6bd4\u5982 cache \u6570\u636e\u53ef\u80fd\u8fd8\u6ca1\u5f02\u6b65\u66f4\u65b0 db \u7684\u8bdd\uff0ccache \u670d\u52a1\u53ef\u80fd\u5c31\u5c31\u6302\u6389\u4e86\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u79cd\u7b56\u7565\u5728\u6211\u4eec\u5e73\u65f6\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u4e5f\u975e\u5e38\u975e\u5e38\u5c11\u89c1\uff0c\u4f46\u662f\u4e0d\u4ee3\u8868\u5b83\u7684\u5e94\u7528\u573a\u666f\u5c11\uff0c\u6bd4\u5982\u6d88\u606f\u961f\u5217\u4e2d\u6d88\u606f\u7684\u5f02\u6b65\u5199\u5165\u78c1\u76d8\u3001MySQL \u7684 Innodb Buffer Pool \u673a\u5236\u90fd\u7528\u5230\u4e86\u8fd9\u79cd\u7b56\u7565\u3002"}),"\n",(0,r.jsx)(n.p,{children:"Write Behind Pattern \u4e0b db \u7684\u5199\u6027\u80fd\u975e\u5e38\u9ad8\uff0c\u975e\u5e38\u9002\u5408\u4e00\u4e9b\u6570\u636e\u7ecf\u5e38\u53d8\u5316\u53c8\u5bf9\u6570\u636e\u4e00\u81f4\u6027\u8981\u6c42\u6ca1\u90a3\u4e48\u9ad8\u7684\u573a\u666f\uff0c\u6bd4\u5982\u6d4f\u89c8\u91cf\u3001\u70b9\u8d5e\u91cf\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"232-\u6570\u636e\u5e93\u548c\u7f13\u5b58\u4e0d\u4e00\u81f4\u91c7\u7528\u4ec0\u4e48\u65b9\u6848",children:"2.3.2 \u3001\u6570\u636e\u5e93\u548c\u7f13\u5b58\u4e0d\u4e00\u81f4\u91c7\u7528\u4ec0\u4e48\u65b9\u6848"}),"\n",(0,r.jsxs)(n.p,{children:["\u7efc\u5408\u8003\u8651",(0,r.jsx)(n.strong,{children:"\u4f7f\u7528\u65b9\u6848\u4e00"}),"\uff0c\u4f46\u662f\u65b9\u6848\u4e00\u8c03\u7528\u8005\u5982\u4f55\u5904\u7406\u5462\uff1f\u8fd9\u91cc\u6709\u51e0\u4e2a\u95ee\u9898"]}),"\n",(0,r.jsx)(n.p,{children:"\u64cd\u4f5c\u7f13\u5b58\u548c\u6570\u636e\u5e93\u65f6\u6709\u4e09\u4e2a\u95ee\u9898\u9700\u8981\u8003\u8651\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u91c7\u7528\u7b2c\u4e00\u4e2a\u65b9\u6848\uff0c\u90a3\u4e48\u5047\u8bbe\u6211\u4eec\u6bcf\u6b21\u64cd\u4f5c\u6570\u636e\u5e93\u540e\uff0c\u90fd\u64cd\u4f5c\u7f13\u5b58\uff0c\u4f46\u662f\u4e2d\u95f4\u5982\u679c\u6ca1\u6709\u4eba\u67e5\u8be2\uff0c\u90a3\u4e48\u8fd9\u4e2a\u66f4\u65b0\u52a8\u4f5c\u5b9e\u9645\u4e0a\u53ea\u6709\u6700\u540e\u4e00\u6b21\u751f\u6548\uff0c\u4e2d\u95f4\u7684\u66f4\u65b0\u52a8\u4f5c\u610f\u4e49\u5e76\u4e0d\u5927\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u7f13\u5b58\u5220\u9664\uff0c\u7b49\u5f85\u518d\u6b21\u67e5\u8be2\u65f6\uff0c\u5c06\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u52a0\u8f7d\u51fa\u6765"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u5220\u9664\u7f13\u5b58\u8fd8\u662f\u66f4\u65b0\u7f13\u5b58\uff1f"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u66f4\u65b0\u7f13\u5b58\uff1a\u6bcf\u6b21\u66f4\u65b0\u6570\u636e\u5e93\u90fd\u66f4\u65b0\u7f13\u5b58\uff0c\u65e0\u6548\u5199\u64cd\u4f5c\u8f83\u591a"}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"\u5220\u9664\u7f13\u5b58\uff1a\u66f4\u65b0\u6570\u636e\u5e93\u65f6\u8ba9\u7f13\u5b58\u5931\u6548\uff0c\u67e5\u8be2\u65f6\u518d\u66f4\u65b0\u7f13\u5b58"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u5982\u4f55\u4fdd\u8bc1\u7f13\u5b58\u4e0e\u6570\u636e\u5e93\u7684\u64cd\u4f5c\u7684\u540c\u65f6\u6210\u529f\u6216\u5931\u8d25\uff1f"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5355\u4f53\u7cfb\u7edf\uff0c\u5c06\u7f13\u5b58\u4e0e\u6570\u636e\u5e93\u64cd\u4f5c\u653e\u5728\u4e00\u4e2a\u4e8b\u52a1"}),"\n",(0,r.jsx)(n.li,{children:"\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u5229\u7528TCC\u7b49\u5206\u5e03\u5f0f\u4e8b\u52a1\u65b9\u6848"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u5e94\u8be5\u5177\u4f53\u64cd\u4f5c\u7f13\u5b58\u8fd8\u662f\u64cd\u4f5c\u6570\u636e\u5e93\uff0c\u6211\u4eec\u5e94\u5f53\u662f\u5148\u64cd\u4f5c\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58\uff0c\u539f\u56e0\u5728\u4e8e\uff0c\u5982\u679c\u4f60\u9009\u62e9\u7b2c\u4e00\u79cd\u65b9\u6848\uff0c\u5728\u4e24\u4e2a\u7ebf\u7a0b\u5e76\u53d1\u6765\u8bbf\u95ee\u65f6\uff0c\u5047\u8bbe\u7ebf\u7a0b1\u5148\u6765\uff0c\u4ed6\u5148\u628a\u7f13\u5b58\u5220\u4e86\uff0c\u6b64\u65f6\u7ebf\u7a0b2\u8fc7\u6765\uff0c\u4ed6\u67e5\u8be2\u7f13\u5b58\u6570\u636e\u5e76\u4e0d\u5b58\u5728\uff0c\u6b64\u65f6\u4ed6\u5199\u5165\u7f13\u5b58\uff0c\u5f53\u4ed6\u5199\u5165\u7f13\u5b58\u540e\uff0c\u7ebf\u7a0b1\u518d\u6267\u884c\u66f4\u65b0\u52a8\u4f5c\u65f6\uff0c\u5b9e\u9645\u4e0a\u5199\u5165\u7684\u5c31\u662f\u65e7\u7684\u6570\u636e\uff0c\u65b0\u7684\u6570\u636e\u88ab\u65e7\u6570\u636e\u8986\u76d6\u4e86\u3002"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u5148\u64cd\u4f5c\u7f13\u5b58\u8fd8\u662f\u5148\u64cd\u4f5c\u6570\u636e\u5e93\uff1f\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5148\u5220\u9664\u7f13\u5b58\uff0c\u518d\u64cd\u4f5c\u6570\u636e\u5e93"}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"\u5148\u64cd\u4f5c\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653323595206",src:s(99723).A+"",width:"1466",height:"804"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\u5148\u5220\u540e\u6539\uff1a\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5982\u4e0a\u56fe\uff0c\u82e5\u4e24\u4e2a\u7ebf\u7a0b\u7a7f\u63d2\uff0c\u7531\u4e8e\u7ebf\u7a0b1\u66f4\u65b0\u6570\u636e\u5e93\u8f83\u6162\uff0c\u6240\u4ee5\u7ebf\u7a0b2\u7684\u60c5\u51b5\u5f88\u53ef\u80fd\u53d1\u751f"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5148\u6539\u540e\u5220\uff1a\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u5982\u4e0a\u56fe\uff0c\u82e5\u4e24\u4e2a\u7ebf\u7a0b\u7a7f\u63d2\uff0c\u9700\u8981\u6ee1\u8db3\u4e0b\u5217\u6761\u4ef6\uff1a\n\u2460\u7ebf\u7a0b1\u67e5\u8be2\u7f13\u5b58\u65f6\u7f13\u5b58",(0,r.jsx)(n.strong,{children:"\u521a\u597d\u5931\u6548"}),"\uff0c\n\u2461\u7531\u4e8e\u7ebf\u7a0b1",(0,r.jsx)(n.strong,{children:"\u5199\u5165\u7f13\u5b58\u901f\u5ea6\u5f88\u5feb"}),"\uff0c\u7ebf\u7a0b2\u5728\u6781\u77ed\u7684\u65f6\u95f4\u5185\u5b8c\u6210\u66f4\u65b0\u6570\u636e\u5e93\u548c\u5220\u9664\u7f13\u5b58\u64cd\u4f5c\uff1b\n\u7efc\u5408\u4ee5\u4e0a\u4e24\u70b9\uff0c\u5148\u6539\u540e\u5220\u53d1\u9001\u4e0d\u4e00\u81f4\u7684\u6982\u7387\u8f83\u5c0f"]}),"\n",(0,r.jsx)(n.li,{children:"\u8fd8\u6709\u4e00\u79cd\u60c5\u51b5\uff1aMySQL\u662f\u4e3b\u4ece\u6a21\u5f0f\u4e0b\uff0c\u6211\u4eec\u5220\u9664\u7f13\u5b58\u8fc7\u540e\uff0c\u7d27\u63a5\u7740\u6709\u4e2a\u8bf7\u6c42\u6765\u8bfb\u4ece\u5e93\uff0c\u4f46\u662f\u7531\u4e8e\u4e3b\u4ece\u5ef6\u8fdf\uff0c\u4ece\u5e93\u8fd8\u662f\u65e7\u6570\u636e\uff0c\u4e8e\u662f\u7f13\u5b58\u7684\u8fd8\u662f\u65e7\u6570\u636e\n\u89e3\u51b3\uff1a\n1 \u5ef6\u8fdf\u53cc\u5220\uff1a\u6bd4\u5982\u5ef6\u8fdf\u4e00\u79d2\u540e\u518d\u6b21\u5220\u9664\u7f13\u5b58\n2 \u57fa\u4e8e\u8ba2\u9605binlog\u53bb\u505a\u7f13\u5b58\u5220\u9664\u64cd\u4f5c\uff1a\u6bd4\u5982\u4f7f\u7528\u4e2d\u95f4\u4ef6Canal"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"233\u7b56\u7565\u603b\u7ed3",children:"2.3.3\u3001\u7b56\u7565\u603b\u7ed3"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\u7f13\u5b58\u66f4\u65b0\u7b56\u7565\u7684\u6700\u4f73\u5b9e\u8df5\u65b9\u6848\uff1a"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u4f4e\u4e00\u81f4\u6027\u9700\u6c42\uff1a\u4f7f\u7528Redis\u81ea\u5e26\u7684\u5185\u5b58\u6dd8\u6c70\u673a\u5236"}),"\n",(0,r.jsxs)(n.li,{children:["\u9ad8\u4e00\u81f4\u6027\u9700\u6c42\uff1a\u4e3b\u52a8\u66f4\u65b0\uff0c\u5e76\u4ee5\u8d85\u65f6\u5254\u9664\u4f5c\u4e3a\u515c\u5e95\u65b9\u6848\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u8bfb\u64cd\u4f5c\uff1a\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u7f13\u5b58\u547d\u4e2d\u5219\u76f4\u63a5\u8fd4\u56de"}),"\n",(0,r.jsx)(n.li,{children:"\u7f13\u5b58\u672a\u547d\u4e2d\u5219\u67e5\u8be2\u6570\u636e\u5e93\uff0c\u5e76\u5199\u5165\u7f13\u5b58\uff0c\u8bbe\u5b9a\u8d85\u65f6\u65f6\u95f4"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5199\u64cd\u4f5c\uff08\u65b9\u684801: \u8c03\u7528\u8005\u540c\u6b65\u66f4\u65b0\uff09\uff1a\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5148\u5199\u6570\u636e\u5e93\uff0c\u7136\u540e\u518d\u5220\u9664\u7f13\u5b58"}),"\n",(0,r.jsx)(n.li,{children:"\u8981\u786e\u4fdd\u6570\u636e\u5e93\u4e0e\u7f13\u5b58\u64cd\u4f5c\u7684\u539f\u5b50\u6027"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.h2,{id:"24-\u5b9e\u73b0\u5546\u94fa\u548c\u7f13\u5b58\u4e0e\u6570\u636e\u5e93\u53cc\u5199\u4e00\u81f4",children:["2.4 \u5b9e\u73b0\u5546\u94fa\u548c\u7f13\u5b58\u4e0e\u6570\u636e\u5e93",(0,r.jsx)(n.strong,{children:"\u53cc\u5199\u4e00\u81f4"})]}),"\n",(0,r.jsx)(n.p,{children:"\u6838\u5fc3\u601d\u8def\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"\u4fee\u6539ShopController\u4e2d\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u6ee1\u8db3\u4e0b\u9762\u7684\u9700\u6c42\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"\u6839\u636eid\u67e5\u8be2\u5e97\u94fa\u65f6\uff0c\u5982\u679c\u7f13\u5b58\u672a\u547d\u4e2d\uff0c\u5219\u67e5\u8be2\u6570\u636e\u5e93\uff0c\u5c06\u6570\u636e\u5e93\u7ed3\u679c\u5199\u5165\u7f13\u5b58\uff0c\u5e76\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4"}),"\n",(0,r.jsx)(n.p,{children:"\u6839\u636eid\u4fee\u6539\u5e97\u94fa\u65f6\uff0c\u5148\u4fee\u6539\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u4fee\u6539\u91cd\u70b9\u4ee3\u78011"}),"\uff1a\u4fee\u6539",(0,r.jsx)(n.strong,{children:"ShopServiceImpl"}),"\u7684queryById\u65b9\u6cd5"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u8bbe\u7f6eredis\u7f13\u5b58\u65f6\u6dfb\u52a0\u8fc7\u671f\u65f6\u95f4"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Override\npublic Result queryById(Long id) {\n    String key = RedisConstants.CACHE_SHOP_KEY + id;\n    //1 \u4eceredis\u67e5\u8be2\u5546\u94fa\u7f13\u5b58\n    String shopJson = stringRedisTemplate.opsForValue().get(key);\n    //2 \u5224\u65ad\u662f\u5426\u5b58\u5728\n    if (StrUtil.isNotBlank(shopJson)) {\n        //3 \u5b58\u5728\uff0c\u76f4\u63a5\u8fd4\u56de\n        Shop shop = JSONUtil.toBean(shopJson, Shop.class);\n        return Result.ok(shop);\n    }\n    //4 \u4e0d\u5b58\u5728\uff0c\u6839\u636eid\u67e5\u8be2\u6570\u636e\u5e93\n    Shop shop = this.getById(id);\n    //5 \u6570\u636e\u5e93\u4e0d\u5b58\u5728\uff0c\u8fd4\u56de\u9519\u8bef\n    if (shop == null){\n        return Result.fail("\u5e97\u94fa\u4e0d\u5b58\u5728\uff01");\n    }\n    //6 \u5b58\u5728\uff0c\u5199\u5165redis\n    stringRedisTemplate.opsForValue().set(key,JSONUtil.toJsonStr(shop),RedisConstants.CACHE_SHOP_TTL, TimeUnit.MINUTES);\n    //7 \u5b58\u5728\uff0c\u8fd4\u56de\u6570\u636e\n    return Result.ok(shop);\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u4fee\u6539\u91cd\u70b9\u4ee3\u78012"})}),"\n",(0,r.jsx)(n.p,{children:"\u4ee3\u7801\u5206\u6790\uff1a\u901a\u8fc7\u4e4b\u524d\u7684\u6dd8\u6c70\uff0c\u6211\u4eec\u786e\u5b9a\u4e86\u91c7\u7528\u5220\u9664\u7b56\u7565\uff0c\u6765\u89e3\u51b3\u53cc\u5199\u95ee\u9898\uff0c\u5f53\u6211\u4eec\u4fee\u6539\u4e86\u6570\u636e\u4e4b\u540e\uff0c\u7136\u540e\u628a\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u5220\u9664\uff0c\u67e5\u8be2\u65f6\u53d1\u73b0\u7f13\u5b58\u4e2d\u6ca1\u6709\u6570\u636e\uff0c\u5219\u4f1a\u4ecemysql\u4e2d\u52a0\u8f7d\u6700\u65b0\u7684\u6570\u636e\uff0c\u4ece\u800c\u907f\u514d\u6570\u636e\u5e93\u548c\u7f13\u5b58\u4e0d\u4e00\u81f4\u7684\u95ee\u9898"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Override\n@Transactional\npublic Result update(Shop shop) {\n    Long id = shop.getId();\n    if (id == null){\n        return Result.fail("\u5e97\u94faid\u4e0d\u80fd\u4e3a\u7a7a");\n    }\n    //1 \u66f4\u65b0\u6570\u636e\u5e93\n    this.updateById(shop);\n    //2 \u5220\u9664\u7f13\u5b58\n    stringRedisTemplate.delete(RedisConstants.CACHE_SHOP_KEY + id);\n    return Result.ok();\n}\n'})}),"\n",(0,r.jsxs)(n.h2,{id:"25-\u7f13\u5b58\u7a7f\u900f\u95ee\u9898\u7684\u89e3\u51b3\u601d\u8def",children:["2.5 ",(0,r.jsx)(n.strong,{children:"\u7f13\u5b58\u7a7f\u900f"}),"\u95ee\u9898\u7684\u89e3\u51b3\u601d\u8def"]}),"\n",(0,r.jsx)(n.p,{children:"\u7f13\u5b58\u7a7f\u900f \uff1a\u7f13\u5b58\u7a7f\u900f\u662f\u6307\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u6570\u636e\u5728\u7f13\u5b58\u4e2d\u548c\u6570\u636e\u5e93\u4e2d\u90fd\u4e0d\u5b58\u5728\uff0c\u8fd9\u6837\u7f13\u5b58\u6c38\u8fdc\u4e0d\u4f1a\u751f\u6548\uff0c\u8fd9\u4e9b\u8bf7\u6c42\u90fd\u4f1a\u6253\u5230\u6570\u636e\u5e93\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u5e38\u89c1\u7684\u89e3\u51b3\u65b9\u6848\u6709\u4e24\u79cd\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u7f13\u5b58\u7a7a\u5bf9\u8c61\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4f18\u70b9\uff1a\u5b9e\u73b0\u7b80\u5355\uff0c\u7ef4\u62a4\u65b9\u4fbf"}),"\n",(0,r.jsxs)(n.li,{children:["\u7f3a\u70b9\uff1a\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u989d\u5916\u7684\u5185\u5b58\u6d88\u8017"}),"\n",(0,r.jsx)(n.li,{children:"\u53ef\u80fd\u9020\u6210\u77ed\u671f\u7684\u4e0d\u4e00\u81f4"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5e03\u9686\u8fc7\u6ee4\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4f18\u70b9\uff1a\u5185\u5b58\u5360\u7528\u8f83\u5c11\uff0c\u6ca1\u6709\u591a\u4f59key"}),"\n",(0,r.jsxs)(n.li,{children:["\u7f3a\u70b9\uff1a\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5b9e\u73b0\u590d\u6742"}),"\n",(0,r.jsx)(n.li,{children:"\u5b58\u5728\u8bef\u5224\u53ef\u80fd"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"**\u7f13\u5b58\u7a7a\u5bf9\u8c61\u601d\u8def\u5206\u6790\uff1a**\u5f53\u6211\u4eec\u5ba2\u6237\u7aef\u8bbf\u95ee\u4e0d\u5b58\u5728\u7684\u6570\u636e\u65f6\uff0c\u5148\u8bf7\u6c42redis\uff0c\u4f46\u662f\u6b64\u65f6redis\u4e2d\u6ca1\u6709\u6570\u636e\uff0c\u6b64\u65f6\u4f1a\u8bbf\u95ee\u5230\u6570\u636e\u5e93\uff0c\u4f46\u662f\u6570\u636e\u5e93\u4e2d\u4e5f\u6ca1\u6709\u6570\u636e\uff0c\u8fd9\u4e2a\u6570\u636e\u7a7f\u900f\u4e86\u7f13\u5b58\uff0c\u76f4\u51fb\u6570\u636e\u5e93\uff0c\u6211\u4eec\u90fd\u77e5\u9053\u6570\u636e\u5e93\u80fd\u591f\u627f\u8f7d\u7684\u5e76\u53d1\u4e0d\u5982redis\u8fd9\u4e48\u9ad8\uff0c\u5982\u679c\u5927\u91cf\u7684\u8bf7\u6c42\u540c\u65f6\u8fc7\u6765\u8bbf\u95ee\u8fd9\u79cd\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u8fd9\u4e9b\u8bf7\u6c42\u5c31\u90fd\u4f1a\u8bbf\u95ee\u5230\u6570\u636e\u5e93\uff0c\u7b80\u5355\u7684\u89e3\u51b3\u65b9\u6848\u5c31\u662f\u54ea\u6015\u8fd9\u4e2a\u6570\u636e\u5728\u6570\u636e\u5e93\u4e2d\u4e5f\u4e0d\u5b58\u5728\uff0c\u6211\u4eec\u4e5f\u628a\u8fd9\u4e2a\u6570\u636e\u5b58\u5165\u5230redis\u4e2d\u53bb\uff0c\u8fd9\u6837\uff0c\u4e0b\u6b21\u7528\u6237\u8fc7\u6765\u8bbf\u95ee\u8fd9\u4e2a\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u90a3\u4e48\u5728redis\u4e2d\u4e5f\u80fd\u627e\u5230\u8fd9\u4e2a\u6570\u636e\u5c31\u4e0d\u4f1a\u8fdb\u5165\u5230\u7f13\u5b58\u4e86"}),"\n",(0,r.jsxs)(n.p,{children:["**\u5e03\u9686\u8fc7\u6ee4\uff1a**\u5e03\u9686\u8fc7\u6ee4\u5668\u5176\u5b9e\u91c7\u7528\u7684\u662f\u54c8\u5e0c\u601d\u60f3\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c",(0,r.jsx)(n.strong,{children:"\u901a\u8fc7\u4e00\u4e2a\u5e9e\u5927\u7684\u4e8c\u8fdb\u5236\u6570\u7ec4"}),"\uff0c\u8d70\u54c8\u5e0c\u601d\u60f3\u53bb\u5224\u65ad\u5f53\u524d\u8fd9\u4e2a\u8981\u67e5\u8be2\u7684\u8fd9\u4e2a\u6570\u636e\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u5e03\u9686\u8fc7\u6ee4\u5668\u5224\u65ad\u5b58\u5728\uff0c\u5219\u653e\u884c\uff0c\u8fd9\u4e2a\u8bf7\u6c42\u4f1a\u53bb\u8bbf\u95eeredis\uff0c\u54ea\u6015\u6b64\u65f6redis\u4e2d\u7684\u6570\u636e\u8fc7\u671f\u4e86\uff0c\u4f46\u662f\u6570\u636e\u5e93\u4e2d\u4e00\u5b9a\u5b58\u5728\u8fd9\u4e2a\u6570\u636e\uff0c\u5728\u6570\u636e\u5e93\u4e2d\u67e5\u8be2\u51fa\u6765\u8fd9\u4e2a\u6570\u636e\u540e\uff0c\u518d\u5c06\u5176\u653e\u5165\u5230redis\u4e2d\uff0c"]}),"\n",(0,r.jsx)(n.p,{children:"\u5047\u8bbe\u5e03\u9686\u8fc7\u6ee4\u5668\u5224\u65ad\u8fd9\u4e2a\u6570\u636e\u4e0d\u5b58\u5728\uff0c\u5219\u76f4\u63a5\u8fd4\u56de"}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u79cd\u65b9\u5f0f\u4f18\u70b9\u5728\u4e8e\u8282\u7ea6\u5185\u5b58\u7a7a\u95f4\uff0c\u5b58\u5728\u8bef\u5224\uff0c\u8bef\u5224\u539f\u56e0\u5728\u4e8e\uff1a\u5e03\u9686\u8fc7\u6ee4\u5668\u8d70\u7684\u662f\u54c8\u5e0c\u601d\u60f3\uff0c\u53ea\u8981\u54c8\u5e0c\u601d\u60f3\uff0c\u5c31\u53ef\u80fd\u5b58\u5728\u54c8\u5e0c\u51b2\u7a81"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653326156516",src:s(46743).A+"",width:"1012",height:"569"})}),"\n",(0,r.jsx)(n.h2,{id:"26-\u5229\u7528\u8fd4\u56de\u7a7a\u503c\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\u95ee\u9898",children:"2.6 \u5229\u7528\u8fd4\u56de\u7a7a\u503c\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\u95ee\u9898"}),"\n",(0,r.jsx)(n.p,{children:"\u6838\u5fc3\u601d\u8def\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u539f\u6765\u7684\u903b\u8f91\u4e2d\uff0c\u6211\u4eec\u5982\u679c\u53d1\u73b0\u8fd9\u4e2a\u6570\u636e\u5728mysql\u4e2d\u4e0d\u5b58\u5728\uff0c\u76f4\u63a5\u5c31\u8fd4\u56de404\u4e86\uff0c\u8fd9\u6837\u662f\u4f1a\u5b58\u5728\u7f13\u5b58\u7a7f\u900f\u95ee\u9898\u7684"}),"\n",(0,r.jsx)(n.p,{children:"\u73b0\u5728\u7684\u903b\u8f91\u4e2d\uff1a\u5982\u679c\u8fd9\u4e2a\u6570\u636e\u4e0d\u5b58\u5728\uff0c\u6211\u4eec\u4e0d\u4f1a\u8fd4\u56de404 \uff0c\u8fd8\u662f\u4f1a\u628a\u8fd9\u4e2a\u6570\u636e\u5199\u5165\u5230Redis\u4e2d\uff0c\u5e76\u4e14\u5c06value\u8bbe\u7f6e\u4e3a\u7a7a\uff0c\u6b27\u5f53\u518d\u6b21\u53d1\u8d77\u67e5\u8be2\u65f6\uff0c\u6211\u4eec\u5982\u679c\u53d1\u73b0\u547d\u4e2d\u4e4b\u540e\uff0c\u5224\u65ad\u8fd9\u4e2avalue\u662f\u5426\u662fnull\uff0c\u5982\u679c\u662fnull\uff0c\u5219\u662f\u4e4b\u524d\u5199\u5165\u7684\u6570\u636e\uff0c\u8bc1\u660e\u662f\u7f13\u5b58\u7a7f\u900f\u6570\u636e\uff0c\u5982\u679c\u4e0d\u662f\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\u6570\u636e\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653327124561",src:s(6829).A+"",width:"1570",height:"682"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Override\n    public Result queryById(Long id) {\n        String key = RedisConstants.CACHE_SHOP_KEY + id;\n        //1 \u4eceredis\u67e5\u8be2\u5546\u94fa\u7f13\u5b58\n        String shopJson = stringRedisTemplate.opsForValue().get(key);\n        //2 \u5224\u65ad\u662f\u5426\u5b58\u5728\n        if (StrUtil.isNotBlank(shopJson)) {\n            //3 \u5b58\u5728\uff0c\u76f4\u63a5\u8fd4\u56de\n            Shop shop = JSONUtil.toBean(shopJson, Shop.class);\n            return Result.ok(shop);\n        }\n        /**\n         * isNotBlank()\u65b9\u6cd5\u4f1a\u68c0\u6d4b\u5230\u7a7a\u5b57\u7b26\u4e32\n         * \u4e3a\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\uff0c\u989d\u5916\u5224\u65ad\u662f\u5426\u4e3a""\u7a7a\u5b57\u7b26\u4e32\uff0c\u662f\u5219\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\n         */\n        if (shopJson == null){\n            return Result.fail("\u5e97\u94fa\u4e0d\u5b58\u5728\uff01");\n        }\n        \n        //4 \u4e0d\u5b58\u5728\uff0c\u6839\u636eid\u67e5\u8be2\u6570\u636e\u5e93\n        Shop shop = this.getById(id);\n        //5 \u6570\u636e\u5e93\u4e0d\u5b58\u5728\uff0c\u8fd4\u56de\u9519\u8bef\n        if (shop == null){\n            /**\n             * \u4e3a\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\uff0c\u5c06\u7a7a\u503c\u5199\u5165redis\n             */\n            stringRedisTemplate.opsForValue().set(key,"",RedisConstants.CACHE_NULL_TTL, TimeUnit.MINUTES);\n            return Result.fail("\u5e97\u94fa\u4e0d\u5b58\u5728\uff01");\n        }\n        //6 \u5b58\u5728\uff0c\u5199\u5165redis\n        stringRedisTemplate.opsForValue().set(key,JSONUtil.toJsonStr(shop),RedisConstants.CACHE_SHOP_TTL, TimeUnit.MINUTES);\n        //7 \u5b58\u5728\uff0c\u8fd4\u56de\u6570\u636e\n        return Result.ok(shop);\n    }\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u5c0f\u603b\u7ed3\uff1a"})}),"\n",(0,r.jsx)(n.p,{children:"\u7f13\u5b58\u7a7f\u900f\u4ea7\u751f\u7684\u539f\u56e0\u662f\u4ec0\u4e48\uff1f"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u7528\u6237\u8bf7\u6c42\u7684\u6570\u636e\u5728\u7f13\u5b58\u4e2d\u548c\u6570\u636e\u5e93\u4e2d\u90fd\u4e0d\u5b58\u5728\uff0c\u4e0d\u65ad\u53d1\u8d77\u8fd9\u6837\u7684\u8bf7\u6c42\uff0c\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u5de8\u5927\u538b\u529b"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u7f13\u5b58\u7a7f\u900f\u7684\u89e3\u51b3\u65b9\u6848\u6709\u54ea\u4e9b\uff1f"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u7f13\u5b58null\u503c"}),"\n",(0,r.jsx)(n.li,{children:"\u5e03\u9686\u8fc7\u6ee4"}),"\n",(0,r.jsx)(n.li,{children:"\u589e\u5f3aid\u7684\u590d\u6742\u5ea6\uff0c\u907f\u514d\u88ab\u731c\u6d4bid\u89c4\u5f8b"}),"\n",(0,r.jsx)(n.li,{children:"\u505a\u597d\u6570\u636e\u7684\u57fa\u7840\u683c\u5f0f\u6821\u9a8c"}),"\n",(0,r.jsx)(n.li,{children:"\u52a0\u5f3a\u7528\u6237\u6743\u9650\u6821\u9a8c"}),"\n",(0,r.jsx)(n.li,{children:"\u505a\u597d\u70ed\u70b9\u53c2\u6570\u7684\u9650\u6d41"}),"\n"]}),"\n",(0,r.jsxs)(n.h2,{id:"27-\u5229\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\u95ee\u9898",children:["2.7 \u5229\u7528",(0,r.jsx)(n.strong,{children:"\u5e03\u9686\u8fc7\u6ee4\u5668"}),"\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\u95ee\u9898"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u5e03\u9686\u8fc7\u6ee4\u5668"}),"\uff1a\u7531\u4e00\u4e2a\u521d\u503c\u90fd\u4e3a\u96f6\u7684bit\u6570\u7ec4\u548c\u591a\u4e2a\u54c8\u5e0c\u51fd\u6570\u6784\u6210\uff0c\u7528\u6765\u5feb\u901f\u5224\u65ad\u96c6\u5408\u4e2d\u662f\u5426\u5b58\u5728\u67d0\u4e2a\u5143\u7d20"]}),"\n",(0,r.jsx)(n.p,{children:"\u8bbe\u8ba1\u601d\u60f3\uff1a\u672c\u8d28\u5c31\u662f\u5224\u65ad\u5177\u4f53\u6570\u636e\u662f\u5426\u5b58\u5728\u4e8e\u4e00\u4e2a\u5927\u7684\u96c6\u5408\u4e2d"}),"\n",(0,r.jsxs)(n.p,{children:["\u6ce8\u610f\uff1a\u5e03\u9686\u8fc7\u6ee4\u5668\u662f\u4e00\u79cd",(0,r.jsx)(n.strong,{children:"\u7c7b\u4f3cset"}),"\u7684\u6570\u636e\u7ed3\u6784\uff0c\u53ea\u662f\u7edf\u8ba1\u7ed3\u679c\u5728\u5de8\u91cf\u6570\u636e\u4e0b\u6709\u70b9\u5c0f\u7455\u75b5\uff0c\u4e0d\u591f\u5b8c\u7f8e"]}),"\n",(0,r.jsx)(n.p,{children:"**\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u4f5c\u7528\uff1a**\u9ad8\u6548\u5730\u63d2\u5165\u548c\u67e5\u8be2\uff0c\u5360\u7528\u7a7a\u95f4\u5c11\uff0c\u4f46\u662f\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u4e0d\u786e\u5b9a\u6027+\u4e0d\u591f\u5b8c\u7f8e\u3002"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\u4e00\u4e2a\u5143\u7d20\u5982\u679c\u5224\u65ad\u7ed3\u679c\uff1a",(0,r.jsx)(n.strong,{children:"\u5b58\u5728\u65f6"}),"\uff0c\u5143\u7d20",(0,r.jsx)(n.strong,{children:"\u4e0d\u4e00\u5b9a\u5b58\u5728"}),"\uff0c\u4f46\u662f\u5224\u65ad\u7ed3\u679c\u4e3a",(0,r.jsx)(n.strong,{children:"\u4e0d\u5b58\u5728\u65f6"}),"\uff0c\u5219",(0,r.jsx)(n.strong,{children:"\u4e00\u5b9a\u4e0d\u5b58\u5728"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u5e03\u9686\u8fc7\u6ee4\u5668",(0,r.jsx)(n.strong,{children:"\u53ef\u4ee5\u6dfb\u52a0"}),"\u5143\u7d20\uff0c\u4f46\u662f",(0,r.jsx)(n.strong,{children:"\u4e0d\u80fd\u5220\u9664"}),"\u5143\u7d20\u7531\u4e8e\u6d89\u53cahashcode\u5224\u65ad\u4f9d\u636e\uff0c\u5220\u6389\u5143\u7d20\u4f1a\u5bfc\u81f4",(0,r.jsx)(n.strong,{children:"\u8bef\u5224\u7387\u589e\u52a0"}),"\u3002\n\u56e0\u4e3a\u5220\u9664\u5143\u7d20\u7684\u65f6\u5019\u4f1a\u5c06\u4e00\u4e2ahash\u69fd\u4f4d\u4e2d\u7684\u6240\u6709\u5143\u7d20\u90fd\u5220\u9664\uff0c\u82e5\u8be5\u69fd\u4e2d\u4e0d\u6b62\u4e00\u4e2a\u5143\u7d20\uff0c\u5219\u4f1a\u5bfc\u81f4\u8bef\u5224\u7387\u589e\u52a0"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u4f18\u7f3a\u70b9\uff1a"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4f18\u70b9\uff1a\u9ad8\u6548\u5730\u63d2\u5165\u548c\u67e5\u8be2\uff0c\u5185\u5b58\u5360\u7528bit\u7a7a\u95f4\u5c11"}),"\n",(0,r.jsxs)(n.li,{children:["\u7f3a\u70b9\uff1a\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5b58\u5728hash\u51b2\u7a81\uff0c\u4f1a\u51fa\u73b0\u8bef\u5224"}),"\n",(0,r.jsx)(n.li,{children:"\u4e0d\u80fd\u5220\u9664\uff0c\u589e\u52a0\u8bef\u5224\u7387"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u539f\u7406\uff1a"})}),"\n",(0,r.jsx)(n.p,{children:"\u5e03\u9686\u8fc7\u6ee4\u5668(Bloom Filter)\u662f\u4e00\u79cd\u4e13\u95e8\u7528\u6765\u89e3\u51b3\u53bb\u91cd\u95ee\u9898\u7684\u9ad8\u7ea7\u6570\u636e\u7ed3\u6784\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u5b9e\u8d28\u5c31\u662f",(0,r.jsx)(n.strong,{children:"\u4e00\u4e2a\u5927\u578b\u4e8c\u8fdb\u5236\u6570\u7ec4"}),"\u548c",(0,r.jsx)(n.strong,{children:"\u51e0\u4e2a\u4e0d\u540c\u7684\u65e0\u504fhash\u51fd\u6570"}),"\uff08\u65e0\u504f\u8868\u793a\u5206\u5e03\u5747\u5300\uff09\u3002\u7531\u4e00\u4e2a\u521d\u503c\u90fd\u4e3a\u96f6\u7684bit\u6570\u7ec4\u548c\u79fb\u4e2a\u4e2a\u54c8\u5e0c\u51fd\u6570\u6784\u6210\uff0c\u7528\u6765\u5feb\u901f\u5224\u65ad\u67d0\u4e2a\u6570\u636e\u662f\u5426\u5b58\u5728\u3002\u4f46\u662f\u8ddfHyperLogLog\u4e00\u6837\uff0c\u5b83\u4e5f\u4e00\u6837\u6709\u90a3\u4e48\u4e00\u70b9\u70b9\u4e0d\u7cbe\u786e\uff0c\u4e5f\u5b58\u5728\u4e00\u5b9a\u7684\u8bef\u5224\u6982\u7387\n",(0,r.jsx)(n.img,{alt:"image-20231031165531777",src:s(76271).A+"",width:"1280",height:"446"})]}),"\n",(0,r.jsxs)(n.p,{children:["\u6dfb\u52a0key\uff1a\u4f7f\u7528",(0,r.jsx)(n.strong,{children:"\u591a\u4e2ahash\u51fd\u6570"}),"\u5bf9key\u8fdb\u884chash\u8fd0\u7b97\u5f97\u5230\u4e00\u4e2a\u6574\u6570\u7d22\u5f15\u503c\uff0c\u5bf9\u4f4d\u6570\u7ec4\u957f\u5ea6\u8fdb\u884c\u53d6\u6a21\u8fd0\u7b97\u5f97\u5230\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u6bcf\u4e2ahash\u51fd\u6570\u90fd\u4f1a\u5f97\u5230\u4e00\u4e2a\u4e0d\u540c\u7684\u4f4d\u7f6e\uff0c",(0,r.jsx)(n.strong,{children:"\u5c06\u8fd9\u51e0\u4e2a\u4f4d\u7f6e\u90fd\u7f6e1"}),"\u5c31\u5b8c\u6210\u4e86add\u64cd\u4f5c\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u67e5\u8be2key\uff1a",(0,r.jsx)(n.strong,{children:"\u53ea\u8981\u6709\u5176\u4e2d\u4e00\u4f4d\u662f\u96f6\u5c31\u8868\u793a\u8fd9\u4e2akey\u4e0d\u5b58\u5728"}),"\uff0c\u4f46\u5982\u679c\u90fd\u662f1\uff0c\u5219\u4e0d\u4e00\u5b9a\u5b58\u5728\u5bf9\u5e94\u7684key\u3002"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u54c8\u5e0c\u51b2\u7a81/\u78b0\u649e\uff1a"})}),"\n",(0,r.jsx)(n.p,{children:"\u56e0\u4e3a\u4e0d\u540c\u7684key\u4e5f\u53ef\u80fd\u6620\u5c04\u51fa\u76f8\u540c\u7684hash\u503c\uff0c\u6240\u4ee5\u5c06\u4f1a\u51fa\u73b0hash\u78b0\u649e\uff0c\u9020\u6210\u5b58\u5728\u65f6\u5143\u7d20\u4e0d\u4e00\u5b9a\u5b58\u5728\uff0c\u56e0\u4e3a\u5b58\u5728\u7684\u53ef\u80fd\u662f\u62e5\u6709\u76f8\u540chash\u503c\u7684\u522b\u7684key"}),"\n",(0,r.jsx)(n.p,{children:"\u6a21\u62dfhash\u78b0\u649e\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Test\nvoid test() {\n\tSystem.out.println("Aa".hashCode());\n    System.out.println("BB".hashCode());\n    \n    System.out.println("\u67f3\u67f4".hashCode());\n    System.out.println("\u67f4\u677c".hashCode());\n    \n    Set<Integer> set = new HashSet<>();\n    int hashCode;\n    for(int i = 0; i <= 200000; i++) {\n        hashCode = new Object().hashCode();\n        if(set.contains(hashCode)) {\n            System.out.println("\u8fd0\u884c\u5230\u7b2c " + i + " \u6b21\u51fa\u73b0\u54c8\u5e0c\u51b2\u7a81\uff0chashCode\uff1a" + hashCode);\n        }\n        set.add(hashCode);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"2112\n2112\n851553\n851553\n\u8fd0\u884c\u5230\u7b2c\uff1a103993\u6b21\u51fa\u73b0hash\u51b2\u7a81\uff0chashc0de:213440019g\n\u8fd0\u884c\u5230\u7b2c\uff1a109440\u6b21\u51fa\u73b0hash\u51b2\u7a81\uff0chashcode:651156501\n\u8fd0\u884c\u5230\u7b2c\uff1a143624\u6b21\u51fa\u73b0hash\u51b2\u7a81\uff0chashcode:2038112324\n\u8fd0\u884c\u5230\u7b2c\uff1a144557\u6b21\u51fa\u73b0hash\u51b2\u7a81\uff0chashcode:1164664992\n\u8fd0\u884c\u5230\u7b2c\uff1a150537\u6b21\u51fa\u73b0hash\u51b2\u7a81\uff0chashcode:273791887\n\u8fd0\u884c\u5230\u7b2c\uff1a179149\u6b21\u51fa\u73b0hash\u51b2\u7a81\uff0chashcode:996371445\n\u8fd0\u884c\u5230\u7b2c\uff1a182462\u6b21\u51fa\u73b0hash\u51b2\u7a81\uff0chashcode:254720071\n\u8fd0\u884c\u5230\u7b2c\uff1a185090\u6b21\u51fa\u73b0hash\u51b2\u7a81\uff0chashcode:1872358815\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u6b64\u770b\u6765\uff0c\u51fa\u73b0hash\u51b2\u7a81\u7684\u6982\u7387\u8fd8\u662f\u633a\u9ad8\u7684"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u4f7f\u7528\u5efa\u8bae\uff1a"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u4f7f\u7528\u65f6\u6700\u597d\u4e0d\u8981\u8ba9\u5b9e\u9645\u5143\u7d20\u6570\u91cf\u8fdc\u5927\u4e8e\u521d\u59cb\u5316\u6570\u91cf\uff0c\u4e00\u6b21\u7ed9\u591f\u907f\u514d\u6269\u5bb9"}),"\n",(0,r.jsx)(n.li,{children:"\u5f53\u5b9e\u9645\u5143\u7d20\u6570\u91cf\u8d85\u8fc7\u521d\u59cb\u5316\u6570\u91cf\u65f6\uff0c\u5e94\u8be5\u5bf9\u5e03\u9686\u8fc7\u6ee4\u5668\u8fdb\u884c\u91cd\u5efa\uff0c\u91cd\u65b0\u5206\u914d\u4e00\u4e2asize\u66f4\u5927\u7684\u8fc7\u6ee4\u5668\uff0c\u518d\u5c06\u6240\u6709\u7684\u5386\u53f2\u5143\u7d20\u6279\u91cfadd\u8fdb\u884c\uff08\u91cd\u5efa\u4ee3\u66ff\u5220\u9664\uff09"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528bitmap\u6a21\u62df\u5e03\u9686\u8fc7\u6ee4\u5668\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Component\n@Slf4j\npublic class BloomFilterInit{\n    @Resource\n    private RedisTemplate redisTemplate;\n\n    //@PostConstruct//\u521d\u59cb\u5316\u767d\u540d\u5355\u6570\u636e,\u6682\u65f6\u6ce8\u91ca\u7701\u7684\u540e\u53f0\u6253\u5370\n    public void init(){\n        //1 \u767d\u540d\u5355\u5ba2\u6237\u52a0\u8f7d\u5230\u5e03\u9686\u8fc7\u6ee4\u5668\n        String key = "customer:12";\n        //2 \u8ba1\u7b97hashValue,\u7531\u4e8e\u5b58\u5728\u8ba1\u7b97\u51fa\u6765\u8d1f\u6570\u7684\u53ef\u80fd\uff0c\u6211\u4eec\u53d6\u7edd\u5bf9\u503c\n        int hashValue = Math.abs(key.hashCode());\n        //3 \u901a\u8fc7hashValue\u548c2\u768432\u6b21\u65b9\u540e\u53d6\u4f59\uff0c\u83b7\u5f97\u5bf9\u5e94\u7684\u4e0b\u6807\u5751\u4f4d\n        long index = (long)(hashValue % Math.pow(2,32));\n        log.info(key+" \u5bf9\u5e94\u7684\u5751\u4f4dindex:{}",index);\n        //4 \u8bbe\u7f6eredis\u91cc\u9762\u7684bitmap\u5bf9\u5e94\u7c7b\u578b\u767d\u540d\u5355\uff1awhitelistCustomer\u7684\u5751\u4f4d\uff0c\u5c06\u8be5\u503c\u8bbe\u7f6e\u4e3a1\n        redisTemplate.opsForValue().setBit("whitelistCustomer",index,true);\n\n    }\n}\n\npublic Customer findCustomerByIdWithBloomFilter (Integer customerId){\n    Customer customer = null;\n    //\u7f13\u5b58key\u7684\u540d\u79f0\n    String key = CACHA_KEY_CUSTOMER + customerId;\n\n    //\u5e03\u9686\u8fc7\u6ee4\u5668check\uff0c\u65e0\u662f\u7edd\u5bf9\u65e0\uff0c\u6709\u662f\u53ef\u80fd\u6709\n    //===============================================\n    if(!checkUtils.checkWithBloomFilter("whitelistCustomer",key)){\n        log.info("\u767d\u540d\u5355\u65e0\u6b64\u987e\u5ba2\uff0c\u4e0d\u53ef\u4ee5\u8bbf\u95ee: "+key);\n        return null;\n    }\n    //===============================================\n\n    //1 \u67e5\u8be2redis\n    customer = (Customer) redisTemplate.opsForValue().get(key);\n    //redis\u65e0\uff0c\u8fdb\u4e00\u6b65\u67e5\u8be2mysql\n    if (customer == null) {\n        //2 \u4ecemysql\u67e5\u51fa\u6765customer\n        customer = customerMapper.selectByPrimaryKey(customerId);\n        // mysql\u6709\uff0credis\u65e0\n        if (customer != null) {\n            //3 \u628amysql\u635e\u5230\u7684\u6570\u636e\u5199\u5165redis\uff0c\u65b9\u4fbf\u4e0b\u6b21\u67e5\u8be2\u80fdredis\u547d\u4e2d\u3002\n            redisTemplate.opsForValue().set(key, customer);\n        }\n    }\n    return customer;\n}\n'})}),"\n",(0,r.jsxs)(n.h2,{id:"27-\u7f13\u5b58\u96ea\u5d29\u95ee\u9898\u53ca\u89e3\u51b3\u601d\u8def",children:["2.7 ",(0,r.jsx)(n.strong,{children:"\u7f13\u5b58\u96ea\u5d29"}),"\u95ee\u9898\u53ca\u89e3\u51b3\u601d\u8def"]}),"\n",(0,r.jsx)(n.p,{children:"\u7f13\u5b58\u96ea\u5d29\u662f\u6307\u5728\u540c\u4e00\u65f6\u6bb5\u5927\u91cf\u7684\u7f13\u5b58key\u540c\u65f6\u5931\u6548\u6216\u8005Redis\u670d\u52a1\u5b95\u673a\uff0c\u5bfc\u81f4\u5927\u91cf\u8bf7\u6c42\u5230\u8fbe\u6570\u636e\u5e93\uff0c\u5e26\u6765\u5de8\u5927\u538b\u529b\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u89e3\u51b3\u65b9\u6848\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u7ed9\u4e0d\u540c\u7684Key\u7684TTL\u6dfb\u52a0\u968f\u673a\u503c\uff0c\u5c06\u5931\u6548\u65f6\u95f4\u5206\u5e03\u5728\u4e00\u4e2a\u65f6\u95f4\u6bb5\u5185"}),"\n",(0,r.jsx)(n.li,{children:"\u5229\u7528Redis\u96c6\u7fa4\u63d0\u9ad8\u670d\u52a1\u7684\u53ef\u7528\u6027"}),"\n",(0,r.jsx)(n.li,{children:"\u7ed9\u7f13\u5b58\u4e1a\u52a1\u6dfb\u52a0\u964d\u7ea7\u9650\u6d41\u7b56\u7565\uff08SpringCloud\uff09"}),"\n",(0,r.jsx)(n.li,{children:"\u7ed9\u4e1a\u52a1\u6dfb\u52a0\u591a\u7ea7\u7f13\u5b58\uff08\u6d4f\u89c8\u5668\u7f13\u5b58\uff0cNginx\u7f13\u5b58\uff0cTomcat\u7f13\u5b58\uff0cJVM\u7f13\u5b58\u7b49\u5f85\uff09\uff0c\u9ad8\u7ea7\u90e8\u5206\u4f1a\u8bb2"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653327884526",src:s(47447).A+"",width:"1030",height:"560"})}),"\n",(0,r.jsxs)(n.h2,{id:"28-\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898\u53ca\u89e3\u51b3\u601d\u8def",children:["2.8 ",(0,r.jsx)(n.strong,{children:"\u7f13\u5b58\u51fb\u7a7f"}),"\u95ee\u9898\u53ca\u89e3\u51b3\u601d\u8def"]}),"\n",(0,r.jsxs)(n.p,{children:["\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898\u4e5f\u53eb",(0,r.jsx)(n.strong,{children:"\u70ed\u70b9Key\u95ee\u9898"}),"\uff0c\u5c31\u662f\u4e00\u4e2a\u88ab",(0,r.jsx)(n.strong,{children:"\u9ad8\u5e76\u53d1\u8bbf\u95ee"}),"\u5e76\u4e14",(0,r.jsx)(n.strong,{children:"\u7f13\u5b58\u91cd\u5efa\u4e1a\u52a1\u8f83\u590d\u6742"}),"\u7684key\u7a81\u7136\u5931\u6548\u4e86\uff0c\u65e0\u6570\u7684\u8bf7\u6c42\u8bbf\u95ee\u4f1a\u5728\u77ac\u95f4\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u5de8\u5927\u7684\u51b2\u51fb\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u903b\u8f91\u5206\u6790\uff1a\u5047\u8bbe\u7ebf\u7a0b1\u5728\u67e5\u8be2\u7f13\u5b58\u4e4b\u540e\uff0c\u672c\u6765\u5e94\u8be5\u53bb\u67e5\u8be2\u6570\u636e\u5e93\uff0c\u7136\u540e\u628a\u8fd9\u4e2a\u6570\u636e\u91cd\u65b0\u52a0\u8f7d\u5230\u7f13\u5b58\u7684\uff0c\u6b64\u65f6\u53ea\u8981\u7ebf\u7a0b1\u8d70\u5b8c\u8fd9\u4e2a\u903b\u8f91\uff0c\u5176\u4ed6\u7ebf\u7a0b\u5c31\u90fd\u80fd\u4ece\u7f13\u5b58\u4e2d\u52a0\u8f7d\u8fd9\u4e9b\u6570\u636e\u4e86\uff0c\u4f46\u662f\u5047\u8bbe\u5728\u7ebf\u7a0b1\u6ca1\u6709\u8d70\u5b8c\u7684\u65f6\u5019\uff0c\u540e\u7eed\u7684\u7ebf\u7a0b2\uff0c\u7ebf\u7a0b3\uff0c\u7ebf\u7a0b4\u540c\u65f6\u8fc7\u6765\u8bbf\u95ee\u5f53\u524d\u8fd9\u4e2a\u65b9\u6cd5\uff0c \u90a3\u4e48\u8fd9\u4e9b\u7ebf\u7a0b\u90fd\u4e0d\u80fd\u4ece\u7f13\u5b58\u4e2d\u67e5\u8be2\u5230\u6570\u636e\uff0c\u90a3\u4e48\u4ed6\u4eec\u5c31\u4f1a\u540c\u4e00\u65f6\u523b\u6765\u8bbf\u95ee\u67e5\u8be2\u7f13\u5b58\uff0c\u90fd\u6ca1\u67e5\u5230\uff0c\u63a5\u7740\u540c\u4e00\u65f6\u95f4\u53bb\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u540c\u65f6\u7684\u53bb\u6267\u884c\u6570\u636e\u5e93\u4ee3\u7801\uff0c\u5bf9\u6570\u636e\u5e93\u8bbf\u95ee\u538b\u529b\u8fc7\u5927"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653328022622",src:s(94215).A+"",width:"1008",height:"600"})}),"\n",(0,r.jsx)(n.p,{children:"\u5e38\u89c1\u7684\u89e3\u51b3\u65b9\u6848\u6709\u4e24\u79cd\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4e92\u65a5\u9501"}),"\n",(0,r.jsx)(n.li,{children:"\u903b\u8f91\u8fc7\u671f"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u89e3\u51b3\u65b9\u6848\u4e00\u3001\u4f7f\u7528\u9501\u6765\u89e3\u51b3\uff1a"})}),"\n",(0,r.jsx)(n.p,{children:"\u56e0\u4e3a\u9501\u80fd\u5b9e\u73b0\u4e92\u65a5\u6027\u3002\u5047\u8bbe\u7ebf\u7a0b\u8fc7\u6765\uff0c\u53ea\u80fd\u4e00\u4e2a\u4eba\u4e00\u4e2a\u4eba\u7684\u6765\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u4ece\u800c\u907f\u514d\u5bf9\u4e8e\u6570\u636e\u5e93\u8bbf\u95ee\u538b\u529b\u8fc7\u5927\uff0c\u4f46\u8fd9\u4e5f\u4f1a\u5f71\u54cd\u67e5\u8be2\u7684\u6027\u80fd\uff0c\u56e0\u4e3a\u6b64\u65f6\u4f1a\u8ba9\u67e5\u8be2\u7684\u6027\u80fd\u4ece\u5e76\u884c\u53d8\u6210\u4e86\u4e32\u884c\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528tryLock\u65b9\u6cd5 + double check\u6765\u89e3\u51b3\u8fd9\u6837\u7684\u95ee\u9898\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u5047\u8bbe\u73b0\u5728\u7ebf\u7a0b1\u8fc7\u6765\u8bbf\u95ee\uff0c\u4ed6\u67e5\u8be2\u7f13\u5b58\u6ca1\u6709\u547d\u4e2d\uff0c\u4f46\u662f\u6b64\u65f6\u4ed6\u83b7\u5f97\u5230\u4e86\u9501\u7684\u8d44\u6e90\uff0c\u90a3\u4e48\u7ebf\u7a0b1\u5c31\u4f1a\u4e00\u4e2a\u4eba\u53bb\u6267\u884c\u903b\u8f91\uff0c\u5047\u8bbe\u73b0\u5728\u7ebf\u7a0b2\u8fc7\u6765\uff0c\u7ebf\u7a0b2\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u5e76\u6ca1\u6709\u83b7\u5f97\u5230\u9501\uff0c\u90a3\u4e48\u7ebf\u7a0b2\u5c31\u53ef\u4ee5\u8fdb\u884c\u5230\u4f11\u7720\uff0c\u76f4\u5230\u7ebf\u7a0b1\u628a\u9501\u91ca\u653e\u540e\uff0c\u7ebf\u7a0b2\u83b7\u5f97\u5230\u9501\uff0c\u7136\u540e\u518d\u6765\u6267\u884c\u903b\u8f91\uff0c\u6b64\u65f6\u5c31\u80fd\u591f\u4ece\u7f13\u5b58\u4e2d\u62ff\u5230\u6570\u636e\u4e86\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653328288627",src:s(12056).A+"",width:"569",height:"723"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u89e3\u51b3\u65b9\u6848\u4e8c\u3001\u903b\u8f91\u8fc7\u671f\u65b9\u6848"})}),"\n",(0,r.jsx)(n.p,{children:"\u65b9\u6848\u5206\u6790\uff1a\u6211\u4eec\u4e4b\u6240\u4ee5\u4f1a\u51fa\u73b0\u8fd9\u4e2a\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898\uff0c\u4e3b\u8981\u539f\u56e0\u662f\u5728\u4e8e\u6211\u4eec\u5bf9key\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\uff0c\u5047\u8bbe\u6211\u4eec\u4e0d\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u5176\u5b9e\u5c31\u4e0d\u4f1a\u6709\u7f13\u5b58\u51fb\u7a7f\u7684\u95ee\u9898\uff0c\u4f46\u662f\u4e0d\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u8fd9\u6837\u6570\u636e\u4e0d\u5c31\u4e00\u76f4\u5360\u7528\u6211\u4eec\u5185\u5b58\u4e86\u5417\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u903b\u8f91\u8fc7\u671f\u65b9\u6848\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u624b\u52a8\u63d0\u524d\u8bbe\u7f6e\u597dredis\u903b\u8f91\u8fc7\u671f\u6570\u636e"})}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u628a\u8fc7\u671f\u65f6\u95f4\u8bbe\u7f6e\u5728 redis\u7684value\u4e2d\uff0c\u6ce8\u610f\uff1a\u8fd9\u4e2a\u8fc7\u671f\u65f6\u95f4\u5e76\u4e0d\u4f1a\u76f4\u63a5\u4f5c\u7528\u4e8eredis\uff0c\u800c\u662f\u6211\u4eec\u540e\u7eed\u901a\u8fc7\u903b\u8f91\u53bb\u5904\u7406\u3002\u5047\u8bbe\u7ebf\u7a0b1\u53bb\u67e5\u8be2\u7f13\u5b58\uff0c\u7136\u540e\u4ecevalue\u4e2d\u5224\u65ad\u51fa\u6765\u5f53\u524d\u7684\u6570\u636e\u5df2\u7ecf\u8fc7\u671f\u4e86\uff0c\u6b64\u65f6\u7ebf\u7a0b1\u53bb\u83b7\u5f97\u4e92\u65a5\u9501\uff0c\u90a3\u4e48\u5176\u4ed6\u7ebf\u7a0b\u4f1a\u8fdb\u884c\u963b\u585e\uff0c\u83b7\u5f97\u4e86\u9501\u7684\u7ebf\u7a0b\u4ed6\u4f1a\u5f00\u542f\u4e00\u4e2a \u7ebf\u7a0b\u53bb\u8fdb\u884c \u4ee5\u524d\u7684\u91cd\u6784\u6570\u636e\u7684\u903b\u8f91\uff0c\u76f4\u5230\u65b0\u5f00\u7684\u7ebf\u7a0b\u5b8c\u6210\u8fd9\u4e2a\u903b\u8f91\u540e\uff0c\u624d\u91ca\u653e\u9501\uff0c \u800c\u7ebf\u7a0b1\u76f4\u63a5\u8fdb\u884c\u8fd4\u56de\uff0c\u5047\u8bbe\u73b0\u5728\u7ebf\u7a0b3\u8fc7\u6765\u8bbf\u95ee\uff0c\u7531\u4e8e\u7ebf\u7a0b\u7ebf\u7a0b2\u6301\u6709\u7740\u9501\uff0c\u6240\u4ee5\u7ebf\u7a0b3\u65e0\u6cd5\u83b7\u5f97\u9501\uff0c\u7ebf\u7a0b3\u4e5f\u76f4\u63a5\u8fd4\u56de\u6570\u636e\uff0c\u53ea\u6709\u7b49\u5230\u65b0\u5f00\u7684\u7ebf\u7a0b2\u628a\u91cd\u5efa\u6570\u636e\u6784\u5efa\u5b8c\u540e\uff0c\u5176\u4ed6\u7ebf\u7a0b\u624d\u80fd\u8d70\u8fd4\u56de\u6b63\u786e\u7684\u6570\u636e\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u79cd\u65b9\u6848\u5de7\u5999\u5728\u4e8e\uff0c\u5f02\u6b65\u7684\u6784\u5efa\u7f13\u5b58\uff0c\u7f3a\u70b9\u5728\u4e8e\u5728\u6784\u5efa\u5b8c\u7f13\u5b58\u4e4b\u524d\uff0c\u8fd4\u56de\u7684\u90fd\u662f\u810f\u6570\u636e\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653328663897",src:s(99572).A+"",width:"943",height:"817"})}),"\n",(0,r.jsxs)(n.p,{children:["\u8fdb\u884c",(0,r.jsx)(n.strong,{children:"\u5bf9\u6bd4"})]}),"\n",(0,r.jsx)(n.p,{children:"**\u4e92\u65a5\u9501\u65b9\u6848\uff1a**\u7531\u4e8e\u4fdd\u8bc1\u4e86\u4e92\u65a5\u6027\uff0c\u6240\u4ee5\u6570\u636e\u4e00\u81f4\uff0c\u4e14\u5b9e\u73b0\u7b80\u5355\uff0c\u56e0\u4e3a\u4ec5\u4ec5\u53ea\u9700\u8981\u52a0\u4e00\u628a\u9501\u800c\u5df2\uff0c\u4e5f\u6ca1\u5176\u4ed6\u7684\u4e8b\u60c5\u9700\u8981\u64cd\u5fc3\uff0c\u6240\u4ee5\u6ca1\u6709\u989d\u5916\u7684\u5185\u5b58\u6d88\u8017\uff0c\u7f3a\u70b9\u5728\u4e8e\u6709\u9501\u5c31\u6709\u6b7b\u9501\u95ee\u9898\u7684\u53d1\u751f\uff0c\u4e14\u53ea\u80fd\u4e32\u884c\u6267\u884c\u6027\u80fd\u80af\u5b9a\u53d7\u5230\u5f71\u54cd"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u903b\u8f91\u8fc7\u671f\u65b9\u6848\uff1a"})," \u7ebf\u7a0b\u8bfb\u53d6\u8fc7\u7a0b\u4e2d\u4e0d\u9700\u8981\u7b49\u5f85\uff0c\u6027\u80fd\u597d\uff0c\u6709\u4e00\u4e2a\u989d\u5916\u7684\u7ebf\u7a0b\u6301\u6709\u9501\u53bb\u8fdb\u884c\u91cd\u6784\u6570\u636e\uff0c\u4f46\u662f\u5728\u91cd\u6784\u6570\u636e\u5b8c\u6210\u524d\uff0c\u5176\u4ed6\u7684\u7ebf\u7a0b\u53ea\u80fd\u8fd4\u56de\u4e4b\u524d\u7684\u6570\u636e\uff0c\u4e14\u5b9e\u73b0\u8d77\u6765\u9ebb\u70e6"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653357522914",src:s(42450).A+"",width:"1044",height:"425"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["\u4e24\u79cd\u65b9\u6848\u5206\u522b\u4e3a",(0,r.jsx)(n.strong,{children:"CP"}),"\u548c",(0,r.jsx)(n.strong,{children:"AP"}),"\u7684\u9700\u6c42\uff0c\u6839\u636e\u9700\u6c42\u9009\u62e9\u65b9\u6848\uff0c\u9009\u62e9",(0,r.jsx)(n.strong,{children:"\u4e00\u81f4\u6027"}),"\u8fd8\u662f",(0,r.jsx)(n.strong,{children:"\u53ef\u7528\u6027"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"29-\u5229\u7528\u4e92\u65a5\u9501\u89e3\u51b3\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898",children:"2.9 \u5229\u7528\u4e92\u65a5\u9501\u89e3\u51b3\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898"}),"\n",(0,r.jsx)(n.p,{children:"\u6838\u5fc3\u601d\u8def\uff1a\u76f8\u8f83\u4e8e\u539f\u6765\u4ece\u7f13\u5b58\u4e2d\u67e5\u8be2\u4e0d\u5230\u6570\u636e\u540e\u76f4\u63a5\u67e5\u8be2\u6570\u636e\u5e93\u800c\u8a00\uff0c\u73b0\u5728\u7684\u65b9\u6848\u662f \u8fdb\u884c\u67e5\u8be2\u4e4b\u540e\uff0c\u5982\u679c\u4ece\u7f13\u5b58\u6ca1\u6709\u67e5\u8be2\u5230\u6570\u636e\uff0c\u5219\u8fdb\u884c\u4e92\u65a5\u9501\u7684\u83b7\u53d6\uff0c\u83b7\u53d6\u4e92\u65a5\u9501\u540e\uff0c\u5224\u65ad\u662f\u5426\u83b7\u5f97\u5230\u4e86\u9501\uff0c\u5982\u679c\u6ca1\u6709\u83b7\u5f97\u5230\uff0c\u5219\u4f11\u7720\uff0c\u8fc7\u4e00\u4f1a\u518d\u8fdb\u884c\u5c1d\u8bd5\uff0c\u76f4\u5230\u83b7\u53d6\u5230\u9501\u4e3a\u6b62\uff0c\u624d\u80fd\u8fdb\u884c\u67e5\u8be2"}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u83b7\u53d6\u5230\u4e86\u9501\u7684\u7ebf\u7a0b\uff0c\u518d\u53bb\u8fdb\u884c\u67e5\u8be2\uff0c\u67e5\u8be2\u540e\u5c06\u6570\u636e\u5199\u5165redis\uff0c\u518d\u91ca\u653e\u9501\uff0c\u8fd4\u56de\u6570\u636e\uff0c\u5229\u7528\u4e92\u65a5\u9501\u5c31\u80fd\u4fdd\u8bc1\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u53bb\u6267\u884c\u64cd\u4f5c\u6570\u636e\u5e93\u7684\u903b\u8f91\uff0c\u9632\u6b62\u7f13\u5b58\u51fb\u7a7f"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653357860001",src:s(64384).A+"",width:"1068",height:"735"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u64cd\u4f5c\u9501\u7684\u4ee3\u7801\uff1a"})}),"\n",(0,r.jsxs)(n.p,{children:["\u6838\u5fc3\u601d\u8def\u5c31\u662f",(0,r.jsx)(n.strong,{children:"\u5229\u7528redis\u7684setnx\u65b9\u6cd5\u6765\u8868\u793a\u83b7\u53d6\u9501"}),"\uff0c\u8be5\u65b9\u6cd5\u542b\u4e49\u662fredis\u4e2d\u5982\u679c\u6ca1\u6709\u8fd9\u4e2akey\uff0c\u5219\u63d2\u5165\u6210\u529f\uff0c\u8fd4\u56de1\uff0c\u5728stringRedisTemplate\u4e2d\u8fd4\u56detrue\uff0c  \u5982\u679c\u6709\u8fd9\u4e2akey\u5219\u63d2\u5165\u5931\u8d25\uff0c\u5219\u8fd4\u56de0\uff0c\u5728stringRedisTemplate\u8fd4\u56defalse\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7true\uff0c\u6216\u8005\u662ffalse\uff0c\u6765\u8868\u793a\u662f\u5426\u6709\u7ebf\u7a0b\u6210\u529f\u63d2\u5165key\uff0c\u6210\u529f\u63d2\u5165\u7684key\u7684\u7ebf\u7a0b\u6211\u4eec\u8ba4\u4e3a\u4ed6\u5c31\u662f\u83b7\u5f97\u5230\u9501\u7684\u7ebf\u7a0b\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'private boolean tryLock(String key) {\n    Boolean isLock = stringRedisTemplate.opsForValue().setIfAbsent(key, "1", RedisConstants.LOCK_SHOP_TTL, TimeUnit.SECONDS);\n    return BooleanUtil.isTrue(isLock);  //\u5305\u88c5\u7c7b\u4f1a\u505a\u62c6\u7bb1\u53ef\u80fd\u51fa\u73b0\u7a7a\u6307\u9488\uff0c\u4e8e\u662f\u4e3b\u52a8\u62c6\u7bb1\n}\n\nprivate void unlock(String key){\n    stringRedisTemplate.delete(key);\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u64cd\u4f5c\u4ee3\u7801\uff1a"})}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u7684\u4f7f\u7528while\u6b7b\u5faa\u73af\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'/**\n * \uff08\u5728\u7f13\u5b58\u7a7f\u900f\u57fa\u7840\u4e0a\uff09\u7f13\u5b58\u51fb\u7a7f\u89e3\u51b3\u65b9\u6848\uff1a1 \u4e92\u65a5\u9501\u65b9\u6848\n *\n * @param id\n * @return\n */\nprivate Result queryWithMutex(Long id) {\n    String key = RedisConstants.CACHE_SHOP_KEY + id;\n    String lockKey = RedisConstants.LOCK_SHOP_KEY + id;\n    while (true) {\n        // 1 \u4eceredis\u67e5\u8be2\u5546\u94fa\u7f13\u5b58\n        String shopJson = stringRedisTemplate.opsForValue().get(key);\n        // 2 \u5224\u65ad\u662f\u5426\u5b58\u5728\n        if (StrUtil.isNotBlank(shopJson)) {\n            // 3 \u5b58\u5728\uff0c\u76f4\u63a5\u8fd4\u56de\n            Shop shop = JSONUtil.toBean(shopJson, Shop.class);\n            return Result.ok(shop);\n        }\n        /**\n         * isNotBlank()\u65b9\u6cd5\u4f1a\u68c0\u6d4b\u5230\u7a7a\u5b57\u7b26\u4e32\n         * \u4e3a\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\uff0c\u989d\u5916\u5224\u65ad\u662f\u5426\u4e3a""\u7a7a\u5b57\u7b26\u4e32\uff0c\u662f\u5219\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\n         */\n        if (shopJson != null) {\n            return Result.fail("\u5e97\u94fa\u4e0d\u5b58\u5728\uff01");\n        }\n\n        // TODO 4 \u5b9e\u73b0\u7f13\u5b58\u91cd\u5efa\n        // TODO 4.1 \u83b7\u53d6\u4e92\u65a5\u9501\n        boolean isLock = tryLock(lockKey);\n        // TODO 4.2 \u5224\u65ad\u662f\u5426\u83b7\u53d6\u6210\u529f\n        if (!isLock) {\n            // TODO 4.3 \u5931\u8d25\uff1a\u5219\u4f11\u7720\u91cd\u8bd5\n            try {\n                Thread.sleep(50);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        } else {\n            break;\n        }\n    }\n    try {\n        //double check\n        shopJson = stringRedisTemplate.opsForValue().get(key);\n        if(StrUtil.isNotBlank(shopJson)) {\n            return Result.ok(JSONUtil.toBean(shopJson, Shop.class));\n        }\n\n        // TODO 4.4 \u6210\u529f\uff0c\u6839\u636eid\u67e5\u8be2\u6570\u636e\u5e93\n        Shop shop = this.getById(id);\n        // \u6a21\u62df\u7f13\u5b58\u51fb\u7a7f\u91cd\u5efa\u4e1a\u52a1\u8017\u65f6\u4e45\u60c5\u51b5\n        Thread.sleep(200);\n        // 5 \u6570\u636e\u5e93\u4e0d\u5b58\u5728\uff0c\u8fd4\u56de\u9519\u8bef\n        if (shop == null) {\n            /**\n             * \u4e3a\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\uff0c\u5c06\u7a7a\u503c\u5199\u5165redis\n             */\n            stringRedisTemplate.opsForValue().set(key, "", RedisConstants.CACHE_NULL_TTL, TimeUnit.MINUTES);\n            return Result.fail("\u5e97\u94fa\u4e0d\u5b58\u5728\uff01");\n        }\n        // 6  \u5b58\u5728\uff0c\u5199\u5165redis\n        stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(shop), RedisConstants.CACHE_SHOP_TTL, TimeUnit.MINUTES);\n\n        // 7 \u5b58\u5728\uff0c\u8fd4\u56de\u6570\u636e\n        return Result.ok(shop);\n    } catch (InterruptedException e) {\n        throw new RuntimeException(e);\n    } finally {\n        // TODO 7 \u91ca\u653e\u4e92\u65a5\u9501\n        unlock(lockKey);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u8001\u5e08\u7684\u4f7f\u7528\u9012\u5f52\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'private Result queryWithMutex(Long id) {\n    String key = RedisConstants.CACHE_SHOP_KEY + id;\n    String lockKey = RedisConstants.LOCK_SHOP_KEY + id;\n    // 1 \u4eceredis\u67e5\u8be2\u5546\u94fa\u7f13\u5b58\n    String shopJson = stringRedisTemplate.opsForValue().get(key);\n    // 2 \u5224\u65ad\u662f\u5426\u5b58\u5728\n    if (StrUtil.isNotBlank(shopJson)) {\n        // 3 \u5b58\u5728\uff0c\u76f4\u63a5\u8fd4\u56de\n        Shop shop = JSONUtil.toBean(shopJson, Shop.class);\n        return Result.ok(shop);\n    }\n    /**\n     * isNotBlank()\u65b9\u6cd5\u4f1a\u68c0\u6d4b\u5230\u7a7a\u5b57\u7b26\u4e32\n     * \u4e3a\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\uff0c\u989d\u5916\u5224\u65ad\u662f\u5426\u4e3a""\u7a7a\u5b57\u7b26\u4e32\uff0c\u662f\u5219\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\n     */\n    if (shopJson != null) {\n        return Result.fail("\u5e97\u94fa\u4e0d\u5b58\u5728\uff01");\n    }\n  \n    try {\n        // TODO 4 \u5b9e\u73b0\u7f13\u5b58\u91cd\u5efa\n        // TODO 4.1 \u83b7\u53d6\u4e92\u65a5\u9501\n        boolean isLock = tryLock(lockKey);\n        // TODO 4.2 \u5224\u65ad\u662f\u5426\u83b7\u53d6\u6210\u529f\n        if (!isLock) {\n            // TODO 4.3 \u5931\u8d25\uff1a\u5219\u4f11\u7720\u91cd\u8bd5\n            Thread.sleep(50);\n            queryWithMutex(id);\n        }\n        //double check\n        shopJson = stringRedisTemplate.opsForValue().get(key);\n        if(StrUtil.isNotBlank(shopJson)) {\n            return Result.ok(JSONUtil.toBean(shopJson, Shop.class));\n      \n        // TODO 4.4 \u6210\u529f\uff0c\u6839\u636eid\u67e5\u8be2\u6570\u636e\u5e93\n        Shop shop = this.getById(id);\n        // \u6a21\u62df\u7f13\u5b58\u51fb\u7a7f\u91cd\u5efa\u4e1a\u52a1\u8017\u65f6\u4e45\u60c5\u51b5\n        Thread.sleep(200);\n        // 5 \u6570\u636e\u5e93\u4e0d\u5b58\u5728\uff0c\u8fd4\u56de\u9519\u8bef\n        if (shop == null) {\n            /**\n             * \u4e3a\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\uff0c\u5c06\u7a7a\u503c\u5199\u5165redis\n             */\n            stringRedisTemplate.opsForValue().set(key, "", RedisConstants.CACHE_NULL_TTL, TimeUnit.MINUTES);\n            return Result.fail("\u5e97\u94fa\u4e0d\u5b58\u5728\uff01");\n        }\n        // 6  \u5b58\u5728\uff0c\u5199\u5165redis\n        stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(shop), RedisConstants.CACHE_SHOP_TTL, TimeUnit.MINUTE\n        // 7 \u5b58\u5728\uff0c\u8fd4\u56de\u6570\u636e\n        return Result.ok(shop);\n    } catch (InterruptedException e) {\n        throw new RuntimeException(e);\n    } finally {\n        // TODO 7 \u91ca\u653e\u4e92\u65a5\u9501\n        unlock(lockKey);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"210-\u5229\u7528\u903b\u8f91\u8fc7\u671f\u89e3\u51b3\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898",children:"2.10 \u5229\u7528\u903b\u8f91\u8fc7\u671f\u89e3\u51b3\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u9700\u6c42\uff1a\u4fee\u6539\u6839\u636eid\u67e5\u8be2\u5546\u94fa\u7684\u4e1a\u52a1\uff0c\u57fa\u4e8e\u903b\u8f91\u8fc7\u671f\u65b9\u5f0f\u6765\u89e3\u51b3\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898"})}),"\n",(0,r.jsx)(n.p,{children:"\u601d\u8def\u5206\u6790\uff1a\u5f53\u7528\u6237\u5f00\u59cb\u67e5\u8be2redis\u65f6\uff0c\u5224\u65ad\u662f\u5426\u547d\u4e2d\uff0c\u5982\u679c\u6ca1\u6709\u547d\u4e2d\u5219\u76f4\u63a5\u8fd4\u56de\u7a7a\u6570\u636e\uff0c\u4e0d\u67e5\u8be2\u6570\u636e\u5e93\uff0c\u800c\u4e00\u65e6\u547d\u4e2d\u540e\uff0c\u5c06value\u53d6\u51fa\uff0c\u5224\u65advalue\u4e2d\u7684\u8fc7\u671f\u65f6\u95f4\u662f\u5426\u6ee1\u8db3\uff0c\u5982\u679c\u6ca1\u6709\u8fc7\u671f\uff0c\u5219\u76f4\u63a5\u8fd4\u56deredis\u4e2d\u7684\u6570\u636e\uff0c\u5982\u679c\u8fc7\u671f\uff0c\u5219\u5728\u5f00\u542f\u72ec\u7acb\u7ebf\u7a0b\u540e\u76f4\u63a5\u8fd4\u56de\u4e4b\u524d\u7684\u6570\u636e\uff0c\u72ec\u7acb\u7ebf\u7a0b\u53bb\u91cd\u6784\u6570\u636e\uff0c\u91cd\u6784\u5b8c\u6210\u540e\u91ca\u653e\u4e92\u65a5\u9501\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653360308731",src:s(43871).A+"",width:"1179",height:"617"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["\u672a\u547d\u4e2d\u76f4\u63a5\u8fd4\u56de\u662f\u56e0\u4e3a\u6211\u4eec",(0,r.jsx)(n.strong,{children:"\u624b\u52a8\u63d0\u524d\u8bbe\u7f6e\u597dredis\u903b\u8f91\u8fc7\u671f\u6570\u636e"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u5c01\u88c5\u6570\u636e\uff1a\u56e0\u4e3a\u73b0\u5728redis\u4e2d\u5b58\u50a8\u7684\u6570\u636e\u7684value\u9700\u8981\u5e26\u4e0a\u8fc7\u671f\u65f6\u95f4\uff0c\u6b64\u65f6\u8981\u4e48\u4f60\u53bb\u4fee\u6539\u539f\u6765\u7684\u5b9e\u4f53\u7c7b\uff0c\u8981\u4e48\u4f60"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u6b65\u9aa4\u4e00\u3001"})}),"\n",(0,r.jsx)(n.p,{children:"\u65b0\u5efa\u4e00\u4e2a\u5b9e\u4f53\u7c7b\uff0c\u6211\u4eec\u91c7\u7528\u7b2c\u4e8c\u4e2a\u65b9\u6848\uff0c\u8fd9\u4e2a\u65b9\u6848\uff0c\u5bf9\u539f\u6765\u4ee3\u7801\u6ca1\u6709\u4fb5\u5165\u6027\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"@Data\npublic class RedisData {\n    private LocalDateTime expireTime;\n    privat\te Object data;\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u6b65\u9aa4\u4e8c\u3001"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5728",(0,r.jsx)(n.strong,{children:"ShopServiceImpl"})," \u65b0\u589e\u6b64\u65b9\u6cd5\uff0c\u5229\u7528\u5355\u5143\u6d4b\u8bd5\u8fdb\u884c\u7f13\u5b58\u9884\u70ed"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"/**\n * \u8bbe\u7f6e\u903b\u8f91\u8fc7\u671f\u7f13\u5b58shop\u5230redis\n *\n * @param id\n * @param expireSeconds\n */\npublic void saveShopRedis(Long id, Long expireSeconds) throws InterruptedException {\n    Thread.sleep(200);\n    // 1 \u67e5\u8be2\u5e97\u94fa\u6570\u636e\n    Shop shop = this.getById(id);\n    // 2 \u5c01\u88c5\u903b\u8f91\u8fc7\u671f\u65f6\u95f4\n    RedisData redisData = new RedisData();\n    redisData.setData(shop);\n    redisData.setExpireTime(LocalDateTime.now().plusSeconds(expireSeconds));\n    // 3 \u5199\u5165redis\n    stringRedisTemplate.opsForValue().set(RedisConstants.CACHE_SHOP_KEY + id, JSONUtil.toJsonStr(redisData));\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u5728\u6d4b\u8bd5\u7c7b\u4e2d"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@Resource\nprivate ShopServiceImpl shopService;\n\n@Test\nvoid testSaveExpire() throws InterruptedException {\n    shopService.saveShopRedis(1L,10L);\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6b65\u9aa4\u4e09\uff1a\u6b63\u5f0f\u4ee3\u7801"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"ShopServiceImpl"})}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u7684\u4f7f\u7528CompletableFuture\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'/**\n * \u903b\u8f91\u8fc7\u671f\u89e3\u51b3\u7f13\u5b58\u51fb\u7a7f\n *\n * @param id\n * @return\n */\nprivate Result queryWithLogicalExpire(Long id) {\n    String key = RedisConstants.CACHE_SHOP_KEY + id;\n    // 1 \u4eceredis\u67e5\u8be2\u5546\u94fa\u7f13\u5b58\n    String shopJson = stringRedisTemplate.opsForValue().get(key);\n    // TODO 2 \u5224\u65ad\u662f\u5426\u5b58\u5728\n    if (StrUtil.isBlank(shopJson)) {\n        // 3 \u4e0d\u5b58\u5728\uff0c\u76f4\u63a5\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\n        return Result.fail("\u5e97\u94fa\u4fe1\u606f\u4e0d\u5b58\u5728\uff01");\n    }\n\n    // TODO 4 \u547d\u4e2d\uff0c\u9700\u8981\u628ajson\u53cd\u5e8f\u5217\u5316\u4e3a\u5bf9\u8c61\n    RedisData redisData = JSONUtil.toBean(shopJson, RedisData.class);\n    JSONObject jsonObject = (JSONObject) redisData.getData();\n    Shop shop = JSONUtil.toBean(jsonObject, Shop.class);\n    LocalDateTime expireTime = redisData.getExpireTime();\n    // TODO 5 \u5224\u65ad\u662f\u5426\u8fc7\u671f\n    if (expireTime.isAfter(LocalDateTime.now())) {\n        // TODO 5.1 \u672a\u8fc7\u671f\uff0c\u76f4\u63a5\u8fd4\u56de\u5e97\u94fa\u4fe1\u606f\n        return Result.ok(shop);\n    }\n    // TODO 5.2 \u5df2\u8fc7\u671f\uff0c\u9700\u8981\u7f13\u5b58\u91cd\u5efa\n    // TODO 6 \u7f13\u5b58\u91cd\u5efa\n    // TODO 6.1 \u83b7\u53d6\u4e92\u65a5\u9501\n    String lockKey = RedisConstants.LOCK_SHOP_KEY + id;\n    boolean isLock = this.tryLock(lockKey);\n    // TODO 6.2 \u5224\u65ad\u662f\u5426\u83b7\u53d6\u9501\u6210\u529f\n    if (isLock) {\n        //double check\n        shopJson = stringRedisTemplate.opsForValue().get(key);\n        redisData = JSONUtil.toBean(shopJson, RedisData.class);\n        data = (JSONObject) redisData.getData();\n        shop = data.toBean(Shop.class);\n        expireTime = redisData.getExpireTime();\n        //double check\u672a\u8fc7\u671f\n        if(expireTime.isAfter(LocalDateTime.now())) {\n            this.unlock(lockKey);\n            return Result.ok(shop);\n        }\n        \n        //\u8fd8\u662f\u8fc7\u671f\uff0c\u5f00\u542f\u65b0\u7ebf\u7a0b\n        // TODO 6.3 \u6210\u529f\uff0c\u5f00\u542f\u72ec\u7acb\u7ebf\u7a0b\uff0c\u5b9e\u73b0\u7f13\u5b58\u91cd\u5efa\u4f60\n        CompletableFuture.runAsync(() -> {\n            try {\n                this.saveShopRedis(id, 100L);\n            } catch (Exception e) {\n                throw new RuntimeException(e);\n            } finally {\n                // TODO \u91ca\u653e\u4e92\u65a5\u9501\n                this.unlock(lockKey);\n            }\n        }, CACHE_REBUILD_EXECUTOR);\n    }\n    // TODO 6.4 \u65e0\u8bba\u6210\u529f\u6216\u5931\u8d25\uff0c\u8fd4\u56de\u8fc7\u671f\u7684\u5546\u94fa\u4fe1\u606f\n    return Result.ok(shop);\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u8001\u5e08\u7684\u4f7f\u7528Runnable\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"private static final ExecutorService CACHE_REBUILD_EXECUTOR = Executors.newFixedThreadPool(10);\npublic Shop queryWithLogicalExpire( Long id ) {\n    String key = CACHE_SHOP_KEY + id;\n    // 1.\u4eceredis\u67e5\u8be2\u5546\u94fa\u7f13\u5b58\n    String json = stringRedisTemplate.opsForValue().get(key);\n    // 2.\u5224\u65ad\u662f\u5426\u5b58\u5728\n    if (StrUtil.isBlank(json)) {\n        // 3.\u5b58\u5728\uff0c\u76f4\u63a5\u8fd4\u56de\n        return null;\n    }\n    // 4.\u547d\u4e2d\uff0c\u9700\u8981\u5148\u628ajson\u53cd\u5e8f\u5217\u5316\u4e3a\u5bf9\u8c61\n    RedisData redisData = JSONUtil.toBean(json, RedisData.class);\n    Shop shop = JSONUtil.toBean((JSONObject) redisData.getData(), Shop.class);\n    LocalDateTime expireTime = redisData.getExpireTime();\n    // 5.\u5224\u65ad\u662f\u5426\u8fc7\u671f\n    if(expireTime.isAfter(LocalDateTime.now())) {\n        // 5.1.\u672a\u8fc7\u671f\uff0c\u76f4\u63a5\u8fd4\u56de\u5e97\u94fa\u4fe1\u606f\n        return shop;\n    }\n    // 5.2.\u5df2\u8fc7\u671f\uff0c\u9700\u8981\u7f13\u5b58\u91cd\u5efa\n    // 6.\u7f13\u5b58\u91cd\u5efa\n    // 6.1.\u83b7\u53d6\u4e92\u65a5\u9501\n    String lockKey = LOCK_SHOP_KEY + id;\n    boolean isLock = tryLock(lockKey);\n    // 6.2.\u5224\u65ad\u662f\u5426\u83b7\u53d6\u9501\u6210\u529f\n    if (isLock){\n        //double check\n        shopJson = stringRedisTemplate.opsForValue().get(key);\n        redisData = JSONUtil.toBean(shopJson, RedisData.class);\n        data = (JSONObject) redisData.getData();\n        shop = data.toBean(Shop.class);\n        expireTime = redisData.getExpireTime();\n        //double check\u672a\u8fc7\u671f\n        if(expireTime.isAfter(LocalDateTime.now())) {\n            this.unlock(lockKey);\n            return Result.ok(shop);\n        }\n        \n        //\u8fd8\u662f\u8fc7\u671f\uff0c\u5f00\u542f\u65b0\u7ebf\u7a0b\n        CACHE_REBUILD_EXECUTOR.submit( ()->{\n\n            try{\n                //\u91cd\u5efa\u7f13\u5b58\n                this.saveShop2Redis(id,20L);\n            }catch (Exception e){\n                throw new RuntimeException(e);\n            }finally {\n                unlock(lockKey);\n            }\n        });\n    }\n    // 6.4.\u8fd4\u56de\u8fc7\u671f\u7684\u5546\u94fa\u4fe1\u606f\n    return shop;\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"211\u5c01\u88c5redis\u5de5\u5177\u7c7b",children:"2.11\u3001\u5c01\u88c5Redis\u5de5\u5177\u7c7b"}),"\n",(0,r.jsx)(n.p,{children:"\u57fa\u4e8eStringRedisTemplate\u5c01\u88c5\u4e00\u4e2a\u7f13\u5b58\u5de5\u5177\u7c7b\uff0c\u6ee1\u8db3\u4e0b\u5217\u9700\u6c42\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u65b9\u6cd51\uff1a\u5c06\u4efb\u610fJava\u5bf9\u8c61\u5e8f\u5217\u5316\u4e3ajson\u5e76\u5b58\u50a8\u5728string\u7c7b\u578b\u7684key\u4e2d\uff0c\u5e76\u4e14\u53ef\u4ee5\u8bbe\u7f6eTTL\u8fc7\u671f\u65f6\u95f4(\u4e3a\u4e86",(0,r.jsx)(n.strong,{children:"\u53cc\u5199\u4e00\u81f4\u515c\u5e95"}),")"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u65b9\u6cd52\uff1a\u5c06\u4efb\u610fJava\u5bf9\u8c61\u5e8f\u5217\u5316\u4e3ajson\u5e76\u5b58\u50a8\u5728string\u7c7b\u578b\u7684key\u4e2d\uff0c\u5e76\u4e14\u53ef\u4ee5\u8bbe\u7f6e",(0,r.jsx)(n.strong,{children:"\u903b\u8f91\u8fc7\u671f\u65f6\u95f4"}),"\uff0c\u7528\u4e8e\u5904\u7406",(0,r.jsx)(n.strong,{children:"\u7f13\u5b58\u51fb\u7a7f"}),"\u95ee\u9898"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u65b9\u6cd53\uff1a\u6839\u636e\u6307\u5b9a\u7684key\u67e5\u8be2\u7f13\u5b58\uff0c\u5e76\u53cd\u5e8f\u5217\u5316\u4e3a\u6307\u5b9a\u7c7b\u578b\uff0c\u5229\u7528\u7f13\u5b58\u7a7a\u503c\u7684\u65b9\u5f0f\u89e3\u51b3",(0,r.jsx)(n.strong,{children:"\u7f13\u5b58\u7a7f\u900f"}),"\u95ee\u9898"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u65b9\u6cd54\uff1a\u6839\u636e\u6307\u5b9a\u7684key\u67e5\u8be2\u7f13\u5b58\uff0c\u5e76\u53cd\u5e8f\u5217\u5316\u4e3a\u6307\u5b9a\u7c7b\u578b\uff0c\u9700\u8981\u5229\u7528",(0,r.jsx)(n.strong,{children:"\u903b\u8f91\u8fc7\u671f"}),"\u89e3\u51b3",(0,r.jsx)(n.strong,{children:"\u7f13\u5b58\u51fb\u7a7f"}),"\u95ee\u9898"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u65b9\u6cd55\uff1a\u6839\u636e\u6307\u5b9a\u7684key\u67e5\u8be2\u7f13\u5b58\uff0c\u5e76\u53cd\u5e8f\u5217\u5316\u4e3a\u6307\u5b9a\u7c7b\u578b\uff0c\u9700\u8981\u5229\u7528",(0,r.jsx)(n.strong,{children:"\u4e92\u65a5\u9501"}),"\u89e3\u51b3",(0,r.jsx)(n.strong,{children:"\u7f13\u5b58\u51fb\u7a7f"}),"\u95ee\u9898"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u5c06\u903b\u8f91\u8fdb\u884c\u5c01\u88c5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'package com.hmdp.utils;\n\nimport cn.hutool.core.util.BooleanUtil;\nimport cn.hutool.core.util.StrUtil;\nimport cn.hutool.json.JSONObject;\nimport cn.hutool.json.JSONUtil;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.data.redis.core.StringRedisTemplate;\nimport org.springframework.stereotype.Component;\n\nimport java.time.LocalDateTime;\nimport java.util.concurrent.*;\nimport java.util.function.Function;\n\n/**\n * Redis\u505a\u7f13\u5b58\u65f6\u4f7f\u7528\u7684\u5de5\u5177\u5305\n * \u53ef\u4ee5\u89e3\u51b3\u4ee5\u4e0b\u95ee\u9898\uff1a\n *      \u65b9\u6cd51\uff1a\u5c06\u4efb\u610fJava\u5bf9\u8c61\u5e8f\u5217\u5316\u4e3ajson\u5e76\u5b58\u50a8\u5728string\u7c7b\u578b\u7684key\u4e2d\uff0c\u5e76\u4e14\u53ef\u4ee5\u8bbe\u7f6eTTL\u8fc7\u671f\u65f6\u95f4(\u4e3a\u4e86**\u53cc\u5199\u4e00\u81f4\u515c\u5e95**)\n *      \u65b9\u6cd52\uff1a\u5c06\u4efb\u610fJava\u5bf9\u8c61\u5e8f\u5217\u5316\u4e3ajson\u5e76\u5b58\u50a8\u5728string\u7c7b\u578b\u7684key\u4e2d\uff0c\u5e76\u4e14\u53ef\u4ee5\u8bbe\u7f6e**\u903b\u8f91\u8fc7\u671f\u65f6\u95f4**\uff0c\u7528\u4e8e\u5904\u7406**\u7f13\u5b58\u51fb\u7a7f**\u95ee\u9898\n *      \u65b9\u6cd53\uff1a\u6839\u636e\u6307\u5b9a\u7684key\u67e5\u8be2\u7f13\u5b58\uff0c\u5e76\u53cd\u5e8f\u5217\u5316\u4e3a\u6307\u5b9a\u7c7b\u578b\uff0c\u5229\u7528\u7f13\u5b58\u7a7a\u503c\u7684\u65b9\u5f0f\u89e3\u51b3**\u7f13\u5b58\u7a7f\u900f**\u95ee\u9898\n *      \u65b9\u6cd54\uff1a\u6839\u636e\u6307\u5b9a\u7684key\u67e5\u8be2\u7f13\u5b58\uff0c\u5e76\u53cd\u5e8f\u5217\u5316\u4e3a\u6307\u5b9a\u7c7b\u578b\uff0c\u9700\u8981\u5229\u7528\u903b\u8f91\u8fc7\u671f\u89e3\u51b3**\u7f13\u5b58\u51fb\u7a7f**\u95ee\u9898\n *      \u65b9\u6cd55\uff1a\u6839\u636e\u6307\u5b9a\u7684key\u67e5\u8be2\u7f13\u5b58\uff0c\u5e76\u53cd\u5e8f\u5217\u5316\u4e3a\u6307\u5b9a\u7c7b\u578b\uff0c\u9700\u8981\u5229\u7528\u4e92\u65a5\u9501\u89e3\u51b3**\u7f13\u5b58\u51fb\u7a7f**\u95ee\u9898\n *          \n * \u6ce8\u610f\u4e8b\u9879\uff1a\u9700\u8981\u5f15\u5165hutool\u4f9d\u8d56\uff0c\u5e76\u4e14\u9700\u8981RedisData\u7c7b\n * \x3c!--hutool--\x3e\n * <dependency>\n *     <groupId>cn.hutool</groupId>\n *     <artifactId>hutool-all</artifactId>\n *     <version>5.7.17</version>\n * </dependency>\n * \n * @Data\n * public class RedisData {\n *     private LocalDateTime expireTime;\n *     private Object data;\n * }\n * \n * @author spongehah from hut\n * @since 2023-09-24\n */\n\n@Component\n@Slf4j\npublic class RedisCacheHelper {\n    \n    private final StringRedisTemplate stringRedisTemplate;\n\n    // \u4f7f\u7528\u6784\u9020\u6ce8\u5165\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u81ea\u52a8\u6ce8\u5165\n    public RedisCacheHelper(StringRedisTemplate stringRedisTemplate) {\n        this.stringRedisTemplate = stringRedisTemplate;\n    }\n\n    /**\n     * \u65b9\u6cd51\uff1a\u5c06\u4efb\u610fJava\u5bf9\u8c61\u5e8f\u5217\u5316\u4e3ajson\u5e76\u5b58\u50a8\u5728string\u7c7b\u578b\u7684key\u4e2d\uff0c\u5e76\u4e14\u53ef\u4ee5\u8bbe\u7f6eTTL\u8fc7\u671f\u65f6\u95f4(\u4e3a\u4e86**\u53cc\u5199\u4e00\u81f4\u515c\u5e95**)\n     * @param key key\n     * @param value value\n     * @param time TTL\u8fc7\u671f\u65f6\u95f4\n     * @param unit TTL\u8fc7\u671f\u65f6\u95f4\u5355\u4f4d\n     */\n    public void set(String key, Object value, Long time, TimeUnit unit) {\n        stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(value), time, unit);\n    }\n\n    /**\n     * \u65b9\u6cd52\uff1a\u5c06\u4efb\u610fJava\u5bf9\u8c61\u5e8f\u5217\u5316\u4e3ajson\u5e76\u5b58\u50a8\u5728string\u7c7b\u578b\u7684key\u4e2d\uff0c\u5e76\u4e14\u53ef\u4ee5\u8bbe\u7f6e**\u903b\u8f91\u8fc7\u671f\u65f6\u95f4**\uff0c\u7528\u4e8e\u5904\u7406**\u7f13\u5b58\u51fb\u7a7f**\u95ee\u9898\n     * @param key key\n     * @param value value\n     * @param expireTime TTL\u903b\u8f91\u8fc7\u671f\u65f6\u95f4\n     * @param unit TTL\u8fc7\u671f\u65f6\u95f4\u5355\u4f4d\n     */\n    public void setWithLogicalExpire(String key, Object value, Long expireTime, TimeUnit unit) {\n        //\u8bbe\u7f6e\u903b\u8f91\u8fc7\u671f\u65f6\u95f4\n        RedisData redisData = new RedisData();\n        redisData.setData(value);\n        redisData.setExpireTime(LocalDateTime.now().plusSeconds(unit.toSeconds(expireTime)));\n        //\u5199\u5165redis\n        stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(redisData));\n    }\n\n    /**\n     * \u65b9\u6cd53\uff1a\u6839\u636e\u6307\u5b9a\u7684key\u67e5\u8be2\u7f13\u5b58\uff0c\u5e76\u53cd\u5e8f\u5217\u5316\u4e3a\u6307\u5b9a\u7c7b\u578b\uff0c\u5229\u7528\u7f13\u5b58\u7a7a\u503c\u7684\u65b9\u5f0f\u89e3\u51b3**\u7f13\u5b58\u7a7f\u900f**\u95ee\u9898\n     * \u975e\u70ed\u70b9\u6570\u636e\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u4f7f\u7528\uff0c\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\u5373\u53ef\n     * @param keyPrefix key\u524d\u7f00\uff0ckey = keyPrefix + id\n     * @param id \u67e5\u8be2\u5bf9\u8c61id\n     * @param type \u67e5\u8be2\u5bf9\u8c61\u7c7b\u578b\n     * @param dbFallback \u67e5\u8be2\u6570\u636e\u5e93\u64cd\u4f5c\u51fd\u6570\n     * @param time \u65b0\u653e\u5165Redis\u5bf9\u8c61\u7684TTL\u8fc7\u671f\u65f6\u95f4\n     * @param unit \u65b0\u653e\u5165Redis\u5bf9\u8c61\u7684TTL\u8fc7\u671f\u65f6\u95f4\u5355\u4f4d\n     * @return \u67e5\u8be2\u7684\u5bf9\u8c61\n     * @param <R> \u67e5\u8be2\u5bf9\u8c61\u7c7b\u578b\n     * @param <ID> \u67e5\u8be2\u5bf9\u8c61id\u7684\u7c7b\u578b\n     */\n    public <R, ID> R queryWithPassThrough(String keyPrefix, ID id, Class<R> type, Function<ID, R> dbFallback,\n                                           Long time, TimeUnit unit) {\n        String key = keyPrefix + id;\n        // 1 \u4eceredis\u67e5\u8be2\u5546\u94fa\u7f13\u5b58\n        String json = stringRedisTemplate.opsForValue().get(key);\n        // 2 \u5224\u65ad\u662f\u5426\u5b58\u5728\n        if (StrUtil.isNotBlank(json)) {\n            // 3 \u5b58\u5728\uff0c\u76f4\u63a5\u8fd4\u56de\n            return JSONUtil.toBean(json, type);\n        }\n        /**\n         * isNotBlank()\u65b9\u6cd5\u4f1a\u68c0\u6d4b\u5230\u7a7a\u5b57\u7b26\u4e32\n         * \u4e3a\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\uff0c\u989d\u5916\u5224\u65ad\u662f\u5426\u4e3a""\u7a7a\u5b57\u7b26\u4e32\uff0c\u662f\u5219\u8fd4\u56denull\n         */\n        if (json != null) {\n            return null;\n        }\n\n        // 4 \u4e0d\u5b58\u5728\uff0c\u6839\u636eid\u67e5\u8be2\u6570\u636e\u5e93\n        R r = dbFallback.apply(id);\n        // 5 \u6570\u636e\u5e93\u4e0d\u5b58\u5728\uff0c\u8fd4\u56de\u9519\u8bef\n        if (r == null) {\n            /**\n             * \u4e3a\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\uff0c\u5c06\u7a7a\u503c\u5199\u5165redis\uff0c2\u5206\u949f\u540e\u8fc7\u671f\uff08\u53ef\u81ea\u5df1\u4fee\u6539\uff09\n             */\n            stringRedisTemplate.opsForValue().set(key, "", 2L, TimeUnit.MINUTES);\n            //\u8fd4\u56de\u7a7a\u503c\n            return null;\n        }\n        // 6 \u5b58\u5728\uff0c\u5199\u5165redis\n        this.set(key, r, time, unit);\n        // 7 \u5b58\u5728\uff0c\u8fd4\u56de\u6570\u636e\n        return r;\n    }\n\n    //\u81ea\u5b9a\u4e49\u7ebf\u7a0b\u6c60\uff0c\u7528\u4e8equeryWithLogicalExpire\u65b9\u6cd5\uff0c\u53ef\u6839\u636e\u81ea\u5df1\u9700\u6c42\u66f4\u6539\n    private static final ExecutorService CACHE_REBUILD_EXECUTOR = new ThreadPoolExecutor(\n            3,\n            7,\n            3L,\n            TimeUnit.SECONDS,\n            new ArrayBlockingQueue<>(4),\n            Executors.defaultThreadFactory(),\n            new ThreadPoolExecutor.AbortPolicy());\n\n    /**\n     * \u65b9\u6cd54\uff1a\u6839\u636e\u6307\u5b9a\u7684key\u67e5\u8be2\u7f13\u5b58\uff0c\u5e76\u53cd\u5e8f\u5217\u5316\u4e3a\u6307\u5b9a\u7c7b\u578b\uff0c\u9700\u8981\u5229\u7528\u903b\u8f91\u8fc7\u671f\u89e3\u51b3**\u7f13\u5b58\u51fb\u7a7f**\u95ee\u9898\n     * \u70ed\u70b9\u6570\u636e\uff0c\u4f7f\u7528\u903b\u8f91\u8fc7\u671f\u89e3\u51b3\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898\n     * \u63d0\u524d\u624b\u52a8\u7f13\u5b58\u70ed\u70b9\u6570\u636e\uff0c\u67e5\u8be2\u7f13\u5b58\u4e3anull\u76f4\u63a5\u8fd4\u56denull\uff0c\u4e0d\u9700\u8981\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\n     * @param keyPrefix key\u524d\u7f00\uff0ckey = keyPrefix + id\n     * @param id \u67e5\u8be2\u5bf9\u8c61id\n     * @param type \u67e5\u8be2\u5bf9\u8c61\u7c7b\u578b\n     * @param dbFallback \u67e5\u8be2\u6570\u636e\u5e93\u64cd\u4f5c\u51fd\u6570\n     * @param time \u65b0\u653e\u5165Redis\u5bf9\u8c61\u7684TTL\u8fc7\u671f\u65f6\u95f4\n     * @param unit \u65b0\u653e\u5165Redis\u5bf9\u8c61\u7684TTL\u8fc7\u671f\u65f6\u95f4\u5355\u4f4d\n     * @param lockKeyPrefix Redis\u7f13\u5b58\u91cd\u5efa\u7684key\n     * @return \u67e5\u8be2\u7684\u5bf9\u8c61\n     * @param <R> \u67e5\u8be2\u5bf9\u8c61\u7c7b\u578b\n     * @param <ID> \u67e5\u8be2\u5bf9\u8c61id\u7684\u7c7b\u578b\n     */\n    public <R, ID> R queryWithLogicalExpire(String keyPrefix, ID id, Class<R> type, Function<ID, R> dbFallback,\n                                             Long time, TimeUnit unit, String lockKeyPrefix) {\n        String key = keyPrefix + id;\n        // 1 \u4eceredis\u67e5\u8be2\u5546\u94fa\u7f13\u5b58\n        String json = stringRedisTemplate.opsForValue().get(key);\n        // TODO 2 \u5224\u65ad\u662f\u5426\u5b58\u5728\n        if (StrUtil.isBlank(json)) {\n            // 3 \u4e0d\u5b58\u5728\uff0c\u76f4\u63a5\u8fd4\u56denull\n            return null;\n        }\n\n        // TODO 4 \u547d\u4e2d\uff0c\u9700\u8981\u628ajson\u53cd\u5e8f\u5217\u5316\u4e3a\u5bf9\u8c61\n        RedisData redisData = JSONUtil.toBean(json, RedisData.class);\n        JSONObject jsonObject = (JSONObject) redisData.getData();\n        R r = JSONUtil.toBean(jsonObject, type);\n        LocalDateTime expireTime = redisData.getExpireTime();\n        // TODO 5 \u5224\u65ad\u662f\u5426\u8fc7\u671f\n        if (expireTime.isAfter(LocalDateTime.now())) {\n            // TODO 5.1 \u672a\u8fc7\u671f\uff0c\u76f4\u63a5\u8fd4\u56de\u67e5\u8be2\u5bf9\u8c61\u4fe1\u606f\n            return r;\n        }\n        // TODO 5.2 \u5df2\u8fc7\u671f\uff0c\u9700\u8981\u7f13\u5b58\u91cd\u5efa\n        // TODO 6 \u7f13\u5b58\u91cd\u5efa\n        // TODO 6.1 \u83b7\u53d6\u4e92\u65a5\u9501\n        String lockKey = lockKeyPrefix + id;\n        boolean isLock = this.tryLock(lockKey);\n        // TODO 6.2 \u5224\u65ad\u662f\u5426\u83b7\u53d6\u9501\u6210\u529f\n        if (isLock) {\n            // TODO \u53ef\u4ee5\u5728\u8fd9\u91cc\u518d\u8fdb\u884c\u4e00\u4e2adouble check\uff0c\u5982\u679credis\u7f13\u5b58\u4f9d\u65e7\u662f\u8fc7\u671f\u7684\uff0c\u624d\u8fdb\u884c\u7f13\u5b58\u91cd\u5efa\n            String jsonAgain = stringRedisTemplate.opsForValue().get(key);\n            RedisData redisDataAgain = JSONUtil.toBean(jsonAgain, RedisData.class);\n            JSONObject jsonObjectAgain = (JSONObject) redisDataAgain.getData();\n            R rAgain = JSONUtil.toBean(jsonObjectAgain, type);\n            LocalDateTime expireTimeAgain = redisDataAgain.getExpireTime();\n            if (expireTimeAgain.isAfter(LocalDateTime.now())) {\n                this.unlock(lockKey);\n                return rAgain;\n            }\n            // TODO 6.3 \u6210\u529f\uff0c\u5f00\u542f\u72ec\u7acb\u7ebf\u7a0b\uff0c\u5b9e\u73b0\u7f13\u5b58\u91cd\u5efa\u4f60\n            CompletableFuture.runAsync(() -> {\n                try {\n                    //\u67e5\u8be2\u6570\u636e\u5e93\n                    R r2 = dbFallback.apply(id);\n                    //\u5199\u5165redis\uff0c\u5e26\u903b\u8f91\u8fc7\u671f\u65f6\u95f4\n                    this.setWithLogicalExpire(key, r2, time, unit);\n                } catch (Exception e) {\n                    throw new RuntimeException(e);\n                } finally {\n                    // TODO \u91ca\u653e\u4e92\u65a5\u9501\n                    this.unlock(lockKey);\n                }\n            }, CACHE_REBUILD_EXECUTOR);\n        }\n        // TODO 6.4 \u65e0\u8bba\u6210\u529f\u6216\u5931\u8d25\uff0c\u8fd4\u56de\u8fc7\u671f\u7684\u5bf9\u8c61\u4fe1\u606f\n        return r;\n    }\n\n    /**\n     * \u65b9\u6cd55\uff1a\u6839\u636e\u6307\u5b9a\u7684key\u67e5\u8be2\u7f13\u5b58\uff0c\u5e76\u53cd\u5e8f\u5217\u5316\u4e3a\u6307\u5b9a\u7c7b\u578b\uff0c\u9700\u8981\u5229\u7528\u4e92\u65a5\u9501\u89e3\u51b3**\u7f13\u5b58\u51fb\u7a7f**\u95ee\u9898\n     * \u70ed\u70b9\u6570\u636e\uff0c\u4f7f\u7528\u4e92\u65a5\u9501\u89e3\u51b3\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898\n     * \u9700\u8981\u540c\u65f6\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\u95ee\u9898\n     * @param keyPrefix key\u524d\u7f00\uff0ckey = keyPrefix + id\n     * @param id \u67e5\u8be2\u5bf9\u8c61id\n     * @param type \u67e5\u8be2\u5bf9\u8c61\u7c7b\u578b\n     * @param dbFallback \u67e5\u8be2\u6570\u636e\u5e93\u64cd\u4f5c\u51fd\u6570\n     * @param time \u65b0\u653e\u5165Redis\u5bf9\u8c61\u7684TTL\u8fc7\u671f\u65f6\u95f4\n     * @param unit \u65b0\u653e\u5165Redis\u5bf9\u8c61\u7684TTL\u8fc7\u671f\u65f6\u95f4\u5355\u4f4d\n     * @param lockKeyPrefix Redis\u7f13\u5b58\u91cd\u5efa\u7684key\n     * @return \u67e5\u8be2\u7684\u5bf9\u8c61\n     * @param <R> \u67e5\u8be2\u5bf9\u8c61\u7c7b\u578b\n     * @param <ID> \u67e5\u8be2\u5bf9\u8c61id\u7684\u7c7b\u578b\n     */\n    public <R, ID> R queryWithMutex(String keyPrefix, ID id, Class<R> type, Function<ID, R> dbFallback,\n                                Long time, TimeUnit unit, String lockKeyPrefix) {\n        String key = keyPrefix + id;\n        String lockKey = lockKeyPrefix + id;\n        while (true) {\n            // 1 \u4eceredis\u67e5\u8be2\u5546\u94fa\u7f13\u5b58\n            String json = stringRedisTemplate.opsForValue().get(key);\n            // 2 \u5224\u65ad\u662f\u5426\u5b58\u5728\n            if (StrUtil.isNotBlank(json)) {\n                // 3 \u5b58\u5728\uff0c\u76f4\u63a5\u8fd4\u56de\n                R r = JSONUtil.toBean(json, type);\n                return r;\n            }\n            /**\n             * isNotBlank()\u65b9\u6cd5\u4f1a\u68c0\u6d4b\u5230\u7a7a\u5b57\u7b26\u4e32\n             * \u4e3a\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\uff0c\u989d\u5916\u5224\u65ad\u662f\u5426\u4e3a""\u7a7a\u5b57\u7b26\u4e32\uff0c\u662f\u5219\u8fd4\u56denull\n             */\n            if (json != null) {\n                return null;\n            }\n\n            // TODO 4 \u5b9e\u73b0\u7f13\u5b58\u91cd\u5efa\n            // TODO 4.1 \u83b7\u53d6\u4e92\u65a5\u9501\n            boolean isLock = this.tryLock(lockKey);\n            // TODO 4.2 \u5224\u65ad\u662f\u5426\u83b7\u53d6\u6210\u529f\n            if (!isLock) {\n                // TODO 4.3 \u5931\u8d25\uff1a\u5219\u4f11\u7720\u91cd\u8bd5\n                try {\n                    Thread.sleep(50);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            } else {\n                break;\n            }\n        }\n        try {\n            // TODO \u53ef\u4ee5\u5728\u8fd9\u91cc\u518d\u8fdb\u884c\u4e00\u4e2adouble check\uff0c\u5982\u679credis\u7f13\u5b58\u4f9d\u65e7\u6ca1\u6709\u6570\u636e\u7684\u8bdd\uff0c\u624d\u67e5\u8be2\u6570\u636e\u5e93\n            String json = stringRedisTemplate.opsForValue().get(key);\n            if (StrUtil.isNotBlank(json)) {\n                R r = JSONUtil.toBean(json, type);\n                return r;\n            }\n            if (json != null) {\n                return null;\n            }\n            // TODO 4.4 \u6210\u529f\uff0c\u6839\u636eid\u67e5\u8be2\u6570\u636e\u5e93\n            R r = dbFallback.apply(id);\n            // 5 \u6570\u636e\u5e93\u4e0d\u5b58\u5728\uff0c\u8fd4\u56de\u9519\u8bef\n            if (r == null) {\n                /**\n                 * \u4e3a\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\uff0c\u5c06\u7a7a\u503c\u5199\u5165redis\n                 */\n                stringRedisTemplate.opsForValue().set(key, "", 2L, TimeUnit.MINUTES);\n                return null;\n            }\n            // 6  \u5b58\u5728\uff0c\u5199\u5165redis\n            this.set(key, r, time, unit);\n\n            // 7 \u5b58\u5728\uff0c\u8fd4\u56de\u6570\u636e\n            return r;\n        } finally {\n            // TODO 7 \u91ca\u653e\u4e92\u65a5\u9501\n            this.unlock(lockKey);\n        }\n    }\n\n    /**\n     * \u7b80\u5355\u7684\u5206\u5e03\u5f0f\u9501\u5b9e\u73b0\u65b9\u6848\n     * \u4ee5setnx\u547d\u4ee4\u4f5c\u4e3a\u4e92\u65a5\uff0c\u4ee5ttl\u8fc7\u671f\u65f6\u95f4\u4f5c\u4e3a\u5b89\u5168\u6027\u4fdd\u8bc1\uff0c\u5b89\u5168\u6027\u8f83\u4f4e\n     * @param key\n     * @return\n     */\n    //\u4e92\u65a5\u9501\u7b80\u5355\u5b9e\u73b0\uff0c\u83b7\u5f97\u9501\uff0cqueryWithLogicalExpire\u548cqueryWithMutex\u65b9\u6cd5\u5185\u8c03\u7528\n    private boolean tryLock(String key) {\n        Boolean isLock = stringRedisTemplate.opsForValue().setIfAbsent(key, "1", 10L, TimeUnit.SECONDS);\n        return BooleanUtil.isTrue(isLock);  // \u5305\u88c5\u7c7b\u4f1a\u505a\u62c6\u7bb1\u53ef\u80fd\u51fa\u73b0\u7a7a\u6307\u9488\uff0c\u4e8e\u662f\u4e3b\u52a8\u62c6\u7bb1\n    }\n    //\u4e92\u65a5\u9501\u7b80\u5355\u5b9e\u73b0\uff0c\u91ca\u653e\u9501\uff0cqueryWithLogicalExpire\u548cqueryWithMutex\u65b9\u6cd5\u5185\u8c03\u7528\n    private void unlock(String key) {\n        stringRedisTemplate.delete(key);\n    }\n    \n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u5728ShopServiceImpl \u4e2d"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Resource\nprivate RedisCacheHelper redisCacheHelper;\n\n@Override\npublic Result queryById(Long id) {\n    // \u7f13\u5b58\u7a7f\u900f\n    // return queryWithPassThrough(id);\n\n\n    /**\n     * \u4e92\u65a5\u9501\u89e3\u51b3\u7f13\u5b58\u51fb\u7a7f\n     */\n    // return queryWithMutex(id);\n    \n    //\u4f7f\u7528\u5c01\u88c5\u597d\u7684\u5de5\u5177\u7c7b\n    // Shop shop = redisCacheHelper.queryWithPassThrough(RedisConstants.CACHE_SHOP_KEY, id, Shop.class, this::getById,\n    //         RedisConstants.CACHE_SHOP_TTL, TimeUnit.MINUTES);\n    // if (shop == null) {\n    //     return Result.fail("\u5e97\u94fa\u4fe1\u606f\u4e0d\u5b58\u5728\uff01");\n    // } \n    // return Result.ok(shop);\n\n\n    /**\n     * \u903b\u8f91\u8fc7\u671f\u89e3\u51b3\u7f13\u5b58\u51fb\u7a7f\n     */\n    // return queryWithLogicalExpire(id);\n    Shop shop =  redisCacheHelper.queryWithLogicalExpire(RedisConstants.CACHE_SHOP_KEY, id, Shop.class, this::getById, 20L, TimeUnit.SECONDS, RedisConstants.LOCK_SHOP_KEY);\n    if (shop == null) {\n        return Result.fail("\u5e97\u94fa\u4fe1\u606f\u4e0d\u5b58\u5728\uff01");\n    }\n    return Result.ok(shop);\n}\n'})}),"\n",(0,r.jsx)(n.h1,{id:"3\u4f18\u60e0\u5377\u79d2\u6740",children:"3\u3001\u4f18\u60e0\u5377\u79d2\u6740"}),"\n",(0,r.jsxs)(n.h2,{id:"31--\u5168\u5c40\u552f\u4e00id",children:["3.1 -",(0,r.jsx)(n.strong,{children:"\u5168\u5c40\u552f\u4e00ID"})]}),"\n",(0,r.jsx)(n.p,{children:"\u6bcf\u4e2a\u5e97\u94fa\u90fd\u53ef\u4ee5\u53d1\u5e03\u4f18\u60e0\u5238\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653362612286",src:s(60210).A+"",width:"563",height:"177"})}),"\n",(0,r.jsx)(n.p,{children:"\u5f53\u7528\u6237\u62a2\u8d2d\u65f6\uff0c\u5c31\u4f1a\u751f\u6210\u8ba2\u5355\u5e76\u4fdd\u5b58\u5230tb_voucher_order\u8fd9\u5f20\u8868\u4e2d\uff0c\u800c\u8ba2\u5355\u8868\u5982\u679c\u4f7f\u7528\u6570\u636e\u5e93\u81ea\u589eID\u5c31\u5b58\u5728\u4e00\u4e9b\u95ee\u9898\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"id\u7684\u89c4\u5f8b\u6027\u592a\u660e\u663e"}),"\n",(0,r.jsx)(n.li,{children:"\u53d7\u5355\u8868\u6570\u636e\u91cf\u7684\u9650\u5236"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u573a\u666f\u5206\u6790\uff1a\u5982\u679c\u6211\u4eec\u7684id\u5177\u6709\u592a\u660e\u663e\u7684\u89c4\u5219\uff0c\u7528\u6237\u6216\u8005\u8bf4\u5546\u4e1a\u5bf9\u624b\u5f88\u5bb9\u6613\u731c\u6d4b\u51fa\u6765\u6211\u4eec\u7684\u4e00\u4e9b\u654f\u611f\u4fe1\u606f\uff0c\u6bd4\u5982\u5546\u57ce\u5728\u4e00\u5929\u65f6\u95f4\u5185\uff0c\u5356\u51fa\u4e86\u591a\u5c11\u5355\uff0c\u8fd9\u660e\u663e\u4e0d\u5408\u9002\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u573a\u666f\u5206\u6790\u4e8c\uff1a\u968f\u7740\u6211\u4eec\u5546\u57ce\u89c4\u6a21\u8d8a\u6765\u8d8a\u5927\uff0cmysql\u7684\u5355\u8868\u7684\u5bb9\u91cf\u4e0d\u5b9c\u8d85\u8fc7500W\uff0c\u6570\u636e\u91cf\u8fc7\u5927\u4e4b\u540e\uff0c\u6211\u4eec\u8981\u8fdb\u884c\u62c6\u5e93\u62c6\u8868\uff0c\u4f46\u62c6\u5206\u8868\u4e86\u4e4b\u540e\uff0c\u4ed6\u4eec\u4ece\u903b\u8f91\u4e0a\u8bb2\u4ed6\u4eec\u662f\u540c\u4e00\u5f20\u8868\uff0c\u6240\u4ee5\u4ed6\u4eec\u7684id\u662f\u4e0d\u80fd\u4e00\u6837\u7684\uff0c \u4e8e\u662f\u4e4e\u6211\u4eec\u9700\u8981\u4fdd\u8bc1id\u7684\u552f\u4e00\u6027\u3002"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u5168\u5c40ID\u751f\u6210\u5668"}),"\uff0c\u662f\u4e00\u79cd\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e0b\u7528\u6765\u751f\u6210\u5168\u5c40\u552f\u4e00ID\u7684\u5de5\u5177\uff0c\u4e00\u822c\u8981\u6ee1\u8db3\u4e0b\u5217\u7279\u6027\uff1a"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653363100502",src:s(49726).A+"",width:"743",height:"304"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:s(73052).A+"",width:"743",height:"713"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"UUID\tMySQL8.0\u4ee5\u540e\uff0cUUID\u53ef\u4ee5\u81ea\u589e\u4e14\u51cf\u5c11\u4e86\u5b58\u50a8\u7a7a\u95f4"}),"\n",(0,r.jsx)(n.li,{children:"Redis\u81ea\u589e"}),"\n",(0,r.jsx)(n.li,{children:"snowflake\u7b97\u6cd5     \u4f9d\u8d56\u4e8e\u7cfb\u7edf\u65f6\u95f4\uff0c\u9700\u8981\u673a\u5668\u95f4\u7684\u65f6\u95f4\u4e00\u81f4"}),"\n",(0,r.jsx)(n.li,{children:"\u6570\u636e\u5e93\u81ea\u589e     \u4e13\u95e8\u5f04\u4e00\u4e2a\u6570\u636e\u5e93\u8868\u7528\u4e8e\u81ea\u589eid\u7684\u83b7\u53d6\uff0c\u7c7b\u4f3cRedis\uff0c\u4f46\u662f\u6027\u80fd\u5dee\u4e8eredis"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u4e3a\u4e86\u589e\u52a0ID\u7684\u5b89\u5168\u6027\uff0c\u6211\u4eec\u53ef\u4ee5\u4e0d\u76f4\u63a5\u4f7f\u7528Redis\u81ea\u589e\u7684\u6570\u503c\uff0c\u800c\u662f\u62fc\u63a5\u4e00\u4e9b\u5176\u5b83\u4fe1\u606f\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Redis\u81ea\u589e\u505a\u5168\u5c40\u552f\u4e00ID\uff1a"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.img,{alt:"1653363172079",src:s(42420).A+"",width:"905",height:"199"}),"ID\u7684"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u7ec4\u6210\u90e8\u5206\uff1a\u7b26\u53f7\u4f4d\uff1a1bit\uff0c\u6c38\u8fdc\u4e3a0"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u65f6\u95f4\u6233\uff1a31bit\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff0c\u53ef\u4ee5\u4f7f\u752869\u5e74"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u5e8f\u5217\u53f7\uff1a32bit\uff0c\u79d2\u5185\u7684\u8ba1\u6570\u5668\uff0c\u652f\u6301\u6bcf\u79d2\u4ea7\u751f2^32^\u4e2a\u4e0d\u540cID"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"32--redis\u5b9e\u73b0\u5168\u5c40\u552f\u4e00id",children:"3.2 -Redis\u5b9e\u73b0\u5168\u5c40\u552f\u4e00Id"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Component\npublic class RedisIdWorker {\n    \n    @Resource\n    private StringRedisTemplate stringRedisTemplate;\n\n    /**\n     * \u5f00\u59cb\u65f6\u95f4\u6233\n     */\n    public static final long BEGIN_TIMESTAMP = 1640995299L;//2021\u5e741\u67081\u65e5\u65f6\u95f4\u6233\n\n    /**\n     * \u5e8f\u5217\u53f7\u7684\u4f4d\u6570\n     */\n    public static final int COUNT_BITS = 32;\n\n    /**\n     * 1\u4f4d\u7b26\u53f7\u4f4d + 31\u4f4d\u65f6\u95f4\u6233 + 32\u4f4d\u5e8f\u5217\u53f7\n     * @param keyPrefix\n     * @return\n     */\n    public long nextId(String keyPrefix) {\n        //1 \u751f\u6210\u65f6\u95f4\u6233\n        LocalDateTime now = LocalDateTime.now();\n        long nowSecond = now.toEpochSecond(ZoneOffset.UTC);\n        long timestamp = nowSecond - BEGIN_TIMESTAMP;\n        \n        //2 \u751f\u6210\u5e8f\u5217\u53f7\n        //2.1 \u83b7\u53d6\u5f53\u524d\u65e5\u671f\uff0c\u7cbe\u786e\u5230\u5929\uff0c\u6bcf\u5929\u4e00\u4e2akey\uff0c\u65b9\u4fbf\u7edf\u8ba1\n        String date = now.format(DateTimeFormatter.ofPattern("yyyy:MM:dd"));\n        //2.2 \u81ea\u589e\u957f\n        long count = stringRedisTemplate.opsForValue().increment("icr:" + keyPrefix + ":" + date);\n\n        //\u62fc\u63a5\u5e76\u8fd4\u56de\n        return timestamp << COUNT_BITS | count;\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u6d4b\u8bd5\u7c7b"}),"\n",(0,r.jsx)(n.p,{children:"\u77e5\u8bc6\u5c0f\u8d34\u58eb\uff1a\u5173\u4e8ecountdownlatch"}),"\n",(0,r.jsx)(n.p,{children:"countdownlatch\u540d\u4e3a\u4fe1\u53f7\u67aa\uff1a\u4e3b\u8981\u7684\u4f5c\u7528\u662f\u540c\u6b65\u534f\u8c03\u5728\u591a\u7ebf\u7a0b\u7684\u7b49\u5f85\u4e8e\u5524\u9192\u95ee\u9898"}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u5982\u679c\u6ca1\u6709CountDownLatch \uff0c\u90a3\u4e48\u7531\u4e8e\u7a0b\u5e8f\u662f\u5f02\u6b65\u7684\uff0c\u5f53\u5f02\u6b65\u7a0b\u5e8f\u6ca1\u6709\u6267\u884c\u5b8c\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u5c31\u5df2\u7ecf\u6267\u884c\u5b8c\u4e86\uff0c\u7136\u540e\u6211\u4eec\u671f\u671b\u7684\u662f\u5206\u7ebf\u7a0b\u5168\u90e8\u8d70\u5b8c\u4e4b\u540e\uff0c\u4e3b\u7ebf\u7a0b\u518d\u8d70\uff0c\u6240\u4ee5\u6211\u4eec\u6b64\u65f6\u9700\u8981\u4f7f\u7528\u5230CountDownLatch"}),"\n",(0,r.jsx)(n.p,{children:"CountDownLatch \u4e2d\u6709\u4e24\u4e2a\u6700\u91cd\u8981\u7684\u65b9\u6cd5"}),"\n",(0,r.jsx)(n.p,{children:"1\u3001countDown"}),"\n",(0,r.jsx)(n.p,{children:"2\u3001await"}),"\n",(0,r.jsx)(n.p,{children:"await \u65b9\u6cd5 \u662f\u963b\u585e\u65b9\u6cd5\uff0c\u6211\u4eec\u62c5\u5fc3\u5206\u7ebf\u7a0b\u6ca1\u6709\u6267\u884c\u5b8c\u65f6\uff0cmain\u7ebf\u7a0b\u5c31\u5148\u6267\u884c\uff0c\u6240\u4ee5\u4f7f\u7528await\u53ef\u4ee5\u8ba9main\u7ebf\u7a0b\u963b\u585e\uff0c\u90a3\u4e48\u4ec0\u4e48\u65f6\u5019main\u7ebf\u7a0b\u4e0d\u518d\u963b\u585e\u5462\uff1f\u5f53CountDownLatch  \u5185\u90e8\u7ef4\u62a4\u7684 \u53d8\u91cf\u53d8\u4e3a0\u65f6\uff0c\u5c31\u4e0d\u518d\u963b\u585e\uff0c\u76f4\u63a5\u653e\u884c\uff0c\u90a3\u4e48\u4ec0\u4e48\u65f6\u5019CountDownLatch   \u7ef4\u62a4\u7684\u53d8\u91cf\u53d8\u4e3a0 \u5462\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8c03\u7528\u4e00\u6b21countDown \uff0c\u5185\u90e8\u53d8\u91cf\u5c31\u51cf\u5c111\uff0c\u6211\u4eec\u8ba9\u5206\u7ebf\u7a0b\u548c\u53d8\u91cf\u7ed1\u5b9a\uff0c \u6267\u884c\u5b8c\u4e00\u4e2a\u5206\u7ebf\u7a0b\u5c31\u51cf\u5c11\u4e00\u4e2a\u53d8\u91cf\uff0c\u5f53\u5206\u7ebf\u7a0b\u5168\u90e8\u8d70\u5b8c\uff0cCountDownLatch \u7ef4\u62a4\u7684\u53d8\u91cf\u5c31\u662f0\uff0c\u6b64\u65f6await\u5c31\u4e0d\u518d\u963b\u585e\uff0c\u7edf\u8ba1\u51fa\u6765\u7684\u65f6\u95f4\u4e5f\u5c31\u662f\u6240\u6709\u5206\u7ebf\u7a0b\u6267\u884c\u5b8c\u540e\u7684\u65f6\u95f4\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Resource\nprivate RedisIdWorker redisIdWorker;\n    \nprivate ExecutorService threadPool = Executors.newFixedThreadPool(500);\n@Test\nvoid testIdWorker() throws InterruptedException {\n    CountDownLatch latch = new CountDownLatch(300);\n\n    Runnable task = () -> {\n        for (int i = 0; i < 100; i++) {\n            long id = redisIdWorker.nextId("order");\n            System.out.println("id = " + id);\n        }\n        latch.countDown();\n    };\n    long begin = System.currentTimeMillis();\n    for (int i = 0; i < 300; i++) {\n        threadPool.submit(task);\n    }\n    latch.await();\n    long end = System.currentTimeMillis();\n    System.out.println("time = " + (end - begin));\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"33-\u6dfb\u52a0\u4f18\u60e0\u5377",children:"3.3 \u6dfb\u52a0\u4f18\u60e0\u5377"}),"\n",(0,r.jsx)(n.p,{children:"\u6bcf\u4e2a\u5e97\u94fa\u90fd\u53ef\u4ee5\u53d1\u5e03\u4f18\u60e0\u5238\uff0c\u5206\u4e3a\u5e73\u4ef7\u5238\u548c\u7279\u4ef7\u5238\u3002\u5e73\u4ef7\u5238\u53ef\u4ee5\u4efb\u610f\u8d2d\u4e70\uff0c\u800c\u7279\u4ef7\u5238\u9700\u8981\u79d2\u6740\u62a2\u8d2d\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653365145124",src:s(5435).A+"",width:"1166",height:"177"})}),"\n",(0,r.jsx)(n.p,{children:"tb_voucher\uff1a\u4f18\u60e0\u5238\u7684\u57fa\u672c\u4fe1\u606f\uff0c\u4f18\u60e0\u91d1\u989d\u3001\u4f7f\u7528\u89c4\u5219\u7b49\ntb_seckill_voucher\uff1a\u4f18\u60e0\u5238\u7684\u5e93\u5b58\u3001\u5f00\u59cb\u62a2\u8d2d\u65f6\u95f4\uff0c\u7ed3\u675f\u62a2\u8d2d\u65f6\u95f4\u3002\u7279\u4ef7\u4f18\u60e0\u5238\u624d\u9700\u8981\u586b\u5199\u8fd9\u4e9b\u4fe1\u606f"}),"\n",(0,r.jsx)(n.p,{children:"\u5e73\u4ef7\u5377\u7531\u4e8e\u4f18\u60e0\u529b\u5ea6\u5e76\u4e0d\u662f\u5f88\u5927\uff0c\u6240\u4ee5\u662f\u53ef\u4ee5\u4efb\u610f\u9886\u53d6"}),"\n",(0,r.jsx)(n.p,{children:"\u800c\u4ee3\u91d1\u5238\u7531\u4e8e\u4f18\u60e0\u529b\u5ea6\u5927\uff0c\u6240\u4ee5\u50cf\u7b2c\u4e8c\u79cd\u5377\uff0c\u5c31\u5f97\u9650\u5236\u6570\u91cf\uff0c\u4ece\u8868\u7ed3\u6784\u4e0a\u4e5f\u80fd\u770b\u51fa\uff0c\u7279\u4ef7\u5377\u9664\u4e86\u5177\u6709\u4f18\u60e0\u5377\u7684\u57fa\u672c\u4fe1\u606f\u4ee5\u5916\uff0c\u8fd8\u5177\u6709\u5e93\u5b58\uff0c\u62a2\u8d2d\u65f6\u95f4\uff0c\u7ed3\u675f\u65f6\u95f4\u7b49\u7b49\u5b57\u6bb5"}),"\n",(0,r.jsx)(n.p,{children:"**\u65b0\u589e\u666e\u901a\u5377\u4ee3\u7801\uff1a  **VoucherController"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@PostMapping\npublic Result addVoucher(@RequestBody Voucher voucher) {\n    voucherService.save(voucher);\n    return Result.ok(voucher.getId());\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u65b0\u589e\u79d2\u6740\u5377\u4ee3\u7801\uff1a"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"VoucherController"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@PostMapping("seckill")\npublic Result addSeckillVoucher(@RequestBody Voucher voucher) {\n    voucherService.addSeckillVoucher(voucher);\n    return Result.ok(voucher.getId());\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"VoucherServiceImpl"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@Override\n@Transactional\npublic void addSeckillVoucher(Voucher voucher) {\n    // \u4fdd\u5b58\u4f18\u60e0\u5238\n    save(voucher);\n    // \u4fdd\u5b58\u79d2\u6740\u4fe1\u606f\n    SeckillVoucher seckillVoucher = new SeckillVoucher();\n    seckillVoucher.setVoucherId(voucher.getId());\n    seckillVoucher.setStock(voucher.getStock());\n    seckillVoucher.setBeginTime(voucher.getBeginTime());\n    seckillVoucher.setEndTime(voucher.getEndTime());\n    seckillVoucherService.save(seckillVoucher);\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528\u5de5\u5177\u4fdd\u5b58\u4e00\u4e2a\u4f18\u60e0\u5238"}),"\n",(0,r.jsxs)(n.p,{children:["POST\uff1a",(0,r.jsx)(n.a,{href:"http://localhost:8081/voucher/seckill",children:"http://localhost:8081/voucher/seckill"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'{\n  "shopId": 1,\n  "title": "100\u5143\u4ee3\u91d1\u5238",\n  "subTitle": "\u5468\u4e00\u81f3\u5468\u4e94\u5747\u53ef\u4f7f\u7528",\n  "rules": "\u5168\u573a\u901a\u7528\\\\n\u65e0\u9700\u9884\u7ea6\\\\n\u4ec5\u9650\u5802\u98df",\n  "payValue": 8000,\n  "actualValue": 10000,\n  "type": 1,\n  "stock": 100,\n  "beginTime": "2023-09-26T10:09:17",\n  "endTime": "2023-10-26T23:09:04" \n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"34-\u5b9e\u73b0\u79d2\u6740\u4e0b\u5355",children:"3.4 \u5b9e\u73b0\u79d2\u6740\u4e0b\u5355"}),"\n",(0,r.jsx)(n.p,{children:"\u4e0b\u5355\u6838\u5fc3\u601d\u8def\uff1a\u5f53\u6211\u4eec\u70b9\u51fb\u62a2\u8d2d\u65f6\uff0c\u4f1a\u89e6\u53d1\u53f3\u4fa7\u7684\u8bf7\u6c42\uff0c\u6211\u4eec\u53ea\u9700\u8981\u7f16\u5199\u5bf9\u5e94\u7684controller\u5373\u53ef"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653365839526",src:s(71853).A+"",width:"1417",height:"699"})}),"\n",(0,r.jsx)(n.p,{children:"\u79d2\u6740\u4e0b\u5355\u5e94\u8be5\u601d\u8003\u7684\u5185\u5bb9\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"\u4e0b\u5355\u65f6\u9700\u8981\u5224\u65ad\u4e24\u70b9\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u79d2\u6740\u662f\u5426\u5f00\u59cb\u6216\u7ed3\u675f\uff0c\u5982\u679c\u5c1a\u672a\u5f00\u59cb\u6216\u5df2\u7ecf\u7ed3\u675f\u5219\u65e0\u6cd5\u4e0b\u5355"}),"\n",(0,r.jsx)(n.li,{children:"\u5e93\u5b58\u662f\u5426\u5145\u8db3\uff0c\u4e0d\u8db3\u5219\u65e0\u6cd5\u4e0b\u5355"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u4e0b\u5355\u6838\u5fc3\u903b\u8f91\u5206\u6790\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"\u5f53\u7528\u6237\u5f00\u59cb\u8fdb\u884c\u4e0b\u5355\uff0c\u6211\u4eec\u5e94\u5f53\u53bb\u67e5\u8be2\u4f18\u60e0\u5377\u4fe1\u606f\uff0c\u67e5\u8be2\u5230\u4f18\u60e0\u5377\u4fe1\u606f\uff0c\u5224\u65ad\u662f\u5426\u6ee1\u8db3\u79d2\u6740\u6761\u4ef6"}),"\n",(0,r.jsx)(n.p,{children:"\u6bd4\u5982\u65f6\u95f4\u662f\u5426\u5145\u8db3\uff0c\u5982\u679c\u65f6\u95f4\u5145\u8db3\uff0c\u5219\u8fdb\u4e00\u6b65\u5224\u65ad\u5e93\u5b58\u662f\u5426\u8db3\u591f\uff0c\u5982\u679c\u4e24\u8005\u90fd\u6ee1\u8db3\uff0c\u5219\u6263\u51cf\u5e93\u5b58\uff0c\u521b\u5efa\u8ba2\u5355\uff0c\u7136\u540e\u8fd4\u56de\u8ba2\u5355id\uff0c\u5982\u679c\u6709\u4e00\u4e2a\u6761\u4ef6\u4e0d\u6ee1\u8db3\u5219\u76f4\u63a5\u7ed3\u675f\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653366238564",src:s(15405).A+"",width:"896",height:"509"})}),"\n",(0,r.jsx)(n.p,{children:"VoucherOrderServiceImpl"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Override\n@Transactional\npublic Result seckillVoucher(Long voucherId) {\n    // 1.\u67e5\u8be2\u4f18\u60e0\u5238\n    SeckillVoucher voucher = seckillVoucherService.getById(voucherId);\n    // 2.\u5224\u65ad\u79d2\u6740\u662f\u5426\u5f00\u59cb\n    if (voucher.getBeginTime().isAfter(LocalDateTime.now())) {\n        // \u5c1a\u672a\u5f00\u59cb\n        return Result.fail("\u79d2\u6740\u5c1a\u672a\u5f00\u59cb\uff01");\n    }\n    // 3.\u5224\u65ad\u79d2\u6740\u662f\u5426\u5df2\u7ecf\u7ed3\u675f\n    if (voucher.getEndTime().isBefore(LocalDateTime.now())) {\n        // \u5c1a\u672a\u5f00\u59cb\n        return Result.fail("\u79d2\u6740\u5df2\u7ecf\u7ed3\u675f\uff01");\n    }\n    // 4.\u5224\u65ad\u5e93\u5b58\u662f\u5426\u5145\u8db3\n    if (voucher.getStock() < 1) {\n        // \u5e93\u5b58\u4e0d\u8db3\n        return Result.fail("\u5e93\u5b58\u4e0d\u8db3\uff01");\n    }\n    //5\uff0c\u6263\u51cf\u5e93\u5b58\n    boolean success = seckillVoucherService.update()\n            .setSql("stock= stock -1")\n            .eq("voucher_id", voucherId).update();\n    if (!success) {\n        //\u6263\u51cf\u5e93\u5b58\n        return Result.fail("\u5e93\u5b58\u4e0d\u8db3\uff01");\n    }\n    //6.\u521b\u5efa\u8ba2\u5355\n    VoucherOrder voucherOrder = new VoucherOrder();\n    // 6.1.\u8ba2\u5355id\n    long orderId = redisIdWorker.nextId("order");\n    voucherOrder.setId(orderId);\n    // 6.2.\u7528\u6237id\n    Long userId = UserHolder.getUser().getId();\n    voucherOrder.setUserId(userId);\n    // 6.3.\u4ee3\u91d1\u5238id\n    voucherOrder.setVoucherId(voucherId);\n    save(voucherOrder);\n\n    return Result.ok(orderId);\n\n}\n'})}),"\n",(0,r.jsxs)(n.h2,{id:"35-\u5e93\u5b58\u8d85\u5356\u95ee\u9898\u5206\u6790",children:["3.5 ",(0,r.jsx)(n.strong,{children:"\u5e93\u5b58\u8d85\u5356"}),"\u95ee\u9898\u5206\u6790"]}),"\n",(0,r.jsx)(n.p,{children:"\u6709\u5173\u8d85\u5356\u95ee\u9898\u5206\u6790\uff1a\u5728\u6211\u4eec\u539f\u6709\u4ee3\u7801\u4e2d\u662f\u8fd9\u4e48\u5199\u7684"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'if (voucher.getStock() < 1) {\n    // \u5e93\u5b58\u4e0d\u8db3\n    return Result.fail("\u5e93\u5b58\u4e0d\u8db3\uff01");\n}\n//5\uff0c\u6263\u51cf\u5e93\u5b58\nboolean success = seckillVoucherService.update()\n        .setSql("stock= stock -1")\n        .eq("voucher_id", voucherId).update();\nif (!success) {\n    //\u6263\u51cf\u5e93\u5b58\n    return Result.fail("\u5e93\u5b58\u4e0d\u8db3\uff01");\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u5047\u8bbe\u7ebf\u7a0b1\u8fc7\u6765\u67e5\u8be2\u5e93\u5b58\uff0c\u5224\u65ad\u51fa\u6765\u5e93\u5b58\u5927\u4e8e1\uff0c\u6b63\u51c6\u5907\u53bb\u6263\u51cf\u5e93\u5b58\uff0c\u4f46\u662f\u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u53bb\u6263\u51cf\uff0c\u6b64\u65f6\u7ebf\u7a0b2\u8fc7\u6765\uff0c\u7ebf\u7a0b2\u4e5f\u53bb\u67e5\u8be2\u5e93\u5b58\uff0c\u53d1\u73b0\u8fd9\u4e2a\u6570\u91cf\u4e00\u5b9a\u4e5f\u5927\u4e8e1\uff0c\u90a3\u4e48\u8fd9\u4e24\u4e2a\u7ebf\u7a0b\u90fd\u4f1a\u53bb\u6263\u51cf\u5e93\u5b58\uff0c\u6700\u7ec8\u591a\u4e2a\u7ebf\u7a0b\u76f8\u5f53\u4e8e\u4e00\u8d77\u53bb\u6263\u51cf\u5e93\u5b58\uff0c\u6b64\u65f6\u5c31\u4f1a\u51fa\u73b0\u5e93\u5b58\u7684\u8d85\u5356\u95ee\u9898\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653368335155",src:s(24651).A+"",width:"1399",height:"709"})}),"\n",(0,r.jsx)(n.p,{children:"\u8d85\u5356\u95ee\u9898\u662f\u5178\u578b\u7684\u591a\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\uff0c\u9488\u5bf9\u8fd9\u4e00\u95ee\u9898\u7684\u5e38\u89c1\u89e3\u51b3\u65b9\u6848\u5c31\u662f\u52a0\u9501\uff1a\u800c\u5bf9\u4e8e\u52a0\u9501\uff0c\u6211\u4eec\u901a\u5e38\u6709\u4e24\u79cd\u89e3\u51b3\u65b9\u6848\uff1a\u89c1\u4e0b\u56fe\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653368562591",src:s(4101).A+"",width:"993",height:"418"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u60b2\u89c2\u9501\uff1a"})}),"\n",(0,r.jsx)(n.p,{children:"\u60b2\u89c2\u9501\u53ef\u4ee5\u5b9e\u73b0\u5bf9\u4e8e\u6570\u636e\u7684\u4e32\u884c\u5316\u6267\u884c\uff0c\u6bd4\u5982syn\uff0c\u548clock\u90fd\u662f\u60b2\u89c2\u9501\u7684\u4ee3\u8868\uff0c\u540c\u65f6\uff0c\u60b2\u89c2\u9501\u4e2d\u53c8\u53ef\u4ee5\u518d\u7ec6\u5206\u4e3a\u516c\u5e73\u9501\uff0c\u975e\u516c\u5e73\u9501\uff0c\u53ef\u91cd\u5165\u9501\uff0c\u7b49\u7b49"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u4e50\u89c2\u9501\uff1a"})}),"\n",(0,r.jsx)(n.p,{children:"\u4e50\u89c2\u9501\uff1a\u4f1a\u6709\u4e00\u4e2a\u7248\u672c\u53f7\uff0c\u6bcf\u6b21\u64cd\u4f5c\u6570\u636e\u4f1a\u5bf9\u7248\u672c\u53f7+1\uff0c\u518d\u63d0\u4ea4\u56de\u6570\u636e\u65f6\uff0c\u4f1a\u53bb\u6821\u9a8c\u662f\u5426\u6bd4\u4e4b\u524d\u7684\u7248\u672c\u59271 \uff0c\u5982\u679c\u59271 \uff0c\u5219\u8fdb\u884c\u64cd\u4f5c\u6210\u529f\uff0c\u8fd9\u5957\u673a\u5236\u7684\u6838\u5fc3\u903b\u8f91\u5728\u4e8e\uff0c\u5982\u679c\u5728\u64cd\u4f5c\u8fc7\u7a0b\u4e2d\uff0c\u7248\u672c\u53f7\u53ea\u6bd4\u539f\u6765\u59271 \uff0c\u90a3\u4e48\u5c31\u610f\u5473\u7740\u64cd\u4f5c\u8fc7\u7a0b\u4e2d\u6ca1\u6709\u4eba\u5bf9\u4ed6\u8fdb\u884c\u8fc7\u4fee\u6539\uff0c\u4ed6\u7684\u64cd\u4f5c\u5c31\u662f\u5b89\u5168\u7684\uff0c\u5982\u679c\u4e0d\u59271\uff0c\u5219\u6570\u636e\u88ab\u4fee\u6539\u8fc7\uff0c\u5f53\u7136\u4e50\u89c2\u9501\u8fd8\u6709\u4e00\u4e9b\u53d8\u79cd\u7684\u5904\u7406\u65b9\u5f0f\u6bd4\u5982cas"}),"\n",(0,r.jsx)(n.p,{children:"\u4e50\u89c2\u9501\u7684\u5178\u578b\u4ee3\u8868\uff1a\u5c31\u662fcas\uff0c\u5229\u7528cas\u8fdb\u884c\u65e0\u9501\u5316\u673a\u5236\u52a0\u9501\uff0cvar5 \u662f\u64cd\u4f5c\u524d\u8bfb\u53d6\u7684\u5185\u5b58\u503c\uff0cwhile\u4e2d\u7684var1+var2 \u662f\u9884\u4f30\u503c\uff0c\u5982\u679c\u9884\u4f30\u503c == \u5185\u5b58\u503c\uff0c\u5219\u4ee3\u8868\u4e2d\u95f4\u6ca1\u6709\u88ab\u4eba\u4fee\u6539\u8fc7\uff0c\u6b64\u65f6\u5c31\u5c06\u65b0\u503c\u53bb\u66ff\u6362 \u5185\u5b58\u503c"}),"\n",(0,r.jsx)(n.p,{children:"\u5176\u4e2ddo while \u662f\u4e3a\u4e86\u5728\u64cd\u4f5c\u5931\u8d25\u65f6\uff0c\u518d\u6b21\u8fdb\u884c\u81ea\u65cb\u64cd\u4f5c\uff0c\u5373\u628a\u4e4b\u524d\u7684\u903b\u8f91\u518d\u64cd\u4f5c\u4e00\u6b21\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"int var5;\ndo {\n    var5 = this.getIntVolatile(var1, var2);\n} while(!this.compareAndSwapInt(var1, var2, var5, var5 + var4));\n\nreturn var5;\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u8bfe\u7a0b\u4e2d\u7684\u4f7f\u7528\u65b9\u5f0f\uff1a"})}),"\n",(0,r.jsx)(n.p,{children:"\u8bfe\u7a0b\u4e2d\u7684\u4f7f\u7528\u65b9\u5f0f\u662f\u6ca1\u6709\u50cfcas\u4e00\u6837\u5e26\u81ea\u65cb\u7684\u64cd\u4f5c\uff0c\u4e5f\u6ca1\u6709\u5bf9version\u7684\u7248\u672c\u53f7+1 \uff0c\u4ed6\u7684\u64cd\u4f5c\u903b\u8f91\u662f\u5728\u64cd\u4f5c\u65f6\uff0c\u5bf9\u7248\u672c\u53f7\u8fdb\u884c+1 \u64cd\u4f5c\uff0c\u7136\u540e\u8981\u6c42version \u5982\u679c\u662f1 \u7684\u60c5\u51b5\u4e0b\uff0c\u624d\u80fd\u64cd\u4f5c\uff0c\u90a3\u4e48\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u5728\u64cd\u4f5c\u540e\uff0c\u6570\u636e\u5e93\u4e2d\u7684version\u53d8\u6210\u4e862\uff0c\u4f46\u662f\u4ed6\u81ea\u5df1\u6ee1\u8db3version=1 \uff0c\u6240\u4ee5\u6ca1\u6709\u95ee\u9898\uff0c\u6b64\u65f6\u7ebf\u7a0b2\u6267\u884c\uff0c\u7ebf\u7a0b2 \u6700\u540e\u4e5f\u9700\u8981\u52a0\u4e0a\u6761\u4ef6version =1 \uff0c\u4f46\u662f\u73b0\u5728\u7531\u4e8e\u7ebf\u7a0b1\u5df2\u7ecf\u64cd\u4f5c\u8fc7\u4e86\uff0c\u6240\u4ee5\u7ebf\u7a0b2\uff0c\u64cd\u4f5c\u65f6\u5c31\u4e0d\u6ee1\u8db3version=1 \u7684\u6761\u4ef6\u4e86\uff0c\u6240\u4ee5\u7ebf\u7a0b2\u65e0\u6cd5\u6267\u884c\u6210\u529f"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653369268550",src:s(73382).A+"",width:"1598",height:"697"})}),"\n",(0,r.jsx)(n.h2,{id:"36-\u4e50\u89c2\u9501\u89e3\u51b3\u8d85\u5356\u95ee\u9898",children:"3.6 \u4e50\u89c2\u9501\u89e3\u51b3\u8d85\u5356\u95ee\u9898"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u4fee\u6539\u4ee3\u7801\u65b9\u6848\u4e00\u3001"})}),"\n",(0,r.jsx)(n.p,{children:"VoucherOrderServiceImpl \u5728\u6263\u51cf\u5e93\u5b58\u65f6\uff0c\u6539\u4e3a\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'boolean success = seckillVoucherService.update()\n            .setSql("stock= stock -1") //set stock = stock -1\n            .eq("voucher_id", voucherId).eq("stock",voucher.getStock()).update(); //where id = \uff1f and stock = ?\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u4ee5\u4e0a\u903b\u8f91\u7684\u6838\u5fc3\u542b\u4e49\u662f\uff1a\u53ea\u8981\u6211\u6263\u51cf\u5e93\u5b58\u65f6\u7684\u5e93\u5b58\u548c\u4e4b\u524d\u6211\u67e5\u8be2\u5230\u7684\u5e93\u5b58\u662f\u4e00\u6837\u7684\uff0c\u5c31\u610f\u5473\u7740\u6ca1\u6709\u4eba\u5728\u4e2d\u95f4\u4fee\u6539\u8fc7\u5e93\u5b58\uff0c\u90a3\u4e48\u6b64\u65f6\u5c31\u662f\u5b89\u5168\u7684\uff0c\u4f46\u662f\u4ee5\u4e0a\u8fd9\u79cd\u65b9\u5f0f\u901a\u8fc7\u6d4b\u8bd5\u53d1\u73b0\u4f1a\u6709\u5f88\u591a\u5931\u8d25\u7684\u60c5\u51b5\uff0c\u5931\u8d25\u7684\u539f\u56e0\u5728\u4e8e\uff1a\u5728\u4f7f\u7528\u4e50\u89c2\u9501\u8fc7\u7a0b\u4e2d\u5047\u8bbe100\u4e2a\u7ebf\u7a0b\u540c\u65f6\u90fd\u62ff\u5230\u4e86100\u7684\u5e93\u5b58\uff0c\u7136\u540e\u5927\u5bb6\u4e00\u8d77\u53bb\u8fdb\u884c\u6263\u51cf\uff0c\u4f46\u662f100\u4e2a\u4eba\u4e2d\u53ea\u67091\u4e2a\u4eba\u80fd\u6263\u51cf\u6210\u529f\uff0c\u5176\u4ed6\u7684\u4eba\u5728\u5904\u7406\u65f6\uff0c\u4ed6\u4eec\u5728\u6263\u51cf\u65f6\uff0c\u5e93\u5b58\u5df2\u7ecf\u88ab\u4fee\u6539\u8fc7\u4e86\uff0c\u6240\u4ee5\u6b64\u65f6\u5176\u4ed6\u7ebf\u7a0b\u90fd\u4f1a\u5931\u8d25"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u6539\u8fdb\uff1a\u4fee\u6539\u4ee3\u7801\u65b9\u6848\u4e8c\u3001"})}),"\n",(0,r.jsxs)(n.p,{children:["\u4e4b\u524d\u7684\u65b9\u5f0f\u8981\u4fee\u6539\u524d\u540e\u90fd\u4fdd\u6301\u4e00\u81f4\uff0c\u4f46\u662f\u8fd9\u6837\u6211\u4eec\u5206\u6790\u8fc7\uff0c",(0,r.jsx)(n.strong,{children:"\u6210\u529f\u7684\u6982\u7387\u592a\u4f4e"}),"\uff0c\u6240\u4ee5\u6211\u4eec\u7684\u4e50\u89c2\u9501\u9700\u8981\u53d8\u4e00\u4e0b\uff0c\u6539\u6210stock\u5927\u4e8e0 \u5373\u53ef"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'boolean success = seckillVoucherService.update()\n            .setSql("stock= stock -1")\n            .eq("voucher_id", voucherId).gt("stock",0).update(); //where id = ? and stock > 0\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u6d4b\u8bd5\uff1a"})}),"\n",(0,r.jsxs)(n.p,{children:["\u4f7f\u7528jemeter\uff0c200\u7ebf\u7a0b\uff0cPOST\uff1a",(0,r.jsx)(n.a,{href:"http://localhost:8081/voucher-order/seckill/7",children:"http://localhost:8081/voucher-order/seckill/7"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u77e5\u8bc6\u5c0f\u6269\u5c55\uff1a"})}),"\n",(0,r.jsx)(n.p,{children:"\u9488\u5bf9cas\u4e2d\u7684\u81ea\u65cb\u538b\u529b\u8fc7\u5927\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528Longaddr\u8fd9\u4e2a\u7c7b\u53bb\u89e3\u51b3"}),"\n",(0,r.jsx)(n.p,{children:"Java8 \u63d0\u4f9b\u7684\u4e00\u4e2a\u5bf9AtomicLong\u6539\u8fdb\u540e\u7684\u4e00\u4e2a\u7c7b\uff0cLongAdder"}),"\n",(0,r.jsx)(n.p,{children:"\u5927\u91cf\u7ebf\u7a0b\u5e76\u53d1\u66f4\u65b0\u4e00\u4e2a\u539f\u5b50\u6027\u7684\u65f6\u5019\uff0c\u5929\u7136\u7684\u95ee\u9898\u5c31\u662f\u81ea\u65cb\uff0c\u4f1a\u5bfc\u81f4\u5e76\u53d1\u6027\u95ee\u9898\uff0c\u5f53\u7136\u8fd9\u4e5f\u6bd4\u6211\u4eec\u76f4\u63a5\u4f7f\u7528syn\u6765\u7684\u597d"}),"\n",(0,r.jsx)(n.p,{children:"\u6240\u4ee5\u5229\u7528\u8fd9\u4e48\u4e00\u4e2a\u7c7b\uff0cLongAdder\u6765\u8fdb\u884c\u4f18\u5316"}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u83b7\u53d6\u67d0\u4e2a\u503c\uff0c\u5219\u4f1a\u5bf9cell\u548cbase\u7684\u503c\u8fdb\u884c\u9012\u589e\uff0c\u6700\u540e\u8fd4\u56de\u4e00\u4e2a\u5b8c\u6574\u7684\u503c"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653370271627",src:s(41391).A+"",width:"1175",height:"424"})}),"\n",(0,r.jsxs)(n.h2,{id:"36-\u5355\u673a\u4f18\u60e0\u5238\u79d2\u6740-\u4e00\u4eba\u4e00\u5355",children:["3.6 \u5355\u673a\u4f18\u60e0\u5238\u79d2\u6740-",(0,r.jsx)(n.strong,{children:"\u4e00\u4eba\u4e00\u5355"})]}),"\n",(0,r.jsx)(n.p,{children:"\u9700\u6c42\uff1a\u4fee\u6539\u79d2\u6740\u4e1a\u52a1\uff0c\u8981\u6c42\u540c\u4e00\u4e2a\u4f18\u60e0\u5238\uff0c\u4e00\u4e2a\u7528\u6237\u53ea\u80fd\u4e0b\u4e00\u5355"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u73b0\u5728\u7684\u95ee\u9898\u5728\u4e8e\uff1a"})}),"\n",(0,r.jsx)(n.p,{children:"\u4f18\u60e0\u5377\u662f\u4e3a\u4e86\u5f15\u6d41\uff0c\u4f46\u662f\u76ee\u524d\u7684\u60c5\u51b5\u662f\uff0c\u4e00\u4e2a\u4eba\u53ef\u4ee5\u65e0\u9650\u5236\u7684\u62a2\u8fd9\u4e2a\u4f18\u60e0\u5377\uff0c\u6240\u4ee5\u6211\u4eec\u5e94\u5f53\u589e\u52a0\u4e00\u5c42\u903b\u8f91\uff0c\u8ba9\u4e00\u4e2a\u7528\u6237\u53ea\u80fd\u4e0b\u4e00\u4e2a\u5355\uff0c\u800c\u4e0d\u662f\u8ba9\u4e00\u4e2a\u7528\u6237\u4e0b\u591a\u4e2a\u5355"}),"\n",(0,r.jsx)(n.p,{children:"\u5177\u4f53\u64cd\u4f5c\u903b\u8f91\u5982\u4e0b\uff1a\u6bd4\u5982\u65f6\u95f4\u662f\u5426\u5145\u8db3\uff0c\u5982\u679c\u65f6\u95f4\u5145\u8db3\uff0c\u5219\u8fdb\u4e00\u6b65\u5224\u65ad\u5e93\u5b58\u662f\u5426\u8db3\u591f\uff0c\u7136\u540e\u518d\u6839\u636e\u4f18\u60e0\u5377id\u548c\u7528\u6237id\u67e5\u8be2\u662f\u5426\u5df2\u7ecf\u4e0b\u8fc7\u8fd9\u4e2a\u8ba2\u5355\uff0c\u5982\u679c\u4e0b\u8fc7\u8fd9\u4e2a\u8ba2\u5355\uff0c\u5219\u4e0d\u518d\u4e0b\u5355\uff0c\u5426\u5219\u8fdb\u884c\u4e0b\u5355"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653371854389",src:s(36632).A+"",width:"1216",height:"587"})}),"\n",(0,r.jsx)(n.p,{children:"VoucherOrderServiceImpl"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u521d\u6b65\u4ee3\u7801\uff1a\u589e\u52a0\u4e00\u4eba\u4e00\u5355\u903b\u8f91"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Override\n@Transactional\npublic Result seckillVoucher(Long voucherId) {\n    // 1.\u67e5\u8be2\u4f18\u60e0\u5238\n    SeckillVoucher voucher = seckillVoucherService.getById(voucherId);\n    // 2.\u5224\u65ad\u79d2\u6740\u662f\u5426\u5f00\u59cb\n    if (voucher.getBeginTime().isAfter(LocalDateTime.now())) {\n        // \u5c1a\u672a\u5f00\u59cb\n        return Result.fail("\u79d2\u6740\u5c1a\u672a\u5f00\u59cb\uff01");\n    }\n    // 3.\u5224\u65ad\u79d2\u6740\u662f\u5426\u5df2\u7ecf\u7ed3\u675f\n    if (voucher.getEndTime().isBefore(LocalDateTime.now())) {\n        // \u5c1a\u672a\u5f00\u59cb\n        return Result.fail("\u79d2\u6740\u5df2\u7ecf\u7ed3\u675f\uff01");\n    }\n    // 4.\u5224\u65ad\u5e93\u5b58\u662f\u5426\u5145\u8db3\n    if (voucher.getStock() < 1) {\n        // \u5e93\u5b58\u4e0d\u8db3\n        return Result.fail("\u5e93\u5b58\u4e0d\u8db3\uff01");\n    }\n    // 5.\u4e00\u4eba\u4e00\u5355\u903b\u8f91\n    // 5.1.\u7528\u6237id\n    Long userId = UserHolder.getUser().getId();\n    int count = query().eq("user_id", userId).eq("voucher_id", voucherId).count();\n    // 5.2.\u5224\u65ad\u662f\u5426\u5b58\u5728\n    if (count > 0) {\n        // \u7528\u6237\u5df2\u7ecf\u8d2d\u4e70\u8fc7\u4e86\n        return Result.fail("\u7528\u6237\u5df2\u7ecf\u8d2d\u4e70\u8fc7\u4e00\u6b21\uff01");\n    }\n\n    //6\uff0c\u6263\u51cf\u5e93\u5b58\n    boolean success = seckillVoucherService.update()\n            .setSql("stock= stock -1")\n            .eq("voucher_id", voucherId).update();\n    if (!success) {\n        //\u6263\u51cf\u5e93\u5b58\n        return Result.fail("\u5e93\u5b58\u4e0d\u8db3\uff01");\n    }\n    //7.\u521b\u5efa\u8ba2\u5355\n    VoucherOrder voucherOrder = new VoucherOrder();\n    // 7.1.\u8ba2\u5355id\n    long orderId = redisIdWorker.nextId("order");\n    voucherOrder.setId(orderId);\n\n    voucherOrder.setUserId(userId);\n    // 7.3.\u4ee3\u91d1\u5238id\n    voucherOrder.setVoucherId(voucherId);\n    save(voucherOrder);\n\n    return Result.ok(orderId);\n\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"**\u5b58\u5728\u95ee\u9898\uff1a**\u73b0\u5728\u7684\u95ee\u9898\u8fd8\u662f\u548c\u4e4b\u524d\u4e00\u6837\uff0c\u5e76\u53d1\u8fc7\u6765\uff0c\u67e5\u8be2\u6570\u636e\u5e93\uff0c\u90fd\u4e0d\u5b58\u5728\u8ba2\u5355\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u662f\u9700\u8981\u52a0\u9501\uff0c\u4f46\u662f\u4e50\u89c2\u9501\u6bd4\u8f83\u9002\u5408\u66f4\u65b0\u6570\u636e\uff0c\u800c\u73b0\u5728\u662f\u63d2\u5165\u6570\u636e\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4f7f\u7528\u60b2\u89c2\u9501\u64cd\u4f5c"}),"\n",(0,r.jsx)(n.p,{children:"**\u6ce8\u610f\uff1a**\u5728\u8fd9\u91cc\u63d0\u5230\u4e86\u975e\u5e38\u591a\u7684\u95ee\u9898\uff0c\u6211\u4eec\u9700\u8981\u6162\u6162\u7684\u6765\u601d\u8003\uff0c\u9996\u5148\u6211\u4eec\u7684\u521d\u59cb\u65b9\u6848\u662f\u5c01\u88c5\u4e86\u4e00\u4e2acreateVoucherOrder\u65b9\u6cd5\uff0c\u540c\u65f6\u4e3a\u4e86\u786e\u4fdd\u4ed6\u7ebf\u7a0b\u5b89\u5168\uff0c\u5728\u65b9\u6cd5\u4e0a\u6dfb\u52a0\u4e86\u4e00\u628asynchronized \u9501"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Transactional\npublic synchronized Result createVoucherOrder(Long voucherId) {\n\n\tLong userId = UserHolder.getUser().getId();\n         // 5.1.\u67e5\u8be2\u8ba2\u5355\n        int count = query().eq("user_id", userId).eq("voucher_id", voucherId).count();\n        // 5.2.\u5224\u65ad\u662f\u5426\u5b58\u5728\n        if (count > 0) {\n            // \u7528\u6237\u5df2\u7ecf\u8d2d\u4e70\u8fc7\u4e86\n            return Result.fail("\u7528\u6237\u5df2\u7ecf\u8d2d\u4e70\u8fc7\u4e00\u6b21\uff01");\n        }\n\n        // 6.\u6263\u51cf\u5e93\u5b58\n        boolean success = seckillVoucherService.update()\n                .setSql("stock = stock - 1") // set stock = stock - 1\n                .eq("voucher_id", voucherId).gt("stock", 0) // where id = ? and stock > 0\n                .update();\n        if (!success) {\n            // \u6263\u51cf\u5931\u8d25\n            return Result.fail("\u5e93\u5b58\u4e0d\u8db3\uff01");\n        }\n\n        // 7.\u521b\u5efa\u8ba2\u5355\n        VoucherOrder voucherOrder = new VoucherOrder();\n        // 7.1.\u8ba2\u5355id\n        long orderId = redisIdWorker.nextId("order");\n        voucherOrder.setId(orderId);\n        // 7.2.\u7528\u6237id\n        voucherOrder.setUserId(userId);\n        // 7.3.\u4ee3\u91d1\u5238id\n        voucherOrder.setVoucherId(voucherId);\n        save(voucherOrder);\n\n        // 7.\u8fd4\u56de\u8ba2\u5355id\n        return Result.ok(orderId);\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\uff0c\u4f46\u662f\u8fd9\u6837\u6dfb\u52a0\u9501\uff0c\u9501\u7684\u7c92\u5ea6\u592a\u7c97\u4e86\uff0c\u5728\u4f7f\u7528\u9501\u8fc7\u7a0b\u4e2d\uff0c\u63a7\u5236",(0,r.jsx)(n.strong,{children:"\u9501\u7c92\u5ea6"})," \u662f\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u4e8b\u60c5\uff0c\u56e0\u4e3a\u5982\u679c\u9501\u7684\u7c92\u5ea6\u592a\u5927\uff0c\u4f1a\u5bfc\u81f4\u6bcf\u4e2a\u7ebf\u7a0b\u8fdb\u6765\u90fd\u4f1a\u9501\u4f4f\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u53bb\u63a7\u5236\u9501\u7684\u7c92\u5ea6\uff0c\u4ee5\u4e0b\u8fd9\u6bb5\u4ee3\u7801\u9700\u8981\u4fee\u6539\u4e3a\uff1a\nintern() \u8fd9\u4e2a\u65b9\u6cd5\u662f\u4ece\u5e38\u91cf\u6c60\u4e2d\u62ff\u5230\u6570\u636e\uff0c\u5982\u679c\u6211\u4eec\u76f4\u63a5\u4f7f\u7528userId.toString() \u4ed6\u62ff\u5230\u7684\u5bf9\u8c61\u5b9e\u9645\u4e0a\u662f\u4e0d\u540c\u7684\u5bf9\u8c61\uff0cnew\u51fa\u6765\u7684\u5bf9\u8c61\uff0c\u6211\u4eec\u4f7f\u7528\u9501\u5fc5\u987b\u4fdd\u8bc1\u9501\u5fc5\u987b\u662f\u540c\u4e00\u628a\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4f7f\u7528**intern()**\u65b9\u6cd5"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Transactional\npublic  Result createVoucherOrder(Long voucherId) {\n\tLong userId = UserHolder.getUser().getId();\n\tsynchronized(userId.toString().intern()){\n         // 5.1.\u67e5\u8be2\u8ba2\u5355\n        int count = query().eq("user_id", userId).eq("voucher_id", voucherId).count();\n        // 5.2.\u5224\u65ad\u662f\u5426\u5b58\u5728\n        if (count > 0) {\n            // \u7528\u6237\u5df2\u7ecf\u8d2d\u4e70\u8fc7\u4e86\n            return Result.fail("\u7528\u6237\u5df2\u7ecf\u8d2d\u4e70\u8fc7\u4e00\u6b21\uff01");\n        }\n\n        // 6.\u6263\u51cf\u5e93\u5b58\n        boolean success = seckillVoucherService.update()\n                .setSql("stock = stock - 1") // set stock = stock - 1\n                .eq("voucher_id", voucherId).gt("stock", 0) // where id = ? and stock > 0\n                .update();\n        if (!success) {\n            // \u6263\u51cf\u5931\u8d25\n            return Result.fail("\u5e93\u5b58\u4e0d\u8db3\uff01");\n        }\n\n        // 7.\u521b\u5efa\u8ba2\u5355\n        VoucherOrder voucherOrder = new VoucherOrder();\n        // 7.1.\u8ba2\u5355id\n        long orderId = redisIdWorker.nextId("order");\n        voucherOrder.setId(orderId);\n        // 7.2.\u7528\u6237id\n        voucherOrder.setUserId(userId);\n        // 7.3.\u4ee3\u91d1\u5238id\n        voucherOrder.setVoucherId(voucherId);\n        save(voucherOrder);\n\n        // 7.\u8fd4\u56de\u8ba2\u5355id\n        return Result.ok(orderId);\n    }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u4f46\u662f\u4ee5\u4e0a\u4ee3\u7801\u8fd8\u662f\u5b58\u5728\u95ee\u9898\uff0c\u95ee\u9898\u7684\u539f\u56e0\u5728\u4e8e\u5f53\u524d\u65b9\u6cd5\u88abspring\u7684\u4e8b\u52a1\u63a7\u5236\uff0c",(0,r.jsx)(n.strong,{children:"\u5982\u679c\u4f60\u5728\u65b9\u6cd5\u5185\u90e8\u52a0\u9501\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5f53\u524d\u65b9\u6cd5\u4e8b\u52a1\u8fd8\u6ca1\u6709\u63d0\u4ea4\uff0c\u4f46\u662f\u9501\u5df2\u7ecf\u91ca\u653e\uff0c\u5176\u5b83\u7528\u6237\u83b7\u5f97\u5230\u9501\u65f6\u4e8b\u52a1\u8fd8\u672a\u63d0\u4ea4\uff0c\u5bfc\u81f4\u6570\u636e\u5e93\u4e2d\u5e76\u6ca1\u6709\u63d2\u5165\u8ba2\u5355"}),"\uff0c\u4e5f\u4f1a\u5bfc\u81f4\u95ee\u9898\uff0c\u6240\u4ee5\u6211\u4eec\u9009\u62e9\u5c06\u5f53\u524d\u65b9\u6cd5\u6574\u4f53\u5305\u88f9\u8d77\u6765\uff0c\u786e\u4fdd\u4e8b\u52a1\u4e0d\u4f1a\u51fa\u73b0\u95ee\u9898\uff1a\u5982\u4e0b\uff1a"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5728seckillVoucher \u65b9\u6cd5\u4e2d\uff0c\u6dfb\u52a0\u4ee5\u4e0b\u903b\u8f91\uff0c\u8fd9\u6837\u5c31\u80fd\u4fdd\u8bc1\u4e8b\u52a1\u7684\u7279\u6027\uff0c\u540c\u65f6\u4e5f\u63a7\u5236\u4e86\u9501\u7684\u7c92\u5ea6\uff0c",(0,r.jsx)(n.strong,{children:"\u53bb\u6389secKillVoucher\u4e2d\u7684@Transactional\u6ce8\u89e3"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"Long userId = UserHolder.getUser().getId();\nsynchronized (userId.toString().intern()) {\n    return this.createVoucherOrder(voucherId);\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u4f46\u662f\u4ee5\u4e0a\u505a\u6cd5\u4f9d\u7136\u6709\u95ee\u9898\uff0c\u56e0\u4e3a\u4f60\u8c03\u7528\u7684\u65b9\u6cd5\uff0c\u662f\u540c\u4e00\u4e2a\u7c7b\u81ea\u8c03\u7528\u81ea\u5df1\u7684\u65b9\u6cd5\uff0c\u4f1a\u9020\u6210\u4e8b\u52a1\u5931\u6548\uff0c",(0,r.jsx)(n.strong,{children:"\u4e8b\u52a1\u60f3\u8981\u751f\u6548\uff0c\u8fd8\u5f97\u5229\u7528\u4ee3\u7406\u6765\u751f\u6548"}),"\uff0c\u6240\u4ee5\u8fd9\u4e2a\u5730\u65b9\uff0c\u6211\u4eec\u9700\u8981\u83b7\u5f97\u539f\u59cb\u7684\u4e8b\u52a1\u5bf9\u8c61\uff0c\u6765\u64cd\u4f5c\u4e8b\u52a1"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"Long userId = UserHolder.getUser().getId();\nsynchronized (userId.toString().intern()) {\n    IVoucherOrderService proxy = (IVoucherOrderService) AopContext.currentProxy();\n    //\u9700\u8981\u4f7f\u7528\u4ee3\u7406\u6765\u8c03\u7528\u65b9\u6cd5\uff0c\u5426\u5219\u4f1a\u9020\u6210\u4e8b\u52a1\u5931\u6548\uff08\u8fd9\u91cc\u662f\u9020\u6210Spring\u4e8b\u52a1\u5931\u6548\u7684\u573a\u666f\u4e4b\u4e00\uff09\n    return proxy.createVoucherOrder(voucherId);\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u7136\u540e\u5728\u63a5\u53e3IVoucherOrderService\u4e2d",(0,r.jsx)(n.strong,{children:"\u521b\u5efa\u4e00\u4e2a\u62bd\u8c61\u65b9\u6cd5createVoucherOrder(Long voucherId)"})]}),"\n",(0,r.jsx)(n.p,{children:"\u8fd8\u9700\u8981\u5f15\u5165\u4f9d\u8d56\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.aspectj</groupId>\n    <artifactId>aspectjweaver</artifactId>\n</dependency>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u4ee5\u53ca\u5728\u542f\u52a8\u7c7b\u4e0a\u6dfb\u52a0 ",(0,r.jsx)(n.strong,{children:"@EnableAspectJAutoProxy(exposeProxy = true)"})," \u6ce8\u89e3"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["\u672c\u8282",(0,r.jsx)(n.strong,{children:"\u4eae\u70b9"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4e50\u89c2\u9501\u89e3\u51b3\u8d85\u5356\uff08\u51cf\u5e93\u5b58\u65f6\u989d\u5916\u5224\u65ad\u662f\u5426\u5927\u4e8e0\uff09"}),"\n",(0,r.jsxs)(n.li,{children:["synchronized\u89e3\u51b3\u5355\u673a\u6a21\u5f0f\u4e0b\u4e00\u4eba\u4e00\u5355\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"synchronized\u9501\u5230\u65b9\u6cd5\u5916\u9762\uff0c\u56e0\u4e3a@Transactional\u4f7f\u65b9\u6cd5\u5b8c\u6210\u65f6\u624d\u4f1a\u63d0\u4ea4\u4e8b\u52a1\uff0c\u9501\u65b9\u6cd5\u4f53\u53ef\u80fd\u4f1a\u51fa\u73b0\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898"}),"\n",(0,r.jsx)(n.li,{children:"\u4f7f\u7528userId.toString().intern()\u65b9\u6cd5\u51cf\u5c0f\u9501\u7c92\u5ea6"}),"\n",(0,r.jsx)(n.li,{children:"\u4f7f\u7528AopContext.currentProxy()\u83b7\u53d6\u4ee3\u7406\u8c03\u7528\u65b9\u6cd5\u89e3\u51b3\u4e8b\u52a1\u5931\u6548"}),"\n",(0,r.jsx)(n.li,{children:"\u4f46\u662f\u96c6\u7fa4\u6a21\u5f0f\u4e0b\uff0csynchronized\u662f\u672c\u5730\u9501\uff0c\u9700\u8981\u66f4\u6362\u60b2\u89c2\u9501\u65b9\u6848\uff0c\u6539\u4e3a\u5206\u5e03\u5f0f\u9501"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"37-\u96c6\u7fa4\u73af\u5883\u4e0b\u7684\u5e76\u53d1\u95ee\u9898",children:"3.7 \u96c6\u7fa4\u73af\u5883\u4e0b\u7684\u5e76\u53d1\u95ee\u9898"}),"\n",(0,r.jsx)(n.p,{children:"\u901a\u8fc7\u52a0\u9501\u53ef\u4ee5\u89e3\u51b3\u5728\u5355\u673a\u60c5\u51b5\u4e0b\u7684\u4e00\u4eba\u4e00\u5355\u5b89\u5168\u95ee\u9898\uff0c\u4f46\u662f\u5728\u96c6\u7fa4\u6a21\u5f0f\u4e0b\u5c31\u4e0d\u884c\u4e86\u3002"}),"\n",(0,r.jsx)(n.p,{children:"1\u3001\u6211\u4eec\u5c06\u670d\u52a1\u542f\u52a8\u4e24\u4efd\uff0c\u7aef\u53e3\u5206\u522b\u4e3a8081\u548c8082\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653373887844",src:s(36144).A+"",width:"674",height:"129"})}),"\n",(0,r.jsx)(n.p,{children:"2\u3001\u7136\u540e\u4fee\u6539nginx\u7684conf\u76ee\u5f55\u4e0b\u7684nginx.conf\u6587\u4ef6\uff0c\u914d\u7f6e\u53cd\u5411\u4ee3\u7406\u548c\u8d1f\u8f7d\u5747\u8861\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653373908620",src:s(85842).A+"",width:"819",height:"137"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u5177\u4f53\u64cd\u4f5c(\u7565)"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u6709\u5173\u9501\u5931\u6548\u539f\u56e0\u5206\u6790"})}),"\n",(0,r.jsx)(n.p,{children:"\u7531\u4e8e\u73b0\u5728\u6211\u4eec\u90e8\u7f72\u4e86\u591a\u4e2atomcat\uff0c\u6bcf\u4e2atomcat\u90fd\u6709\u4e00\u4e2a\u5c5e\u4e8e\u81ea\u5df1\u7684jvm\uff0c\u90a3\u4e48\u5047\u8bbe\u5728\u670d\u52a1\u5668A\u7684tomcat\u5185\u90e8\uff0c\u6709\u4e24\u4e2a\u7ebf\u7a0b\uff0c\u8fd9\u4e24\u4e2a\u7ebf\u7a0b\u7531\u4e8e\u4f7f\u7528\u7684\u662f\u540c\u4e00\u4efd\u4ee3\u7801\uff0c\u90a3\u4e48\u4ed6\u4eec\u7684\u9501\u5bf9\u8c61\u662f\u540c\u4e00\u4e2a\uff0c\u662f\u53ef\u4ee5\u5b9e\u73b0\u4e92\u65a5\u7684\uff0c\u4f46\u662f\u5982\u679c\u73b0\u5728\u662f\u670d\u52a1\u5668B\u7684tomcat\u5185\u90e8\uff0c\u53c8\u6709\u4e24\u4e2a\u7ebf\u7a0b\uff0c\u4f46\u662f\u4ed6\u4eec\u7684\u9501\u5bf9\u8c61\u5199\u7684\u867d\u7136\u548c\u670d\u52a1\u5668A\u4e00\u6837\uff0c\u4f46\u662f\u9501\u5bf9\u8c61\u5374\u4e0d\u662f\u540c\u4e00\u4e2a\uff0c\u6240\u4ee5\u7ebf\u7a0b3\u548c\u7ebf\u7a0b4\u53ef\u4ee5\u5b9e\u73b0\u4e92\u65a5\uff0c\u4f46\u662f\u5374\u65e0\u6cd5\u548c\u7ebf\u7a0b1\u548c\u7ebf\u7a0b2\u5b9e\u73b0\u4e92\u65a5\uff0c\u8fd9\u5c31\u662f \u96c6\u7fa4\u73af\u5883\u4e0b\uff0csyn\u9501\u5931\u6548\u7684\u539f\u56e0\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5c31\u9700\u8981\u4f7f\u7528\u5206\u5e03\u5f0f\u9501\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653374044740",src:s(97749).A+"",width:"1580",height:"785"})}),"\n",(0,r.jsx)(n.h1,{id:"4\u5206\u5e03\u5f0f\u9501-setnx",children:"4\u3001\u5206\u5e03\u5f0f\u9501-setnx"}),"\n",(0,r.jsx)(n.h2,{id:"41-\u57fa\u672c\u539f\u7406\u548c\u5b9e\u73b0\u65b9\u5f0f\u5bf9\u6bd4",children:"4.1 \u3001\u57fa\u672c\u539f\u7406\u548c\u5b9e\u73b0\u65b9\u5f0f\u5bf9\u6bd4"}),"\n",(0,r.jsxs)(n.p,{children:["\u5206\u5e03\u5f0f\u9501\uff1a\u6ee1\u8db3\u5206\u5e03\u5f0f\u7cfb\u7edf\u6216\u96c6\u7fa4\u6a21\u5f0f\u4e0b\u591a",(0,r.jsx)(n.strong,{children:"\u8fdb\u7a0b\u53ef\u89c1\u5e76\u4e14\u4e92\u65a5"}),"\u7684\u9501\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u5206\u5e03\u5f0f\u9501\u7684\u6838\u5fc3\u601d\u60f3\u5c31\u662f\u8ba9\u5927\u5bb6\u90fd\u4f7f\u7528\u540c\u4e00\u628a\u9501\uff0c\u53ea\u8981\u5927\u5bb6\u4f7f\u7528\u7684\u662f\u540c\u4e00\u628a\u9501\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u80fd\u9501\u4f4f\u7ebf\u7a0b\uff0c\u4e0d\u8ba9\u7ebf\u7a0b\u8fdb\u884c\uff0c\u8ba9\u7a0b\u5e8f\u4e32\u884c\u6267\u884c\uff0c\u8fd9\u5c31\u662f\u5206\u5e03\u5f0f\u9501\u7684\u6838\u5fc3\u601d\u8def"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653374296906",src:s(83592).A+"",width:"1616",height:"808"})}),"\n",(0,r.jsx)(n.p,{children:"\u90a3\u4e48\u5206\u5e03\u5f0f\u9501\u4ed6\u5e94\u8be5\u6ee1\u8db3\u4e00\u4e9b\u4ec0\u4e48\u6837\u7684\u6761\u4ef6\u5462\uff1f"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u53ef\u89c1\u6027\uff1a\u591a\u4e2a\u7ebf\u7a0b\u90fd\u80fd\u770b\u5230\u76f8\u540c\u7684\u7ed3\u679c\uff0c\u6ce8\u610f\uff1a\u8fd9\u4e2a\u5730\u65b9\u8bf4\u7684\u53ef\u89c1\u6027\u5e76\u4e0d\u662f\u5e76\u53d1\u7f16\u7a0b\u4e2d\u6307\u7684\u5185\u5b58\u53ef\u89c1\u6027\uff0c\u53ea\u662f\u8bf4\u591a\u4e2a\u8fdb\u7a0b\u4e4b\u95f4\u90fd\u80fd\u611f\u77e5\u5230\u53d8\u5316\u7684\u610f\u601d"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u4e92\u65a5\uff1a\u4e92\u65a5\u662f\u5206\u5e03\u5f0f\u9501\u7684\u6700\u57fa\u672c\u7684\u6761\u4ef6\uff0c\u4f7f\u5f97\u7a0b\u5e8f\u4e32\u884c\u6267\u884c"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u9ad8\u53ef\u7528\uff1a\u7a0b\u5e8f\u4e0d\u6613\u5d29\u6e83\uff0c\u65f6\u65f6\u523b\u523b\u90fd\u4fdd\u8bc1\u8f83\u9ad8\u7684\u53ef\u7528\u6027"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u9ad8\u6027\u80fd\uff1a\u7531\u4e8e\u52a0\u9501\u672c\u8eab\u5c31\u8ba9\u6027\u80fd\u964d\u4f4e\uff0c\u6240\u6709\u5bf9\u4e8e\u5206\u5e03\u5f0f\u9501\u672c\u8eab\u9700\u8981\u4ed6\u5c31\u8f83\u9ad8\u7684\u52a0\u9501\u6027\u80fd\u548c\u91ca\u653e\u9501\u6027\u80fd"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u5b89\u5168\u6027\uff1a\u5b89\u5168\u4e5f\u662f\u7a0b\u5e8f\u4e2d\u5fc5\u4e0d\u53ef\u5c11\u7684\u4e00\u73af"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653381992018",src:s(90373).A+"",width:"1270",height:"569"})}),"\n",(0,r.jsx)(n.p,{children:"\u5e38\u89c1\u7684\u5206\u5e03\u5f0f\u9501\u6709\u4e09\u79cd"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Mysql\uff1amysql\u672c\u8eab\u5c31\u5e26\u6709\u9501\u673a\u5236\uff0c\u4f46\u662f\u7531\u4e8emysql\u6027\u80fd\u672c\u8eab\u4e00\u822c\uff0c\u6240\u4ee5\u91c7\u7528\u5206\u5e03\u5f0f\u9501\u7684\u60c5\u51b5\u4e0b\uff0c\u5176\u5b9e\u4f7f\u7528mysql\u4f5c\u4e3a\u5206\u5e03\u5f0f\u9501\u6bd4\u8f83\u5c11\u89c1"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Redis\uff1aredis\u4f5c\u4e3a\u5206\u5e03\u5f0f\u9501\u662f\u975e\u5e38\u5e38\u89c1\u7684\u4e00\u79cd\u4f7f\u7528\u65b9\u5f0f\uff0c\u73b0\u5728\u4f01\u4e1a\u7ea7\u5f00\u53d1\u4e2d\u57fa\u672c\u90fd\u4f7f\u7528redis\u6216\u8005zookeeper\u4f5c\u4e3a\u5206\u5e03\u5f0f\u9501\uff0c\u5229\u7528setnx\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u5982\u679c\u63d2\u5165key\u6210\u529f\uff0c\u5219\u8868\u793a\u83b7\u5f97\u5230\u4e86\u9501\uff0c\u5982\u679c\u6709\u4eba\u63d2\u5165\u6210\u529f\uff0c\u5176\u4ed6\u4eba\u63d2\u5165\u5931\u8d25\u5219\u8868\u793a\u65e0\u6cd5\u83b7\u5f97\u5230\u9501\uff0c\u5229\u7528\u8fd9\u5957\u903b\u8f91\u6765\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Zookeeper\uff1azookeeper\u4e5f\u662f\u4f01\u4e1a\u7ea7\u5f00\u53d1\u4e2d\u8f83\u597d\u7684\u4e00\u4e2a\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u7684\u65b9\u6848\uff0c\u7531\u4e8e\u672c\u5957\u89c6\u9891\u5e76\u4e0d\u8bb2\u89e3zookeeper\u7684\u539f\u7406\u548c\u5206\u5e03\u5f0f\u9501\u7684\u5b9e\u73b0\uff0c\u6240\u4ee5\u4e0d\u8fc7\u591a\u9610\u8ff0"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653382219377",src:s(252).A+"",width:"1497",height:"538"})}),"\n",(0,r.jsx)(n.h2,{id:"42-redis\u5206\u5e03\u5f0f\u9501\u7684\u5b9e\u73b0\u6838\u5fc3\u601d\u8def",children:"4.2 \u3001Redis\u5206\u5e03\u5f0f\u9501\u7684\u5b9e\u73b0\u6838\u5fc3\u601d\u8def"}),"\n",(0,r.jsx)(n.p,{children:"\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u65f6\u9700\u8981\u5b9e\u73b0\u7684\u4e24\u4e2a\u57fa\u672c\u65b9\u6cd5\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u83b7\u53d6\u9501\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4e92\u65a5\uff1a\u786e\u4fdd\u53ea\u80fd\u6709\u4e00\u4e2a\u7ebf\u7a0b\u83b7\u53d6\u9501"}),"\n",(0,r.jsx)(n.li,{children:"\u975e\u963b\u585e\uff1a\u5c1d\u8bd5\u4e00\u6b21\uff0c\u6210\u529f\u8fd4\u56detrue\uff0c\u5931\u8d25\u8fd4\u56defalse"}),"\n",(0,r.jsx)(n.li,{children:"setnx\u548cexpire\u5408\u5e76\u4e3a\u4e00\u4e2a\u8bed\u53e5\uff0c\u907f\u514d\u53ea\u6267\u884csetnx\u540e\u5b95\u673a"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:s(75698).A+"",width:"878",height:"87"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u91ca\u653e\u9501\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u624b\u52a8\u91ca\u653e"}),"\n",(0,r.jsx)(n.li,{children:"\u8d85\u65f6\u91ca\u653e\uff1a\u83b7\u53d6\u9501\u65f6\u6dfb\u52a0\u4e00\u4e2a\u8d85\u65f6\u65f6\u95f4"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653382669900",src:s(49503).A+"",width:"622",height:"72"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u6838\u5fc3\u601d\u8def\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u5229\u7528redis \u7684setNx \u65b9\u6cd5\uff0c\u5f53\u6709\u591a\u4e2a\u7ebf\u7a0b\u8fdb\u5165\u65f6\uff0c\u6211\u4eec\u5c31\u5229\u7528\u8be5\u65b9\u6cd5\uff0c\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u8fdb\u5165\u65f6\uff0credis \u4e2d\u5c31\u6709\u8fd9\u4e2akey \u4e86\uff0c\u8fd4\u56de\u4e861\uff0c\u5982\u679c\u7ed3\u679c\u662f1\uff0c\u5219\u8868\u793a\u4ed6\u62a2\u5230\u4e86\u9501\uff0c\u90a3\u4e48\u4ed6\u53bb\u6267\u884c\u4e1a\u52a1\uff0c\u7136\u540e\u518d\u5220\u9664\u9501\uff0c\u9000\u51fa\u9501\u903b\u8f91\uff0c\u6ca1\u6709\u62a2\u5230\u9501\u7684\u54e5\u4eec\uff0c\u7b49\u5f85\u4e00\u5b9a\u65f6\u95f4\u540e\u91cd\u8bd5\u5373\u53ef"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.img,{src:s(95321).A+"",width:"715",height:"888"}),(0,r.jsx)(n.img,{src:s(61225).A+"",width:"629",height:"664"})]}),"\n",(0,r.jsx)(n.h2,{id:"43-\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u7248\u672c\u4e00",children:"4.3 \u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u7248\u672c\u4e00"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u52a0\u9501\u903b\u8f91"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u9501\u7684\u57fa\u672c\u63a5\u53e3"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"public interface ILock {\n\n    /**\n     * \u5c1d\u8bd5\u83b7\u53d6\u9501\n     * @param timeoutSec \u9501\u6301\u6709\u7684\u8d85\u65f6\u65f6\u95f4\uff08\u79d2\uff09\uff0c\u8fc7\u671f\u540e\u81ea\u52a8\u91ca\u653e\n     * @return true\u4ee3\u8868\u83b7\u53d6\u9501\u6210\u529f\uff1bfalse\u4ee3\u8868\u83b7\u53d6\u9501\u5931\u8d25\n     */\n    boolean tryLock(Long timeoutSec);\n\n    /**\n     * \u91ca\u653e\u9501\n     */\n    void unlock();\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"SimpleRedisLock"})}),"\n",(0,r.jsx)(n.p,{children:"\u5229\u7528setnx\u65b9\u6cd5\u8fdb\u884c\u52a0\u9501\uff0c\u540c\u65f6\u589e\u52a0\u8fc7\u671f\u65f6\u95f4\uff0c\u9632\u6b62\u6b7b\u9501\uff0c\u6b64\u65b9\u6cd5\u53ef\u4ee5\u4fdd\u8bc1\u52a0\u9501\u548c\u589e\u52a0\u8fc7\u671f\u65f6\u95f4\u5177\u6709\u539f\u5b50\u6027"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'public static final String KEY_PREFIX = "lock:";\nprivate String name;\nprivate StringRedisTemplate stringRedisTemplate;\n\npublic SimpleRedisLock(String name, StringRedisTemplate stringRedisTemplate) {\n    this.name = name;\n    this.stringRedisTemplate = stringRedisTemplate;\n}\n\n@Override\npublic boolean tryLock(Long timeoutSec) {\n    // \u83b7\u53d6\u9501\n    long threadID = Thread.currentThread().getId();\n    Boolean success = stringRedisTemplate.opsForValue().setIfAbsent(KEY_PREFIX + name, threadID + "", timeoutSec, TimeUnit.SECONDS);\n    return BooleanUtil.isTrue(success);\n}\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u91ca\u653e\u9501\u903b\u8f91"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"SimpleRedisLock"}),"\n",(0,r.jsx)(n.p,{children:"\u91ca\u653e\u9501\uff0c\u9632\u6b62\u5220\u9664\u522b\u4eba\u7684\u9501"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"public void unlock() {\n    //\u901a\u8fc7del\u5220\u9664\u9501\n    stringRedisTemplate.delete(KEY_PREFIX + name);\n}\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4fee\u6539\u4e1a\u52a1\u4ee3\u7801"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:' @Override\n    public Result secKillVoucher(Long voucherId) {\n        //1 \u67e5\u8be2\u4f18\u60e0\u5238\n        SeckillVoucher voucher = seckillVoucherService.getById(voucherId);\n        //2 \u5224\u65ad\u79d2\u6740\u662f\u5426\u5f00\u59cb\n        if (voucher.getBeginTime().isAfter(LocalDateTime.now())) {\n            return Result.fail("\u79d2\u6740\u5c1a\u672a\u5f00\u59cb\uff01");\n        }\n        //3 \u5224\u65ad\u79d2\u6740\u662f\u5426\u7ed3\u675f\n        if (voucher.getEndTime().isBefore(LocalDateTime.now())) {\n            return Result.fail("\u79d2\u6740\u5df2\u7ecf\u7ed3\u675f\uff01");\n        }\n        //4 \u5224\u65ad\u5e93\u5b58\u662f\u5426\u5145\u8db3\n        if (voucher.getStock() < 1) {\n            return Result.fail("\u5e93\u5b58\u4e0d\u8db3\uff01");\n        }\n\n        Long userId = UserHolder.getUser().getId();\n        /*synchronized (userId.toString().intern()) {\n            IVoucherOrderService proxy = (IVoucherOrderService) AopContext.currentProxy();\n            //\u9700\u8981\u4f7f\u7528\u4ee3\u7406\u6765\u8c03\u7528\u65b9\u6cd5\uff0c\u5426\u5219\u4f1a\u9020\u6210\u4e8b\u52a1\u5931\u6548\uff08\u8fd9\u91cc\u662f\u9020\u6210Spring\u4e8b\u52a1\u5931\u6548\u7684\u573a\u666f\u4e4b\u4e00\uff09\n            return proxy.createVoucherOrder(voucherId);\n        }*/\n\n        /**\n         * \u96c6\u7fa4\u6a21\u5f0f\u4e0b\u4f7f\u7528\u5206\u5e03\u5f0f\u9501\n         */\n        // \u521b\u5efa\u9501\u5bf9\u8c61\n        SimpleRedisLock lock = new SimpleRedisLock("order:" + userId, stringRedisTemplate);\n        // \u83b7\u53d6\u9501\n        boolean isLock = lock.tryLock(10L);\n        // \u5224\u65ad\u9501\u662f\u5426\u83b7\u53d6\u6210\u529f\n        if (!isLock) {\n            // \u5931\u8d25\uff0c\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\n            return Result.fail("\u4e0d\u5141\u8bb8\u91cd\u590d\u4e0b\u5355\uff01");\n        }\n        \n        // \u6210\u529f\uff0c\u6267\u884c\u4e1a\u52a1\n        try {\n            IVoucherOrderService proxy = (IVoucherOrderService) AopContext.currentProxy();\n            //\u9700\u8981\u4f7f\u7528\u4ee3\u7406\u6765\u8c03\u7528\u65b9\u6cd5\uff0c\u5426\u5219\u4f1a\u9020\u6210\u4e8b\u52a1\u5931\u6548\uff08\u8fd9\u91cc\u662f\u9020\u6210Spring\u4e8b\u52a1\u5931\u6548\u7684\u573a\u666f\u4e4b\u4e00\uff09\n            return proxy.createVoucherOrder(voucherId);\n        } finally {\n            // \u91ca\u653e\u9501\n            lock.unlock();\n        }\n    }\n'})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\u4f46\u8fd9\u79cd\u7b80\u5355\u7684\u5206\u5e03\u5f0f\u9501\u5b9e\u73b0\u65b9\u5f0f\uff0c\u4ecd\u7136\u53ef\u80fd\u51fa\u73b0\u95ee\u9898\uff0c\u5982\u4e0b\u8bf4\u660e"}),"\n"]}),"\n",(0,r.jsxs)(n.h2,{id:"44-redis\u5206\u5e03\u5f0f\u9501\u8bef\u5220\u60c5\u51b5\u8bf4\u660e",children:["4.4 Redis\u5206\u5e03\u5f0f\u9501",(0,r.jsx)(n.strong,{children:"\u8bef\u5220"}),"\u60c5\u51b5\u8bf4\u660e"]}),"\n",(0,r.jsx)(n.p,{children:"\u903b\u8f91\u8bf4\u660e\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"\u6301\u6709\u9501\u7684\u7ebf\u7a0b\u5728\u9501\u7684\u5185\u90e8\u51fa\u73b0\u4e86\u963b\u585e\uff0c\u5bfc\u81f4\u4ed6\u7684\u9501\u81ea\u52a8\u91ca\u653e\uff0c\u8fd9\u65f6\u5176\u4ed6\u7ebf\u7a0b\uff0c\u7ebf\u7a0b2\u6765\u5c1d\u8bd5\u83b7\u5f97\u9501\uff0c\u5c31\u62ff\u5230\u4e86\u8fd9\u628a\u9501\uff0c\u7136\u540e\u7ebf\u7a0b2\u5728\u6301\u6709\u9501\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u7ebf\u7a0b1\u53cd\u5e94\u8fc7\u6765\uff0c\u7ee7\u7eed\u6267\u884c\uff0c\u800c\u7ebf\u7a0b1\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u8d70\u5230\u4e86\u5220\u9664\u9501\u903b\u8f91\uff0c\u6b64\u65f6\u5c31\u4f1a\u628a\u672c\u5e94\u8be5\u5c5e\u4e8e\u7ebf\u7a0b2\u7684\u9501\u8fdb\u884c\u5220\u9664\uff0c\u8fd9\u5c31\u662f\u8bef\u5220\u522b\u4eba\u9501\u7684\u60c5\u51b5\u8bf4\u660e"}),"\n",(0,r.jsx)(n.p,{children:"\u89e3\u51b3\u65b9\u6848\uff1a\u89e3\u51b3\u65b9\u6848\u5c31\u662f\u5728\u6bcf\u4e2a\u7ebf\u7a0b\u91ca\u653e\u9501\u7684\u65f6\u5019\uff0c\u53bb\u5224\u65ad\u4e00\u4e0b\u5f53\u524d\u8fd9\u628a\u9501\u662f\u5426\u5c5e\u4e8e\u81ea\u5df1\uff0c\u5982\u679c\u5c5e\u4e8e\u81ea\u5df1\uff0c\u5219\u4e0d\u8fdb\u884c\u9501\u7684\u5220\u9664\uff0c\u5047\u8bbe\u8fd8\u662f\u4e0a\u8fb9\u7684\u60c5\u51b5\uff0c\u7ebf\u7a0b1\u5361\u987f\uff0c\u9501\u81ea\u52a8\u91ca\u653e\uff0c\u7ebf\u7a0b2\u8fdb\u5165\u5230\u9501\u7684\u5185\u90e8\u6267\u884c\u903b\u8f91\uff0c\u6b64\u65f6\u7ebf\u7a0b1\u53cd\u5e94\u8fc7\u6765\uff0c\u7136\u540e\u5220\u9664\u9501\uff0c\u4f46\u662f\u7ebf\u7a0b1\uff0c\u4e00\u770b\u5f53\u524d\u8fd9\u628a\u9501\u4e0d\u662f\u5c5e\u4e8e\u81ea\u5df1\uff0c\u4e8e\u662f\u4e0d\u8fdb\u884c\u5220\u9664\u9501\u903b\u8f91\uff0c\u5f53\u7ebf\u7a0b2\u8d70\u5230\u5220\u9664\u9501\u903b\u8f91\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u5361\u8fc7\u81ea\u52a8\u91ca\u653e\u9501\u7684\u65f6\u95f4\u70b9\uff0c\u5219\u5224\u65ad\u5f53\u524d\u8fd9\u628a\u9501\u662f\u5c5e\u4e8e\u81ea\u5df1\u7684\uff0c\u4e8e\u662f\u5220\u9664\u8fd9\u628a\u9501\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653385920025",src:s(87116).A+"",width:"1526",height:"642"})}),"\n",(0,r.jsx)(n.h2,{id:"45-\u89e3\u51b3redis\u5206\u5e03\u5f0f\u9501\u8bef\u5220\u95ee\u9898",children:"4.5 \u89e3\u51b3Redis\u5206\u5e03\u5f0f\u9501\u8bef\u5220\u95ee\u9898"}),"\n",(0,r.jsx)(n.p,{children:"\u9700\u6c42\uff1a\u4fee\u6539\u4e4b\u524d\u7684\u5206\u5e03\u5f0f\u9501\u5b9e\u73b0\uff0c\u6ee1\u8db3\uff1a\u5728\u83b7\u53d6\u9501\u65f6\u5b58\u5165\u7ebf\u7a0b\u6807\u793a\uff08\u53ef\u4ee5\u7528UUID\u8868\u793a\uff09\n\u5728\u91ca\u653e\u9501\u65f6\u5148\u83b7\u53d6\u9501\u4e2d\u7684\u7ebf\u7a0b\u6807\u793a\uff0c\u5224\u65ad\u662f\u5426\u4e0e\u5f53\u524d\u7ebf\u7a0b\u6807\u793a\u4e00\u81f4"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5982\u679c\u4e00\u81f4\u5219\u91ca\u653e\u9501"}),"\n",(0,r.jsx)(n.li,{children:"\u5982\u679c\u4e0d\u4e00\u81f4\u5219\u4e0d\u91ca\u653e\u9501"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u6838\u5fc3\u903b\u8f91\uff1a\u5728\u5b58\u5165\u9501\u65f6\uff0c\u653e\u5165\u81ea\u5df1\u7ebf\u7a0b\u7684\u6807\u8bc6\uff0c\u5728\u5220\u9664\u9501\u65f6\uff0c\u5224\u65ad\u5f53\u524d\u8fd9\u628a\u9501\u7684\u6807\u8bc6\u662f\u4e0d\u662f\u81ea\u5df1\u5b58\u5165\u7684\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fdb\u884c\u5220\u9664\uff0c\u5982\u679c\u4e0d\u662f\uff0c\u5219\u4e0d\u8fdb\u884c\u5220\u9664\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653387398820",src:s(16670).A+"",width:"546",height:"644"})}),"\n",(0,r.jsx)(n.p,{children:"\u5177\u4f53\u4ee3\u7801\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'public class SimpleRedisLock implements ILock{\n    \n    public static final String KEY_PREFIX = "lock:";\n    /**\n     * \u4f7f\u7528public static final\u7684UUID\u4f5c\u4e3aJVM\u7684\u533a\u5206\uff0c\u540c\u4e00\u4e2aJVM\u83b7\u53d6\u5230\u7684SimpleRedisLock\u5b9e\u4f8bID_PREFIX\u76f8\u540c\n     * \u7528\u4e8e\u4f5c\u4e3a\u9501\u7684value\u7684\u524d\u7f00\uff0c\u907f\u514d\u4e0d\u540cJVM\u4e0bthreadId\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\u9501\u88ab\u522b\u7684\u7ebf\u7a0b\u8bef\u5220\n     */\n    public static final String ID_PREFIX = UUID.randomUUID().toString(true) + "-";\n    private String name;\n    private StringRedisTemplate stringRedisTemplate;\n\n    public SimpleRedisLock(String name, StringRedisTemplate stringRedisTemplate) {\n        this.name = name;\n        this.stringRedisTemplate = stringRedisTemplate;\n    }\n\n    @Override\n    public boolean tryLock(Long timeoutSec) {\n        // \u83b7\u53d6\u9501\n        String threadID = ID_PREFIX + Thread.currentThread().getId();\n        Boolean success = stringRedisTemplate.opsForValue().setIfAbsent(KEY_PREFIX + name, threadID, timeoutSec, TimeUnit.SECONDS);\n        return BooleanUtil.isTrue(success);\n    }\n\n    @Override\n    public void unlock() {\n        //\u83b7\u53d6\u7ebf\u7a0b\u6807\u8bc6\n        String threadId = ID_PREFIX + Thread.currentThread().getId();\n        //\u83b7\u53d6\u9501\u4e2d\u7684\u6807\u8bc6\uff08value\uff09\n        String id = stringRedisTemplate.opsForValue().get(KEY_PREFIX + name);\n        //\u5224\u65ad\u6807\u8bc6\u662f\u5426\u4e00\u81f4\n        if (threadId.equals(id)) {\n            //\u91ca\u653e\u9501\n            stringRedisTemplate.delete(KEY_PREFIX + name);\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u6709\u5173\u4ee3\u7801\u5b9e\u64cd\u8bf4\u660e\uff1a"})}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u6211\u4eec\u4fee\u6539\u5b8c\u6b64\u5904\u4ee3\u7801\u540e\uff0c\u6211\u4eec\u91cd\u542f\u5de5\u7a0b\uff0c\u7136\u540e\u542f\u52a8\u4e24\u4e2a\u7ebf\u7a0b\uff0c\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u6301\u6709\u9501\u540e\uff0c\u624b\u52a8\u91ca\u653e\u9501\uff0c\u7b2c\u4e8c\u4e2a\u7ebf\u7a0b \u6b64\u65f6\u8fdb\u5165\u5230\u9501\u5185\u90e8\uff0c\u518d\u653e\u884c\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u6b64\u65f6\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u7531\u4e8e\u9501\u7684value\u503c\u5e76\u975e\u662f\u81ea\u5df1\uff0c\u6240\u4ee5\u4e0d\u80fd\u91ca\u653e\u9501\uff0c\u4e5f\u5c31\u65e0\u6cd5\u5220\u9664\u522b\u4eba\u7684\u9501\uff0c\u6b64\u65f6\u7b2c\u4e8c\u4e2a\u7ebf\u7a0b\u80fd\u591f\u6b63\u786e\u91ca\u653e\u9501\uff0c\u901a\u8fc7\u8fd9\u4e2a\u6848\u4f8b\u521d\u6b65\u8bf4\u660e\u6211\u4eec\u89e3\u51b3\u4e86\u9501\u8bef\u5220\u7684\u95ee\u9898\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"46-\u5206\u5e03\u5f0f\u9501\u7684\u539f\u5b50\u6027\u95ee\u9898",children:"4.6 \u5206\u5e03\u5f0f\u9501\u7684\u539f\u5b50\u6027\u95ee\u9898"}),"\n",(0,r.jsx)(n.p,{children:"\u66f4\u4e3a\u6781\u7aef\u7684\u8bef\u5220\u903b\u8f91\u8bf4\u660e\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"\u7ebf\u7a0b1\u73b0\u5728\u6301\u6709\u9501\u4e4b\u540e\uff0c\u5728\u6267\u884c\u4e1a\u52a1\u903b\u8f91\u8fc7\u7a0b\u4e2d\uff0c\u4ed6\u6b63\u51c6\u5907\u5220\u9664\u9501\uff0c\u800c\u4e14\u5df2\u7ecf\u8d70\u5230\u4e86\u6761\u4ef6\u5224\u65ad\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6bd4\u5982\u4ed6\u5df2\u7ecf\u62ff\u5230\u4e86\u5f53\u524d\u8fd9\u628a\u9501\u786e\u5b9e\u662f\u5c5e\u4e8e\u4ed6\u81ea\u5df1\u7684\uff0c\u6b63\u51c6\u5907\u5220\u9664\u9501\uff0c\u4f46\u662f\u6b64\u65f6\u4ed6\u7684\u9501\u5230\u671f\u4e86\uff0c\u90a3\u4e48\u6b64\u65f6\u7ebf\u7a0b2\u8fdb\u6765\uff0c\u4f46\u662f\u7ebf\u7a0b1\u4ed6\u4f1a\u63a5\u7740\u5f80\u540e\u6267\u884c\uff0c\u5f53\u4ed6\u5361\u987f\u7ed3\u675f\u540e\uff0c\u4ed6\u76f4\u63a5\u5c31\u4f1a\u6267\u884c\u5220\u9664\u9501\u90a3\u884c\u4ee3\u7801\uff0c\u76f8\u5f53\u4e8e\u6761\u4ef6\u5224\u65ad\u5e76\u6ca1\u6709\u8d77\u5230\u4f5c\u7528\uff0c\u8fd9\u5c31\u662f\u5220\u9501\u65f6\u7684\u539f\u5b50\u6027\u95ee\u9898\uff0c\u4e4b\u6240\u4ee5\u6709\u8fd9\u4e2a\u95ee\u9898\uff0c\u662f\u56e0\u4e3a\u7ebf\u7a0b1\u7684\u62ff\u9501\uff0c\u6bd4\u9501\uff0c\u5220\u9501\uff0c\u5b9e\u9645\u4e0a\u5e76\u4e0d\u662f\u539f\u5b50\u6027\u7684\uff0c\u6211\u4eec\u8981\u9632\u6b62\u521a\u624d\u7684\u60c5\u51b5\u53d1\u751f\uff0c"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653387764938",src:s(75403).A+"",width:"1611",height:"697"})}),"\n",(0,r.jsxs)(n.h2,{id:"47-lua\u811a\u672c\u89e3\u51b3\u591a\u6761\u547d\u4ee4\u539f\u5b50\u6027\u95ee\u9898",children:["4.7 ",(0,r.jsx)(n.strong,{children:"Lua\u811a\u672c"}),"\u89e3\u51b3\u591a\u6761\u547d\u4ee4\u539f\u5b50\u6027\u95ee\u9898"]}),"\n",(0,r.jsxs)(n.p,{children:["Redis\u63d0\u4f9b\u4e86Lua\u811a\u672c\u529f\u80fd\uff0c\u5728\u4e00\u4e2a\u811a\u672c\u4e2d\u7f16\u5199\u591a\u6761Redis\u547d\u4ee4\uff0c\u786e\u4fdd\u591a\u6761\u547d\u4ee4\u6267\u884c\u65f6\u7684\u539f\u5b50\u6027\u3002Lua\u662f\u4e00\u79cd\u7f16\u7a0b\u8bed\u8a00\uff0c\u5b83\u7684\u57fa\u672c\u8bed\u6cd5\u5927\u5bb6\u53ef\u4ee5\u53c2\u8003\u7f51\u7ad9\uff1a",(0,r.jsx)(n.a,{href:"https://www.runoob.com/lua/lua-tutorial.html%EF%BC%8C%E8%BF%99%E9%87%8C%E9%87%8D%E7%82%B9%E4%BB%8B%E7%BB%8DRedis%E6%8F%90%E4%BE%9B%E7%9A%84%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8lua%E5%8E%BB%E6%93%8D%E4%BD%9Credis%EF%BC%8C%E5%8F%88%E8%83%BD%E4%BF%9D%E8%AF%81%E4%BB%96%E7%9A%84%E5%8E%9F%E5%AD%90%E6%80%A7%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%AE%9E%E7%8E%B0%E6%8B%BF%E9%94%81%E6%AF%94%E9%94%81%E5%88%A0%E9%94%81%E6%98%AF%E4%B8%80%E4%B8%AA%E5%8E%9F%E5%AD%90%E6%80%A7%E5%8A%A8%E4%BD%9C%E4%BA%86%EF%BC%8C%E4%BD%9C%E4%B8%BAJava%E7%A8%8B%E5%BA%8F%E5%91%98%E8%BF%99%E4%B8%80%E5%9D%97%E5%B9%B6%E4%B8%8D%E4%BD%9C%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E8%A6%81%E6%B1%82%EF%BC%8C%E5%B9%B6%E4%B8%8D%E9%9C%80%E8%A6%81%E5%A4%A7%E5%AE%B6%E8%BF%87%E4%BA%8E%E7%B2%BE%E9%80%9A%EF%BC%8C%E5%8F%AA%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E4%BB%96%E6%9C%89%E4%BB%80%E4%B9%88%E4%BD%9C%E7%94%A8%E5%8D%B3%E5%8F%AF%E3%80%82",children:"https://www.runoob.com/lua/lua-tutorial.html\uff0c\u8fd9\u91cc\u91cd\u70b9\u4ecb\u7ecdRedis\u63d0\u4f9b\u7684\u8c03\u7528\u51fd\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528lua\u53bb\u64cd\u4f5credis\uff0c\u53c8\u80fd\u4fdd\u8bc1\u4ed6\u7684\u539f\u5b50\u6027\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5b9e\u73b0\u62ff\u9501\u6bd4\u9501\u5220\u9501\u662f\u4e00\u4e2a\u539f\u5b50\u6027\u52a8\u4f5c\u4e86\uff0c\u4f5c\u4e3aJava\u7a0b\u5e8f\u5458\u8fd9\u4e00\u5757\u5e76\u4e0d\u4f5c\u4e00\u4e2a\u7b80\u5355\u8981\u6c42\uff0c\u5e76\u4e0d\u9700\u8981\u5927\u5bb6\u8fc7\u4e8e\u7cbe\u901a\uff0c\u53ea\u9700\u8981\u77e5\u9053\u4ed6\u6709\u4ec0\u4e48\u4f5c\u7528\u5373\u53ef\u3002"})]}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u91cc\u91cd\u70b9\u4ecb\u7ecdRedis\u63d0\u4f9b\u7684\u8c03\u7528\u51fd\u6570\uff0c\u8bed\u6cd5\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"redis.call('\u547d\u4ee4\u540d\u79f0', 'key', '\u5176\u5b83\u53c2\u6570', ...)\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u4f8b\u5982\uff0c\u6211\u4eec\u8981\u6267\u884cset name jack\uff0c\u5219\u811a\u672c\u662f\u8fd9\u6837\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:" \u6267\u884c set name jack\nredis.call('set', 'name', 'jack')\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u4f8b\u5982\uff0c\u6211\u4eec\u8981\u5148\u6267\u884cset name Rose\uff0c\u518d\u6267\u884cget name\uff0c\u5219\u811a\u672c\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:" \u5148\u6267\u884c set name jack\nredis.call('set', 'name', 'Rose')\n \u518d\u6267\u884c get name\nlocal name = redis.call('get', 'name')\n \u8fd4\u56de\nreturn name\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5199\u597d\u811a\u672c\u4ee5\u540e\uff0c\u9700\u8981\u7528Redis\u547d\u4ee4\u6765\u8c03\u7528\u811a\u672c\uff0c\u8c03\u7528\u811a\u672c\u7684\u5e38\u89c1\u547d\u4ee4\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653392181413",src:s(58854).A+"",width:"714",height:"163"})}),"\n",(0,r.jsx)(n.p,{children:"\u4f8b\u5982\uff0c\u6211\u4eec\u8981\u6267\u884c redis.call('set', 'name', 'jack') \u8fd9\u4e2a\u811a\u672c\uff0c\u8bed\u6cd5\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653392218531",src:s(65940).A+"",width:"668",height:"113"})}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u811a\u672c\u4e2d\u7684key\u3001value\u4e0d\u60f3\u5199\u6b7b\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u3002key\u7c7b\u578b\u53c2\u6570\u4f1a\u653e\u5165KEYS\u6570\u7ec4\uff0c\u5176\u5b83\u53c2\u6570\u4f1a\u653e\u5165ARGV\u6570\u7ec4\uff0c\u5728\u811a\u672c\u4e2d\u53ef\u4ee5\u4eceKEYS\u548cARGV\u6570\u7ec4\u83b7\u53d6\u8fd9\u4e9b\u53c2\u6570\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653392438917",src:s(72740).A+"",width:"1129",height:"151"})}),"\n",(0,r.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\u6211\u4eec\u6765\u56de\u4e00\u4e0b\u6211\u4eec\u91ca\u653e\u9501\u7684\u903b\u8f91\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"\u91ca\u653e\u9501\u7684\u4e1a\u52a1\u6d41\u7a0b\u662f\u8fd9\u6837\u7684"}),"\n",(0,r.jsx)(n.p,{children:"\u200b\t1\u3001\u83b7\u53d6\u9501\u4e2d\u7684\u7ebf\u7a0b\u6807\u793a"}),"\n",(0,r.jsx)(n.p,{children:"\u200b\t2\u3001\u5224\u65ad\u662f\u5426\u4e0e\u6307\u5b9a\u7684\u6807\u793a\uff08\u5f53\u524d\u7ebf\u7a0b\u6807\u793a\uff09\u4e00\u81f4"}),"\n",(0,r.jsx)(n.p,{children:"\u200b\t3\u3001\u5982\u679c\u4e00\u81f4\u5219\u91ca\u653e\u9501\uff08\u5220\u9664\uff09"}),"\n",(0,r.jsx)(n.p,{children:"\u200b\t4\u3001\u5982\u679c\u4e0d\u4e00\u81f4\u5219\u4ec0\u4e48\u90fd\u4e0d\u505a"}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u7528Lua\u811a\u672c\u6765\u8868\u793a\u5219\u662f\u8fd9\u6837\u7684\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"\u6700\u7ec8\u6211\u4eec\u64cd\u4f5credis\u7684\u62ff\u9501\u6bd4\u9501\u5220\u9501\u7684lua\u811a\u672c\u5c31\u4f1a\u53d8\u6210\u8fd9\u6837"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"-- \u8fd9\u91cc\u7684 KEYS[1] \u5c31\u662f\u9501\u7684key\uff0c\u8fd9\u91cc\u7684ARGV[1] \u5c31\u662f\u5f53\u524d\u7ebf\u7a0b\u6807\u793a\n-- \u83b7\u53d6\u9501\u4e2d\u7684\u6807\u793a\uff0c\u5224\u65ad\u662f\u5426\u4e0e\u5f53\u524d\u7ebf\u7a0b\u6807\u793a\u4e00\u81f4\nif (redis.call('GET', KEYS[1]) == ARGV[1]) then\n  -- \u4e00\u81f4\uff0c\u5219\u5220\u9664\u9501\n  return redis.call('DEL', KEYS[1])\nend\n-- \u4e0d\u4e00\u81f4\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\nreturn 0\n"})}),"\n",(0,r.jsx)(n.h2,{id:"48-\u5229\u7528java\u4ee3\u7801\u8c03\u7528lua\u811a\u672c\u6539\u9020\u5206\u5e03\u5f0f\u9501",children:"4.8 \u5229\u7528Java\u4ee3\u7801\u8c03\u7528Lua\u811a\u672c\u6539\u9020\u5206\u5e03\u5f0f\u9501"}),"\n",(0,r.jsx)(n.p,{children:"lua\u811a\u672c\u672c\u8eab\u5e76\u4e0d\u9700\u8981\u5927\u5bb6\u82b1\u8d39\u592a\u591a\u65f6\u95f4\u53bb\u7814\u7a76\uff0c\u53ea\u9700\u8981\u77e5\u9053\u5982\u4f55\u8c03\u7528\uff0c\u5927\u81f4\u662f\u4ec0\u4e48\u610f\u601d\u5373\u53ef\uff0c\u6240\u4ee5\u5728\u7b14\u8bb0\u4e2d\u5e76\u4e0d\u4f1a\u8be6\u7ec6\u7684\u53bb\u89e3\u91ca\u8fd9\u4e9blua\u8868\u8fbe\u5f0f\u7684\u542b\u4e49\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u7684RedisTemplate\u4e2d\uff0c\u53ef\u4ee5\u5229\u7528execute\u65b9\u6cd5\u53bb\u6267\u884clua\u811a\u672c\uff0c\u53c2\u6570\u5bf9\u5e94\u5173\u7cfb\u5c31\u5982\u4e0b\u56fe\u80a1"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653393304844",src:s(48586).A+"",width:"822",height:"384"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Java\u4ee3\u7801"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'private static final DefaultRedisScript<Long> UNLOCK_SCRIPT;\n static {\n     UNLOCK_SCRIPT = new DefaultRedisScript<>();\n     UNLOCK_SCRIPT.setLocation(new ClassPathResource("unlock.lua"));\n     UNLOCK_SCRIPT.setResultType(Long.class);\n }\n\n/**\n * \u4f7f\u7528lua\u811a\u672c\u4fdd\u8bc1\u6bd4\u9501\u5220\u9501\u7684\u539f\u5b50\u6027\n */\npublic void unlock() {\n    // \u8c03\u7528lua\u811a\u672c\n    stringRedisTemplate.execute(\n            UNLOCK_SCRIPT,\n            Collections.singletonList(KEY_PREFIX + name),\n            ID_PREFIX + Thread.currentThread().getId());\n}\n//\u7ecf\u8fc7\u4ee5\u4e0a\u4ee3\u7801\u6539\u9020\u540e\uff0c\u6211\u4eec\u5c31\u80fd\u591f\u5b9e\u73b0 \u62ff\u9501\u6bd4\u9501\u5220\u9501\u7684\u539f\u5b50\u6027\u52a8\u4f5c\u4e86~\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u5168\u90e8\u4ee3\u7801"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'package org.idea.qiyu.live.framework.redis.starter.lock;\n\nimport cn.hutool.core.lang.UUID;\nimport cn.hutool.core.util.BooleanUtil;\nimport org.springframework.core.io.ClassPathResource;\nimport org.springframework.data.redis.core.StringRedisTemplate;\nimport org.springframework.data.redis.core.script.DefaultRedisScript;\n\nimport java.util.Collections;\nimport java.util.concurrent.TimeUnit;\n\n/**\n * Redis\u5206\u5e03\u5f0f\u9501setnx\u5b9e\u73b0\uff0c\u9002\u7528\u4e8e\u5927\u591a\u6570\u60c5\u51b5\uff0c\u89e3\u51b3\u4e86\u8bef\u5220\u9501\u95ee\u9898\u548c\u539f\u5b50\u6027\u95ee\u9898\n * \u4f46\u8fd8\u5b58\u5728\u4ee5\u4e0b\u95ee\u9898\uff1a\n *      \u91cd\u5165\u95ee\u9898\n *      \u4e0d\u53ef\u91cd\u8bd5\n *      \u8d85\u65f6\u91ca\u653e\n *      \u4e3b\u4ece\u4e00\u81f4\u6027\n * \u5982\u9700\u89e3\u51b3\u8fd9\u4e9b\u6781\u4f4e\u6982\u7387\u95ee\u9898\uff0c\u8bf7\u4f7f\u7528Redission\n * \n *  \x3c!--hutool--\x3e\n *  <dependency>\n *      <groupId>cn.hutool</groupId>\n *      <artifactId>hutool-all</artifactId>\n *      <version>5.7.17</version>\n *  </dependency>\n *  \n *  public interface ILock {\n *      /**\n *      * \u5c1d\u8bd5\u83b7\u53d6\u9501\n *      * @param timeoutSec \u9501\u6301\u6709\u7684\u8d85\u65f6\u65f6\u95f4\uff08\u79d2\uff09\uff0c\u8fc7\u671f\u540e\u81ea\u52a8\u91ca\u653e\n *      * @return true\u4ee3\u8868\u83b7\u53d6\u9501\u6210\u529f\uff1bfalse\u4ee3\u8868\u83b7\u53d6\u9501\u5931\u8d25\n *      * /\n *      boolean tryLock(Long timeoutSec);\n *      /**\n *      * \u91ca\u653e\u9501\n *      * /\n *      void unlock();\n *  }\n *  \n *  unlock.lua:\uff08\u65b0\u5efa\u5728resources\u76ee\u5f55\u4e0b\uff09\n *  -- \u8fd9\u91cc\u7684 KEYS[1] \u5c31\u662f\u9501\u7684key\uff0c\u8fd9\u91cc\u7684ARGV[1] \u5c31\u662f\u5f53\u524d\u7ebf\u7a0b\u6807\u793a\n *  -- \u83b7\u53d6\u9501\u4e2d\u7684\u6807\u793a\uff0c\u5224\u65ad\u662f\u5426\u4e0e\u5f53\u524d\u7ebf\u7a0b\u6807\u793a\u4e00\u81f4\n *  if (redis.call(\'GET\', KEYS[1]) == ARGV[1]) then\n *    -- \u4e00\u81f4\uff0c\u5219\u5220\u9664\u9501\n *    return redis.call(\'DEL\', KEYS[1])\n *  end\n *  -- \u4e0d\u4e00\u81f4\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\n */\npublic class SimpleRedisLock implements ILock{\n    public static final String KEY_PREFIX = "lock:";\n    /**\n     * \u4f7f\u7528public static final\u7684UUID\u4f5c\u4e3aJVM\u7684\u533a\u5206\uff0c\u540c\u4e00\u4e2aJVM\u83b7\u53d6\u5230\u7684SimpleRedisLock\u5b9e\u4f8bID_PREFIX\u76f8\u540c\n     * \u7528\u4e8e\u4f5c\u4e3a\u9501\u7684value\u7684\u524d\u7f00\uff0c\u907f\u514d\u4e0d\u540cJVM\u4e0bthreadId\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\u9501\u88ab\u522b\u7684\u7ebf\u7a0b\u8bef\u5220\n     */\n    public static final String ID_PREFIX = UUID.randomUUID().toString(true) + "-";\n    private String name;\n    private StringRedisTemplate stringRedisTemplate;\n\n    public SimpleRedisLock(String name, StringRedisTemplate stringRedisTemplate) {\n        this.name = name;\n        this.stringRedisTemplate = stringRedisTemplate;\n    }\n\n    //\u521d\u59cb\u5316lua\u811a\u672c\uff0c\u907f\u514d\u91cd\u590d\u521d\u59cb\u5316\n    public static final DefaultRedisScript<Long> UNLOCK_SCRIPT;\n    static {\n        UNLOCK_SCRIPT = new DefaultRedisScript<>();\n        UNLOCK_SCRIPT.setLocation(new ClassPathResource("unlock.lua"));\n        UNLOCK_SCRIPT.setResultType(Long.class);\n    }\n\n    @Override\n    public boolean tryLock(Long timeoutSec) {\n        // \u83b7\u53d6\u9501\n        /**\n         * UUID\u7528\u4e8e\u533a\u5206JVM\uff0cthreadId\u7528\u4e8e\u533a\u5206\u540c\u4e00\u4e2aJVM\u5185\u7684\u4e0d\u540c\u7ebf\u7a0b\n         * UUID\u4fdd\u8bc1\u4e0d\u540cJVM\u5185\u76f8\u540cuserId\u548c\u76f8\u540cThreadId\u7684\u7ebf\u7a0b\u62ff\u5230\u9501\n         * threadId\u4fdd\u8bc1\u540c\u4e00\u4e2aJVM\u5185\u76f8\u540cuserId\u7684\u7ebf\u7a0b\u62ff\u5230\u9501\n         */\n        String threadID = ID_PREFIX + Thread.currentThread().getId();\n        Boolean success = stringRedisTemplate.opsForValue().setIfAbsent(KEY_PREFIX + name, threadID, timeoutSec, TimeUnit.SECONDS);\n        return BooleanUtil.isTrue(success);\n    }\n\n    /**\n     * \u4f7f\u7528lua\u811a\u672c\u4fdd\u8bc1\u6bd4\u9501\u5220\u9501\u7684\u539f\u5b50\u6027\n     */\n    @Override\n    public void unlock() {\n        //\u8c03\u7528lua\u811a\u672c\n        stringRedisTemplate.execute(\n                UNLOCK_SCRIPT,\n                Collections.singletonList(KEY_PREFIX + name),\n                ID_PREFIX + Thread.currentThread().getId()\n        );\n    }\n\n    /**\n     * \u4e0b\u9762\u65b9\u6cd5\u8fd8\u5b58\u5728\u6bd4\u9501\u548c\u91ca\u653e\u9501\u4e4b\u95f4\u7684\u539f\u5b50\u6027\u95ee\u9898\n     * \u6240\u4ee5\u91c7\u7528lua\u811a\u672c\u5b9e\u73b0\u539f\u5b50\u6027\u64cd\u4f5c\uff0c\u56e0\u4e3a\u8c03\u7528lua\u811a\u672c\u53ea\u9700\u8981\u4e00\u884c\u4ee3\u7801\n     */\n    /*@Override\n    public void unlock() {\n        //\u83b7\u53d6\u7ebf\u7a0b\u6807\u8bc6\n        String threadId = ID_PREFIX + Thread.currentThread().getId();\n        //\u83b7\u53d6\u9501\u4e2d\u7684\u6807\u8bc6\uff08value\uff09\n        String id = stringRedisTemplate.opsForValue().get(KEY_PREFIX + name);\n        //\u5224\u65ad\u6807\u8bc6\u662f\u5426\u4e00\u81f4\n        if (threadId.equals(id)) {\n            //\u91ca\u653e\u9501\n            stringRedisTemplate.delete(KEY_PREFIX + name);\n        }\n    }*/\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u5c0f\u603b\u7ed3",children:"\u5c0f\u603b\u7ed3"}),"\n",(0,r.jsx)(n.p,{children:"\u57fa\u4e8eRedis\u7684\u5206\u5e03\u5f0f\u9501\u5b9e\u73b0\u601d\u8def\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5229\u7528set nx ex\u83b7\u53d6\u9501\uff0c\u5e76\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u4fdd\u5b58\u7ebf\u7a0b\u6807\u793a"}),"\n",(0,r.jsxs)(n.li,{children:["\u91ca\u653e\u9501\u65f6\u5148\u5224\u65ad\u7ebf\u7a0b\u6807\u793a\u662f\u5426\u4e0e\u81ea\u5df1\u4e00\u81f4\uff0c\u4e00\u81f4\u5219\u5220\u9664\u9501\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u7279\u6027\uff1a\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u5229\u7528set nx\u6ee1\u8db3",(0,r.jsx)(n.strong,{children:"\u4e92\u65a5\u6027"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u5229\u7528set ex\u4fdd\u8bc1\u6545\u969c\u65f6\u9501\u4f9d\u7136\u80fd\u91ca\u653e\uff0c",(0,r.jsx)(n.strong,{children:"\u907f\u514d\u6b7b\u9501"}),"\uff0c\u63d0\u9ad8\u5b89\u5168\u6027"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5229\u7528Redis\u96c6\u7fa4\u4fdd\u8bc1",(0,r.jsx)(n.strong,{children:"\u9ad8\u53ef\u7528\u548c\u9ad8\u5e76\u53d1\u7279\u6027"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u7b14\u8005\u603b\u7ed3\uff1a\u6211\u4eec\u4e00\u8def\u8d70\u6765\uff0c\u5229\u7528\u6dfb\u52a0\u8fc7\u671f\u65f6\u95f4\uff0c\u9632\u6b62\u6b7b\u9501\u95ee\u9898\u7684\u53d1\u751f\uff0c\u4f46\u662f\u6709\u4e86\u8fc7\u671f\u65f6\u95f4\u4e4b\u540e\uff0c\u53ef\u80fd\u51fa\u73b0\u8bef\u5220\u522b\u4eba\u9501\u7684\u95ee\u9898\uff0c\u8fd9\u4e2a\u95ee\u9898\u6211\u4eec\u5f00\u59cb\u662f\u5229\u7528\u5220\u4e4b\u524d \u901a\u8fc7\u62ff\u9501\uff0c\u6bd4\u9501\uff0c\u5220\u9501\u8fd9\u4e2a\u903b\u8f91\u6765\u89e3\u51b3\u7684\uff0c\u4e5f\u5c31\u662f\u5220\u4e4b\u524d\u5224\u65ad\u4e00\u4e0b\u5f53\u524d\u8fd9\u628a\u9501\u662f\u5426\u662f\u5c5e\u4e8e\u81ea\u5df1\u7684\uff0c\u4f46\u662f\u73b0\u5728\u8fd8\u6709\u539f\u5b50\u6027\u95ee\u9898\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u6ca1\u6cd5\u4fdd\u8bc1\u62ff\u9501\u6bd4\u9501\u5220\u9501\u662f\u4e00\u4e2a\u539f\u5b50\u6027\u7684\u52a8\u4f5c\uff0c\u6700\u540e\u901a\u8fc7lua\u8868\u8fbe\u5f0f\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898"}),"\n",(0,r.jsx)(n.p,{children:"\u4f46\u662f\u76ee\u524d\u8fd8\u5269\u4e0b\u4e00\u4e2a\u95ee\u9898\u9501\u4e0d\u4f4f\uff0c\u4ec0\u4e48\u662f\u9501\u4e0d\u4f4f\u5462\uff0c\u4f60\u60f3\u4e00\u60f3\uff0c\u5982\u679c\u5f53\u8fc7\u671f\u65f6\u95f4\u5230\u4e86\u4e4b\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u7ed9\u4ed6\u7eed\u671f\u4e00\u4e0b\uff0c\u6bd4\u5982\u7eed\u4e2a30s\uff0c\u5c31\u597d\u50cf\u662f\u7f51\u5427\u4e0a\u7f51\uff0c \u7f51\u8d39\u5230\u4e86\u4e4b\u540e\uff0c\u7136\u540e\u8bf4\uff0c\u6765\uff0c\u7f51\u7ba1\uff0c\u518d\u7ed9\u6211\u676510\u5757\u7684\uff0c\u662f\u4e0d\u662f\u540e\u8fb9\u7684\u95ee\u9898\u90fd\u4e0d\u4f1a\u53d1\u751f\u4e86\uff0c\u90a3\u4e48\u7eed\u671f\u95ee\u9898\u600e\u4e48\u89e3\u51b3\u5462\uff0c\u53ef\u4ee5\u4f9d\u8d56\u4e8e\u6211\u4eec\u63a5\u4e0b\u6765\u8981\u5b66\u4e60redission\u5566"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u6d4b\u8bd5\u903b\u8f91\uff1a"})}),"\n",(0,r.jsx)(n.p,{children:"\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u8fdb\u6765\uff0c\u5f97\u5230\u4e86\u9501\uff0c\u624b\u52a8\u5220\u9664\u9501\uff0c\u6a21\u62df\u9501\u8d85\u65f6\u4e86\uff0c\u5176\u4ed6\u7ebf\u7a0b\u4f1a\u6267\u884clua\u6765\u62a2\u9501\uff0c\u5f53\u7b2c\u4e00\u5929\u7ebf\u7a0b\u5229\u7528lua\u5220\u9664\u9501\u65f6\uff0clua\u80fd\u4fdd\u8bc1\u4ed6\u4e0d\u80fd\u5220\u9664\u4ed6\u7684\u9501\uff0c\u7b2c\u4e8c\u4e2a\u7ebf\u7a0b\u5220\u9664\u9501\u65f6\uff0c\u5229\u7528lua\u540c\u6837\u53ef\u4ee5\u4fdd\u8bc1\u4e0d\u4f1a\u5220\u9664\u522b\u4eba\u7684\u9501\uff0c\u540c\u65f6\u8fd8\u80fd\u4fdd\u8bc1\u539f\u5b50\u6027\u3002"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"senx\u5206\u5e03\u5f0f\u9501\u8fd8\u5b58\u5728\u4e00\u4e9b\u95ee\u9898\uff0c\u5982\u4e0bredission\u4e2d\u6240\u8ff0\uff1a"}),"\n"]}),"\n",(0,r.jsxs)(n.h1,{id:"5\u5206\u5e03\u5f0f\u9501-redission",children:["5\u3001\u5206\u5e03\u5f0f\u9501-",(0,r.jsx)(n.strong,{children:"redission"})]}),"\n",(0,r.jsx)(n.h2,{id:"51-\u5206\u5e03\u5f0f\u9501-redission\u529f\u80fd\u4ecb\u7ecd",children:"5.1 \u5206\u5e03\u5f0f\u9501-redission\u529f\u80fd\u4ecb\u7ecd"}),"\n",(0,r.jsx)(n.p,{children:"\u57fa\u4e8esetnx\u5b9e\u73b0\u7684\u5206\u5e03\u5f0f\u9501\u5b58\u5728\u4e0b\u9762\u7684\u95ee\u9898\uff1a"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u91cd\u5165\u95ee\u9898"}),"\uff1a\u91cd\u5165\u95ee\u9898\u662f\u6307 \u83b7\u5f97\u9501\u7684\u7ebf\u7a0b\u53ef\u4ee5\u518d\u6b21\u8fdb\u5165\u5230\u76f8\u540c\u7684\u9501\u7684\u4ee3\u7801\u5757\u4e2d\uff0c\u53ef\u91cd\u5165\u9501\u7684\u610f\u4e49\u5728\u4e8e\u9632\u6b62\u6b7b\u9501\uff0c\u6bd4\u5982HashTable\u8fd9\u6837\u7684\u4ee3\u7801\u4e2d\uff0c\u4ed6\u7684\u65b9\u6cd5\u90fd\u662f\u4f7f\u7528synchronized\u4fee\u9970\u7684\uff0c\u5047\u5982\u4ed6\u5728\u4e00\u4e2a\u65b9\u6cd5\u5185\uff0c\u8c03\u7528\u53e6\u4e00\u4e2a\u65b9\u6cd5\uff0c\u90a3\u4e48\u6b64\u65f6\u5982\u679c\u662f\u4e0d\u53ef\u91cd\u5165\u7684\uff0c\u4e0d\u5c31\u6b7b\u9501\u4e86\u5417\uff1f\u6240\u4ee5\u53ef\u91cd\u5165\u9501\u4ed6\u7684\u4e3b\u8981\u610f\u4e49\u662f\u9632\u6b62\u6b7b\u9501\uff0c\u6211\u4eec\u7684synchronized\u548cLock\u9501\u90fd\u662f\u53ef\u91cd\u5165\u7684\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u4e0d\u53ef\u91cd\u8bd5"}),"\uff1a\u662f\u6307\u76ee\u524d\u7684\u5206\u5e03\u5f0f\u53ea\u80fd\u5c1d\u8bd5\u4e00\u6b21\uff0c\u6211\u4eec\u8ba4\u4e3a\u5408\u7406\u7684\u60c5\u51b5\u662f\uff1a\u5f53\u7ebf\u7a0b\u5728\u83b7\u5f97\u9501\u5931\u8d25\u540e\uff0c\u4ed6\u5e94\u8be5\u80fd\u518d\u6b21\u5c1d\u8bd5\u83b7\u5f97\u9501\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"**\u8d85\u65f6\u91ca\u653e\uff1a**\u6211\u4eec\u5728\u52a0\u9501\u65f6\u589e\u52a0\u4e86\u8fc7\u671f\u65f6\u95f4\uff0c\u8fd9\u6837\u7684\u6211\u4eec\u53ef\u4ee5\u9632\u6b62\u6b7b\u9501\uff0c\u4f46\u662f\u5982\u679c\u5361\u987f\u7684\u65f6\u95f4\u8d85\u957f\uff0c\u867d\u7136\u6211\u4eec\u91c7\u7528\u4e86lua\u8868\u8fbe\u5f0f\u9632\u6b62\u5220\u9501\u7684\u65f6\u5019\uff0c\u8bef\u5220\u522b\u4eba\u7684\u9501\uff0c\u4f46\u662f\u6bd5\u7adf\u6ca1\u6709\u9501\u4f4f\uff0c\u6709\u5b89\u5168\u9690\u60a3"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u4e3b\u4ece\u4e00\u81f4\u6027\uff1a"})," \u5982\u679cRedis\u63d0\u4f9b\u4e86\u4e3b\u4ece\u96c6\u7fa4\uff0c\u5f53\u6211\u4eec\u5411\u96c6\u7fa4\u5199\u6570\u636e\u65f6\uff0c\u4e3b\u673a\u9700\u8981\u5f02\u6b65\u7684\u5c06\u6570\u636e\u540c\u6b65\u7ed9\u4ece\u673a\uff0c\u800c\u4e07\u4e00\u5728\u540c\u6b65\u8fc7\u53bb\u4e4b\u524d\uff0c\u4e3b\u673a\u5b95\u673a\u4e86\uff0c\u5c31\u4f1a\u51fa\u73b0\u6b7b\u9501\u95ee\u9898\u3002"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653546070602",src:s(74688).A+"",width:"1541",height:"621"})}),"\n",(0,r.jsx)(n.p,{children:"\u90a3\u4e48\u4ec0\u4e48\u662fRedisson\u5462"}),"\n",(0,r.jsx)(n.p,{children:"Redisson\u662f\u4e00\u4e2a\u5728Redis\u7684\u57fa\u7840\u4e0a\u5b9e\u73b0\u7684Java\u9a7b\u5185\u5b58\u6570\u636e\u7f51\u683c\uff08In-Memory Data Grid\uff09\u3002\u5b83\u4e0d\u4ec5\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u7684\u5206\u5e03\u5f0f\u7684Java\u5e38\u7528\u5bf9\u8c61\uff0c\u8fd8\u63d0\u4f9b\u4e86\u8bb8\u591a\u5206\u5e03\u5f0f\u670d\u52a1\uff0c\u5176\u4e2d\u5c31\u5305\u542b\u4e86\u5404\u79cd\u5206\u5e03\u5f0f\u9501\u7684\u5b9e\u73b0\u3002"}),"\n",(0,r.jsx)(n.p,{children:"Redisson\u63d0\u4f9b\u4e86\u5206\u5e03\u5f0f\u9501\u7684\u591a\u79cd\u591a\u6837\u7684\u529f\u80fd"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653546736063",src:s(95350).A+"",width:"920",height:"402"})}),"\n",(0,r.jsx)(n.h2,{id:"52-\u5206\u5e03\u5f0f\u9501-redisson\u5feb\u901f\u5165\u95e8",children:"5.2 \u5206\u5e03\u5f0f\u9501-Redisson\u5feb\u901f\u5165\u95e8"}),"\n",(0,r.jsx)(n.p,{children:"\u5f15\u5165\u4f9d\u8d56\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"<dependency>\n\t<groupId>org.redisson</groupId>\n\t<artifactId>redisson</artifactId>\n\t<version>3.13.6</version>\n</dependency>\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u914d\u7f6eRedisson\u5ba2\u6237\u7aef\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Configuration\npublic class RedissonConfig {\n\n    @Bean\n    public RedissonClient redissonClient(){\n        // \u914d\u7f6e\n        Config config = new Config();\n        // \u82e5\u662f\u96c6\u7fa4\u4f7f\u7528useClusterServers()\n        config.useSingleServer().setAddress("redis://192.168.111.100:6379").setPassword("123456");\n        // \u521b\u5efaRedissonClient\u5bf9\u8c61\n        return Redisson.create(config);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u4f55\u4f7f\u7528Redisson\u7684\u5206\u5e03\u5f0f\u9501"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Resource\nprivate RedissonClient redissonClient;\n\n@Test\nvoid testRedisson() throws Exception{\n    //\u83b7\u53d6\u9501(\u53ef\u91cd\u5165)\uff0c\u6307\u5b9a\u9501\u7684\u540d\u79f0\n    RLock lock = redissonClient.getLock("anyLock");\n    //\u5c1d\u8bd5\u83b7\u53d6\u9501\uff0c\u53c2\u6570\u5206\u522b\u662f\uff1a\u83b7\u53d6\u9501\u7684\u6700\u5927\u7b49\u5f85\u65f6\u95f4(\u671f\u95f4\u4f1a\u91cd\u8bd5)\uff0c\u9501\u81ea\u52a8\u91ca\u653e\u65f6\u95f4\uff0c\u65f6\u95f4\u5355\u4f4d\n    boolean isLock = lock.tryLock(1,10,TimeUnit.SECONDS);\n    //\u5224\u65ad\u83b7\u53d6\u9501\u6210\u529f\n    if(isLock){\n        try{\n            System.out.println("\u6267\u884c\u4e1a\u52a1");          \n        }finally{\n            //\u91ca\u653e\u9501\n            if(lock.isLocked() && lock.isHeldByCurrentThread()){\n                lock.unlock();\n            }//\u8fd9\u91cc\u4e3a\u4ec0\u4e48\u8fd8\u8981\u518d\u5224\u65ad\u4e00\u6b21\uff0c\u57285.7\u4e2d\u8bb2\u89e3\n        }   \n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u5728 VoucherOrderServiceImpl"}),"\n",(0,r.jsx)(n.p,{children:"\u6ce8\u5165RedissonClient"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Resource\nprivate RedissonClient redissonClient;\n\n@Override\npublic Result seckillVoucher(Long voucherId) {\n        // 1.\u67e5\u8be2\u4f18\u60e0\u5238\n        SeckillVoucher voucher = seckillVoucherService.getById(voucherId);\n        // 2.\u5224\u65ad\u79d2\u6740\u662f\u5426\u5f00\u59cb\n        if (voucher.getBeginTime().isAfter(LocalDateTime.now())) {\n            // \u5c1a\u672a\u5f00\u59cb\n            return Result.fail("\u79d2\u6740\u5c1a\u672a\u5f00\u59cb\uff01");\n        }\n        // 3.\u5224\u65ad\u79d2\u6740\u662f\u5426\u5df2\u7ecf\u7ed3\u675f\n        if (voucher.getEndTime().isBefore(LocalDateTime.now())) {\n            // \u5c1a\u672a\u5f00\u59cb\n            return Result.fail("\u79d2\u6740\u5df2\u7ecf\u7ed3\u675f\uff01");\n        }\n        // 4.\u5224\u65ad\u5e93\u5b58\u662f\u5426\u5145\u8db3\n        if (voucher.getStock() < 1) {\n            // \u5e93\u5b58\u4e0d\u8db3\n            return Result.fail("\u5e93\u5b58\u4e0d\u8db3\uff01");\n        }\n        Long userId = UserHolder.getUser().getId();\n        //\u521b\u5efa\u9501\u5bf9\u8c61 \u8fd9\u4e2a\u4ee3\u7801\u4e0d\u7528\u4e86\uff0c\u56e0\u4e3a\u6211\u4eec\u73b0\u5728\u8981\u4f7f\u7528\u5206\u5e03\u5f0f\u9501\n        //SimpleRedisLock lock = new SimpleRedisLock("order:" + userId, stringRedisTemplate);\n        RLock lock = redissonClient.getLock("lock:order:" + userId);\n        //\u83b7\u53d6\u9501\u5bf9\u8c61\n        boolean isLock = lock.tryLock();\n       \n\t\t//\u52a0\u9501\u5931\u8d25\n        if (!isLock) {\n            return Result.fail("\u4e0d\u5141\u8bb8\u91cd\u590d\u4e0b\u5355");\n        }\n        try {\n            //\u83b7\u53d6\u4ee3\u7406\u5bf9\u8c61(\u4e8b\u52a1)\n            IVoucherOrderService proxy = (IVoucherOrderService) AopContext.currentProxy();\n            return proxy.createVoucherOrder(voucherId);\n        } finally {\n            //\u91ca\u653e\u9501\n            lock.unlock();\n        }\n }\n'})}),"\n",(0,r.jsx)(n.h2,{id:"53-\u5206\u5e03\u5f0f\u9501-redission\u53ef\u91cd\u5165\u9501\u539f\u7406",children:"5.3 \u5206\u5e03\u5f0f\u9501-redission\u53ef\u91cd\u5165\u9501\u539f\u7406"}),"\n",(0,r.jsx)(n.p,{children:"\u5728Lock\u9501\u4e2d\uff0c\u4ed6\u662f\u501f\u52a9\u4e8e\u5e95\u5c42\u7684\u4e00\u4e2avoaltile\u7684\u4e00\u4e2astate\u53d8\u91cf\u6765\u8bb0\u5f55\u91cd\u5165\u7684\u72b6\u6001\u7684\uff0c\u6bd4\u5982\u5f53\u524d\u6ca1\u6709\u4eba\u6301\u6709\u8fd9\u628a\u9501\uff0c\u90a3\u4e48state=0\uff0c\u5047\u5982\u6709\u4eba\u6301\u6709\u8fd9\u628a\u9501\uff0c\u90a3\u4e48state=1\uff0c\u5982\u679c\u6301\u6709\u8fd9\u628a\u9501\u7684\u4eba\u518d\u6b21\u6301\u6709\u8fd9\u628a\u9501\uff0c\u90a3\u4e48state\u5c31\u4f1a+1 \uff0c\u5982\u679c\u662f\u5bf9\u4e8esynchronized\u800c\u8a00\uff0c\u4ed6\u5728c\u8bed\u8a00\u4ee3\u7801\u4e2d\u4f1a\u6709\u4e00\u4e2acount\uff0c\u539f\u7406\u548cstate\u7c7b\u4f3c\uff0c\u4e5f\u662f\u91cd\u5165\u4e00\u6b21\u5c31\u52a0\u4e00\uff0c\u91ca\u653e\u4e00\u6b21\u5c31-1 \uff0c\u76f4\u5230\u51cf\u5c11\u62100 \u65f6\uff0c\u8868\u793a\u5f53\u524d\u8fd9\u628a\u9501\u6ca1\u6709\u88ab\u4eba\u6301\u6709\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653548087334",src:s(76733).A+"",width:"1655",height:"720"})}),"\n",(0,r.jsx)(n.p,{children:"\u5728redission\u4e2d\uff0c\u6211\u4eec\u7684\u4e5f\u652f\u6301\u652f\u6301\u53ef\u91cd\u5165\u9501"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u5206\u5e03\u5f0f\u9501\u4e2d\uff0c\u4ed6\u91c7\u7528hash\u7ed3\u6784\u7528\u6765\u5b58\u50a8\u9501\uff0c\u5176\u4e2d\u5927key\u8868\u793a\u8868\u793a\u8fd9\u628a\u9501\u662f\u5426\u5b58\u5728\uff0c\u7528\u5c0fkey\u8868\u793a\u5f53\u524d\u8fd9\u628a\u9501\u88ab\u54ea\u4e2a\u7ebf\u7a0b\u6301\u6709\uff0c\u6240\u4ee5\u63a5\u4e0b\u6765\u6211\u4eec\u4e00\u8d77\u5206\u6790\u4e00\u4e0b\u5f53\u524d\u7684\u8fd9\u4e2alua\u8868\u8fbe\u5f0f"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u83b7\u5f97\u9501\uff1a"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20231003230525033",src:s(58529).A+"",width:"2205",height:"1079"})}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u4e2a\u5730\u65b9\u4e00\u5171\u67093\u4e2a\u53c2\u6570"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"KEYS[1] \uff1a \u9501\u540d\u79f0"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"ARGV[1]\uff1a  \u9501\u5931\u6548\u65f6\u95f4"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:'ARGV[2]\uff1a  id + ":" + threadId; \u9501\u7684\u5c0fkey'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u91ca\u653e\u9501\uff1a"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20231003230754547",src:s(25011).A+"",width:"2177",height:"1134"})}),"\n",(0,r.jsx)(n.h2,{id:"54-\u5206\u5e03\u5f0f\u9501-redission\u9501\u91cd\u8bd5\u548cwatchdog\u673a\u5236",children:"5.4 \u5206\u5e03\u5f0f\u9501-redission\u9501\u91cd\u8bd5\u548cWatchDog\u673a\u5236"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20231004185259933",src:s(63e3).A+"",width:"2135",height:"1028"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u9501\u91cd\u8bd5"}),"\u89e3\u51b3\u4e86\u4e0d\u80fd\u91cd\u8bd5\u7684\u95ee\u9898\uff0c",(0,r.jsx)(n.strong,{children:"WatchDog\u673a\u5236"}),"\u89e3\u51b3\u4e86\u9501\u8d85\u65f6\u91ca\u653e\u7684\u95ee\u9898"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"**\u9501\u91cd\u8bd5\uff1a**\u5f53\u83b7\u53d6\u9501\u6210\u529f\uff0c\u8fd4\u56dettl\u4e3anull\uff1b\u5f53\u83b7\u53d6\u9501\u5931\u8d25\u65f6\uff0c\u5c06\u8fd4\u56de\u5269\u4f59\u6709\u6548\u671f\uff0c\u7136\u540e\u5c06\u4f1a\u5224\u65ad\u8bbe\u7f6e\u7684\u7b49\u5f85\u9501\u7684\u65f6\u95f4\u662f\u5426\u8fd8\u6709\uff0c\u5982\u679c\u8fd8\u6709\u5219\u4f7f\u7528\u8ba2\u9605\u673a\u5236\uff0c\u8ba2\u9605\u9501\u91ca\u653e\u7684\u4fe1\u53f7\uff0c\u6536\u5230\u4fe1\u53f7\u540e\u518d\u6b21\u5224\u65ad\u662f\u5426\u8fd8\u6709\u5269\u4f59\u65f6\u95f4\uff0c\u6709\u5c31\u518d\u6b21\u5c1d\u8bd5\u83b7\u53d6\u9501\uff0c\u82e5\u83b7\u53d6\u9501\u5931\u8d25\u5219\u518d\u6b21\u5faa\u73af\u4e0a\u9762\u6b65\u9aa4"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["WatchDog\u673a\u5236\uff1a",(0,r.jsx)(n.strong,{children:"\u8bbe\u7f6e\u9501TTL\u8d85\u65f6\u91ca\u653e\u65f6\u95f4\u662f\u56e0\u4e3a\u6015\u4e1a\u52a1\u5b95\u673a\u8fc7\u540e\uff0c\u9020\u6210\u65e0\u4eba\u80fd\u83b7\u53d6\u9501\u7684\u73b0\u8c61\uff0c\u4f46\u662f\u5982\u679c\u4e1a\u52a1\u6ca1\u6709\u5b95\u673a\u4e5f\u6709\u53ef\u80fd\u88ab\u8d85\u65f6\u91ca\u653e\uff0c\u6240\u4ee5\u8bbe\u7f6e\u4e86WatchDog\u673a\u5236\uff0c\u5f53"}),"\u6ca1\u6709\u8bbe\u7f6eTTL\u65f6\uff0c\u9ed8\u8ba4\u4e3a-1\uff0c\u624d\u4f1a\u6709\u770b\u95e8\u72d7\u673a\u5236"]}),"\uff0c\u9ed8\u8ba4TTL\u65f6\u95f4\u4e3a30s\uff0c",(0,r.jsx)(n.strong,{children:"\u53ea\u8981\u4e1a\u52a1\u6ca1\u6709\u5b95\u673a"}),"\uff0c\u6bcf\u8fc71/3TTL\u65f6\u95f4\u537310s\uff0c\u5c31\u4f1a\u91cd\u65b0\u8bbe\u7f6eTTL\u65f6\u95f4\uff0c\u8fbe\u5230\u4e0d\u4f1a\u8fc7\u671f\u7684\u76ee\u7684\uff0c\u82e5\u662f\u81ea\u5df1\u8bbe\u7f6e\u4e86TTL\u65f6\u95f4\uff0c\u5219\u6ca1\u6709\u770b\u95e8\u72d7\u673a\u5236\uff0c",(0,r.jsx)(n.strong,{children:"\u82e5\u662f\u4e1a\u52a1\u5b95\u673a"}),"\uff0c\u5c06\u65e0\u6cd5\u91cd\u7f6eTTL\uff0c\u8fc7\u671f\u540e\u81ea\u52a8\u91ca\u653e\u9501"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u53ef\u91cd\u5165\uff1a\u5229\u7528hash\u7ed3\u6784\u8bb0\u5f55\u7ebf\u7a0bid\u548c\u91cd\u5165\u6b21\u6570"}),"\n",(0,r.jsx)(n.li,{children:"\u53ef\u91cd\u8bd5\uff1a\u5229\u7528\u4fe1\u53f7\u91cf\u548cPubSub\u529f\u80fd\u5b9e\u73b0\u7b49\u5f85\u3001\u5524\u9192\uff0c\u83b7\u53d6\u9501\u5931\u8d25\u7684\u91cd\u8bd5\u673a\u5236"}),"\n",(0,r.jsx)(n.li,{children:"\u8d85\u65f6\u7eed\u7ea6\uff1a\u5229\u7528watchDog,\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4(releaseTime/3),\u91cd\u7f6e\u8d85\u65f6\u65f6\u95f4"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u8bf4\u660e"}),"\uff1a\u7531\u4e8e\u8bfe\u7a0b\u4e2d\u5df2\u7ecf\u8bf4\u660e\u4e86\u6709\u5173tryLock\u7684\u6e90\u7801\u89e3\u6790\u4ee5\u53ca\u5176\u770b\u95e8\u72d7\u539f\u7406\uff0c\u6240\u4ee5\u7b14\u8005\u5728\u8fd9\u91cc\u7ed9\u5927\u5bb6\u5206\u6790lock()\u65b9\u6cd5\u7684\u6e90\u7801\u89e3\u6790\uff0c\u5e0c\u671b\u5927\u5bb6\u5728\u5b66\u4e60\u8fc7\u7a0b\u4e2d\uff0c\u80fd\u591f\u638c\u63e1\u66f4\u591a\u7684\u77e5\u8bc6"]}),"\n",(0,r.jsx)(n.p,{children:"\u62a2\u9501\u8fc7\u7a0b\u4e2d\uff0c\u83b7\u5f97\u5f53\u524d\u7ebf\u7a0b\uff0c\u901a\u8fc7tryAcquire\u8fdb\u884c\u62a2\u9501\uff0c\u8be5\u62a2\u9501\u903b\u8f91\u548c\u4e4b\u524d\u903b\u8f91\u76f8\u540c"}),"\n",(0,r.jsx)(n.p,{children:"1\u3001\u5148\u5224\u65ad\u5f53\u524d\u8fd9\u628a\u9501\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u63d2\u5165\u4e00\u628a\u9501\uff0c\u8fd4\u56denull"}),"\n",(0,r.jsx)(n.p,{children:"2\u3001\u5224\u65ad\u5f53\u524d\u8fd9\u628a\u9501\u662f\u5426\u662f\u5c5e\u4e8e\u5f53\u524d\u7ebf\u7a0b\uff0c\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56denull"}),"\n",(0,r.jsx)(n.p,{children:"\u6240\u4ee5\u5982\u679c\u8fd4\u56de\u662fnull\uff0c\u5219\u4ee3\u8868\u7740\u5f53\u524d\u8fd9\u54e5\u4eec\u5df2\u7ecf\u62a2\u9501\u5b8c\u6bd5\uff0c\u6216\u8005\u53ef\u91cd\u5165\u5b8c\u6bd5\uff0c\u4f46\u662f\u5982\u679c\u4ee5\u4e0a\u4e24\u4e2a\u6761\u4ef6\u90fd\u4e0d\u6ee1\u8db3\uff0c\u5219\u8fdb\u5165\u5230\u7b2c\u4e09\u4e2a\u6761\u4ef6\uff0c\u8fd4\u56de\u7684\u662f\u9501\u7684\u5931\u6548\u65f6\u95f4\uff0c\u540c\u5b66\u4eec\u53ef\u4ee5\u81ea\u884c\u5f80\u4e0b\u7ffb\u4e00\u70b9\u70b9\uff0c\u4f60\u80fd\u53d1\u73b0\u6709\u4e2awhile( true) \u518d\u6b21\u8fdb\u884ctryAcquire\u8fdb\u884c\u62a2\u9501"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"long threadId = Thread.currentThread().getId();\nLong ttl = tryAcquire(-1, leaseTime, unit, threadId);\n// lock acquired\nif (ttl == null) {\n    return;\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\u4f1a\u6709\u4e00\u4e2a\u6761\u4ef6\u5206\u652f\uff0c\u56e0\u4e3alock\u65b9\u6cd5\u6709\u91cd\u8f7d\u65b9\u6cd5\uff0c\u4e00\u4e2a\u662f\u5e26\u53c2\u6570\uff0c\u4e00\u4e2a\u662f\u4e0d\u5e26\u53c2\u6570\uff0c\u5982\u679c\u5e26\u5e26\u53c2\u6570\u4f20\u5165\u7684\u503c\u662f-1\uff0c\u5982\u679c\u4f20\u5165\u53c2\u6570\uff0c\u5219leaseTime\u662f\u4ed6\u672c\u8eab\uff0c\u6240\u4ee5\u5982\u679c\u4f20\u5165\u4e86\u53c2\u6570\uff0c\u6b64\u65f6leaseTime != -1 \u5219\u4f1a\u8fdb\u53bb\u62a2\u9501\uff0c\u62a2\u9501\u7684\u903b\u8f91\u5c31\u662f\u4e4b\u524d\u8bf4\u7684\u90a3\u4e09\u4e2a\u903b\u8f91"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"if (leaseTime != -1) {\n    return tryLockInnerAsync(waitTime, leaseTime, unit, threadId, RedisCommands.EVAL_LONG);\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u662f\u6ca1\u6709\u4f20\u5165\u65f6\u95f4\uff0c\u5219\u6b64\u65f6\u4e5f\u4f1a\u8fdb\u884c\u62a2\u9501\uff0c \u800c\u4e14\u62a2\u9501\u65f6\u95f4\u662f\u9ed8\u8ba4\u770b\u95e8\u72d7\u65f6\u95f4 commandExecutor.getConnectionManager().getCfg().getLockWatchdogTimeout()"}),"\n",(0,r.jsx)(n.p,{children:"ttlRemainingFuture.onComplete((ttlRemaining, e) \u8fd9\u53e5\u8bdd\u76f8\u5f53\u4e8e\u5bf9\u4ee5\u4e0a\u62a2\u9501\u8fdb\u884c\u4e86\u76d1\u542c\uff0c\u4e5f\u5c31\u662f\u8bf4\u5f53\u4e0a\u8fb9\u62a2\u9501\u5b8c\u6bd5\u540e\uff0c\u6b64\u65b9\u6cd5\u4f1a\u88ab\u8c03\u7528\uff0c\u5177\u4f53\u8c03\u7528\u7684\u903b\u8f91\u5c31\u662f\u53bb\u540e\u53f0\u5f00\u542f\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u8fdb\u884c\u7eed\u7ea6\u903b\u8f91\uff0c\u4e5f\u5c31\u662f\u770b\u95e8\u72d7\u7ebf\u7a0b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"RFuture<Long> ttlRemainingFuture = tryLockInnerAsync(waitTime,\n                                        commandExecutor.getConnectionManager().getCfg().getLockWatchdogTimeout(),\n                                        TimeUnit.MILLISECONDS, threadId, RedisCommands.EVAL_LONG);\nttlRemainingFuture.onComplete((ttlRemaining, e) -> {\n    if (e != null) {\n        return;\n    }\n\n    // lock acquired\n    if (ttlRemaining == null) {\n        scheduleExpirationRenewal(threadId);\n    }\n});\nreturn ttlRemainingFuture;\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6b64\u903b\u8f91\u5c31\u662f\u7eed\u7ea6\u903b\u8f91\uff0c\u6ce8\u610f\u770bcommandExecutor.getConnectionManager().newTimeout\uff08\uff09 \u6b64\u65b9\u6cd5"}),"\n",(0,r.jsxs)(n.p,{children:["Method(  ",(0,r.jsx)(n.strong,{children:"new"})," TimerTask() {},\u53c2\u65702 \uff0c\u53c2\u65703  )"]}),"\n",(0,r.jsx)(n.p,{children:"\u6307\u7684\u662f\uff1a\u901a\u8fc7\u53c2\u65702\uff0c\u53c2\u65703 \u53bb\u63cf\u8ff0\u4ec0\u4e48\u65f6\u5019\u53bb\u505a\u53c2\u65701\u7684\u4e8b\u60c5\uff0c\u73b0\u5728\u7684\u60c5\u51b5\u662f\uff1a10s\u4e4b\u540e\u53bb\u505a\u53c2\u6570\u4e00\u7684\u4e8b\u60c5"}),"\n",(0,r.jsx)(n.p,{children:"\u56e0\u4e3a\u9501\u7684\u5931\u6548\u65f6\u95f4\u662f30s\uff0c\u5f5310s\u4e4b\u540e\uff0c\u6b64\u65f6\u8fd9\u4e2atimeTask \u5c31\u89e6\u53d1\u4e86\uff0c\u4ed6\u5c31\u53bb\u8fdb\u884c\u7eed\u7ea6\uff0c\u628a\u5f53\u524d\u8fd9\u628a\u9501\u7eed\u7ea6\u621030s\uff0c\u5982\u679c\u64cd\u4f5c\u6210\u529f\uff0c\u90a3\u4e48\u6b64\u65f6\u5c31\u4f1a\u9012\u5f52\u8c03\u7528\u81ea\u5df1\uff0c\u518d\u91cd\u65b0\u8bbe\u7f6e\u4e00\u4e2atimeTask()\uff0c\u4e8e\u662f\u518d\u8fc710s\u540e\u53c8\u518d\u8bbe\u7f6e\u4e00\u4e2atimerTask\uff0c\u5b8c\u6210\u4e0d\u505c\u7684\u7eed\u7ea6"}),"\n",(0,r.jsx)(n.p,{children:"\u90a3\u4e48\u5927\u5bb6\u53ef\u4ee5\u60f3\u4e00\u60f3\uff0c\u5047\u8bbe\u6211\u4eec\u7684\u7ebf\u7a0b\u51fa\u73b0\u4e86\u5b95\u673a\u4ed6\u8fd8\u4f1a\u7eed\u7ea6\u5417\uff1f\u5f53\u7136\u4e0d\u4f1a\uff0c\u56e0\u4e3a\u6ca1\u6709\u4eba\u518d\u53bb\u8c03\u7528renewExpiration\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u6240\u4ee5\u7b49\u5230\u65f6\u95f4\u4e4b\u540e\u81ea\u7136\u5c31\u91ca\u653e\u4e86\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'private void renewExpiration() {\n    ExpirationEntry ee = EXPIRATION_RENEWAL_MAP.get(getEntryName());\n    if (ee == null) {\n        return;\n    }\n    \n    Timeout task = commandExecutor.getConnectionManager().newTimeout(new TimerTask() {\n        @Override\n        public void run(Timeout timeout) throws Exception {\n            ExpirationEntry ent = EXPIRATION_RENEWAL_MAP.get(getEntryName());\n            if (ent == null) {\n                return;\n            }\n            Long threadId = ent.getFirstThreadId();\n            if (threadId == null) {\n                return;\n            }\n            \n            RFuture<Boolean> future = renewExpirationAsync(threadId);\n            future.onComplete((res, e) -> {\n                if (e != null) {\n                    log.error("Can\'t update lock " + getName() + " expiration", e);\n                    return;\n                }\n                \n                if (res) {\n                    // reschedule itself\n                    renewExpiration();\n                }\n            });\n        }\n    }, internalLockLeaseTime / 3, TimeUnit.MILLISECONDS);\n    \n    ee.setTimeout(task);\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"55-\u5206\u5e03\u5f0f\u9501-redission\u9501\u7684mutilock\u539f\u7406",children:"5.5 \u5206\u5e03\u5f0f\u9501-redission\u9501\u7684MutiLock\u539f\u7406"}),"\n",(0,r.jsx)(n.p,{children:"\u4e3a\u4e86\u63d0\u9ad8redis\u7684\u53ef\u7528\u6027\uff0c\u6211\u4eec\u4f1a\u642d\u5efa\u96c6\u7fa4\u6216\u8005\u4e3b\u4ece\uff0c\u73b0\u5728\u4ee5\u4e3b\u4ece\u4e3a\u4f8b"}),"\n",(0,r.jsxs)(n.p,{children:["\u6b64\u65f6\u6211\u4eec\u53bb\u5199\u547d\u4ee4\uff0c\u5199\u5728\u4e3b\u673a\u4e0a\uff0c \u4e3b\u673a\u4f1a\u5c06\u6570\u636e\u540c\u6b65\u7ed9\u4ece\u673a\uff0c\u4f46\u662f\u5047\u8bbe\u5728\u4e3b\u673a\u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u628a\u6570\u636e\u5199\u5165\u5230\u4ece\u673a\u53bb\u7684\u65f6\u5019\uff0c\u6b64\u65f6\u4e3b\u673a\u5b95\u673a\uff0c\u54e8\u5175\u4f1a\u53d1\u73b0\u4e3b\u673a\u5b95\u673a\uff0c\u5e76\u4e14\u9009\u4e3e\u4e00\u4e2aslave\u53d8\u6210master\uff0c\u800c\u6b64\u65f6\u65b0\u7684master\u4e2d\u5b9e\u9645\u4e0a\u5e76\u6ca1\u6709\u9501\u4fe1\u606f\uff0c\u6b64\u65f6\u9501\u4fe1\u606f\u5c31\u5df2\u7ecf\u4e22\u6389\u4e86\uff0c\u6b64\u65f6\u5982\u679c\u6709\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u53bb\u4ece\u673a\u4e0a\u83b7\u5f97\u9501\u5c31\u4f1a\u6210\u529f\uff0c\u9020\u6210",(0,r.jsx)(n.strong,{children:"\u4e00\u9501\u88ab\u591a\u5efa\u591a\u7528"}),"\u3002"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653553998403",src:s(96544).A+"",width:"1121",height:"536"})}),"\n",(0,r.jsxs)(n.p,{children:["\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0credission\u63d0\u51fa\u6765\u4e86",(0,r.jsx)(n.strong,{children:"MutiLock\u9501"}),"\uff0c\u4f7f\u7528\u8fd9\u628a\u9501\u54b1\u4eec\u5c31",(0,r.jsx)(n.strong,{children:"\u4e0d\u4f7f\u7528\u4e3b\u4ece"}),"\u4e86\uff0c",(0,r.jsx)(n.strong,{children:"\u4f7f\u7528\u591a\u4e2a\u72ec\u7acb\u7684master"}),"\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684\u5730\u4f4d\u90fd\u662f\u4e00\u6837\u7684\uff0c\u8fd9\u628a\u9501\u52a0\u9501\u7684\u903b\u8f91\u9700\u8981\u5199\u5165\u5230\u6bcf\u4e00\u4e2a\u4e3b\u4e1b\u8282\u70b9\u4e0a\uff0c\u53ea\u6709\u6240\u6709\u7684\u670d\u52a1\u5668\u90fd\u5199\u5165\u6210\u529f\uff0c\u6b64\u65f6\u624d\u662f\u52a0\u9501\u6210\u529f\uff0c\u5047\u8bbe\u73b0\u5728\u67d0\u4e2a\u8282\u70b9\u6302\u4e86\uff0c\u90a3\u4e48\u4ed6\u53bb\u83b7\u5f97\u9501\u7684\u65f6\u5019\uff0c\u53ea\u8981\u6709\u4e00\u4e2a\u8282\u70b9\u62ff\u4e0d\u5230\uff0c\u90fd\u4e0d\u80fd\u7b97\u662f\u52a0\u9501\u6210\u529f\uff0c\u5c31\u4fdd\u8bc1\u4e86\u52a0\u9501\u7684\u53ef\u9760\u6027\u3002"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653554055048",src:s(7400).A+"",width:"1591",height:"579"})}),"\n",(0,r.jsx)(n.p,{children:"\u90a3\u4e48MutiLock\uff08\u8fde\u9501\uff09 \u52a0\u9501\u539f\u7406\u662f\u4ec0\u4e48\u5462\uff1f\u7b14\u8005\u753b\u4e86\u4e00\u5e45\u56fe\u6765\u8bf4\u660e"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"**MutiLock\uff08\u8fde\u9501\uff09\uff1a**\u5f53\u6211\u4eec\u53bb\u8bbe\u7f6e\u4e86\u591a\u4e2a\u9501\u65f6\uff0credission\u4f1a\u5c06\u591a\u4e2a\u9501\u6dfb\u52a0\u5230\u4e00\u4e2a\u96c6\u5408\u4e2d\uff0c\u7136\u540e\u7528while\u5faa\u73af\u53bb\u4e0d\u505c\u53bb\u5c1d\u8bd5\u62ff\u9501\uff0c\u4f46\u662f\u4f1a\u6709\u4e00\u4e2a\u603b\u5171\u7684\u52a0\u9501\u65f6\u95f4\uff0c\u8fd9\u4e2a\u65f6\u95f4\u662f\u7528 \u9700\u8981\u52a0\u9501\u7684\u4e2a\u6570 * 1500ms \uff0c\u5047\u8bbe\u67093\u4e2a\u9501\uff0c\u90a3\u4e48\u65f6\u95f4\u5c31\u662f4500ms\uff0c\u5047\u8bbe\u5728\u8fd94500ms\u5185\uff0c\u6240\u6709\u7684\u9501\u90fd\u52a0\u9501\u6210\u529f\uff08\u83b7\u53d6\u5230\u7684\u9501\u4f1a\u653e\u5230\u4e00\u4e2aacquiredLocks\u5217\u8868\u91cc\uff09\uff0c\u90a3\u4e48\u6b64\u65f6\u624d\u7b97\u662f\u52a0\u9501\u6210\u529f\uff0c\u5982\u679c\u57284500ms\u6709\u7ebf\u7a0b\u52a0\u9501\u5931\u8d25\uff0c\u5219\u4f1a\u91ca\u653e\u6389\u6240\u6709\u5df2\u7ecf\u83b7\u5f97\u6210\u529f\u7684\u9501\uff0c\u518d\u6b21\u53bb\u8fdb\u884c\u91cd\u8bd5\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653553093967",src:s(42533).A+"",width:"1411",height:"428"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u4f7f\u7528\uff1a"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'RLock lock1 = redissonClient.getLock("order" + userId);\nRLock lock2 = redissonClient.getLock("order" + userId);\nRLock lock3 = redissonClient.getLock("order" + userId);\nRLock multiLock = redissonClient.getMultiLock(lock1, lock2, lock3);\n'})}),"\n",(0,r.jsx)(n.h2,{id:"56-\u5206\u5e03\u5f0f\u9501-redission\u9501\u7684\u7ea2\u9501redlock",children:"5.6 \u5206\u5e03\u5f0f\u9501-redission\u9501\u7684\u7ea2\u9501RedLock"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"RedLock\u5df2\u88ab\u5f03\u7528"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["RedLock\u89e3\u51b3\u7684\u95ee\u9898\u548c\u8054\u9501\u4e00\u6837\uff0c\u90fd\u662f\u4e3a\u4e86\u89e3\u51b3\u5355\u673a\u60c5\u51b5\u4e0b\u7684",(0,r.jsx)(n.strong,{children:"\u5355\u70b9\u6545\u969c\u95ee\u9898"}),"\u6216\u8005\u4e3b\u4ece\u6a21\u5f0f\u4e0b\u7684",(0,r.jsx)(n.strong,{children:"\u4e00\u9501\u591a\u5efa\u591a\u7528\u95ee\u9898"})]}),"\n",(0,r.jsxs)(n.p,{children:["\u4ecd\u7136\u91c7\u7528\u7684\u662f ",(0,r.jsx)(n.strong,{children:"\u591a\u53f0 \u72ec\u7acb\u7684 master\u4e3b\u8282\u70b9"}),"\uff0c\u6570\u91cf\u53ef\u4e3a",(0,r.jsx)(n.strong,{children:"\u5927\u4e8e\u7b49\u4e8e3\u7684\u5947\u6570"}),"\uff0c\u5b98\u65b9\u63a8\u8350\u6570\u91cf\u4e3a5"]}),"\n",(0,r.jsxs)(n.p,{children:["\u8be5\u65b9\u6848\u4e5f\u662f\u57fa\u4e8e\uff08set \u52a0\u9501\u3001Lua \u811a\u672c\u89e3\u9501\uff09\u8fdb\u884c\u6539\u826f\u7684\u3002\u5047\u8bbe\u6211\u4eec\u6709N\u4e2aRedis\u4e3b\u8282\u70b9\uff0c\u4f8b\u5982 N = 5\u8fd9\u4e9b\u8282\u70b9\u662f\u5b8c\u5168\u72ec\u7acb\u7684\uff0c\u6211\u4eec\u4e0d\u4f7f\u7528\u590d\u5236\u6216\u4efb\u4f55\u5176\u4ed6\u9690\u5f0f\u534f\u8c03\u7cfb\u7edf\uff0c",(0,r.jsx)(n.strong,{children:"\u83b7\u53d6\u9501\u7684\u6b65\u9aa4\u5982\u4e0b\uff1a"})]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u83b7\u53d6\u5f53\u524dUnix\u65f6\u95f4"}),"\uff0c\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u4f9d\u6b21\u5c1d\u8bd5\u4ece5\u4e2a\u5b9e\u4f8b\uff0c\u4f7f\u7528\u76f8\u540c\u7684 key \u548c\u968f\u673a\u503c\uff08\u4f8b\u5982 UUID\uff09\u83b7\u53d6\u9501"}),"\u3002\u5f53\u5411Redis \u8bf7\u6c42\u83b7\u53d6\u9501\u65f6\uff0c\u5ba2\u6237\u7aef\u5e94\u8be5\u8bbe\u7f6e\u4e00\u4e2a\u8d85\u65f6\u65f6\u95f4\uff0c\u8fd9\u4e2a\u8d85\u65f6\u65f6\u95f4\u5e94\u8be5\u5c0f\u4e8e\u9501\u7684\u5931\u6548\u65f6\u95f4\u3002\u4f8b\u5982\u4f60\u7684\u9501\u81ea\u52a8\u5931\u6548\u65f6\u95f4\u4e3a 10 \u79d2\uff0c\u5219\u8d85\u65f6\u65f6\u95f4\u5e94\u8be5\u5728 5-50 \u6beb\u79d2\u4e4b\u95f4\u3002\u8fd9\u6837\u53ef\u4ee5\u9632\u6b62\u5ba2\u6237\u7aef\u5728\u8bd5\u56fe\u4e0e\u4e00\u4e2a\u5b95\u673a\u7684 Redis \u8282\u70b9\u5bf9\u8bdd\u65f6\u957f\u65f6\u95f4\u5904\u4e8e\u963b\u585e\u72b6\u6001\u3002",(0,r.jsx)(n.strong,{children:"\u5982\u679c\u4e00\u4e2a\u5b9e\u4f8b\u4e0d\u53ef\u7528\uff0c\u5ba2\u6237\u7aef\u5e94\u8be5\u5c3d\u5feb\u5c1d\u8bd5\u53bb\u53e6\u5916\u4e00\u4e2a Redis \u5b9e\u4f8b\u8bf7\u6c42\u83b7\u53d6\u9501\uff1b"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u5ba2\u6237\u7aef\u901a\u8fc7\u5f53\u524d\u65f6\u95f4\u51cf\u53bb\u6b65\u9aa4 1 \u8bb0\u5f55\u7684\u65f6\u95f4\u6765",(0,r.jsx)(n.strong,{children:"\u8ba1\u7b97\u83b7\u53d6\u9501\u4f7f\u7528\u7684\u65f6\u95f4"}),"\u3002",(0,r.jsx)(n.strong,{children:"\u5f53\u4e14\u4ec5\u5f53\u4ece\u5927\u591a\u6570\uff08N/2+1\uff0c\u8fd9\u91cc\u662f 3 \u4e2a\u8282\u70b9\uff09\u7684 Redis \u8282\u70b9\u90fd\u53d6\u5230\u9501\uff0c\u5e76\u4e14\u83b7\u53d6\u9501\u4f7f\u7528\u7684\u65f6\u95f4\u5c0f\u4e8e\u9501\u5931\u6548\u65f6\u95f4\u65f6\uff0c\u9501\u624d\u7b97\u83b7\u53d6\u6210\u529f"}),"\uff1b"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5982\u679c\u53d6\u5230\u4e86\u9501\uff0c\u5176",(0,r.jsx)(n.strong,{children:"\u771f\u6b63\u6709\u6548\u65f6\u95f4\u7b49\u4e8e\u521d\u59cb\u6709\u6548\u65f6\u95f4\u51cf\u53bb\u83b7\u53d6\u9501\u6240\u4f7f\u7528\u7684\u65f6\u95f4"}),"\uff08\u6b65\u9aa4 3 \u8ba1\u7b97\u7684\u7ed3\u679c\uff09\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5982\u679c\u7531\u4e8e\u67d0\u4e9b\u539f\u56e0",(0,r.jsx)(n.strong,{children:"\u672a\u80fd\u83b7\u5f97\u9501"}),"\uff08\u65e0\u6cd5\u5728\u81f3\u5c11 N/2 + 1 \u4e2a Redis \u5b9e\u4f8b\u83b7\u53d6\u9501\u3001\u6216\u83b7\u53d6\u9501\u7684\u65f6\u95f4\u8d85\u8fc7\u4e86\u6709\u6548\u65f6\u95f4\uff09\uff0c",(0,r.jsx)(n.strong,{children:"\u5ba2\u6237\u7aef\u5e94\u8be5\u5728\u6240\u6709\u7684 Redis \u5b9e\u4f8b\u4e0a\u8fdb\u884c\u89e3\u9501"}),"\uff08\u5373\u4fbf\u67d0\u4e9bRedis\u5b9e\u4f8b\u6839\u672c\u5c31\u6ca1\u6709\u52a0\u9501\u6210\u529f\uff0c\u9632\u6b62\u67d0\u4e9b\u8282\u70b9\u83b7\u53d6\u5230\u9501\u4f46\u662f\u5ba2\u6237\u7aef\u6ca1\u6709\u5f97\u5230\u54cd\u5e94\u800c\u5bfc\u81f4\u63a5\u4e0b\u6765\u7684\u4e00\u6bb5\u65f6\u95f4\u4e0d\u80fd\u88ab\u91cd\u65b0\u83b7\u53d6\u9501\uff09\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u603b\u7ed3\uff1a\u5ba2\u6237\u7aef\u53ea\u6709\u5728\u6ee1\u8db3\u4e0b\u9762\u7684\u8fd9\u4e24\u4e2a\u6761\u4ef6\u65f6\uff0c\u624d\u80fd\u8ba4\u4e3a\u662f\u52a0\u9501\u6210\u529f\u3002"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6761\u4ef61\uff1a\u5ba2\u6237\u7aef\u4ece\u8d85\u8fc7\u534a\u6570\uff08\u5927\u4e8e\u7b49\u4e8eN/2+1\uff09\u7684Redis\u5b9e\u4f8b\u4e0a\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff1b"}),"\n",(0,r.jsx)(n.li,{children:"\u6761\u4ef62\uff1a\u5ba2\u6237\u7aef\u83b7\u53d6\u9501\u7684\u603b\u8017\u65f6\u6ca1\u6709\u8d85\u8fc7\u9501\u7684\u6709\u6548\u65f6\u95f4\u3002"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u8ba1\u7b97 \u72ec\u7acbmaster\u6570\u91cf \u7684",(0,r.jsx)(n.strong,{children:"\u5bb9\u9519\u516c\u5f0f"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"N = 2X + 1"}),"  (N\u662f\u6700\u7ec8\u90e8\u7f72\u673a\u5668\u6570\uff0cX\u662f\u5bb9\u9519\u673a\u5668\u6570)"]}),"\n",(0,r.jsxs)(n.p,{children:["eg\uff1a\u82e5\u5141\u8bb81\u53f0\u673a\u5668\u51fa\u9519\u7684\u60c5\u51b5\u4e0b\u8fd8\u80fd\u6709\u6548\u63d0\u4f9b\u670d\u52a1\uff0c\u90a3\u4e48\u9700\u8981\u90e8\u7f72\u7684\u673a\u5668\u6570\u4e3a 2\xd71+1=3\u53f0\uff0c\u82e5\u5141\u8bb82\u53f0\u51fa\u9519\uff0c\u90a3\u4e48\u90e8\u7f722\xd72+1=5\u53f0\n",(0,r.jsx)(n.strong,{children:"\u4e3a\u4ec0\u4e48\u662f\u5947\u6570\uff1f"}),"\n\u56e0\u4e3a+1\u5c31\u5df2\u7ecf\u53ef\u4ee5\u4fdd\u8bc1X\u4e0d\u53d8\u7684\u60c5\u51b5\u4e0b\u63d0\u4f9b\u6709\u6548\u670d\u52a1\uff0c\u4e0d\u9700\u8981\u591a\u4e00\u53f0\u673a\u5668"]}),"\n",(0,r.jsx)(n.p,{children:"RedLock \u548c MutiLock \u7684\u533a\u522b\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"RedLock\u53ea\u9700\u8981\u8d85\u8fc7\u534a\u6570\u83b7\u5f97\u9501\u6210\u529f\u5373\u53ef\uff0c\u6210\u529f\u7387\u5927\u4e8eMutiLock"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"57-\u5206\u5e03\u5f0f\u9501-\u89e3\u9501\u5f02\u5e38\u95ee\u9898",children:"5.7 \u5206\u5e03\u5f0f\u9501-\u89e3\u9501\u5f02\u5e38\u95ee\u9898"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u5e76\u53d1\u64cd\u4f5c\u7684\u573a\u666f\u4e0b\uff08\u5bf9\u4e1a\u52a1\u63a5\u53e3\u8fde\u7eed\u8bf7\u6c42\u4e09\u6b21\uff09\uff0c\u4f7f\u7528\u57fa\u4e8eredis\u7684RedissonLock\u89e3\u9501\u65f6\u629b\u51fa\u5f02\u5e38\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u6848\u4f8b\u4ee3\u7801\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'    //\u83b7\u53d6\u9501(\u53ef\u91cd\u5165)\uff0c\u6307\u5b9a\u9501\u7684\u540d\u79f0\n    RLock lock = redissonClient.getLock("anyLock");\n    //\u5c1d\u8bd5\u83b7\u53d6\u9501\uff0c\u53c2\u6570\u5206\u522b\u662f\uff1a\u83b7\u53d6\u9501\u7684\u6700\u5927\u7b49\u5f85\u65f6\u95f4(\u671f\u95f4\u4f1a\u91cd\u8bd5)\uff0c\u9501\u81ea\u52a8\u91ca\u653e\u65f6\u95f4\uff0c\u65f6\u95f4\u5355\u4f4d\n    boolean isLock = lock.tryLock(1,10,TimeUnit.SECONDS);\n    //\u5224\u65ad\u83b7\u53d6\u9501\u6210\u529f\n    if(isLock){\n        try{\n            System.out.println("\u6267\u884c\u4e1a\u52a1");          \n        }finally{\n            //\u91ca\u653e\u9501\n            lock.unlock();\n        }   \n    }\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u5e76\u53d1\u5ea6\u592a\u9ad8\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u5439\u51fa\u73b0\u4ee5\u4e0b\u5f02\u5e38\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"java.lang.IllegalMonitorStateException: attempt to unlock lock, not locked by current thread by node id: 1f24378c-5456-4321-827a-bc0a7515ec5d thread-id: 227\nat org.redisson.RedissonLock.unlock(RedissonLock.java:366) ~[redisson-2.10.5.jar:na]\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u89e3\u51b3\u529e\u6cd5\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"//\u91ca\u653e\u9501\nif(lock.isLocked() && lock.isHeldByCurrentThread()){\n    lock.unlock();\n}//\u8fd9\u91cc\u4e3a\u4ec0\u4e48\u8fd8\u8981\u518d\u5224\u65ad\u4e00\u6b21\uff0c\u57285.7\u4e2d\u8bb2\u89e3\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5c0f\u603b\u7ed3-1",children:"\u5c0f\u603b\u7ed3"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\u4e0d\u53ef\u91cd\u5165Redis\u5206\u5e03\u5f0f\u9501\uff1a\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u539f\u7406\uff1a\u5229\u7528setnx\u7684\u4e92\u65a5\u6027\uff1b\u5229\u7528ex\u907f\u514d\u6b7b\u9501\uff1b\u91ca\u653e\u9501\u65f6\u5224\u65ad\u7ebf\u7a0b\u6807\u793a"}),"\n",(0,r.jsx)(n.li,{children:"\u7f3a\u9677\uff1a\u4e0d\u53ef\u91cd\u5165\u3001\u65e0\u6cd5\u91cd\u8bd5\u3001\u9501\u8d85\u65f6\u5931\u6548"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u53ef\u91cd\u5165\u7684Redis\u5206\u5e03\u5f0f\u9501\uff1a\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u539f\u7406\uff1a\u5229\u7528hash\u7ed3\u6784\uff0c\u8bb0\u5f55\u7ebf\u7a0b\u6807\u793a\u548c\u91cd\u5165\u6b21\u6570\uff1b\u5229\u7528watchDog\u5ef6\u7eed\u9501\u65f6\u95f4\uff1b\u5229\u7528\u4fe1\u53f7\u91cf\u63a7\u5236\u9501\u91cd\u8bd5\u7b49\u5f85"}),"\n",(0,r.jsx)(n.li,{children:"\u7f3a\u9677\uff1aredis:\u5b95\u673a\u5f15\u8d77\u9501\u5931\u6548\u95ee\u9898"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Redisson\u7684multiLock:\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u539f\u7406\uff1a\u591a\u4e2a\u72ec\u7acb\u7684Redis\u8282\u70b9\uff0c\u5fc5\u987b\u5728\u6240\u6709\u8282\u70b9\u90fd\u83b7\u53d6\u91cd\u5165\u9501\uff0c\u624d\u7b97\u83b7\u53d6\u9501\u6210\u529f"}),"\n",(0,r.jsx)(n.li,{children:"\u7f3a\u9677\uff1a\u8fd0\u7ef4\u6210\u672c\u9ad8\u3001\u5b9e\u73b0\u590d\u6742"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Redisson\u7684RedLock\uff1a\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u539f\u7406\uff1a\u591a\u4e2a\u72ec\u7acb\u7684Redis\u8282\u70b9\uff0c\u5fc5\u987b\u8d85\u8fc7\u534a\u6570(N/2+1)\u90fd\u83b7\u53d6\u91cd\u5165\u9501\uff0c\u624d\u7b97\u83b7\u53d6\u9501\u6210\u529f"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h1,{id:"6\u79d2\u6740\u4f18\u5316",children:"6\u3001\u79d2\u6740\u4f18\u5316"}),"\n",(0,r.jsx)(n.h2,{id:"61-\u79d2\u6740\u4f18\u5316-\u5f02\u6b65\u79d2\u6740\u601d\u8def",children:"6.1 \u79d2\u6740\u4f18\u5316-\u5f02\u6b65\u79d2\u6740\u601d\u8def"}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u6765\u56de\u987e\u4e00\u4e0b\u4e0b\u5355\u6d41\u7a0b"}),"\n",(0,r.jsx)(n.p,{children:"\u5f53\u7528\u6237\u53d1\u8d77\u8bf7\u6c42\uff0c\u6b64\u65f6\u4f1a\u8bf7\u6c42nginx\uff0cnginx\u4f1a\u8bbf\u95ee\u5230tomcat\uff0c\u800ctomcat\u4e2d\u7684\u7a0b\u5e8f\uff0c\u4f1a\u8fdb\u884c\u4e32\u884c\u64cd\u4f5c\uff0c\u5206\u6210\u5982\u4e0b\u51e0\u4e2a\u6b65\u9aa4"}),"\n",(0,r.jsx)(n.p,{children:"1\u3001\u67e5\u8be2\u4f18\u60e0\u5377"}),"\n",(0,r.jsx)(n.p,{children:"2\u3001\u5224\u65ad\u79d2\u6740\u5e93\u5b58\u662f\u5426\u8db3\u591f"}),"\n",(0,r.jsx)(n.p,{children:"3\u3001\u67e5\u8be2\u8ba2\u5355"}),"\n",(0,r.jsx)(n.p,{children:"4\u3001\u6821\u9a8c\u662f\u5426\u662f\u4e00\u4eba\u4e00\u5355"}),"\n",(0,r.jsx)(n.p,{children:"5\u3001\u6263\u51cf\u5e93\u5b58"}),"\n",(0,r.jsx)(n.p,{children:"6\u3001\u521b\u5efa\u8ba2\u5355"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u8fd9\u516d\u6b65\u64cd\u4f5c\u4e2d\uff0c\u53c8\u6709\u5f88\u591a\u64cd\u4f5c\u662f\u8981\u53bb\u64cd\u4f5c\u6570\u636e\u5e93\u7684\uff0c\u800c\u4e14\u8fd8\u662f\u4e00\u4e2a\u7ebf\u7a0b\u4e32\u884c\u6267\u884c\uff0c \u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4\u6211\u4eec\u7684\u7a0b\u5e8f\u6267\u884c\u7684\u5f88\u6162\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5f02\u6b65\u7a0b\u5e8f\u6267\u884c\uff0c\u90a3\u4e48\u5982\u4f55\u52a0\u901f\u5462\uff1f"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u8fd9\u91cc\u7b14\u8005\u60f3\u7ed9\u5927\u5bb6\u5206\u4eab\u4e00\u4e0b\u8bfe\u7a0b\u5185\u6ca1\u6709\u7684\u601d\u8def\uff0c\u770b\u770b\u6709\u6ca1\u6709\u5c0f\u4f19\u4f34\u8fd9\u4e48\u60f3\uff0c\u6bd4\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u4e0d\u53ef\u4ee5\u4f7f\u7528\u5f02\u6b65\u7f16\u6392\u6765\u505a\uff0c\u6216\u8005\u8bf4\u6211\u5f00\u542fN\u591a\u7ebf\u7a0b\uff0cN\u591a\u4e2a\u7ebf\u7a0b\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u67e5\u8be2\u4f18\u60e0\u5377\uff0c\u4e00\u4e2a\u6267\u884c\u5224\u65ad\u6263\u51cf\u5e93\u5b58\uff0c\u4e00\u4e2a\u53bb\u521b\u5efa\u8ba2\u5355\u7b49\u7b49\uff0c\u7136\u540e\u518d\u7edf\u4e00\u505a\u8fd4\u56de\uff0c\u8fd9\u79cd\u505a\u6cd5\u548c\u8bfe\u7a0b\u4e2d\u6709\u54ea\u79cd\u597d\u5462\uff1f\u7b54\u6848\u662f\u8bfe\u7a0b\u4e2d\u7684\u597d\uff0c\u56e0\u4e3a\u5982\u679c\u4f60\u91c7\u7528\u6211\u521a\u8bf4\u7684\u65b9\u5f0f\uff0c\u5982\u679c\u8bbf\u95ee\u7684\u4eba\u5f88\u591a\uff0c\u90a3\u4e48\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u53ef\u80fd\u4e00\u4e0b\u5b50\u5c31\u88ab\u6d88\u8017\u5b8c\u4e86\uff0c\u800c\u4e14\u4f60\u4f7f\u7528\u4e0a\u8ff0\u65b9\u6848\uff0c\u6700\u5927\u7684\u7279\u70b9\u5728\u4e8e\uff0c\u4f60\u89c9\u5f97\u65f6\u6548\u6027\u4f1a\u975e\u5e38\u91cd\u8981\uff0c\u4f46\u662f\u4f60\u60f3\u60f3\u662f\u5417\uff1f\u5e76\u4e0d\u662f\uff0c\u6bd4\u5982\u6211\u53ea\u8981\u786e\u5b9a\u4ed6\u80fd\u505a\u8fd9\u4ef6\u4e8b\uff0c\u7136\u540e\u6211\u540e\u8fb9\u6162\u6162\u505a\u5c31\u53ef\u4ee5\u4e86\uff0c\u6211\u5e76\u4e0d\u9700\u8981\u4ed6\u4e00\u53e3\u6c14\u505a\u5b8c\u8fd9\u4ef6\u4e8b\uff0c\u6240\u4ee5\u6211\u4eec\u5e94\u5f53\u91c7\u7528\u7684\u662f\u8bfe\u7a0b\u4e2d\uff0c\u7c7b\u4f3c\u6d88\u606f\u961f\u5217\u7684\u65b9\u5f0f\u6765\u5b8c\u6210\u6211\u4eec\u7684\u9700\u6c42\uff0c\u800c\u4e0d\u662f\u4f7f\u7528\u7ebf\u7a0b\u6c60\u6216\u8005\u662f\u5f02\u6b65\u7f16\u6392\u7684\u65b9\u5f0f\u6765\u5b8c\u6210\u8fd9\u4e2a\u9700\u6c42"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653560986599",src:s(76473).A+"",width:"1536",height:"757"})}),"\n",(0,r.jsx)(n.p,{children:"\u4f18\u5316\u65b9\u6848\uff1a\u6211\u4eec\u5c06\u8017\u65f6\u6bd4\u8f83\u77ed\u7684\u903b\u8f91\u5224\u65ad\u653e\u5165\u5230redis\u4e2d\uff0c\u6bd4\u5982\u662f\u5426\u5e93\u5b58\u8db3\u591f\uff0c\u6bd4\u5982\u662f\u5426\u4e00\u4eba\u4e00\u5355\uff0c\u8fd9\u6837\u7684\u64cd\u4f5c\uff0c\u53ea\u8981\u8fd9\u79cd\u903b\u8f91\u53ef\u4ee5\u5b8c\u6210\uff0c\u5c31\u610f\u5473\u7740\u6211\u4eec\u662f\u4e00\u5b9a\u53ef\u4ee5\u4e0b\u5355\u5b8c\u6210\u7684\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8fdb\u884c\u5feb\u901f\u7684\u903b\u8f91\u5224\u65ad\uff0c\u6839\u672c\u5c31\u4e0d\u7528\u7b49\u4e0b\u5355\u903b\u8f91\u8d70\u5b8c\uff0c\u6211\u4eec\u76f4\u63a5\u7ed9\u7528\u6237\u8fd4\u56de\u6210\u529f\uff0c \u518d\u5728\u540e\u53f0\u5f00\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u540e\u53f0\u7ebf\u7a0b\u6162\u6162\u7684\u53bb\u6267\u884cqueue\u91cc\u8fb9\u7684\u6d88\u606f\uff0c\u8fd9\u6837\u7a0b\u5e8f\u4e0d\u5c31\u8d85\u7ea7\u5feb\u4e86\u5417\uff1f\u800c\u4e14\u4e5f\u4e0d\u7528\u62c5\u5fc3\u7ebf\u7a0b\u6c60\u6d88\u8017\u6b86\u5c3d\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u8fd9\u91cc\u6211\u4eec\u7684\u7a0b\u5e8f\u4e2d\u5e76\u6ca1\u6709\u624b\u52a8\u4f7f\u7528\u4efb\u4f55\u7ebf\u7a0b\u6c60\uff0c\u5f53\u7136\u8fd9\u91cc\u8fb9\u6709\u4e24\u4e2a\u96be\u70b9"}),"\n",(0,r.jsx)(n.p,{children:"\u7b2c\u4e00\u4e2a\u96be\u70b9\u662f\u6211\u4eec\u600e\u4e48\u5728redis\u4e2d\u53bb\u5feb\u901f\u6821\u9a8c\u4e00\u4eba\u4e00\u5355\uff0c\u8fd8\u6709\u5e93\u5b58\u5224\u65ad"}),"\n",(0,r.jsx)(n.p,{children:"\u7b2c\u4e8c\u4e2a\u96be\u70b9\u662f\u7531\u4e8e\u6211\u4eec\u6821\u9a8c\u548ctomct\u4e0b\u5355\u662f\u4e24\u4e2a\u7ebf\u7a0b\uff0c\u90a3\u4e48\u6211\u4eec\u5982\u4f55\u77e5\u9053\u5230\u5e95\u54ea\u4e2a\u5355\u4ed6\u6700\u540e\u662f\u5426\u6210\u529f\uff0c\u6216\u8005\u662f\u4e0b\u5355\u5b8c\u6210\uff0c\u4e3a\u4e86\u5b8c\u6210\u8fd9\u4ef6\u4e8b\u6211\u4eec\u5728redis\u64cd\u4f5c\u5b8c\u4e4b\u540e\uff0c\u6211\u4eec\u4f1a\u5c06\u4e00\u4e9b\u4fe1\u606f\u8fd4\u56de\u7ed9\u524d\u7aef\uff0c\u540c\u65f6\u4e5f\u4f1a\u628a\u8fd9\u4e9b\u4fe1\u606f\u4e22\u5230\u5f02\u6b65queue\u4e2d\u53bb\uff0c\u540e\u7eed\u64cd\u4f5c\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2aid\u6765\u67e5\u8be2\u6211\u4eectomcat\u4e2d\u7684\u4e0b\u5355\u903b\u8f91\u662f\u5426\u5b8c\u6210\u4e86\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653561657295",src:s(87528).A+"",width:"1511",height:"718"})}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u73b0\u5728\u6765\u770b\u770b\u6574\u4f53\u601d\u8def\uff1a\u5f53\u7528\u6237\u4e0b\u5355\u4e4b\u540e\uff0c\u5224\u65ad\u5e93\u5b58\u662f\u5426\u5145\u8db3\u53ea\u9700\u8981\u5bfcredis\u4e2d\u53bb\u6839\u636ekey\u627e\u5bf9\u5e94\u7684value\u662f\u5426\u5927\u4e8e0\u5373\u53ef\uff0c\u5982\u679c\u4e0d\u5145\u8db3\uff0c\u5219\u76f4\u63a5\u7ed3\u675f\uff0c\u5982\u679c\u5145\u8db3\uff0c\u7ee7\u7eed\u5728redis\u4e2d\u5224\u65ad\u7528\u6237\u662f\u5426\u53ef\u4ee5\u4e0b\u5355\uff0c\u5982\u679cset\u96c6\u5408\u4e2d\u6ca1\u6709\u8fd9\u6761\u6570\u636e\uff0c\u8bf4\u660e\u4ed6\u53ef\u4ee5\u4e0b\u5355\uff0c\u5982\u679cset\u96c6\u5408\u4e2d\u6ca1\u6709\u8fd9\u6761\u8bb0\u5f55\uff0c\u5219\u5c06userId\u548c\u4f18\u60e0\u5377\u5b58\u5165\u5230redis\u4e2d\uff0c\u5e76\u4e14\u8fd4\u56de0\uff0c\u6574\u4e2a\u8fc7\u7a0b\u9700\u8981\u4fdd\u8bc1\u662f\u539f\u5b50\u6027\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528lua\u6765\u64cd\u4f5c"}),"\n",(0,r.jsx)(n.p,{children:"\u5f53\u4ee5\u4e0a\u5224\u65ad\u903b\u8f91\u8d70\u5b8c\u4e4b\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u5224\u65ad\u5f53\u524dredis\u4e2d\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u5426\u662f0 \uff0c\u5982\u679c\u662f0\uff0c\u5219\u8868\u793a\u53ef\u4ee5\u4e0b\u5355\uff0c\u5219\u5c06\u4e4b\u524d\u8bf4\u7684\u4fe1\u606f\u5b58\u5165\u5230\u5230queue\u4e2d\u53bb\uff0c\u7136\u540e\u8fd4\u56de\uff0c\u7136\u540e\u518d\u6765\u4e2a\u7ebf\u7a0b\u5f02\u6b65\u7684\u4e0b\u5355\uff0c\u524d\u7aef\u53ef\u4ee5\u901a\u8fc7\u8fd4\u56de\u7684\u8ba2\u5355id\u6765\u5224\u65ad\u662f\u5426\u4e0b\u5355\u6210\u529f\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653562234886",src:s(33446).A+"",width:"1606",height:"760"})}),"\n",(0,r.jsx)(n.h2,{id:"62-\u79d2\u6740\u4f18\u5316-redis\u5b8c\u6210\u79d2\u6740\u8d44\u683c\u5224\u65ad",children:"6.2 \u79d2\u6740\u4f18\u5316-Redis\u5b8c\u6210\u79d2\u6740\u8d44\u683c\u5224\u65ad"}),"\n",(0,r.jsx)(n.p,{children:"\u9700\u6c42\uff1a"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u65b0\u589e\u79d2\u6740\u4f18\u60e0\u5238\u7684\u540c\u65f6\uff0c\u5c06\u4f18\u60e0\u5238\u4fe1\u606f\u4fdd\u5b58\u5230Redis\u4e2d"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u57fa\u4e8eLua\u811a\u672c\uff0c\u5224\u65ad\u79d2\u6740\u5e93\u5b58\u3001\u4e00\u4eba\u4e00\u5355\uff0c\u51b3\u5b9a\u7528\u6237\u662f\u5426\u62a2\u8d2d\u6210\u529f"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u62a2\u8d2d\u6210\u529f\uff0c\u5c06\u4f18\u60e0\u5238id\u548c\u7528\u6237id\u5c01\u88c5\u540e\u5b58\u5165\u963b\u585e\u961f\u5217"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u5f00\u542f\u7ebf\u7a0b\u4efb\u52a1\uff0c\u4e0d\u65ad\u4ece\u963b\u585e\u961f\u5217\u4e2d\u83b7\u53d6\u4fe1\u606f\uff0c\u5b9e\u73b0\u5f02\u6b65\u4e0b\u5355\u529f\u80fd"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1656080546603",src:s(38819).A+"",width:"1224",height:"146"})}),"\n",(0,r.jsx)(n.p,{children:"VoucherServiceImpl"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Override\n@Transactional\npublic void addSeckillVoucher(Voucher voucher) {\n    // \u4fdd\u5b58\u4f18\u60e0\u5238\n    save(voucher);\n    // \u4fdd\u5b58\u79d2\u6740\u4fe1\u606f\n    SeckillVoucher seckillVoucher = new SeckillVoucher();\n    seckillVoucher.setVoucherId(voucher.getId());\n    seckillVoucher.setStock(voucher.getStock());\n    seckillVoucher.setBeginTime(voucher.getBeginTime());\n    seckillVoucher.setEndTime(voucher.getEndTime());\n    seckillVoucherService.save(seckillVoucher);\n    // \u4fdd\u5b58\u79d2\u6740\u5e93\u5b58\u5230Redis\u4e2d\n    //SECKILL_STOCK_KEY \u8fd9\u4e2a\u53d8\u91cf\u5b9a\u4e49\u5728RedisConstans\u4e2d\n    //private static final String SECKILL_STOCK_KEY ="seckill:stock:"\n    stringRedisTemplate.opsForValue().set(SECKILL_STOCK_KEY + voucher.getId(), voucher.getStock().toString());\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u5b8c\u6574lua\u8868\u8fbe\u5f0f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"-- 1.\u53c2\u6570\u5217\u8868\n-- 1.1.\u4f18\u60e0\u5238id\nlocal voucherId = ARGV[1]\n-- 1.2.\u7528\u6237id\nlocal userId = ARGV[2]\n\n-- 2.\u6570\u636ekey\n-- 2.1.\u5e93\u5b58key\nlocal stockKey = 'seckill:stock:' .. voucherId\n-- 2.2.\u8ba2\u5355key\nlocal orderKey = 'seckill:order:' .. voucherId\n\n-- 3.\u811a\u672c\u4e1a\u52a1\n-- 3.1.\u5224\u65ad\u5e93\u5b58\u662f\u5426\u5145\u8db3 get stockKey\nif(tonumber(redis.call('get', stockKey)) <= 0) then\n    -- 3.2.\u5e93\u5b58\u4e0d\u8db3\uff0c\u8fd4\u56de1\n    return 1\nend\n-- 3.2.\u5224\u65ad\u7528\u6237\u662f\u5426\u4e0b\u5355 SISMEMBER orderKey userId\nif(redis.call('sismember', orderKey, userId) == 1) then\n    -- 3.3.\u5b58\u5728\uff0c\u8bf4\u660e\u662f\u91cd\u590d\u4e0b\u5355\uff0c\u8fd4\u56de2\n    return 2\nend\n-- 3.4.\u6263\u5e93\u5b58 incrby stockKey -1\nredis.call('incrby', stockKey, -1)\n-- 3.5.\u4e0b\u5355\uff08\u4fdd\u5b58\u7528\u6237\uff09sadd orderKey userId\nredis.call('sadd', orderKey, userId)\nreturn 0\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5f53\u4ee5\u4e0alua\u8868\u8fbe\u5f0f\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u5269\u4e0b\u7684\u5c31\u662f\u6839\u636e\u6b65\u9aa43,4\u6765\u6267\u884c\u6211\u4eec\u63a5\u4e0b\u6765\u7684\u4efb\u52a1\u4e86"}),"\n",(0,r.jsx)(n.p,{children:"VoucherOrderServiceImpl"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u8001\u5e08\u7684\uff1a"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'public static final DefaultRedisScript<Long> SECKILL_SCRIPT;\nstatic {\n    SECKILL_SCRIPT = new DefaultRedisScript<>();\n    SECKILL_SCRIPT.setLocation(new ClassPathResource("seckill.lua"));\n    SECKILL_SCRIPT.setResultType(Long.class);\n}\n\n@Override\npublic Result seckillVoucher(Long voucherId) {\n    //\u83b7\u53d6\u7528\u6237\n    Long userId = UserHolder.getUser().getId();\n    long orderId = redisIdWorker.nextId("order");\n    // 1.\u6267\u884clua\u811a\u672c\n    Long result = stringRedisTemplate.execute(\n            SECKILL_SCRIPT,\n            Collections.emptyList(),\n            voucherId.toString(), \n        \tuserId.toString()\n    );\n    int r = result.intValue();\n    // 2.\u5224\u65ad\u7ed3\u679c\u662f\u5426\u4e3a0\n    if (r != 0) {\n        // 2.1.\u4e0d\u4e3a0 \uff0c\u4ee3\u8868\u6ca1\u6709\u8d2d\u4e70\u8d44\u683c\n        return Result.fail(r == 1 ? "\u5e93\u5b58\u4e0d\u8db3" : "\u4e0d\u80fd\u91cd\u590d\u4e0b\u5355");\n    }\n    //TODO \u4fdd\u5b58\u963b\u585e\u961f\u5217\n    // 3.\u8fd4\u56de\u8ba2\u5355id\n    return Result.ok(orderId);\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.strong,{children:["\u6211\u7684\uff1a",(0,r.jsx)(n.strong,{children:"\u8001\u5e08\u7684\u662f\u76f4\u63a5\u6539secKillVoucher()\uff0c\u4f46\u662f\u8fd8\u5f97\u8865\u5145\u5b8c\u6210\u4f18\u60e0\u5238\u53ef\u8d2d\u4e70\u65f6\u95f4\uff0c\u4f46\u662f\u5df2\u7ecf\u662f"}),"\u4e0d\u518d\u9700\u8981\u5206\u5e03\u5f0f\u9501\u4e0a\u9501"]}),"\u4e86\uff0clua\u811a\u672c\u76f4\u63a5\u4fdd\u8bc1\u4e86\u539f\u5b50\u6027\u4fdd\u8bc1\u4e86\u4e00\u4eba\u4e00\u5355\u548c\u4e0d\u8d85\u5356\u95ee\u9898"]}),"\n",(0,r.jsx)(n.p,{children:"\u53e6\u5916\uff1a\u6211\u7684\u591a\u4e86\u4e00\u4e2a\u5224\u65ad\u662f\u5426\u5df2\u7ecf\u7f13\u5b58\u4f18\u60e0\u5238\u5e93\u5b58\u7684\u903b\u8f91"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:' @Override\n    public Result secKillVoucher(Long voucherId) {\n        //1 \u67e5\u8be2\u4f18\u60e0\u5238\n        SeckillVoucher voucher = seckillVoucherService.getById(voucherId);\n        //2 \u5224\u65ad\u79d2\u6740\u662f\u5426\u5f00\u59cb\n        if (voucher.getBeginTime().isAfter(LocalDateTime.now())) {\n            return Result.fail("\u79d2\u6740\u5c1a\u672a\u5f00\u59cb\uff01");\n        }\n        //3 \u5224\u65ad\u79d2\u6740\u662f\u5426\u7ed3\u675f\n        if (voucher.getEndTime().isBefore(LocalDateTime.now())) {\n            return Result.fail("\u79d2\u6740\u5df2\u7ecf\u7ed3\u675f\uff01");\n        }\n        //4 \u5224\u65ad\u5e93\u5b58\u662f\u5426\u5145\u8db3\n        if (voucher.getStock() < 1) {\n            return Result.fail("\u5e93\u5b58\u4e0d\u8db3\uff01");\n        }\n\n        return createVoucherOrder(voucherId);\n    }\n\npublic static final DefaultRedisScript<Long> SECKILL_SCRIPT;\nstatic {\n    SECKILL_SCRIPT = new DefaultRedisScript<>();\n    SECKILL_SCRIPT.setLocation(new ClassPathResource("seckill.lua"));\n    SECKILL_SCRIPT.setResultType(Long.class);\n}\n\n/**\n * \u4f18\u5316\u79d2\u6740\u4e4b\u540e\uff0c\u4f7f\u7528redis\u4e14\u5f02\u6b65\u6267\u884c\n * \u4e5f\u53ef\u4ee5\u76f4\u63a5\u5c06\u6b64\u65b9\u6cd5\u5f53\u6210secKillVoucher\u65b9\u6cd5\uff0c\u4f46\u662f\u5f97\u8865\u5145\u5b8c\u6210\u4f18\u60e0\u5238\u53ef\u8d2d\u4e70\u65f6\u95f4\n */\n@Override\npublic Result createVoucherOrder(Long voucherId) {\n    // \u5224\u65adredis\u4e2d\u662f\u5426\u4e00\u5df2\u7ecf\u7f13\u5b58\u4e86\u6539\u4f18\u60e0\u5238\u7684\u5e93\u5b58\u4fe1\u606f\uff0c\u82e5\u6ca1\u6709\uff0c\u5219\u83b7\u53d6\u4e50\u89c2\u9501\u8fdb\u884c\u7f13\u5b58\u6784\u5efa\n    String s = stringRedisTemplate.opsForValue().get(SECKILL_STOCK_KEY + voucherId);\n    do {\n        if (StrUtil.isBlank(s)) {\n            RLock lock = redissonClient.getLock("voucher" + voucherId);\n            if (lock.tryLock() && StrUtil.isBlank(stringRedisTemplate.opsForValue().get(SECKILL_STOCK_KEY + voucherId))) {\n                try {\n                    SeckillVoucher voucher = seckillVoucherService.getById(voucherId);\n                    Integer stock = voucher.getStock();\n                    stringRedisTemplate.opsForValue().set(SECKILL_STOCK_KEY + voucherId, stock.toString());\n                    s = stock.toString();\n                } finally {\n                    lock.unlock();\n                }\n            }\n        }\n    }while (StrUtil.isBlank(s));\n    \n\n    //\u83b7\u53d6\u7528\u6237\n    Long userId = UserHolder.getUser().getId();\n    long orderId = redisIdWorker.nextId("order");\n    // 1.\u6267\u884clua\u811a\u672c\n    Long result = stringRedisTemplate.execute(\n            SECKILL_SCRIPT,\n            Collections.emptyList(),\n            voucherId.toString(), userId.toString()\n    );\n    int r = result.intValue();\n    // 2.\u5224\u65ad\u7ed3\u679c\u662f\u5426\u4e3a0\n    if (r != 0) {\n        // 2.1.\u4e0d\u4e3a0 \uff0c\u4ee3\u8868\u6ca1\u6709\u8d2d\u4e70\u8d44\u683c\n        return Result.fail(r == 1 ? "\u5e93\u5b58\u4e0d\u8db3" : "\u4e0d\u80fd\u91cd\u590d\u4e0b\u5355");\n    }\n    //TODO \u4fdd\u5b58\u963b\u585e\u961f\u5217\n    // 3.\u8fd4\u56de\u8ba2\u5355id\n    return Result.ok(orderId);\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"63-\u79d2\u6740\u4f18\u5316-\u57fa\u4e8e\u963b\u585e\u961f\u5217\u5b9e\u73b0\u79d2\u6740\u4f18\u5316",children:"6.3 \u79d2\u6740\u4f18\u5316-\u57fa\u4e8e\u963b\u585e\u961f\u5217\u5b9e\u73b0\u79d2\u6740\u4f18\u5316"}),"\n",(0,r.jsx)(n.p,{children:"VoucherOrderServiceImpl"}),"\n",(0,r.jsx)(n.p,{children:"\u4fee\u6539\u4e0b\u5355\u52a8\u4f5c\uff0c\u73b0\u5728\u6211\u4eec\u53bb\u4e0b\u5355\u65f6\uff0c\u662f\u901a\u8fc7lua\u8868\u8fbe\u5f0f\u53bb\u539f\u5b50\u6267\u884c\u5224\u65ad\u903b\u8f91\uff0c\u5982\u679c\u5224\u65ad\u6211\u51fa\u6765\u4e0d\u4e3a0 \uff0c\u5219\u8981\u4e48\u662f\u5e93\u5b58\u4e0d\u8db3\uff0c\u8981\u4e48\u662f\u91cd\u590d\u4e0b\u5355\uff0c\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\uff0c\u5982\u679c\u662f0\uff0c\u5219\u628a\u4e0b\u5355\u7684\u903b\u8f91\u4fdd\u5b58\u5230\u961f\u5217\u4e2d\u53bb\uff0c\u7136\u540e\u5f02\u6b65\u6267\u884c"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u8001\u5e08\u7684\uff1a"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'    //\u5f02\u6b65\u5904\u7406\u7ebf\u7a0b\u6c60\n    private static final ExecutorService SECKILL_ORDER_EXECUTOR = Executors.newSingleThreadExecutor();\n\n    //\u5728\u7c7b\u521d\u59cb\u5316\u4e4b\u540e\u6267\u884c\uff0c\u56e0\u4e3a\u5f53\u8fd9\u4e2a\u7c7b\u521d\u59cb\u5316\u597d\u4e86\u4e4b\u540e\uff0c\u968f\u65f6\u90fd\u662f\u6709\u53ef\u80fd\u8981\u6267\u884c\u7684\n    @PostConstruct\n    private void init() {\n       SECKILL_ORDER_EXECUTOR.submit(new VoucherOrderHandler());\n    }\n    // \u7528\u4e8e\u7ebf\u7a0b\u6c60\u5904\u7406\u7684\u4efb\u52a1\n    // \u5f53\u521d\u59cb\u5316\u5b8c\u6bd5\u540e\uff0c\u5c31\u4f1a\u53bb\u4ece\u5bf9\u5217\u4e2d\u53bb\u62ff\u4fe1\u606f\n    private class VoucherOrderHandler implements Runnable{\n        @Override\n        public void run() {\n            while (true){\n                try {\n                    // 1.\u83b7\u53d6\u961f\u5217\u4e2d\u7684\u8ba2\u5355\u4fe1\u606f\n                    VoucherOrder voucherOrder = orderTasks.take();\n                    // 2.\u521b\u5efa\u8ba2\u5355\n                    handleVoucherOrder(voucherOrder);\n                } catch (Exception e) {\n                    log.error("\u5904\u7406\u8ba2\u5355\u5f02\u5e38", e);\n                }\n             }\n        }\n\n        private void handleVoucherOrder(VoucherOrder voucherOrder) {\n             //1.\u83b7\u53d6\u7528\u6237\n             Long userId = voucherOrder.getUserId();\n             // 2.\u521b\u5efa\u9501\u5bf9\u8c61\n             RLock redisLock = redissonClient.getLock("lock:order:" + userId);\n             // 3.\u5c1d\u8bd5\u83b7\u53d6\u9501\n             boolean isLock = redisLock.lock();\n             // 4.\u5224\u65ad\u662f\u5426\u83b7\u5f97\u9501\u6210\u529f\n             if (!isLock) {\n                 // \u83b7\u53d6\u9501\u5931\u8d25\uff0c\u76f4\u63a5\u8fd4\u56de\u5931\u8d25\u6216\u8005\u91cd\u8bd5\n                 log.error("\u4e0d\u5141\u8bb8\u91cd\u590d\u4e0b\u5355\uff01");\n                 return;\n             }\n             try {\t\t//\u6ce8\u610f\uff1a\u7531\u4e8e\u662fspring\u7684\u4e8b\u52a1\u662f\u653e\u5728threadLocal\u4e2d\uff0c\u6b64\u65f6\u7684\u662f\u591a\u7ebf\u7a0b\uff0c\u4e8b\u52a1\u4f1a\u5931\u6548\n                 proxy.createVoucherOrder(voucherOrder);\n             } finally {\n                 // \u91ca\u653e\u9501\n                 redisLock.unlock();\n             }\n        }\n    }\n   \n\tprivate BlockingQueue<VoucherOrder> orderTasks =new  ArrayBlockingQueue<>(1024 * 1024);\n\n    @Override\n    public Result seckillVoucher(Long voucherId) {\n        Long userId = UserHolder.getUser().getId();\n        // 1.\u6267\u884clua\u811a\u672c\n        Long result = stringRedisTemplate.execute(\n                SECKILL_SCRIPT,\n                Collections.emptyList(),\n                voucherId.toString(), userId.toString(), String.valueOf(orderId)\n        );\n        int r = result.intValue();\n        // 2.\u5224\u65ad\u7ed3\u679c\u662f\u5426\u4e3a0\n        if (r != 0) {\n            // 2.1.\u4e0d\u4e3a0 \uff0c\u4ee3\u8868\u6ca1\u6709\u8d2d\u4e70\u8d44\u683c\n            return Result.fail(r == 1 ? "\u5e93\u5b58\u4e0d\u8db3" : "\u4e0d\u80fd\u91cd\u590d\u4e0b\u5355");\n        }\n        VoucherOrder voucherOrder = new VoucherOrder();\n        // 2.3.\u8ba2\u5355id\n        long orderId = redisIdWorker.nextId("order");\n        voucherOrder.setId(orderId);\n        // 2.4.\u7528\u6237id\n        voucherOrder.setUserId(userId);\n        // 2.5.\u4ee3\u91d1\u5238id\n        voucherOrder.setVoucherId(voucherId);\n        // 2.6.\u653e\u5165\u963b\u585e\u961f\u5217\n        orderTasks.add(voucherOrder);\n        //3.\u83b7\u53d6\u4ee3\u7406\u5bf9\u8c61\n        proxy = (IVoucherOrderService)AopContext.currentProxy();\n        //4.\u8fd4\u56de\u8ba2\u5355id\n        return Result.ok(orderId);\n    }\n     \n\t@Transactional\n    public  void createVoucherOrder(VoucherOrder voucherOrder) {\n        Long userId = voucherOrder.getUserId();\n        // 5.1.\u67e5\u8be2\u8ba2\u5355\n        int count = query().eq("user_id", userId).eq("voucher_id", voucherOrder.getVoucherId()).count();\n        // 5.2.\u5224\u65ad\u662f\u5426\u5b58\u5728\n        if (count > 0) {\n            // \u7528\u6237\u5df2\u7ecf\u8d2d\u4e70\u8fc7\u4e86\n           log.error("\u7528\u6237\u5df2\u7ecf\u8d2d\u4e70\u8fc7\u4e86");\n           return ;\n        }\n\n        // 6.\u6263\u51cf\u5e93\u5b58\n        boolean success = seckillVoucherService.update()\n                .setSql("stock = stock - 1") // set stock = stock - 1\n                .eq("voucher_id", voucherOrder.getVoucherId()).gt("stock", 0) // where id = ? and stock > 0\n                .update();\n        if (!success) {\n            // \u6263\u51cf\u5931\u8d25\n            log.error("\u5e93\u5b58\u4e0d\u8db3");\n            return ;\n        }\n        save(voucherOrder);\n \n    }\n\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u6211\u7684\uff1a"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Service\n@Slf4j\npublic class VoucherOrderServiceImpl extends ServiceImpl<VoucherOrderMapper, VoucherOrder> implements IVoucherOrderService {\n    \n    @Resource\n    private ISeckillVoucherService seckillVoucherService;\n    \n    @Resource\n    private RedisIdWorker redisIdWorker;\n    \n    @Resource\n    private StringRedisTemplate stringRedisTemplate;\n    \n    @Resource\n    private RedissonClient redissonClient;\n    \n    public static final DefaultRedisScript<Long> SECKILL_SCRIPT;\n    static {\n        SECKILL_SCRIPT = new DefaultRedisScript<>();\n        SECKILL_SCRIPT.setLocation(new ClassPathResource("seckill.lua"));\n        SECKILL_SCRIPT.setResultType(Long.class);\n    }\n    \n    private BlockingQueue<VoucherOrder> orderTasks = new ArrayBlockingQueue<>(1024 * 1024);\n    //\u5f02\u6b65\u5904\u7406\u7ebf\u7a0b\u6c60\n    public static final ExecutorService SECKILL_ORDER_EXECUTOR = Executors.newSingleThreadExecutor();\n    private IVoucherOrderService proxy;\n    \n    //\u5728\u7c7b\u521d\u59cb\u5316\u4e4b\u540e\u6267\u884c\uff0c\u56e0\u4e3a\u5f53\u8fd9\u4e2a\u7c7b\u521d\u59cb\u5316\u597d\u4e86\u4e4b\u540e\uff0c\u968f\u65f6\u90fd\u662f\u6709\u53ef\u80fd\u8981\u6267\u884c\u7684\n    @PostConstruct\n    private void init(){\n        SECKILL_ORDER_EXECUTOR.submit(new VoucherOrderHandler());\n    }\n    \n    // \u7528\u4e8e\u7ebf\u7a0b\u6c60\u5904\u7406\u7684\u4efb\u52a1\n    // \u5f53\u521d\u59cb\u5316\u5b8c\u6bd5\u540e\uff0c\u5c31\u4f1a\u53bb\u4ece\u5bf9\u5217\u4e2d\u53bb\u62ff\u4fe1\u606f\n    private class VoucherOrderHandler implements Runnable {\n        @Override\n        public void run() {\n            while (true) {\n                try {\n                    // 1.\u83b7\u53d6\u961f\u5217\u4e2d\u7684\u8ba2\u5355\u4fe1\u606f\n                    VoucherOrder voucherOrder = orderTasks.take();\n                    // 2.\u521b\u5efa\u8ba2\u5355\n                    proxy.handleVoucherOrder(voucherOrder);\n                } catch (InterruptedException e) {\n                    log.error("\u5904\u7406\u8ba2\u5355\u5f02\u5e38", e);\n                }\n            }\n        }\n    }\n    \n    @Transactional\n    public void handleVoucherOrder(VoucherOrder voucherOrder) {\n        //\u5224\u65ad\u662f\u5426\u5df2\u7ecf\u4e0b\u8fc7\u8ba2\u5355\uff08\u8d77\u59cblua\u811a\u672c\u4e2d\u5df2\u7ecf\u5224\u65ad\u8fc7\u4e00\u904d\u4e86\uff09\n        Integer count = query().eq("voucher_id", voucherOrder.getVoucherId()).eq("user_id", voucherOrder.getUserId()).count();\n        if(count > 0) {\n            log.error("\u4e0d\u80fd\u91cd\u590d\u4e0b\u5355\uff0c\u8ba2\u5355\uff1a" + voucherOrder.toString());\n            return;\n        }\n        //\u6263\u51cf\u5e93\u5b58\n        boolean success = seckillVoucherService.update()\n                .setSql("stock = stock - 1")\n                .eq("voucher_id", voucherOrder.getVoucherId())\n                .gt("stock", 0)\n                .update();\n        if(!success) {\n            log.error("\u5e93\u5b58\u4e0d\u8db3\uff0c\u8ba2\u5355\uff1a" + voucherOrder.toString());\n            return;\n        }\n        //\u4e0b\u5355\n        this.save(voucherOrder);\n    }\n\n\n    @Override\n    public Result secKillVoucher(Long voucherId) {\n        //1 \u67e5\u8be2\u4f18\u60e0\u5238\n        SeckillVoucher voucher = seckillVoucherService.getById(voucherId);\n        //2 \u5224\u65ad\u79d2\u6740\u662f\u5426\u5f00\u59cb\n        if (voucher.getBeginTime().isAfter(LocalDateTime.now())) {\n            return Result.fail("\u79d2\u6740\u5c1a\u672a\u5f00\u59cb\uff01");\n        }\n        //3 \u5224\u65ad\u79d2\u6740\u662f\u5426\u7ed3\u675f\n        if (voucher.getEndTime().isBefore(LocalDateTime.now())) {\n            return Result.fail("\u79d2\u6740\u5df2\u7ecf\u7ed3\u675f\uff01");\n        }\n        //4 \u5224\u65ad\u5e93\u5b58\u662f\u5426\u5145\u8db3\n        if (voucher.getStock() < 1) {\n            return Result.fail("\u5e93\u5b58\u4e0d\u8db3\uff01");\n        }\n\n        Long userId = UserHolder.getUser().getId();\n\n        return createVoucherOrder(voucherId);\n    }\n\n    /**\n     * \u4f18\u5316\u79d2\u6740\u4e4b\u540e\uff0c\u4f7f\u7528redis\u4e14\u5f02\u6b65\u6267\u884c\n     * \u4e5f\u53ef\u4ee5\u76f4\u63a5\u5c06\u6b64\u65b9\u6cd5\u5f53\u6210secKillVoucher\u65b9\u6cd5\uff0c\u4f46\u662f\u5f97\u8865\u5145\u5b8c\u6210\u4f18\u60e0\u5238\u53ef\u8d2d\u4e70\u65f6\u95f4\n     */\n    @Override\n    public Result createVoucherOrder(Long voucherId) {\n        // \u5224\u65adredis\u4e2d\u662f\u5426\u4e00\u5df2\u7ecf\u7f13\u5b58\u4e86\u6539\u4f18\u60e0\u5238\u7684\u5e93\u5b58\u4fe1\u606f\uff0c\u82e5\u6ca1\u6709\uff0c\u5219\u83b7\u53d6\u4e50\u89c2\u9501\u8fdb\u884c\u7f13\u5b58\u6784\u5efa\n        String s = stringRedisTemplate.opsForValue().get(SECKILL_STOCK_KEY + voucherId);\n        do {\n            if (StrUtil.isBlank(s)) {\n                RLock lock = redissonClient.getLock("voucher" + voucherId);\n                if (lock.tryLock() && StrUtil.isBlank(stringRedisTemplate.opsForValue().get(SECKILL_STOCK_KEY + voucherId))) {\n                    try {\n                        SeckillVoucher voucher = seckillVoucherService.getById(voucherId);\n                        Integer stock = voucher.getStock();\n                        stringRedisTemplate.opsForValue().set(SECKILL_STOCK_KEY + voucherId, stock.toString());\n                        s = stock.toString();\n                    } finally {\n                        lock.unlock();\n                    }\n                }\n            }\n        }while (StrUtil.isBlank(s));\n\n\n        //\u83b7\u53d6\u7528\u6237\n        Long userId = UserHolder.getUser().getId();\n        long orderId = redisIdWorker.nextId("order");\n        // 1.\u6267\u884clua\u811a\u672c\n        Long result = stringRedisTemplate.execute(\n                SECKILL_SCRIPT,\n                Collections.emptyList(),\n                voucherId.toString(), userId.toString()\n        );\n        int r = result.intValue();\n        // 2.\u5224\u65ad\u7ed3\u679c\u662f\u5426\u4e3a0\n        if (r != 0) {\n            // 2.1.\u4e0d\u4e3a0 \uff0c\u4ee3\u8868\u6ca1\u6709\u8d2d\u4e70\u8d44\u683c\n            return Result.fail(r == 1 ? "\u5e93\u5b58\u4e0d\u8db3" : "\u4e0d\u80fd\u91cd\u590d\u4e0b\u5355");\n        }\n        \n        //TODO \u4fdd\u5b58\u963b\u585e\u961f\u5217\n        VoucherOrder voucherOrder = new VoucherOrder();\n        // 2.3.\u8ba2\u5355id\n        voucherOrder.setId(orderId);\n        // 2.4.\u7528\u6237id\n        voucherOrder.setUserId(userId);\n        // 2.5.\u4ee3\u91d1\u5238id\n        voucherOrder.setVoucherId(voucherId);\n        // \u83b7\u53d6\u4ee3\u7406\u5bf9\u8c61\uff0c\u7528\u4e8e\u5f02\u6b65\u4e0b\u5355\u65f6\u5904\u7406\u4e8b\u52a1\n        proxy =  (IVoucherOrderService)AopContext.currentProxy();\n        // 2.6.\u653e\u5165\u963b\u585e\u961f\u5217\n        orderTasks.add(voucherOrder);\n        \n        // 3.\u8fd4\u56de\u8ba2\u5355id\n        return Result.ok(orderId);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u751f\u6210tokens.txt\u6587\u4ef6\u5e76\u4e14\u5b58\u5165redis\u6d4b\u8bd5\u4ee3\u7801\uff1a"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'package com.hmdp;\n\nimport cn.hutool.core.lang.Assert;\nimport cn.hutool.core.thread.ThreadUtil;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport com.hmdp.dto.LoginFormDTO;\nimport com.hmdp.dto.Result;\nimport com.hmdp.entity.User;\nimport com.hmdp.service.IUserService;\nimport lombok.SneakyThrows;\nimport org.junit.jupiter.api.DisplayName;\nimport org.junit.jupiter.api.Test;\nimport org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.http.MediaType;\nimport org.springframework.test.web.servlet.MockMvc;\nimport org.springframework.test.web.servlet.request.MockMvcRequestBuilders;\nimport org.springframework.test.web.servlet.result.MockMvcResultMatchers;\n\nimport javax.annotation.Resource;\nimport java.io.BufferedWriter;\nimport java.io.File;\nimport java.io.FileOutputStream;\nimport java.io.OutputStreamWriter;\nimport java.nio.charset.StandardCharsets;\nimport java.util.List;\nimport java.util.concurrent.CopyOnWriteArrayList;\nimport java.util.concurrent.CountDownLatch;\nimport java.util.concurrent.ExecutorService;\nimport java.util.stream.Collectors;\n@SpringBootTest\n@AutoConfigureMockMvc\nclass VoucherOrderControllerTest {\n\n    @Resource\n    private MockMvc mockMvc;\n\n    @Resource\n    private IUserService userService;\n\n    @Resource\n    private ObjectMapper mapper;\n\n    @Test\n    @SneakyThrows\n    @DisplayName("\u767b\u5f551000\u4e2a\u7528\u6237\uff0c\u5e76\u8f93\u51fa\u5230\u6587\u4ef6\u4e2d")\n    void login() {\n        List<String> phoneList = userService.lambdaQuery()\n                .select(User::getPhone)\n                .last("limit 1000")\n                .list().stream().map(User::getPhone).collect(Collectors.toList());\n        ExecutorService executorService = ThreadUtil.newExecutor(phoneList.size());\n        List<String> tokenList = new CopyOnWriteArrayList<>();\n        CountDownLatch countDownLatch = new CountDownLatch(phoneList.size());\n        phoneList.forEach(phone -> {\n            executorService.execute(() -> {\n                try {\n                    // \u9a8c\u8bc1\u7801\n                    String codeJson = mockMvc.perform(MockMvcRequestBuilders\n                                    .post("/user/code")\n                                    .queryParam("phone", phone))\n                            .andExpect(MockMvcResultMatchers.status().isOk())\n                            .andReturn().getResponse().getContentAsString();\n                    Result result = mapper.readerFor(Result.class).readValue(codeJson);\n                    Assert.isTrue(result.getSuccess(), String.format("\u83b7\u53d6\u201c%s\u201d\u624b\u673a\u53f7\u7684\u9a8c\u8bc1\u7801\u5931\u8d25", phone));\n                    String code = result.getData().toString();\n                    LoginFormDTO formDTO = LoginFormDTO.builder().code(code).phone(phone).build();\n                    String json = mapper.writeValueAsString(formDTO);\n                    // token\n                    String tokenJson = mockMvc.perform(MockMvcRequestBuilders\n                                    .post("/user/login").content(json).contentType(MediaType.APPLICATION_JSON))\n                            .andExpect(MockMvcResultMatchers.status().isOk())\n                            .andReturn().getResponse().getContentAsString();\n                    result = mapper.readerFor(Result.class).readValue(tokenJson);\n                    Assert.isTrue(result.getSuccess(), String.format("\u83b7\u53d6\u201c%s\u201d\u624b\u673a\u53f7\u7684token\u5931\u8d25,json\u4e3a\u201c%s\u201d", phone, json));\n                    String token = result.getData().toString();\n                    tokenList.add(token);\n                    countDownLatch.countDown();\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }\n            });\n        });\n        countDownLatch.await();\n        executorService.shutdown();\n        Assert.isTrue(tokenList.size() == phoneList.size());\n        writeToTxt(tokenList, "\\\\tokens.txt");\n        System.out.println("\u5199\u5165\u5b8c\u6210\uff01");\n    }\n\n    private static void writeToTxt(List<String> list, String suffixPath) throws Exception {\n        // 1. \u521b\u5efa\u6587\u4ef6\n        File file = new File(System.getProperty("user.dir") + "\\\\src\\\\main\\\\resources" + suffixPath);\n        if (!file.exists()) {\n            file.createNewFile();\n        }\n        // 2. \u8f93\u51fa\n        BufferedWriter bw = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(file), StandardCharsets.UTF_8));\n        for (String content : list) {\n            bw.write(content);\n            bw.newLine();\n        }\n        bw.close();\n        System.out.println("\u5199\u5165\u5b8c\u6210\uff01");\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u5c0f\u603b\u7ed3\uff1a"})}),"\n",(0,r.jsx)(n.p,{children:"\u9700\u6c42\uff1a"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u65b0\u589e\u79d2\u6740\u4f18\u60e0\u5238\u7684\u540c\u65f6\uff0c\u5c06\u4f18\u60e0\u5238\u4fe1\u606f\u4fdd\u5b58\u5230Redis\u4e2d"}),"\n",(0,r.jsx)(n.li,{children:"\u57fa\u4e8eLua\u811a\u672c\uff0c\u5224\u65ad\u79d2\u6740\u5e93\u5b58\u3001\u4e00\u4eba\u4e00\u5355\uff0c\u51b3\u5b9a\u7528\u6237\u662f\u5426\u62a2\u8d2d\u6210\u529f"}),"\n",(0,r.jsx)(n.li,{children:"\u5982\u679c\u62a2\u8d2d\u6210\u529f\uff0c\u5c06\u4f18\u60e0\u5238id\u548c\u7528\u6237id\u5c01\u88c5\u540e\u5b58\u5165\u963b\u585e\u961f\u5217"}),"\n",(0,r.jsx)(n.li,{children:"\u5f00\u542f\u7ebf\u7a0b\u4efb\u52a1\uff0c\u4e0d\u65ad\u4ece\u963b\u585e\u961f\u5217\u4e2d\u83b7\u53d6\u4fe1\u606f\uff0c\u5b9e\u73b0\u5f02\u6b65\u4e0b\u5355\u529f\u80fd"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u79d2\u6740\u4e1a\u52a1\u7684\u4f18\u5316\u601d\u8def\u662f\u4ec0\u4e48\uff1f"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5148\u5229\u7528Redis\u5b8c\u6210\u5e93\u5b58\u4f59\u91cf\u3001\u4e00\u4eba\u4e00\u5355\u5224\u65ad\uff0c\u5b8c\u6210\u62a2\u5355\u4e1a\u52a1"}),"\n",(0,r.jsx)(n.li,{children:"\u518d\u5c06\u4e0b\u5355\u4e1a\u52a1\u653e\u5165\u963b\u585e\u961f\u5217\uff0c\u5229\u7528\u72ec\u7acb\u7ebf\u7a0b\u5f02\u6b65\u4e0b\u5355"}),"\n",(0,r.jsxs)(n.li,{children:["\u57fa\u4e8e\u963b\u585e\u961f\u5217\u7684\u5f02\u6b65\u79d2\u6740\u5b58\u5728\u54ea\u4e9b\u95ee\u9898\uff1f\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5185\u5b58\u9650\u5236\u95ee\u9898\uff1a\u963b\u585e\u961f\u5217\u5bb9\u91cf\u6709\u9650\u5236\uff0c\u4f46\u662f\u4e0d\u9650\u5236\u5bb9\u91cf\u53c8\u5bb9\u6613\u5185\u5b58\u6ea2\u51fa"}),"\n",(0,r.jsx)(n.li,{children:"\u6570\u636e\u5b89\u5168\u95ee\u9898\uff1a\u5b95\u673a\u540e\u4e1a\u52a1\u4e22\u5931"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\u6240\u4ee5\u79d2\u6740\u7ee7\u7eed\u4f18\u5316\uff1a \u5c06\u963b\u585e\u961f\u5217\u6362\u4e3a\u6d88\u606f\u961f\u5217"}),"\n"]}),"\n",(0,r.jsx)(n.h1,{id:"7redis\u6d88\u606f\u961f\u5217",children:"7\u3001Redis\u6d88\u606f\u961f\u5217"}),"\n",(0,r.jsx)(n.h2,{id:"71-redis\u6d88\u606f\u961f\u5217-\u8ba4\u8bc6\u6d88\u606f\u961f\u5217",children:"7.1 Redis\u6d88\u606f\u961f\u5217-\u8ba4\u8bc6\u6d88\u606f\u961f\u5217"}),"\n",(0,r.jsx)(n.p,{children:"\u4ec0\u4e48\u662f\u6d88\u606f\u961f\u5217\uff1a\u5b57\u9762\u610f\u601d\u5c31\u662f\u5b58\u653e\u6d88\u606f\u7684\u961f\u5217\u3002\u6700\u7b80\u5355\u7684\u6d88\u606f\u961f\u5217\u6a21\u578b\u5305\u62ec3\u4e2a\u89d2\u8272\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6d88\u606f\u961f\u5217\uff1a\u5b58\u50a8\u548c\u7ba1\u7406\u6d88\u606f\uff0c\u4e5f\u88ab\u79f0\u4e3a\u6d88\u606f\u4ee3\u7406\uff08Message Broker\uff09"}),"\n",(0,r.jsx)(n.li,{children:"\u751f\u4ea7\u8005\uff1a\u53d1\u9001\u6d88\u606f\u5230\u6d88\u606f\u961f\u5217"}),"\n",(0,r.jsx)(n.li,{children:"\u6d88\u8d39\u8005\uff1a\u4ece\u6d88\u606f\u961f\u5217\u83b7\u53d6\u6d88\u606f\u5e76\u5904\u7406\u6d88\u606f"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653574849336",src:s(60691).A+"",width:"1128",height:"377"})}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528\u961f\u5217\u7684\u597d\u5904\u5728\u4e8e **\u89e3\u8026\uff1a**\u6240\u8c13\u89e3\u8026\uff0c\u4e3e\u4e00\u4e2a\u751f\u6d3b\u4e2d\u7684\u4f8b\u5b50\u5c31\u662f\uff1a\u5feb\u9012\u5458(\u751f\u4ea7\u8005)\u628a\u5feb\u9012\u653e\u5230\u5feb\u9012\u67dc\u91cc\u8fb9(Message Queue)\u53bb\uff0c\u6211\u4eec(\u6d88\u8d39\u8005)\u4ece\u5feb\u9012\u67dc\u91cc\u8fb9\u53bb\u62ff\u4e1c\u897f\uff0c\u8fd9\u5c31\u662f\u4e00\u4e2a\u5f02\u6b65\uff0c\u5982\u679c\u8026\u5408\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5feb\u9012\u5458\u76f8\u5f53\u4e8e\u76f4\u63a5\u628a\u5feb\u9012\u4ea4\u7ed9\u4f60\uff0c\u8fd9\u4e8b\u56fa\u7136\u597d\uff0c\u4f46\u662f\u4e07\u4e00\u4f60\u4e0d\u5728\u5bb6\uff0c\u90a3\u4e48\u5feb\u9012\u5458\u5c31\u4f1a\u4e00\u76f4\u7b49\u4f60\uff0c\u8fd9\u5c31\u6d6a\u8d39\u4e86\u5feb\u9012\u5458\u7684\u65f6\u95f4\uff0c\u6240\u4ee5\u8fd9\u79cd\u601d\u60f3\u5728\u6211\u4eec\u65e5\u5e38\u5f00\u53d1\u4e2d\uff0c\u662f\u975e\u5e38\u6709\u5fc5\u8981\u7684\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u79cd\u573a\u666f\u5728\u6211\u4eec\u79d2\u6740\u4e2d\u5c31\u53d8\u6210\u4e86\uff1a\u6211\u4eec\u4e0b\u5355\u4e4b\u540e\uff0c\u5229\u7528redis\u53bb\u8fdb\u884c\u6821\u9a8c\u4e0b\u5355\u6761\u4ef6\uff0c\u518d\u901a\u8fc7\u961f\u5217\u628a\u6d88\u606f\u53d1\u9001\u51fa\u53bb\uff0c\u7136\u540e\u518d\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\u53bb\u6d88\u8d39\u8fd9\u4e2a\u6d88\u606f\uff0c\u5b8c\u6210\u89e3\u8026\uff0c\u540c\u65f6\u4e5f\u52a0\u5feb\u6211\u4eec\u7684\u54cd\u5e94\u901f\u5ea6\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e9b\u73b0\u6210\u7684mq\uff0c\u6bd4\u5982kafka\uff0crabbitmq\u7b49\u7b49\uff0c\u4f46\u662f\u5462\uff0c\u5982\u679c\u6ca1\u6709\u5b89\u88c5mq\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528redis\u63d0\u4f9b\u7684mq\u65b9\u6848\uff0c\u964d\u4f4e\u6211\u4eec\u7684\u90e8\u7f72\u548c\u5b66\u4e60\u6210\u672c\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"72-redis\u6d88\u606f\u961f\u5217-\u57fa\u4e8elist\u5b9e\u73b0\u6d88\u606f\u961f\u5217",children:"7.2 Redis\u6d88\u606f\u961f\u5217-\u57fa\u4e8eList\u5b9e\u73b0\u6d88\u606f\u961f\u5217"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u57fa\u4e8eList\u7ed3\u6784\u6a21\u62df\u6d88\u606f\u961f\u5217"})}),"\n",(0,r.jsx)(n.p,{children:"\u6d88\u606f\u961f\u5217\uff08Message Queue\uff09\uff0c\u5b57\u9762\u610f\u601d\u5c31\u662f\u5b58\u653e\u6d88\u606f\u7684\u961f\u5217\u3002\u800cRedis\u7684list\u6570\u636e\u7ed3\u6784\u662f\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\uff0c\u5f88\u5bb9\u6613\u6a21\u62df\u51fa\u961f\u5217\u6548\u679c\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u961f\u5217\u662f\u5165\u53e3\u548c\u51fa\u53e3\u4e0d\u5728\u4e00\u8fb9\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5229\u7528\uff1aLPUSH \u7ed3\u5408 RPOP\u3001\u6216\u8005 RPUSH \u7ed3\u5408 LPOP\u6765\u5b9e\u73b0\u3002\n\u4e0d\u8fc7\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5f53\u961f\u5217\u4e2d\u6ca1\u6709\u6d88\u606f\u65f6RPOP\u6216LPOP\u64cd\u4f5c\u4f1a\u8fd4\u56denull\uff0c\u5e76\u4e0d\u50cfJVM\u7684\u963b\u585e\u961f\u5217\u90a3\u6837\u4f1a\u963b\u585e\u5e76\u7b49\u5f85\u6d88\u606f\u3002\u56e0\u6b64\u8fd9\u91cc\u5e94\u8be5\u4f7f\u7528BRPOP\u6216\u8005BLPOP\u6765\u5b9e\u73b0\u963b\u585e\u6548\u679c\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653575176451",src:s(15613).A+"",width:"1332",height:"181"})}),"\n",(0,r.jsx)(n.p,{children:"\u57fa\u4e8eList\u7684\u6d88\u606f\u961f\u5217\u6709\u54ea\u4e9b\u4f18\u7f3a\u70b9\uff1f\n\u4f18\u70b9\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5229\u7528Redis\u5b58\u50a8\uff0c\u4e0d\u53d7\u9650\u4e8eJVM\u5185\u5b58\u4e0a\u9650"}),"\n",(0,r.jsx)(n.li,{children:"\u57fa\u4e8eRedis\u7684\u6301\u4e45\u5316\u673a\u5236\uff0c\u6570\u636e\u5b89\u5168\u6027\u6709\u4fdd\u8bc1"}),"\n",(0,r.jsx)(n.li,{children:"\u53ef\u4ee5\u6ee1\u8db3\u6d88\u606f\u6709\u5e8f\u6027"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u7f3a\u70b9\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u65e0\u6cd5\u907f\u514d\u6d88\u606f\u4e22\u5931"}),"\n",(0,r.jsx)(n.li,{children:"\u53ea\u652f\u6301\u5355\u6d88\u8d39\u8005"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"73-redis\u6d88\u606f\u961f\u5217-\u57fa\u4e8epubsub\u7684\u6d88\u606f\u961f\u5217",children:"7.3 Redis\u6d88\u606f\u961f\u5217-\u57fa\u4e8ePubSub\u7684\u6d88\u606f\u961f\u5217"}),"\n",(0,r.jsx)(n.p,{children:"PubSub\uff08\u53d1\u5e03\u8ba2\u9605\uff09\u662fRedis2.0\u7248\u672c\u5f15\u5165\u7684\u6d88\u606f\u4f20\u9012\u6a21\u578b\u3002\u987e\u540d\u601d\u4e49\uff0c\u6d88\u8d39\u8005\u53ef\u4ee5\u8ba2\u9605\u4e00\u4e2a\u6216\u591a\u4e2achannel\uff0c\u751f\u4ea7\u8005\u5411\u5bf9\u5e94channel\u53d1\u9001\u6d88\u606f\u540e\uff0c\u6240\u6709\u8ba2\u9605\u8005\u90fd\u80fd\u6536\u5230\u76f8\u5173\u6d88\u606f\u3002"}),"\n",(0,r.jsx)(n.p,{children:"SUBSCRIBE channel [channel] \uff1a\u8ba2\u9605\u4e00\u4e2a\u6216\u591a\u4e2a\u9891\u9053\nPUBLISH channel msg \uff1a\u5411\u4e00\u4e2a\u9891\u9053\u53d1\u9001\u6d88\u606f\nPSUBSCRIBE pattern[pattern] \uff1a\u8ba2\u9605\u4e0epattern\u683c\u5f0f\u5339\u914d\u7684\u6240\u6709\u9891\u9053"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653575506373",src:s(85669).A+"",width:"1377",height:"451"})}),"\n",(0,r.jsx)(n.p,{children:"\u57fa\u4e8ePubSub\u7684\u6d88\u606f\u961f\u5217\u6709\u54ea\u4e9b\u4f18\u7f3a\u70b9\uff1f\n\u4f18\u70b9\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u91c7\u7528\u53d1\u5e03\u8ba2\u9605\u6a21\u578b\uff0c\u652f\u6301\u591a\u751f\u4ea7\u3001\u591a\u6d88\u8d39"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u7f3a\u70b9\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4e0d\u652f\u6301\u6570\u636e\u6301\u4e45\u5316"}),"\n",(0,r.jsx)(n.li,{children:"\u65e0\u6cd5\u907f\u514d\u6d88\u606f\u4e22\u5931"}),"\n",(0,r.jsx)(n.li,{children:"\u6d88\u606f\u5806\u79ef\u6709\u4e0a\u9650\uff0c\u8d85\u51fa\u65f6\u6570\u636e\u4e22\u5931"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"74-redis\u6d88\u606f\u961f\u5217-\u57fa\u4e8estream\u7684\u6d88\u606f\u961f\u5217",children:"7.4 Redis\u6d88\u606f\u961f\u5217-\u57fa\u4e8eStream\u7684\u6d88\u606f\u961f\u5217"}),"\n",(0,r.jsx)(n.p,{children:"Stream \u662f Redis 5.0 \u5f15\u5165\u7684\u4e00\u79cd\u65b0\u6570\u636e\u7c7b\u578b\uff0c\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u529f\u80fd\u975e\u5e38\u5b8c\u5584\u7684\u6d88\u606f\u961f\u5217\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u53d1\u9001\u6d88\u606f\u7684\u547d\u4ee4\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653577301737",src:s(44448).A+"",width:"1507",height:"207"})}),"\n",(0,r.jsx)(n.p,{children:"\u4f8b\u5982\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653577349691",src:s(35937).A+"",width:"1508",height:"189"})}),"\n",(0,r.jsx)(n.p,{children:"\u8bfb\u53d6\u6d88\u606f\u7684\u65b9\u5f0f\u4e4b\u4e00\uff1aXREAD"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653577445413",src:s(64308).A+"",width:"1418",height:"296"})}),"\n",(0,r.jsx)(n.p,{children:"\u4f8b\u5982\uff0c\u4f7f\u7528XREAD\u8bfb\u53d6\u7b2c\u4e00\u4e2a\u6d88\u606f\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653577643629",src:s(73017).A+"",width:"1093",height:"250"})}),"\n",(0,r.jsx)(n.p,{children:"XREAD\u963b\u585e\u65b9\u5f0f\uff0c\u8bfb\u53d6\u6700\u65b0\u7684\u6d88\u606f\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653577659166",src:s(24146).A+"",width:"978",height:"106"})}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u4e1a\u52a1\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5faa\u73af\u7684\u8c03\u7528XREAD\u963b\u585e\u65b9\u5f0f\u6765\u67e5\u8be2\u6700\u65b0\u6d88\u606f\uff0c\u4ece\u800c\u5b9e\u73b0\u6301\u7eed\u76d1\u542c\u961f\u5217\u7684\u6548\u679c\uff0c\u4f2a\u4ee3\u7801\u5982\u4e0b"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653577689129",src:s(45148).A+"",width:"1045",height:"358"})}),"\n",(0,r.jsx)(n.p,{children:"\u6ce8\u610f\uff1a\u5f53\u6211\u4eec\u6307\u5b9a\u8d77\u59cbID\u4e3a$\u65f6\uff0c\u4ee3\u8868\u8bfb\u53d6\u6700\u65b0\u7684\u6d88\u606f\uff0c\u5982\u679c\u6211\u4eec\u5904\u7406\u4e00\u6761\u6d88\u606f\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53c8\u6709\u8d85\u8fc71\u6761\u4ee5\u4e0a\u7684\u6d88\u606f\u5230\u8fbe\u961f\u5217\uff0c\u5219\u4e0b\u6b21\u83b7\u53d6\u65f6\u4e5f\u53ea\u80fd\u83b7\u53d6\u5230\u6700\u65b0\u7684\u4e00\u6761\uff0c\u4f1a\u51fa\u73b0\u6f0f\u8bfb\u6d88\u606f\u7684\u95ee\u9898"}),"\n",(0,r.jsx)(n.p,{children:"STREAM\u7c7b\u578b\u6d88\u606f\u961f\u5217\u7684XREAD\u547d\u4ee4\u7279\u70b9\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6d88\u606f\u53ef\u56de\u6eaf"}),"\n",(0,r.jsx)(n.li,{children:"\u4e00\u4e2a\u6d88\u606f\u53ef\u4ee5\u88ab\u591a\u4e2a\u6d88\u8d39\u8005\u8bfb\u53d6"}),"\n",(0,r.jsx)(n.li,{children:"\u53ef\u4ee5\u963b\u585e\u8bfb\u53d6"}),"\n",(0,r.jsx)(n.li,{children:"\u6709\u6d88\u606f\u6f0f\u8bfb\u7684\u98ce\u9669"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"75-redis\u6d88\u606f\u961f\u5217-\u57fa\u4e8estream\u7684\u6d88\u606f\u961f\u5217-\u6d88\u8d39\u8005\u7ec4",children:"7.5 Redis\u6d88\u606f\u961f\u5217-\u57fa\u4e8eStream\u7684\u6d88\u606f\u961f\u5217-\u6d88\u8d39\u8005\u7ec4"}),"\n",(0,r.jsx)(n.p,{children:"\u6d88\u8d39\u8005\u7ec4\uff08Consumer Group\uff09\uff1a\u5c06\u591a\u4e2a\u6d88\u8d39\u8005\u5212\u5206\u5230\u4e00\u4e2a\u7ec4\u4e2d\uff0c\u76d1\u542c\u540c\u4e00\u4e2a\u961f\u5217\u3002\u5177\u5907\u4e0b\u5217\u7279\u70b9\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653577801668",src:s(80724).A+"",width:"979",height:"327"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u521b\u5efa\u6d88\u8d39\u8005\u7ec4\uff1a"}),"\n",(0,r.jsx)(n.img,{alt:"1653577984924",src:s(22987).A+"",width:"937",height:"41"}),"\nkey\uff1a\u961f\u5217\u540d\u79f0\ngroupName\uff1a\u6d88\u8d39\u8005\u7ec4\u540d\u79f0\nID\uff1a\u8d77\u59cbID\u6807\u793a\uff0c$\u4ee3\u8868\u961f\u5217\u4e2d\u6700\u540e\u4e00\u4e2a\u6d88\u606f\uff0c0\u5219\u4ee3\u8868\u961f\u5217\u4e2d\u7b2c\u4e00\u4e2a\u6d88\u606f\nMKSTREAM\uff1a\u961f\u5217\u4e0d\u5b58\u5728\u65f6\u81ea\u52a8\u521b\u5efa\u961f\u5217\n\u5176\u5b83\u5e38\u89c1\u547d\u4ee4\uff1a"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u5220\u9664\u6307\u5b9a\u7684\u6d88\u8d39\u8005\u7ec4"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"XGROUP DESTORY key groupName\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u7ed9\u6307\u5b9a\u7684\u6d88\u8d39\u8005\u7ec4\u6dfb\u52a0\u6d88\u8d39\u8005"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"XGROUP CREATECONSUMER key groupname consumername\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u5220\u9664\u6d88\u8d39\u8005\u7ec4\u4e2d\u7684\u6307\u5b9a\u6d88\u8d39\u8005"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"XGROUP DELCONSUMER key groupname consumername\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u4ece\u6d88\u8d39\u8005\u7ec4\u8bfb\u53d6\u6d88\u606f\uff1a"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"XREADGROUP GROUP group consumer [COUNT count] [BLOCK milliseconds] [NOACK] STREAMS key [key ...] ID [ID ...]\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"group\uff1a\u6d88\u8d39\u7ec4\u540d\u79f0"}),"\n",(0,r.jsx)(n.li,{children:"consumer\uff1a\u6d88\u8d39\u8005\u540d\u79f0\uff0c\u5982\u679c\u6d88\u8d39\u8005\u4e0d\u5b58\u5728\uff0c\u4f1a\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u6d88\u8d39\u8005"}),"\n",(0,r.jsx)(n.li,{children:"count\uff1a\u672c\u6b21\u67e5\u8be2\u7684\u6700\u5927\u6570\u91cf"}),"\n",(0,r.jsx)(n.li,{children:"BLOCK milliseconds\uff1a\u5f53\u6ca1\u6709\u6d88\u606f\u65f6\u6700\u957f\u7b49\u5f85\u65f6\u95f4"}),"\n",(0,r.jsx)(n.li,{children:"NOACK\uff1a\u65e0\u9700\u624b\u52a8ACK\uff0c\u83b7\u53d6\u5230\u6d88\u606f\u540e\u81ea\u52a8\u786e\u8ba4"}),"\n",(0,r.jsx)(n.li,{children:"STREAMS key\uff1a\u6307\u5b9a\u961f\u5217\u540d\u79f0"}),"\n",(0,r.jsx)(n.li,{children:"ID\uff1a\u83b7\u53d6\u6d88\u606f\u7684\u8d77\u59cbID\uff1a"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:'">"\uff1a\u4ece\u4e0b\u4e00\u4e2a\u672a\u6d88\u8d39\u7684\u6d88\u606f\u5f00\u59cb\n\u5176\u5b83\uff1a\u6839\u636e\u6307\u5b9aid\u4ecepending-list\u4e2d\u83b7\u53d6\u5df2\u6d88\u8d39\u4f46\u672a\u786e\u8ba4\u7684\u6d88\u606f\uff0c\u4f8b\u59820\uff0c\u662f\u4ecepending-list\u4e2d\u7684\u7b2c\u4e00\u4e2a\u6d88\u606f\u5f00\u59cb'}),"\n",(0,r.jsx)(n.p,{children:"\u6d88\u8d39\u8005\u76d1\u542c\u6d88\u606f\u7684\u57fa\u672c\u601d\u8def\uff1a"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.img,{alt:"1653578211854",src:s(97779).A+"",width:"808",height:"736"}),"STREAM\u7c7b\u578b\u6d88\u606f\u961f\u5217\u7684XREADGROUP\u547d\u4ee4\u7279\u70b9\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6d88\u606f\u53ef\u56de\u6eaf"}),"\n",(0,r.jsx)(n.li,{children:"\u53ef\u4ee5\u591a\u6d88\u8d39\u8005\u4e89\u62a2\u6d88\u606f\uff0c\u52a0\u5feb\u6d88\u8d39\u901f\u5ea6"}),"\n",(0,r.jsx)(n.li,{children:"\u53ef\u4ee5\u963b\u585e\u8bfb\u53d6"}),"\n",(0,r.jsx)(n.li,{children:"\u6ca1\u6709\u6d88\u606f\u6f0f\u8bfb\u7684\u98ce\u9669"}),"\n",(0,r.jsx)(n.li,{children:"\u6709\u6d88\u606f\u786e\u8ba4\u673a\u5236\uff0c\u4fdd\u8bc1\u6d88\u606f\u81f3\u5c11\u88ab\u6d88\u8d39\u4e00\u6b21"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u6700\u540e\u6211\u4eec\u6765\u4e2a\u5c0f\u5bf9\u6bd4"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653578560691",src:s(33445).A+"",width:"968",height:"426"})}),"\n",(0,r.jsx)(n.h2,{id:"76-\u57fa\u4e8eredis\u7684stream\u7ed3\u6784\u4f5c\u4e3a\u6d88\u606f\u961f\u5217\u5b9e\u73b0\u5f02\u6b65\u79d2\u6740\u4e0b\u5355",children:"7.6 \u57fa\u4e8eRedis\u7684Stream\u7ed3\u6784\u4f5c\u4e3a\u6d88\u606f\u961f\u5217\uff0c\u5b9e\u73b0\u5f02\u6b65\u79d2\u6740\u4e0b\u5355"}),"\n",(0,r.jsx)(n.p,{children:"\u9700\u6c42\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u521b\u5efa\u4e00\u4e2aStream\u7c7b\u578b\u7684\u6d88\u606f\u961f\u5217\uff0c\u540d\u4e3astream.orders"}),"\n",(0,r.jsx)(n.li,{children:"\u4fee\u6539\u4e4b\u524d\u7684\u79d2\u6740\u4e0b\u5355Lua\u811a\u672c\uff0c\u5728\u8ba4\u5b9a\u6709\u62a2\u8d2d\u8d44\u683c\u540e\uff0c\u76f4\u63a5\u5411stream.orders\u4e2d\u6dfb\u52a0\u6d88\u606f\uff0c\u5185\u5bb9\u5305\u542bvoucherId\u3001userId\u3001orderId"}),"\n",(0,r.jsx)(n.li,{children:"\u9879\u76ee\u542f\u52a8\u65f6\uff0c\u5f00\u542f\u4e00\u4e2a\u7ebf\u7a0b\u4efb\u52a1\uff0c\u5c1d\u8bd5\u83b7\u53d6stream.orders\u4e2d\u7684\u6d88\u606f\uff0c\u5b8c\u6210\u4e0b\u5355\\"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u5148\u624b\u52a8\u6dfb\u52a0\u6d88\u606f\u961f\u5217\u548c\u6d88\u8d39\u8005\u7ec4"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"redis> XGROUP create stream.orders g1 0 mkstream\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u4fee\u6539lua\u8868\u8fbe\u5f0f,\u65b0\u589e1.3\u548c3.6\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"-- 1.3.\u8ba2\u5355id\nlocal orderId = ARGV[3]\n\n\n-- 3.6.\u53d1\u9001\u6d88\u606f\u5230\u961f\u5217\u4e2d\uff0c XADD stream.orders * k1 v1 k2 v2 ...\nredis.call('xadd', 'stream.orders', '*', 'userId', userId, 'voucherId', voucherId, 'id', orderId)\n"})}),"\n",(0,r.jsx)(n.p,{children:"VoucherOrderServiceImpl"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'//\u4fee\u6539\u79d2\u6740\u7684\u65b9\u6cd5seckillVoucher()\uff1a\nLong orderId = redisIdWorker.nextId("order");\t//orderId\u632a\u5230\u524d\u9762\nLong result = stringRedisTemplate.execute(\n        SECKILL_SCRIPT,\n        Collections.emptyList(),\n        voucherId.toString(),\n        userId.toString(),\n        orderId.toString()\t//\u65b0\u589e\u4e00\u4e2a\u53c2\u6570\n);\n\n//\u4fee\u6539\u5185\u90e8\u7c7bVoucherOrderHandler\uff1a\nprivate class VoucherOrderHandler implements Runnable {\n\n    @Override\n    public void run() {\n        while (true) {\n            try {\n                // 1.\u83b7\u53d6\u6d88\u606f\u961f\u5217\u4e2d\u7684\u8ba2\u5355\u4fe1\u606f XREADGROUP GROUP g1 c1 COUNT 1 BLOCK 2000 STREAMS s1 >\n                List<MapRecord<String, Object, Object>> list = stringRedisTemplate.opsForStream().read(\n                    Consumer.from("g1", "c1"),\n                    StreamReadOptions.empty().count(1).block(Duration.ofSeconds(2)),\n                    StreamOffset.create("stream.orders", ReadOffset.lastConsumed())\n                );\n                // 2.\u5224\u65ad\u8ba2\u5355\u4fe1\u606f\u662f\u5426\u4e3a\u7a7a\n                if (list == null || list.isEmpty()) {\n                    // \u5982\u679c\u4e3anull\uff0c\u8bf4\u660e\u6ca1\u6709\u6d88\u606f\uff0c\u7ee7\u7eed\u4e0b\u4e00\u6b21\u5faa\u73af\n                    continue;\n                }\n                // \u89e3\u6790\u6570\u636e\n                MapRecord<String, Object, Object> record = list.get(0);\n                Map<Object, Object> value = record.getValue();\n                VoucherOrder voucherOrder = BeanUtil.fillBeanWithMap(value, new VoucherOrder(), true);\n                // 3.\u521b\u5efa\u8ba2\u5355\n                createVoucherOrder(voucherOrder);\n                //\u6211\u7684\u662f\u8fd9\u53e5\n                /proxy.handleVoucherOrder(voucherOrder);\n                // 4.\u786e\u8ba4\u6d88\u606f XACK\n                stringRedisTemplate.opsForStream().acknowledge("s1", "g1", record.getId());\n            } catch (Exception e) {\n                log.error("\u5904\u7406\u8ba2\u5355\u5f02\u5e38", e);\n                //\u5904\u7406\u5f02\u5e38\u6d88\u606f\n                handlePendingList();\n            }\n        }\n    }\n\n    private void handlePendingList() {\n        while (true) {\n            try {\n                // 1.\u83b7\u53d6pending-list\u4e2d\u7684\u8ba2\u5355\u4fe1\u606f XREADGROUP GROUP g1 c1 COUNT 1 BLOCK 2000 STREAMS s1 0\n                List<MapRecord<String, Object, Object>> list = stringRedisTemplate.opsForStream().read(\n                    Consumer.from("g1", "c1"),\n                    StreamReadOptions.empty().count(1),\n                    StreamOffset.create("stream.orders", ReadOffset.from("0"))\n                );\n                // 2.\u5224\u65ad\u8ba2\u5355\u4fe1\u606f\u662f\u5426\u4e3a\u7a7a\n                if (list == null || list.isEmpty()) {\n                    // \u5982\u679c\u4e3anull\uff0c\u8bf4\u660e\u6ca1\u6709\u5f02\u5e38\u6d88\u606f\uff0c\u7ed3\u675f\u5faa\u73af\n                    break;\n                }\n                // \u89e3\u6790\u6570\u636e\n                MapRecord<String, Object, Object> record = list.get(0);\n                Map<Object, Object> value = record.getValue();\n                VoucherOrder voucherOrder = BeanUtil.fillBeanWithMap(value, new VoucherOrder(), true);\n                // 3.\u521b\u5efa\u8ba2\u5355\n                createVoucherOrder(voucherOrder);\n                // 4.\u786e\u8ba4\u6d88\u606f XACK\n                stringRedisTemplate.opsForStream().acknowledge("s1", "g1", record.getId());\n            } catch (Exception e) {\n                log.error("\u5904\u7406pendding\u8ba2\u5355\u5f02\u5e38", e);\n                try{\n                    Thread.sleep(20);\n                }catch(Exception e){\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n}\n\n'})}),"\n",(0,r.jsx)(n.h1,{id:"8\u8fbe\u4eba\u63a2\u5e97",children:"8\u3001\u8fbe\u4eba\u63a2\u5e97"}),"\n",(0,r.jsx)(n.h2,{id:"81\u8fbe\u4eba\u63a2\u5e97-\u53d1\u5e03\u63a2\u5e97\u7b14\u8bb0",children:"8.1\u3001\u8fbe\u4eba\u63a2\u5e97-\u53d1\u5e03\u63a2\u5e97\u7b14\u8bb0"}),"\n",(0,r.jsx)(n.p,{children:"\u53d1\u5e03\u63a2\u5e97\u7b14\u8bb0"}),"\n",(0,r.jsx)(n.p,{children:"\u63a2\u5e97\u7b14\u8bb0\u7c7b\u4f3c\u70b9\u8bc4\u7f51\u7ad9\u7684\u8bc4\u4ef7\uff0c\u5f80\u5f80\u662f\u56fe\u6587\u7ed3\u5408\u3002\u5bf9\u5e94\u7684\u8868\u6709\u4e24\u4e2a\uff1a\ntb_blog\uff1a\u63a2\u5e97\u7b14\u8bb0\u8868\uff0c\u5305\u542b\u7b14\u8bb0\u4e2d\u7684\u6807\u9898\u3001\u6587\u5b57\u3001\u56fe\u7247\u7b49\ntb_blog_comments\uff1a\u5176\u4ed6\u7528\u6237\u5bf9\u63a2\u5e97\u7b14\u8bb0\u7684\u8bc4\u4ef7"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u5177\u4f53\u53d1\u5e03\u6d41\u7a0b"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653578992639",src:s(24518).A+"",width:"1567",height:"680"})}),"\n",(0,r.jsx)(n.p,{children:"\u4e0a\u4f20\u63a5\u53e3"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Slf4j\n@RestController\n@RequestMapping("upload")\npublic class UploadController {\n\n    @PostMapping("blog")\n    public Result uploadImage(@RequestParam("file") MultipartFile image) {\n        try {\n            // \u83b7\u53d6\u539f\u59cb\u6587\u4ef6\u540d\u79f0\n            String originalFilename = image.getOriginalFilename();\n            // \u751f\u6210\u65b0\u6587\u4ef6\u540d\n            String fileName = createNewFileName(originalFilename);\n            // \u4fdd\u5b58\u6587\u4ef6\n            image.transferTo(new File(SystemConstants.IMAGE_UPLOAD_DIR, fileName));\n            // \u8fd4\u56de\u7ed3\u679c\n            log.debug("\u6587\u4ef6\u4e0a\u4f20\u6210\u529f\uff0c{}", fileName);\n            return Result.ok(fileName);\n        } catch (IOException e) {\n            throw new RuntimeException("\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25", e);\n        }\n    }\n\n    @GetMapping("/blog/delete")\n    public Result deleteBlogImg(@RequestParam("name") String filename) {\n        File file = new File(SystemConstants.IMAGE_UPLOAD_DIR, filename);\n        if (file.isDirectory()) {\n            return Result.fail("\u9519\u8bef\u7684\u6587\u4ef6\u540d\u79f0");\n        }\n        FileUtil.del(file);\n        return Result.ok();\n    }\n\n    private String createNewFileName(String originalFilename) {\n        // \u83b7\u53d6\u540e\u7f00\n        String suffix = StrUtil.subAfter(originalFilename, ".", true);\n        // \u751f\u6210\u76ee\u5f55\n        String name = UUID.randomUUID().toString();\n        int hash = name.hashCode();\n        int d1 = hash & 0xF;\n        int d2 = (hash >> 4) & 0xF;\n        // \u5224\u65ad\u76ee\u5f55\u662f\u5426\u5b58\u5728\n        File dir = new File(SystemConstants.IMAGE_UPLOAD_DIR, StrUtil.format("/blogs/{}/{}", d1, d2));\n        if (!dir.exists()) {\n            dir.mkdirs();\n        }\n        // \u751f\u6210\u6587\u4ef6\u540d\n        return StrUtil.format("/blogs/{}/{}/{}.{}", d1, d2, name, suffix);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u6ce8\u610f\uff1a\u540c\u5b66\u4eec\u5728\u64cd\u4f5c\u65f6\uff0c\u9700\u8981\u4fee\u6539SystemConstants.IMAGE_UPLOAD_DIR \u81ea\u5df1\u56fe\u7247\u6240\u5728\u7684\u5730\u5740\uff0c\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\u56fe\u7247\u4e00\u822c\u4f1a\u653e\u5728nginx\u4e0a\u6216\u8005\u662f\u4e91\u5b58\u50a8\u4e0a\u3002"}),"\n",(0,r.jsx)(n.p,{children:"BlogController"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@RestController\n@RequestMapping("/blog")\npublic class BlogController {\n\n    @Resource\n    private IBlogService blogService;\n\n    @PostMapping\n    public Result saveBlog(@RequestBody Blog blog) {\n        //\u83b7\u53d6\u767b\u5f55\u7528\u6237\n        UserDTO user = UserHolder.getUser();\n        blog.setUpdateTime(user.getId());\n        //\u4fdd\u5b58\u63a2\u5e97\u535a\u6587\n        blogService.saveBlog(blog);\n        //\u8fd4\u56deid\n        return Result.ok(blog.getId());\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"82-\u8fbe\u4eba\u63a2\u5e97-\u67e5\u770b\u63a2\u5e97\u7b14\u8bb0",children:"8.2 \u8fbe\u4eba\u63a2\u5e97-\u67e5\u770b\u63a2\u5e97\u7b14\u8bb0"}),"\n",(0,r.jsx)(n.p,{children:"\u5b9e\u73b0\u67e5\u770b\u53d1\u5e03\u63a2\u5e97\u7b14\u8bb0\u7684\u63a5\u53e3"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653579931626",src:s(45856).A+"",width:"967",height:"462"})}),"\n",(0,r.jsx)(n.p,{children:"\u5b9e\u73b0\u4ee3\u7801\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"BlogController"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@GetMapping("/{id}")\npublic Result queryBlogById(@PathVariable("id") Long id) {\n    return blogService.queryBlogById(id);\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"BlogServiceImpl"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Resource\nprivate IUserService userService;\n\n@Override\npublic Result queryBlogById(Long id) {\n    // 1.\u67e5\u8be2blog\n    Blog blog = getById(id);\n    if (blog == null) {\n        return Result.fail("\u7b14\u8bb0\u4e0d\u5b58\u5728\uff01");\n    }\n    // 2.\u67e5\u8be2blog\u6709\u5173\u7684\u7528\u6237\n    queryBlogUser(blog);\n  \n    return Result.ok(blog);\n}\n\nprivate void queryBlogUser(Blog blog) {\n    Long userId = blog.getUserId();\n    User user = userService.getById(userId);\n    blog.setName(user.getNickName());\n    blog.setIcon(user.getIcon());\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"83-\u8fbe\u4eba\u63a2\u5e97-\u70b9\u8d5e\u529f\u80fd",children:"8.3 \u8fbe\u4eba\u63a2\u5e97-\u70b9\u8d5e\u529f\u80fd"}),"\n",(0,r.jsx)(n.p,{children:"\u521d\u59cb\u4ee3\u7801"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@GetMapping("/like/{id}")\npublic Result queryBlogLikes(@PathVariable("id") Long id) {\n    //\u4fee\u6539\u70b9\u8d5e\u6570\u91cf\n    blogService.update().setSql("liked = liked +1 ").eq("id",id).update();\n    return Result.ok();\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u95ee\u9898\u5206\u6790\uff1a\u8fd9\u79cd\u65b9\u5f0f\u4f1a\u5bfc\u81f4\u4e00\u4e2a\u7528\u6237\u65e0\u9650\u70b9\u8d5e\uff0c\u660e\u663e\u662f\u4e0d\u5408\u7406\u7684"}),"\n",(0,r.jsx)(n.p,{children:"\u9020\u6210\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f\uff0c\u6211\u4eec\u73b0\u5728\u7684\u903b\u8f91\uff0c\u53d1\u8d77\u8bf7\u6c42\u53ea\u662f\u7ed9\u6570\u636e\u5e93+1\uff0c\u6240\u4ee5\u624d\u4f1a\u51fa\u73b0\u8fd9\u4e2a\u95ee\u9898"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653581590453",src:s(35842).A+"",width:"1573",height:"707"})}),"\n",(0,r.jsx)(n.p,{children:"\u5b8c\u5584\u70b9\u8d5e\u529f\u80fd"}),"\n",(0,r.jsx)(n.p,{children:"\u9700\u6c42\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u540c\u4e00\u4e2a\u7528\u6237\u53ea\u80fd\u70b9\u8d5e\u4e00\u6b21\uff0c\u518d\u6b21\u70b9\u51fb\u5219\u53d6\u6d88\u70b9\u8d5e"}),"\n",(0,r.jsx)(n.li,{children:"\u5982\u679c\u5f53\u524d\u7528\u6237\u5df2\u7ecf\u70b9\u8d5e\uff0c\u5219\u70b9\u8d5e\u6309\u94ae\u9ad8\u4eae\u663e\u793a\uff08\u524d\u7aef\u5df2\u5b9e\u73b0\uff0c\u5224\u65ad\u5b57\u6bb5Blog\u7c7b\u7684isLike\u5c5e\u6027\uff09"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u5b9e\u73b0\u6b65\u9aa4\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u7ed9Blog\u7c7b\u4e2d\u6dfb\u52a0\u4e00\u4e2aisLike\u5b57\u6bb5\uff0c\u6807\u793a\u662f\u5426\u88ab\u5f53\u524d\u7528\u6237\u70b9\u8d5e"}),"\n",(0,r.jsx)(n.li,{children:"\u4fee\u6539\u70b9\u8d5e\u529f\u80fd\uff0c\u5229\u7528Redis\u7684set\u96c6\u5408\u5224\u65ad\u662f\u5426\u70b9\u8d5e\u8fc7\uff0c\u672a\u70b9\u8d5e\u8fc7\u5219\u70b9\u8d5e\u6570+1\uff0c\u5df2\u70b9\u8d5e\u8fc7\u5219\u70b9\u8d5e\u6570-1"}),"\n",(0,r.jsx)(n.li,{children:"\u4fee\u6539\u6839\u636eid\u67e5\u8be2Blog\u7684\u4e1a\u52a1\uff0c\u5224\u65ad\u5f53\u524d\u767b\u5f55\u7528\u6237\u662f\u5426\u70b9\u8d5e\u8fc7\uff0c\u8d4b\u503c\u7ed9isLike\u5b57\u6bb5"}),"\n",(0,r.jsx)(n.li,{children:"\u4fee\u6539\u5206\u9875\u67e5\u8be2Blog\u4e1a\u52a1\uff0c\u5224\u65ad\u5f53\u524d\u767b\u5f55\u7528\u6237\u662f\u5426\u70b9\u8d5e\u8fc7\uff0c\u8d4b\u503c\u7ed9isLike\u5b57\u6bb5"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u4e3a\u4ec0\u4e48\u91c7\u7528set\u96c6\u5408\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"\u56e0\u4e3a\u6211\u4eec\u7684\u6570\u636e\u662f\u4e0d\u80fd\u91cd\u590d\u7684\uff0c\u5f53\u7528\u6237\u64cd\u4f5c\u8fc7\u4e4b\u540e\uff0c\u65e0\u8bba\u4ed6\u600e\u4e48\u64cd\u4f5c\uff0c\u90fd\u662f"}),"\n",(0,r.jsx)(n.p,{children:"\u5177\u4f53\u6b65\u9aa4\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"1\u3001\u5728Blog \u6dfb\u52a0\u4e00\u4e2a\u5b57\u6bb5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@TableField(exist = false)\nprivate Boolean isLike;\n"})}),"\n",(0,r.jsx)(n.p,{children:"2\u3001\u4fee\u6539\u4ee3\u7801"}),"\n",(0,r.jsx)(n.p,{children:"BlogContrller"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:' \t@PutMapping("/like/{id}")\n    public Result likeBlog(@PathVariable("id") Long id) {\n        return blogService.likeBlog(id);\n    }\n'})}),"\n",(0,r.jsx)(n.p,{children:"BlogServiceImpl"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'\t@Override\n    public Result queryHotBlog(Integer current) {\n\t\t...\n        //\u4fee\u6539forEach\n        records.forEach(blog -> {\n            //\u67e5\u8be2blog\u6709\u5173\u7684\u7528\u6237\n            this.queryBlogUser(blog);\n            //\u67e5\u8be2\u8be5blog\u81ea\u5df1\u662f\u5426\u70b9\u8d5e\n            this.isBlogLiked(blog);\t\n        });\n\t\t...\n    }\n\n\t@Override\n    public Result queryBlogById(Long id) {\n        ...\n        //\u67e5\u8be2\u8be5blog\u81ea\u5df1\u662f\u5426\u70b9\u8d5e\n        this.isBlogLiked(blog);\t\t//\u65b0\u589e\n        ...\n    }\n\n\t@Override\n    public Result likeBlog(Long id){\n        // 1.\u83b7\u53d6\u767b\u5f55\u7528\u6237\n        Long userId = UserHolder.getUser().getId();\n        // 2.\u5224\u65ad\u5f53\u524d\u767b\u5f55\u7528\u6237\u662f\u5426\u5df2\u7ecf\u70b9\u8d5e\n        String key = BLOG_LIKED_KEY + id;\n        Boolean isMember = stringRedisTemplate.opsForSet().isMember(key, userId.toString());\n        if(BooleanUtil.isFalse(isMember)){\n             //3.\u5982\u679c\u672a\u70b9\u8d5e\uff0c\u53ef\u4ee5\u70b9\u8d5e\n            //3.1 \u6570\u636e\u5e93\u70b9\u8d5e\u6570+1\n            boolean isSuccess = update().setSql("liked = liked + 1").eq("id", id).update();\n            //3.2 \u4fdd\u5b58\u7528\u6237\u5230Redis\u7684set\u96c6\u5408\n            if(isSuccess){\n                stringRedisTemplate.opsForSet().add(key,userId.toString());\n            }\n        }else{\n             //4.\u5982\u679c\u5df2\u70b9\u8d5e\uff0c\u53d6\u6d88\u70b9\u8d5e\n            //4.1 \u6570\u636e\u5e93\u70b9\u8d5e\u6570-1\n            boolean isSuccess = update().setSql("liked = liked - 1").eq("id", id).update();\n            //4.2 \u628a\u7528\u6237\u4eceRedis\u7684set\u96c6\u5408\u79fb\u9664\n            if(isSuccess){\n                stringRedisTemplate.opsForSet().remove(key,userId.toString());\n            }\n        }\n        return Result.ok();\n    }\n\n\tprivate void isBlogLiked(Blog blog) {\n        UserDTO user = UserHolder.getUser();\n        if(user == null) {\n            return;\n        }\n        Long userId = user.getId();\n        String key = RedisConstants.BLOG_LIKED_KEY + blog.getId();\n        Double score = stringRedisTemplate.opsForZSet().score(key, userId.toString());\n        blog.setIsLike(score != null);\n    }\n'})}),"\n",(0,r.jsx)(n.h2,{id:"84-\u8fbe\u4eba\u63a2\u5e97-\u70b9\u8d5e\u6392\u884c\u699c",children:"8.4 \u8fbe\u4eba\u63a2\u5e97-\u70b9\u8d5e\u6392\u884c\u699c"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u63a2\u5e97\u7b14\u8bb0\u7684\u8be6\u60c5\u9875\u9762\uff0c\u5e94\u8be5\u628a\u7ed9\u8be5\u7b14\u8bb0\u70b9\u8d5e\u7684\u4eba\u663e\u793a\u51fa\u6765\uff0c\u6bd4\u5982\u6700\u65e9\u70b9\u8d5e\u7684TOP5\uff0c\u5f62\u6210\u70b9\u8d5e\u6392\u884c\u699c\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"\u4e4b\u524d\u7684\u70b9\u8d5e\u662f\u653e\u5230set\u96c6\u5408\uff0c\u4f46\u662fset\u96c6\u5408\u662f\u4e0d\u80fd\u6392\u5e8f\u7684\uff0c\u6240\u4ee5\u8fd9\u4e2a\u65f6\u5019\uff0c\u54b1\u4eec\u53ef\u4ee5\u91c7\u7528\u4e00\u4e2a\u53ef\u4ee5\u6392\u5e8f\u7684set\u96c6\u5408\uff0c\u5c31\u662f\u54b1\u4eec\u7684sortedSet"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653805077118",src:s(96053).A+"",width:"1306",height:"633"})}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u63a5\u4e0b\u6765\u6765\u5bf9\u6bd4\u4e00\u4e0b\u8fd9\u4e9b\u96c6\u5408\u7684\u533a\u522b\u662f\u4ec0\u4e48"}),"\n",(0,r.jsx)(n.p,{children:"\u6240\u6709\u70b9\u8d5e\u7684\u4eba\uff0c\u9700\u8981\u662f\u552f\u4e00\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u5e94\u5f53\u4f7f\u7528set\u6216\u8005\u662fsortedSet"}),"\n",(0,r.jsx)(n.p,{children:"\u5176\u6b21\u6211\u4eec\u9700\u8981\u6392\u5e8f\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u9501\u5b9a\u4f7f\u7528sortedSet\u5566"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653805203758",src:s(20866).A+"",width:"1167",height:"412"})}),"\n",(0,r.jsx)(n.p,{children:"\u4fee\u6539\u4ee3\u7801"}),"\n",(0,r.jsx)(n.p,{children:"BlogServiceImpl"}),"\n",(0,r.jsx)(n.p,{children:"\u70b9\u8d5e\u903b\u8f91\u4ee3\u7801"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\u628a\u524d\u4e00\u8282\u4e2d\u7684 \u5bf9set \u7684\u64cd\u4f5c\u90fd\u5148\u6539\u4e3a\u5bf9 zset \u7684\u64cd\u4f5c"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'   @Override\n    public Result likeBlog(Long id) {\n        // 1.\u83b7\u53d6\u767b\u5f55\u7528\u6237\n        Long userId = UserHolder.getUser().getId();\n        // 2.\u5224\u65ad\u5f53\u524d\u767b\u5f55\u7528\u6237\u662f\u5426\u5df2\u7ecf\u70b9\u8d5e\n        String key = BLOG_LIKED_KEY + id;\n        Double score = stringRedisTemplate.opsForZSet().score(key, userId.toString());\n        if (score == null) {\n            // 3.\u5982\u679c\u672a\u70b9\u8d5e\uff0c\u53ef\u4ee5\u70b9\u8d5e\n            // 3.1.\u6570\u636e\u5e93\u70b9\u8d5e\u6570 + 1\n            boolean isSuccess = update().setSql("liked = liked + 1").eq("id", id).update();\n            // 3.2.\u4fdd\u5b58\u7528\u6237\u5230Redis\u7684set\u96c6\u5408  zadd key value score\n            if (isSuccess) {\n                stringRedisTemplate.opsForZSet().add(key, userId.toString(), System.currentTimeMillis());\n            }\n        } else {\n            // 4.\u5982\u679c\u5df2\u70b9\u8d5e\uff0c\u53d6\u6d88\u70b9\u8d5e\n            // 4.1.\u6570\u636e\u5e93\u70b9\u8d5e\u6570 -1\n            boolean isSuccess = update().setSql("liked = liked - 1").eq("id", id).update();\n            // 4.2.\u628a\u7528\u6237\u4eceRedis\u7684set\u96c6\u5408\u79fb\u9664\n            if (isSuccess) {\n                stringRedisTemplate.opsForZSet().remove(key, userId.toString());\n            }\n        }\n        return Result.ok();\n    }\n\n\n    private void isBlogLiked(Blog blog) {\n        // 1.\u83b7\u53d6\u767b\u5f55\u7528\u6237\n        UserDTO user = UserHolder.getUser();\n        if (user == null) {\n            // \u7528\u6237\u672a\u767b\u5f55\uff0c\u65e0\u9700\u67e5\u8be2\u662f\u5426\u70b9\u8d5e\n            return;\n        }\n        Long userId = user.getId();\n        // 2.\u5224\u65ad\u5f53\u524d\u767b\u5f55\u7528\u6237\u662f\u5426\u5df2\u7ecf\u70b9\u8d5e\n        String key = "blog:liked:" + blog.getId();\n        Double score = stringRedisTemplate.opsForZSet().score(key, userId.toString());\n        blog.setIsLike(score != null);\n    }\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u70b9\u8d5e\u5217\u8868\u67e5\u8be2\u5217\u8868"}),"\n",(0,r.jsx)(n.p,{children:"BlogController"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@GetMapping("/likes/{id}")\npublic Result queryBlogLikes(@PathVariable("id") Long id) {\n\n    return blogService.queryBlogLikes(id);\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"BlogService"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Override\npublic Result queryBlogLikes(Long id) {\n    String key = BLOG_LIKED_KEY + id;\n    // 1.\u67e5\u8be2top5\u7684\u70b9\u8d5e\u7528\u6237 zrange key 0 4\n    Set<String> top5 = stringRedisTemplate.opsForZSet().range(key, 0, 4);\n    if (top5 == null || top5.isEmpty()) {\n        return Result.ok(Collections.emptyList());\n    }\n    // 2.\u89e3\u6790\u51fa\u5176\u4e2d\u7684\u7528\u6237id\n    List<Long> ids = top5.stream().map(Long::valueOf).collect(Collectors.toList());\n    String idStr = StrUtil.join(",", ids);\n    // 3.\u6839\u636e\u7528\u6237id\u67e5\u8be2\u7528\u6237 WHERE id IN ( 5 , 1 ) ORDER BY FIELD(id, 5, 1)\n    List<UserDTO> userDTOS = userService.query()\n            .in("id", ids).last("ORDER BY FIELD(id," + idStr + ")").list()//\u56e0\u4e3amysql\u7528in\u67e5\u8be2\u51fa\u6765\u7684\u662f\u5012\u5e8f\uff0c\u6240\u4ee5\u7528order by\u6b63\u8fc7\u6765\n            .stream()\n            .map(user -> BeanUtil.copyProperties(user, UserDTO.class))\n            .collect(Collectors.toList());\n    // 4.\u8fd4\u56de\n    return Result.ok(userDTOS);\n}\n'})}),"\n",(0,r.jsx)(n.h1,{id:"9\u597d\u53cb\u5173\u6ce8",children:"9\u3001\u597d\u53cb\u5173\u6ce8"}),"\n",(0,r.jsx)(n.h2,{id:"91-\u597d\u53cb\u5173\u6ce8-\u5173\u6ce8\u548c\u53d6\u6d88\u5173\u6ce8",children:"9.1 \u597d\u53cb\u5173\u6ce8-\u5173\u6ce8\u548c\u53d6\u6d88\u5173\u6ce8"}),"\n",(0,r.jsx)(n.p,{children:"\u9488\u5bf9\u7528\u6237\u7684\u64cd\u4f5c\uff1a\u53ef\u4ee5\u5bf9\u7528\u6237\u8fdb\u884c\u5173\u6ce8\u548c\u53d6\u6d88\u5173\u6ce8\u529f\u80fd\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653806140822",src:s(7325).A+"",width:"1404",height:"694"})}),"\n",(0,r.jsx)(n.p,{children:"\u5b9e\u73b0\u601d\u8def\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"\u9700\u6c42\uff1a\u57fa\u4e8e\u8be5\u8868\u6570\u636e\u7ed3\u6784\uff0c\u5b9e\u73b0\u4e24\u4e2a\u63a5\u53e3\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5173\u6ce8\u548c\u53d6\u5173\u63a5\u53e3"}),"\n",(0,r.jsx)(n.li,{children:"\u5224\u65ad\u662f\u5426\u5173\u6ce8\u7684\u63a5\u53e3"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u5173\u6ce8\u662fUser\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u662f\u535a\u4e3b\u4e0e\u7c89\u4e1d\u7684\u5173\u7cfb\uff0c\u6570\u636e\u5e93\u4e2d\u6709\u4e00\u5f20tb_follow\u8868\u6765\u6807\u793a\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653806253817",src:s(84828).A+"",width:"1200",height:"250"})}),"\n",(0,r.jsx)(n.p,{children:"\u6ce8\u610f: \u8fd9\u91cc\u9700\u8981\u628a\u4e3b\u952e\u4fee\u6539\u4e3a\u81ea\u589e\u957f\uff0c\u7b80\u5316\u5f00\u53d1\u3002"}),"\n",(0,r.jsx)(n.p,{children:"FollowController"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'//\u5173\u6ce8\n@PutMapping("/{id}/{isFollow}")\npublic Result follow(@PathVariable("id") Long followUserId, @PathVariable("isFollow") Boolean isFollow) {\n    return followService.follow(followUserId, isFollow);\n}\n//\u53d6\u6d88\u5173\u6ce8\n@GetMapping("/or/not/{id}")\npublic Result isFollow(@PathVariable("id") Long followUserId) {\n      return followService.isFollow(followUserId);\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"FollowService"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Override\npublic Result isFollow(Long followUserId) {\n    // 1.\u83b7\u53d6\u767b\u5f55\u7528\u6237\n    Long userId = UserHolder.getUser().getId();\n    // 2.\u67e5\u8be2\u662f\u5426\u5173\u6ce8 select count(*) from tb_follow where user_id = ? and follow_user_id = ?\n    Integer count = query().eq("user_id", userId).eq("follow_user_id", followUserId).count();\n    // 3.\u5224\u65ad\n    return Result.ok(count > 0);\n}\n\n@Override\npublic Result follow(Long followUserId, Boolean isFollow) {\n    // 1.\u83b7\u53d6\u767b\u5f55\u7528\u6237\n    Long userId = UserHolder.getUser().getId();\n    // 1.\u5224\u65ad\u5230\u5e95\u662f\u5173\u6ce8\u8fd8\u662f\u53d6\u5173\n    if (isFollow) {\n        // 2.\u5173\u6ce8\uff0c\u65b0\u589e\u6570\u636e\n        Follow follow = new Follow();\n        follow.setUserId(userId);\n        follow.setFollowUserId(followUserId);\n        save(follow);\n    } else {\n        // 3.\u53d6\u5173\uff0c\u5220\u9664 delete from tb_follow where user_id = ? and follow_user_id = ?\n        remove(new QueryWrapper<Follow>()\n                .eq("user_id", userId).eq("follow_user_id", followUserId));\n    }\n    return Result.ok();\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"92-\u597d\u53cb\u5173\u6ce8-\u5171\u540c\u5173\u6ce8",children:"9.2 \u597d\u53cb\u5173\u6ce8-\u5171\u540c\u5173\u6ce8"}),"\n",(0,r.jsx)(n.p,{children:"\u60f3\u8981\u53bb\u770b\u5171\u540c\u5173\u6ce8\u7684\u597d\u53cb\uff0c\u9700\u8981\u9996\u5148\u8fdb\u5165\u5230\u8fd9\u4e2a\u9875\u9762\uff0c\u8fd9\u4e2a\u9875\u9762\u4f1a\u53d1\u8d77\u4e24\u4e2a\u8bf7\u6c42"}),"\n",(0,r.jsx)(n.p,{children:"1\u3001\u53bb\u67e5\u8be2\u7528\u6237\u7684\u8be6\u60c5"}),"\n",(0,r.jsx)(n.p,{children:"2\u3001\u53bb\u67e5\u8be2\u7528\u6237\u7684\u7b14\u8bb0"}),"\n",(0,r.jsx)(n.p,{children:"\u4ee5\u4e0a\u4e24\u4e2a\u529f\u80fd\u548c\u5171\u540c\u5173\u6ce8\u6ca1\u6709\u4ec0\u4e48\u5173\u7cfb\uff0c\u5927\u5bb6\u53ef\u4ee5\u81ea\u884c\u5c06\u7b14\u8bb0\u4e2d\u7684\u4ee3\u7801\u62f7\u8d1d\u5230idea\u4e2d\u5c31\u53ef\u4ee5\u5b9e\u73b0\u8fd9\u4e24\u4e2a\u529f\u80fd\u4e86\uff0c\u6211\u4eec\u7684\u91cd\u70b9\u5728\u4e8e\u5171\u540c\u5173\u6ce8\u529f\u80fd\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653806706296",src:s(290).A+"",width:"1602",height:"630"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// UserController \u6839\u636eid\u67e5\u8be2\u7528\u6237\n@GetMapping("/{id}")\npublic Result queryUserById(@PathVariable("id") Long userId){\n\t// \u67e5\u8be2\u8be6\u60c5\n\tUser user = userService.getById(userId);\n\tif (user == null) {\n\t\treturn Result.ok();\n\t}\n\tUserDTO userDTO = BeanUtil.copyProperties(user, UserDTO.class);\n\t// \u8fd4\u56de\n\treturn Result.ok(userDTO);\n}\n\n// BlogController  \u6839\u636eid\u67e5\u8be2\u535a\u4e3b\u7684\u63a2\u5e97\u7b14\u8bb0\n@GetMapping("/of/user")\npublic Result queryBlogByUserId(\n\t\t@RequestParam(value = "current", defaultValue = "1") Integer current,\n\t\t@RequestParam("id") Long id) {\n\t// \u6839\u636e\u7528\u6237\u67e5\u8be2\n\tPage<Blog> page = blogService.query()\n\t\t\t.eq("user_id", id).page(new Page<>(current, SystemConstants.MAX_PAGE_SIZE));\n\t// \u83b7\u53d6\u5f53\u524d\u9875\u6570\u636e\n\tList<Blog> records = page.getRecords();\n\treturn Result.ok(records);\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\u6211\u4eec\u6765\u770b\u770b\u5171\u540c\u5173\u6ce8\u5982\u4f55\u5b9e\u73b0\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"\u9700\u6c42\uff1a\u5229\u7528Redis\u4e2d\u6070\u5f53\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5b9e\u73b0\u5171\u540c\u5173\u6ce8\u529f\u80fd\u3002\u5728\u535a\u4e3b\u4e2a\u4eba\u9875\u9762\u5c55\u793a\u51fa\u5f53\u524d\u7528\u6237\u4e0e\u535a\u4e3b\u7684\u5171\u540c\u5173\u6ce8\u5462\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u5f53\u7136\u662f\u4f7f\u7528\u6211\u4eec\u4e4b\u524d\u5b66\u4e60\u8fc7\u7684set\u96c6\u5408\u54af\uff0c\u5728set\u96c6\u5408\u4e2d\uff0c\u6709\u4ea4\u96c6\u5e76\u96c6\u8865\u96c6\u7684api\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u4e24\u4eba\u7684\u5173\u6ce8\u7684\u4eba\u5206\u522b\u653e\u5165\u5230\u4e00\u4e2aset\u96c6\u5408\u4e2d\uff0c\u7136\u540e\u518d\u901a\u8fc7api\u53bb\u67e5\u770b\u8fd9\u4e24\u4e2aset\u96c6\u5408\u4e2d\u7684\u4ea4\u96c6\u6570\u636e\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653806973212",src:s(35708).A+"",width:"1259",height:"563"})}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u5148\u6765\u6539\u9020\u5f53\u524d\u7684\u5173\u6ce8\u5217\u8868"}),"\n",(0,r.jsx)(n.p,{children:"\u6539\u9020\u539f\u56e0\u662f\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u5728\u7528\u6237\u5173\u6ce8\u4e86\u67d0\u4f4d\u7528\u6237\u540e\uff0c\u9700\u8981\u5c06\u6570\u636e\u653e\u5165\u5230set\u96c6\u5408\u4e2d\uff0c\u65b9\u4fbf\u540e\u7eed\u8fdb\u884c\u5171\u540c\u5173\u6ce8\uff0c\u540c\u65f6\u5f53\u53d6\u6d88\u5173\u6ce8\u65f6\uff0c\u4e5f\u9700\u8981\u4eceset\u96c6\u5408\u4e2d\u8fdb\u884c\u5220\u9664"}),"\n",(0,r.jsx)(n.p,{children:"FollowServiceImpl"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Override\npublic Result follow(Long followUserId, Boolean isFollow) {\n    // 1.\u83b7\u53d6\u767b\u5f55\u7528\u6237\n    Long userId = UserHolder.getUser().getId();\n    String key = "follows:" + userId;\n    // 1.\u5224\u65ad\u5230\u5e95\u662f\u5173\u6ce8\u8fd8\u662f\u53d6\u5173\n    if (isFollow) {\n        // 2.\u5173\u6ce8\uff0c\u65b0\u589e\u6570\u636e\n        Follow follow = new Follow();\n        follow.setUserId(userId);\n        follow.setFollowUserId(followUserId);\n        boolean isSuccess = save(follow);\n        if (isSuccess) {\n            // \u628a\u5173\u6ce8\u7528\u6237\u7684id\uff0c\u653e\u5165redis\u7684set\u96c6\u5408 sadd userId followerUserId\n            stringRedisTemplate.opsForSet().add(key, followUserId.toString());\n        }\n    } else {\n        // 3.\u53d6\u5173\uff0c\u5220\u9664 delete from tb_follow where user_id = ? and follow_user_id = ?\n        boolean isSuccess = remove(new QueryWrapper<Follow>()\n                .eq("user_id", userId).eq("follow_user_id", followUserId));\n        if (isSuccess) {\n            // \u628a\u5173\u6ce8\u7528\u6237\u7684id\u4eceRedis\u96c6\u5408\u4e2d\u79fb\u9664\n            stringRedisTemplate.opsForSet().remove(key, followUserId.toString());\n        }\n    }\n    return Result.ok();\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u5177\u4f53\u7684\u5173\u6ce8\u4ee3\u7801\uff1a"})}),"\n",(0,r.jsx)(n.p,{children:"FollowServiceImpl"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Override\npublic Result followCommons(Long id) {\n    // 1.\u83b7\u53d6\u5f53\u524d\u7528\u6237\n    Long userId = UserHolder.getUser().getId();\n    String key = "follows:" + userId;\n    // 2.\u6c42\u4ea4\u96c6\n    String key2 = "follows:" + id;\n    Set<String> intersect = stringRedisTemplate.opsForSet().intersect(key, key2);\n    if (intersect == null || intersect.isEmpty()) {\n        // \u65e0\u4ea4\u96c6\n        return Result.ok(Collections.emptyList());\n    }\n    // 3.\u89e3\u6790id\u96c6\u5408\n    List<Long> ids = intersect.stream().map(Long::valueOf).collect(Collectors.toList());\n    // 4.\u67e5\u8be2\u7528\u6237\n    List<UserDTO> users = userService.listByIds(ids)\n            .stream()\n            .map(user -> BeanUtil.copyProperties(user, UserDTO.class))\n            .collect(Collectors.toList());\n    return Result.ok(users);\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"93-\u597d\u53cb\u5173\u6ce8-feed\u6d41\u5b9e\u73b0\u65b9\u6848",children:"9.3 \u597d\u53cb\u5173\u6ce8-Feed\u6d41\u5b9e\u73b0\u65b9\u6848"}),"\n",(0,r.jsx)(n.p,{children:"\u5f53\u6211\u4eec\u5173\u6ce8\u4e86\u7528\u6237\u540e\uff0c\u8fd9\u4e2a\u7528\u6237\u53d1\u4e86\u52a8\u6001\uff0c\u90a3\u4e48\u6211\u4eec\u5e94\u8be5\u628a\u8fd9\u4e9b\u6570\u636e\u63a8\u9001\u7ed9\u7528\u6237\uff0c\u8fd9\u4e2a\u9700\u6c42\uff0c\u5176\u5b9e\u6211\u4eec\u53c8\u628a\u4ed6\u53eb\u505aFeed\u6d41\uff0c\u5173\u6ce8\u63a8\u9001\u4e5f\u53eb\u505aFeed\u6d41\uff0c\u76f4\u8bd1\u4e3a\u6295\u5582\u3002\u4e3a\u7528\u6237\u6301\u7eed\u7684\u63d0\u4f9b\u201c\u6c89\u6d78\u5f0f\u201d\u7684\u4f53\u9a8c\uff0c\u901a\u8fc7\u65e0\u9650\u4e0b\u62c9\u5237\u65b0\u83b7\u53d6\u65b0\u7684\u4fe1\u606f\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u5bf9\u4e8e\u4f20\u7edf\u7684\u6a21\u5f0f\u7684\u5185\u5bb9\u89e3\u9501\uff1a\u6211\u4eec\u662f\u9700\u8981\u7528\u6237\u53bb\u901a\u8fc7\u641c\u7d22\u5f15\u64ce\u6216\u8005\u662f\u5176\u4ed6\u7684\u65b9\u5f0f\u53bb\u89e3\u9501\u60f3\u8981\u770b\u7684\u5185\u5bb9"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653808641260",src:s(3041).A+"",width:"1060",height:"175"})}),"\n",(0,r.jsx)(n.p,{children:"\u5bf9\u4e8e\u65b0\u578b\u7684Feed\u6d41\u7684\u7684\u6548\u679c\uff1a\u4e0d\u9700\u8981\u6211\u4eec\u7528\u6237\u518d\u53bb\u63a8\u9001\u4fe1\u606f\uff0c\u800c\u662f\u7cfb\u7edf\u5206\u6790\u7528\u6237\u5230\u5e95\u60f3\u8981\u4ec0\u4e48\uff0c\u7136\u540e\u76f4\u63a5\u628a\u5185\u5bb9\u63a8\u9001\u7ed9\u7528\u6237\uff0c\u4ece\u800c\u4f7f\u7528\u6237\u80fd\u591f\u66f4\u52a0\u7684\u8282\u7ea6\u65f6\u95f4\uff0c\u4e0d\u7528\u4e3b\u52a8\u53bb\u5bfb\u627e\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653808993693",src:s(69341).A+"",width:"1062",height:"188"})}),"\n",(0,r.jsx)(n.p,{children:"Feed\u6d41\u7684\u5b9e\u73b0\u6709\u4e24\u79cd\u6a21\u5f0f\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"Feed\u6d41\u4ea7\u54c1\u6709\u4e24\u79cd\u5e38\u89c1\u6a21\u5f0f\uff1a\nTimeline\uff1a\u4e0d\u505a\u5185\u5bb9\u7b5b\u9009\uff0c\u7b80\u5355\u7684\u6309\u7167\u5185\u5bb9\u53d1\u5e03\u65f6\u95f4\u6392\u5e8f\uff0c\u5e38\u7528\u4e8e\u597d\u53cb\u6216\u5173\u6ce8\u3002\u4f8b\u5982\u670b\u53cb\u5708"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4f18\u70b9\uff1a\u4fe1\u606f\u5168\u9762\uff0c\u4e0d\u4f1a\u6709\u7f3a\u5931\u3002\u5e76\u4e14\u5b9e\u73b0\u4e5f\u76f8\u5bf9\u7b80\u5355"}),"\n",(0,r.jsx)(n.li,{children:"\u7f3a\u70b9\uff1a\u4fe1\u606f\u566a\u97f3\u8f83\u591a\uff0c\u7528\u6237\u4e0d\u4e00\u5b9a\u611f\u5174\u8da3\uff0c\u5185\u5bb9\u83b7\u53d6\u6548\u7387\u4f4e"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u667a\u80fd\u6392\u5e8f\uff1a\u5229\u7528\u667a\u80fd\u7b97\u6cd5\u5c4f\u853d\u6389\u8fdd\u89c4\u7684\u3001\u7528\u6237\u4e0d\u611f\u5174\u8da3\u7684\u5185\u5bb9\u3002\u63a8\u9001\u7528\u6237\u611f\u5174\u8da3\u4fe1\u606f\u6765\u5438\u5f15\u7528\u6237"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4f18\u70b9\uff1a\u6295\u5582\u7528\u6237\u611f\u5174\u8da3\u4fe1\u606f\uff0c\u7528\u6237\u7c98\u5ea6\u5f88\u9ad8\uff0c\u5bb9\u6613\u6c89\u8ff7"}),"\n",(0,r.jsx)(n.li,{children:"\u7f3a\u70b9\uff1a\u5982\u679c\u7b97\u6cd5\u4e0d\u7cbe\u51c6\uff0c\u53ef\u80fd\u8d77\u5230\u53cd\u4f5c\u7528\n\u672c\u4f8b\u4e2d\u7684\u4e2a\u4eba\u9875\u9762\uff0c\u662f\u57fa\u4e8e\u5173\u6ce8\u7684\u597d\u53cb\u6765\u505aFeed\u6d41\uff0c\u56e0\u6b64\u91c7\u7528Timeline\u7684\u6a21\u5f0f\u3002\u8be5\u6a21\u5f0f\u7684\u5b9e\u73b0\u65b9\u6848\u6709\u4e09\u79cd\uff1a"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u672c\u6b21\u9488\u5bf9\u597d\u53cb\u7684\u64cd\u4f5c\uff0c\u91c7\u7528\u7684\u5c31\u662fTimeline\u7684\u65b9\u5f0f\uff0c\u53ea\u9700\u8981\u62ff\u5230\u6211\u4eec\u5173\u6ce8\u7528\u6237\u7684\u4fe1\u606f\uff0c\u7136\u540e\u6309\u7167\u65f6\u95f4\u6392\u5e8f\u5373\u53ef\uff0c\u56e0\u6b64\u91c7\u7528Timeline\u7684\u6a21\u5f0f\u3002\u8be5\u6a21\u5f0f\u7684\u5b9e\u73b0\u65b9\u6848\u6709\u4e09\u79cd\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u62c9\u6a21\u5f0f"}),"\n",(0,r.jsx)(n.li,{children:"\u63a8\u6a21\u5f0f"}),"\n",(0,r.jsx)(n.li,{children:"\u63a8\u62c9\u7ed3\u5408"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u62c9\u6a21\u5f0f"}),"\uff1a\u4e5f\u53eb\u505a\u8bfb\u6269\u6563"]}),"\n",(0,r.jsx)(n.p,{children:"\u8be5\u6a21\u5f0f\u7684\u6838\u5fc3\u542b\u4e49\u5c31\u662f\uff1a\u5f53\u5f20\u4e09\u548c\u674e\u56db\u548c\u738b\u4e94\u53d1\u4e86\u6d88\u606f\u540e\uff0c\u90fd\u4f1a\u4fdd\u5b58\u5728\u81ea\u5df1\u7684\u90ae\u7bb1\u4e2d\uff0c\u5047\u8bbe\u8d75\u516d\u8981\u8bfb\u53d6\u4fe1\u606f\uff0c\u90a3\u4e48\u4ed6\u4f1a\u4ece\u8bfb\u53d6\u4ed6\u81ea\u5df1\u7684\u6536\u4ef6\u7bb1\uff0c\u6b64\u65f6\u7cfb\u7edf\u4f1a\u4ece\u4ed6\u5173\u6ce8\u7684\u4eba\u7fa4\u4e2d\uff0c\u628a\u4ed6\u5173\u6ce8\u4eba\u7684\u4fe1\u606f\u5168\u90e8\u90fd\u8fdb\u884c\u62c9\u53d6\uff0c\u7136\u540e\u5728\u8fdb\u884c\u6392\u5e8f"}),"\n",(0,r.jsx)(n.p,{children:"\u4f18\u70b9\uff1a\u6bd4\u8f83\u8282\u7ea6\u7a7a\u95f4\uff0c\u56e0\u4e3a\u8d75\u516d\u5728\u8bfb\u4fe1\u606f\u65f6\uff0c\u5e76\u6ca1\u6709\u91cd\u590d\u8bfb\u53d6\uff0c\u800c\u4e14\u8bfb\u53d6\u5b8c\u4e4b\u540e\u53ef\u4ee5\u628a\u4ed6\u7684\u6536\u4ef6\u7bb1\u8fdb\u884c\u6e05\u695a\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u7f3a\u70b9\uff1a",(0,r.jsx)(n.strong,{children:"\u6bd4\u8f83\u5ef6\u8fdf"}),"\uff0c\u5f53\u7528\u6237\u8bfb\u53d6\u6570\u636e\u65f6\u624d\u53bb\u5173\u6ce8\u7684\u4eba\u91cc\u8fb9\u53bb\u8bfb\u53d6\u6570\u636e\uff0c\u5047\u8bbe\u7528\u6237\u5173\u6ce8\u4e86\u5927\u91cf\u7684\u7528\u6237\uff0c\u90a3\u4e48\u6b64\u65f6\u5c31\u4f1a\u62c9\u53d6\u6d77\u91cf\u7684\u5185\u5bb9\uff0c\u5bf9\u670d\u52a1\u5668\u538b\u529b\u5de8\u5927\u3002"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653809450816",src:s(31609).A+"",width:"1474",height:"637"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u63a8\u6a21\u5f0f"}),"\uff1a\u4e5f\u53eb\u505a\u5199\u6269\u6563\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u63a8\u6a21\u5f0f\u662f\u6ca1\u6709\u5199\u90ae\u7bb1\u7684\uff0c\u5f53\u5f20\u4e09\u5199\u4e86\u4e00\u4e2a\u5185\u5bb9\uff0c\u6b64\u65f6\u4f1a\u4e3b\u52a8\u7684\u628a\u5f20\u4e09\u5199\u7684\u5185\u5bb9\u53d1\u9001\u5230\u4ed6\u7684\u7c89\u4e1d\u6536\u4ef6\u7bb1\u4e2d\u53bb\uff0c\u5047\u8bbe\u6b64\u65f6\u674e\u56db\u518d\u6765\u8bfb\u53d6\uff0c\u5c31\u4e0d\u7528\u518d\u53bb\u4e34\u65f6\u62c9\u53d6\u4e86"}),"\n",(0,r.jsx)(n.p,{children:"\u4f18\u70b9\uff1a\u65f6\u6548\u5feb\uff0c\u4e0d\u7528\u4e34\u65f6\u62c9\u53d6"}),"\n",(0,r.jsxs)(n.p,{children:["\u7f3a\u70b9\uff1a",(0,r.jsx)(n.strong,{children:"\u5185\u5b58\u538b\u529b\u5927"}),"\uff0c\u5047\u8bbe\u4e00\u4e2a\u5927V\u5199\u4fe1\u606f\uff0c\u5f88\u591a\u4eba\u5173\u6ce8\u4ed6\uff0c \u5c31\u4f1a\u5199\u5f88\u591a\u5206\u6570\u636e\u5230\u7c89\u4e1d\u90a3\u8fb9\u53bb"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653809875208",src:s(55579).A+"",width:"1012",height:"688"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u63a8\u62c9\u7ed3\u5408\u6a21\u5f0f"}),"\uff1a\u4e5f\u53eb\u505a\u8bfb\u5199\u6df7\u5408\uff0c\u517c\u5177\u63a8\u548c\u62c9\u4e24\u79cd\u6a21\u5f0f\u7684\u4f18\u70b9\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u63a8\u62c9\u6a21\u5f0f\u662f\u4e00\u4e2a\u6298\u4e2d\u7684\u65b9\u6848\uff0c\u7ad9\u5728\u53d1\u4ef6\u4eba\u8fd9\u4e00\u6bb5\uff0c\u5982\u679c\u662f\u4e2a\u666e\u901a\u7684\u4eba\uff0c\u90a3\u4e48\u6211\u4eec\u91c7\u7528\u5199\u6269\u6563\u7684\u65b9\u5f0f\uff0c\u76f4\u63a5\u628a\u6570\u636e\u5199\u5165\u5230\u4ed6\u7684\u7c89\u4e1d\u4e2d\u53bb\uff0c\u56e0\u4e3a\u666e\u901a\u7684\u4eba\u4ed6\u7684\u7c89\u4e1d\u5173\u6ce8\u91cf\u6bd4\u8f83\u5c0f\uff0c\u6240\u4ee5\u8fd9\u6837\u505a\u6ca1\u6709\u538b\u529b\uff0c\u5982\u679c\u662f\u5927V\uff0c\u90a3\u4e48\u4ed6\u662f\u76f4\u63a5\u5c06\u6570\u636e\u5148\u5199\u5165\u5230\u4e00\u4efd\u5230\u53d1\u4ef6\u7bb1\u91cc\u8fb9\u53bb\uff0c\u7136\u540e\u518d\u76f4\u63a5\u5199\u4e00\u4efd\u5230\u6d3b\u8dc3\u7c89\u4e1d\u6536\u4ef6\u7bb1\u91cc\u8fb9\u53bb\uff0c\u73b0\u5728\u7ad9\u5728\u6536\u4ef6\u4eba\u8fd9\u7aef\u6765\u770b\uff0c\u5982\u679c\u662f\u6d3b\u8dc3\u7c89\u4e1d\uff0c\u90a3\u4e48\u5927V\u548c\u666e\u901a\u7684\u4eba\u53d1\u7684\u90fd\u4f1a\u76f4\u63a5\u5199\u5165\u5230\u81ea\u5df1\u6536\u4ef6\u7bb1\u91cc\u8fb9\u6765\uff0c\u800c\u5982\u679c\u662f\u666e\u901a\u7684\u7c89\u4e1d\uff0c\u7531\u4e8e\u4ed6\u4eec\u4e0a\u7ebf\u4e0d\u662f\u5f88\u9891\u7e41\uff0c\u6240\u4ee5\u7b49\u4ed6\u4eec\u4e0a\u7ebf\u65f6\uff0c\u518d\u4ece\u53d1\u4ef6\u7bb1\u91cc\u8fb9\u53bb\u62c9\u4fe1\u606f\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653812346852",src:s(20091).A+"",width:"1442",height:"640"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20240120195705841",src:s(16890).A+"",width:"2032",height:"974"})}),"\n",(0,r.jsx)(n.h2,{id:"94-\u597d\u53cb\u5173\u6ce8-\u63a8\u9001\u5230\u7c89\u4e1d\u6536\u4ef6\u7bb1",children:"9.4 \u597d\u53cb\u5173\u6ce8-\u63a8\u9001\u5230\u7c89\u4e1d\u6536\u4ef6\u7bb1"}),"\n",(0,r.jsx)(n.p,{children:"\u9700\u6c42\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4fee\u6539\u65b0\u589e\u63a2\u5e97\u7b14\u8bb0\u7684\u4e1a\u52a1\uff0c\u5728\u4fdd\u5b58blog\u5230\u6570\u636e\u5e93\u7684\u540c\u65f6\uff0c\u63a8\u9001\u5230\u7c89\u4e1d\u7684\u6536\u4ef6\u7bb1"}),"\n",(0,r.jsx)(n.li,{children:"\u6536\u4ef6\u7bb1\u6ee1\u8db3\u53ef\u4ee5\u6839\u636e\u65f6\u95f4\u6233\u6392\u5e8f\uff0c\u5fc5\u987b\u7528Redis\u7684\u6570\u636e\u7ed3\u6784\u5b9e\u73b0"}),"\n",(0,r.jsx)(n.li,{children:"\u67e5\u8be2\u6536\u4ef6\u7bb1\u6570\u636e\u65f6\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5206\u9875\u67e5\u8be2"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Feed\u6d41\u4e2d\u7684\u6570\u636e\u4f1a\u4e0d\u65ad\u66f4\u65b0\uff0c\u6240\u4ee5\u6570\u636e\u7684\u89d2\u6807\u4e5f\u5728\u53d8\u5316\uff0c\u56e0\u6b64\u4e0d\u80fd\u91c7\u7528\u4f20\u7edf\u7684\u5206\u9875\u6a21\u5f0f\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u4f20\u7edf\u4e86\u5206\u9875\u5728feed\u6d41\u662f\u4e0d\u9002\u7528\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u7684\u6570\u636e\u4f1a\u968f\u65f6\u53d1\u751f\u53d8\u5316"}),"\n",(0,r.jsxs)(n.p,{children:["\u5047\u8bbe\u5728t1 \u65f6\u523b\uff0c\u6211\u4eec\u53bb\u8bfb\u53d6\u7b2c\u4e00\u9875\uff0c\u6b64\u65f6page = 1 \uff0csize = 5 \uff0c\u90a3\u4e48\u6211\u4eec\u62ff\u5230\u7684\u5c31\u662f10",(0,r.jsx)(n.del,{children:"6 \u8fd9\u51e0\u6761\u8bb0\u5f55\uff0c\u5047\u8bbe\u73b0\u5728t2\u65f6\u5019\u53c8\u53d1\u5e03\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u6b64\u65f6t3 \u65f6\u523b\uff0c\u6211\u4eec\u6765\u8bfb\u53d6\u7b2c\u4e8c\u9875\uff0c\u8bfb\u53d6\u7b2c\u4e8c\u9875\u4f20\u5165\u7684\u53c2\u6570\u662fpage=2 \uff0csize=5 \uff0c\u90a3\u4e48\u6b64\u65f6\u8bfb\u53d6\u5230\u7684\u7b2c\u4e8c\u9875\u5b9e\u9645\u4e0a\u662f\u4ece6 \u5f00\u59cb\uff0c\u7136\u540e\u662f6"}),"2 \uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u8bfb\u53d6\u5230\u4e86\u91cd\u590d\u7684\u6570\u636e\uff0c\u6240\u4ee5feed\u6d41\u7684\u5206\u9875\uff0c",(0,r.jsx)(n.strong,{children:"\u4e0d\u80fd\u91c7\u7528\u539f\u59cb\u65b9\u6848\u6765\u505a\u3002"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653813047671",src:s(33539).A+"",width:"1431",height:"634"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Feed\u6d41\u7684\u6eda\u52a8\u5206\u9875"})}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u9700\u8981\u8bb0\u5f55\u6bcf\u6b21\u64cd\u4f5c\u7684\u6700\u540e\u4e00\u6761\uff0c\u7136\u540e\u4ece\u8fd9\u4e2a\u4f4d\u7f6e\u5f00\u59cb\u53bb\u8bfb\u53d6\u6570\u636e"}),"\n",(0,r.jsx)(n.p,{children:"\u4e3e\u4e2a\u4f8b\u5b50\uff1a\u6211\u4eec\u4ecet1\u65f6\u523b\u5f00\u59cb\uff0c\u62ff\u7b2c\u4e00\u9875\u6570\u636e\uff0c\u62ff\u5230\u4e8610~6\uff0c\u7136\u540e\u8bb0\u5f55\u4e0b\u5f53\u524d\u6700\u540e\u4e00\u6b21\u62ff\u53d6\u7684\u8bb0\u5f55\uff0c\u5c31\u662f6\uff0ct2\u65f6\u523b\u53d1\u5e03\u4e86\u65b0\u7684\u8bb0\u5f55\uff0c\u6b64\u65f6\u8fd9\u4e2a11\u653e\u5230\u6700\u9876\u4e0a\uff0c\u4f46\u662f\u4e0d\u4f1a\u5f71\u54cd\u6211\u4eec\u4e4b\u524d\u8bb0\u5f55\u76846\uff0c\u6b64\u65f6t3\u65f6\u523b\u6765\u62ff\u7b2c\u4e8c\u9875\uff0c\u7b2c\u4e8c\u9875\u8fd9\u4e2a\u65f6\u5019\u62ff\u6570\u636e\uff0c\u8fd8\u662f\u4ece6\u540e\u4e00\u70b9\u76845\u53bb\u62ff\uff0c\u5c31\u62ff\u5230\u4e865-1\u7684\u8bb0\u5f55\u3002\u6211\u4eec\u8fd9\u4e2a\u5730\u65b9\u53ef\u4ee5\u91c7\u7528sortedSet\u6765\u505a\uff0c\u53ef\u4ee5\u8fdb\u884c\u8303\u56f4\u67e5\u8be2\uff0c\u5e76\u4e14\u8fd8\u53ef\u4ee5\u8bb0\u5f55\u5f53\u524d\u83b7\u53d6\u6570\u636e\u65f6\u95f4\u6233\u6700\u5c0f\u503c\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u6eda\u52a8\u5206\u9875\u4e86"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653813462834",src:s(40557).A+"",width:"1289",height:"675"})}),"\n",(0,r.jsx)(n.p,{children:"\u6838\u5fc3\u7684\u610f\u601d\uff1a\u5c31\u662f\u6211\u4eec\u5728\u4fdd\u5b58\u5b8c\u63a2\u5e97\u7b14\u8bb0\u540e\uff0c\u83b7\u5f97\u5230\u5f53\u524d\u7b14\u8bb0\u7684\u7c89\u4e1d\uff0c\u7136\u540e\u628a\u6570\u636e\u63a8\u9001\u5230\u7c89\u4e1d\u7684redis\u4e2d\u53bb\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Override\npublic Result saveBlog(Blog blog) {\n    // 1.\u83b7\u53d6\u767b\u5f55\u7528\u6237\n    UserDTO user = UserHolder.getUser();\n    blog.setUserId(user.getId());\n    // 2.\u4fdd\u5b58\u63a2\u5e97\u7b14\u8bb0\n    boolean isSuccess = save(blog);\n    if(!isSuccess){\n        return Result.fail("\u65b0\u589e\u7b14\u8bb0\u5931\u8d25!");\n    }\n    // 3.\u67e5\u8be2\u7b14\u8bb0\u4f5c\u8005\u7684\u6240\u6709\u7c89\u4e1d select * from tb_follow where follow_user_id = ?\n    List<Follow> follows = followService.query().eq("follow_user_id", user.getId()).list();\n    // 4.\u63a8\u9001\u7b14\u8bb0id\u7ed9\u6240\u6709\u7c89\u4e1d\n    for (Follow follow : follows) {\n        // 4.1.\u83b7\u53d6\u7c89\u4e1did\n        Long userId = follow.getUserId();\n        // 4.2.\u63a8\u9001\n        String key = FEED_KEY + userId;\n        stringRedisTemplate.opsForZSet().add(key, blog.getId().toString(), System.currentTimeMillis());\n    }\n    // 5.\u8fd4\u56deid\n    return Result.ok(blog.getId());\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"95\u597d\u53cb\u5173\u6ce8-feed\u6d41\u5b9e\u73b0\u6eda\u52a8\u5206\u9875\u67e5\u8be2\u6536\u90ae\u7bb1",children:"9.5\u597d\u53cb\u5173\u6ce8-Feed\u6d41\u5b9e\u73b0\u6eda\u52a8\u5206\u9875\u67e5\u8be2\u6536\u90ae\u7bb1"}),"\n",(0,r.jsx)(n.p,{children:"\u9700\u6c42\uff1a\u5728\u4e2a\u4eba\u4e3b\u9875\u7684\u201c\u5173\u6ce8\u201d\u5361\u7247\u4e2d\uff0c\u67e5\u8be2\u5e76\u5c55\u793a\u63a8\u9001\u7684Blog\u4fe1\u606f\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u6211\u4eec\u9700\u8981\u4f7f\u7528ZSet\u7684ZREVRANGEBYSCORES\u547d\u4ee4\u8fdb\u884c\u6eda\u52a8\u5206\u9875\u7684\u67e5\u8be2"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"ZREVRANGEBYSCORE key max min WITHSCORES LIMIT offset count\n"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u6307\u4ee4"}),(0,r.jsx)(n.th,{children:"\u662f\u5426\u5fc5\u987b"}),(0,r.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"ZREVRANGEBYSCORE"}),(0,r.jsx)(n.td,{children:"\u662f"}),(0,r.jsx)(n.td,{children:"\u6307\u4ee4"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"key"}),(0,r.jsx)(n.td,{children:"\u662f"}),(0,r.jsx)(n.td,{children:"\u6709\u5e8f\u96c6\u5408\u952e\u540d\u79f0"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"max"}),(0,r.jsx)(n.td,{children:"\u662f"}),(0,r.jsx)(n.td,{children:'\u6700\u5927\u5206\u6570\u503c,\u53ef\u4f7f\u7528"+inf"\u4ee3\u66ff'})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"min"}),(0,r.jsx)(n.td,{children:"\u662f"}),(0,r.jsx)(n.td,{children:'\u6700\u5c0f\u5206\u6570\u503c,\u53ef\u4f7f\u7528"-inf"\u4ee3\u66ff'})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"WITHSCORES"}),(0,r.jsx)(n.td,{children:"\u5426"}),(0,r.jsx)(n.td,{children:"\u5c06\u6210\u5458\u5206\u6570\u4e00\u5e76\u8fd4\u56de"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"LIMIT"}),(0,r.jsx)(n.td,{children:"\u5426"}),(0,r.jsx)(n.td,{children:"\u8fd4\u56de\u7ed3\u679c\u662f\u5426\u5206\u9875,\u6307\u4ee4\u4e2d\u5305\u542bLIMIT\u540eoffset\u3001count\u5fc5\u987b\u8f93\u5165"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"offset"}),(0,r.jsx)(n.td,{children:"\u5426"}),(0,r.jsx)(n.td,{children:"\u8fd4\u56de\u7ed3\u679c\u8d77\u59cb\u4f4d\u7f6e\uff08\u504f\u79fb\u91cf\uff09"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"count"}),(0,r.jsx)(n.td,{children:"\u5426"}),(0,r.jsx)(n.td,{children:"\u8fd4\u56de\u7ed3\u679c\u6570\u91cf"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"\u6240\u4ee5\u6211\u4eec\u9700\u8981max\uff08lastId\uff0c\u7b2c\u4e00\u6b21\u65f6\u4e3a\u5f53\u524d\u65f6\u95f4\u6233\uff09\u3001offset\uff08\u6700\u5c0f\u7684\u65f6\u95f4\u6233\u76f8\u540c\u7684\u4e2a\u6570\u5c31\u662f\u8df3\u8fc7\u7684\u504f\u79fb\u91cf\uff09\u8fd9\u4e24\u4e2a\u53c2\u6570"}),"\n",(0,r.jsx)(n.p,{children:"\u5177\u4f53\u64cd\u4f5c\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"1\u3001\u6bcf\u6b21\u67e5\u8be2\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u8981\u5206\u6790\u51fa\u67e5\u8be2\u51fa\u6570\u636e\u7684\u6700\u5c0f\u65f6\u95f4\u6233\uff0c\u8fd9\u4e2a\u503c\u4f1a\u4f5c\u4e3a\u4e0b\u4e00\u6b21\u67e5\u8be2\u7684\u6761\u4ef6"}),"\n",(0,r.jsx)(n.p,{children:"2\u3001\u6211\u4eec\u9700\u8981\u627e\u5230\u4e0e\u4e0a\u4e00\u6b21\u67e5\u8be2\u76f8\u540c\u7684\u67e5\u8be2\u4e2a\u6570\u4f5c\u4e3a\u504f\u79fb\u91cf\uff0c\u4e0b\u6b21\u67e5\u8be2\u65f6\uff0c\u8df3\u8fc7\u8fd9\u4e9b\u67e5\u8be2\u8fc7\u7684\u6570\u636e\uff0c\u62ff\u5230\u6211\u4eec\u9700\u8981\u7684\u6570\u636e"}),"\n",(0,r.jsx)(n.p,{children:"\u7efc\u4e0a\uff1a\u6211\u4eec\u7684\u8bf7\u6c42\u53c2\u6570\u4e2d\u5c31\u9700\u8981\u643a\u5e26 lastId\uff1a\u4e0a\u4e00\u6b21\u67e5\u8be2\u7684\u6700\u5c0f\u65f6\u95f4\u6233 \u548c\u504f\u79fb\u91cf\u8fd9\u4e24\u4e2a\u53c2\u6570\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u4e24\u4e2a\u53c2\u6570\u7b2c\u4e00\u6b21\u4f1a\u7531\u524d\u7aef\u6765\u6307\u5b9a\uff0c\u4ee5\u540e\u7684\u67e5\u8be2\u5c31\u6839\u636e\u540e\u53f0\u7ed3\u679c\u4f5c\u4e3a\u6761\u4ef6\uff0c\u518d\u6b21\u4f20\u9012\u5230\u540e\u53f0\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653819821591",src:s(1428).A+"",width:"1244",height:"624"})}),"\n",(0,r.jsx)(n.p,{children:"\u4e00\u3001\u5b9a\u4e49\u51fa\u6765\u5177\u4f53\u7684\u8fd4\u56de\u503c\u5b9e\u4f53\u7c7b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@Data\npublic class ScrollResult {\n    private List<?> list;\n    private Long minTime;\n    private Integer offset;\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"BlogController"}),"\n",(0,r.jsx)(n.p,{children:"\u6ce8\u610f\uff1aRequestParam \u8868\u793a\u63a5\u53d7url\u5730\u5740\u680f\u4f20\u53c2\u7684\u6ce8\u89e3\uff0c\u5f53\u65b9\u6cd5\u4e0a\u53c2\u6570\u7684\u540d\u79f0\u548curl\u5730\u5740\u680f\u4e0d\u76f8\u540c\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7RequestParam \u6765\u8fdb\u884c\u6307\u5b9a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@GetMapping("/of/follow")\npublic Result queryBlogOfFollow(\n    @RequestParam("lastId") Long max, @RequestParam(value = "offset", defaultValue = "0") Integer offset){\n    return blogService.queryBlogOfFollow(max, offset);\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"BlogServiceImpl"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Override\npublic Result queryBlogOfFollow(Long max, Integer offset) {\n    // 1.\u83b7\u53d6\u5f53\u524d\u7528\u6237\n    Long userId = UserHolder.getUser().getId();\n    // 2.\u67e5\u8be2\u6536\u4ef6\u7bb1 ZREVRANGEBYSCORE key Max Min LIMIT offset count\n    String key = FEED_KEY + userId;\n    Set<ZSetOperations.TypedTuple<String>> typedTuples = stringRedisTemplate.opsForZSet()\n        .reverseRangeByScoreWithScores(key, 0, max, offset, 2);\n    // 3.\u975e\u7a7a\u5224\u65ad\n    if (typedTuples == null || typedTuples.isEmpty()) {\n        return Result.ok();\n    }\n    // 4.\u89e3\u6790\u6570\u636e\uff1ablogId\u3001minTime\uff08\u65f6\u95f4\u6233\uff09\u3001offset\n    List<Long> ids = new ArrayList<>(typedTuples.size());\n    long minTime = 0; // 2\n    int os = 1; // 2\n    for (ZSetOperations.TypedTuple<String> tuple : typedTuples) { // 5 4 4 2 2\n        // 4.1.\u83b7\u53d6id\n        ids.add(Long.valueOf(tuple.getValue()));\n        // 4.2.\u83b7\u53d6\u5206\u6570(\u65f6\u95f4\u6233\uff09\n        long time = tuple.getScore().longValue();\n        if(time == minTime){\n            os++;\n        }else{\n            minTime = time;\n            os = 1;\n        }\n    }\n    //\u82e5\u662f\u6574\u9875\u90fd\u4e0e\u4e0a\u4e00\u9875\u7684\u6700\u5c0f\u503c\u7684score\u76f8\u7b49\uff0c\u5219\u8df3\u8fc7\u7684\u6570\u91cf\u8fd8\u9700\u589e\u52a0\n\tos = minTime == max ? os : os + offset;\n    // 5.\u6839\u636eid\u67e5\u8be2blog\n    String idStr = StrUtil.join(",", ids);\n    List<Blog> blogs = query().in("id", ids).last("ORDER BY FIELD(id," + idStr + ")").list();\n\n    for (Blog blog : blogs) {\n        // 5.1.\u67e5\u8be2blog\u6709\u5173\u7684\u7528\u6237\n        queryBlogUser(blog);\n        // 5.2.\u67e5\u8be2blog\u662f\u5426\u88ab\u70b9\u8d5e\n        isBlogLiked(blog);\n    }\n\n    // 6.\u5c01\u88c5\u5e76\u8fd4\u56de\n    ScrollResult r = new ScrollResult();\n    r.setList(blogs);\n    r.setOffset(os);\n    r.setMinTime(minTime);\n\n    return Result.ok(r);\n}\n'})}),"\n",(0,r.jsx)(n.h1,{id:"10\u9644\u8fd1\u5546\u6237",children:"10\u3001\u9644\u8fd1\u5546\u6237"}),"\n",(0,r.jsx)(n.h2,{id:"101\u9644\u8fd1\u5546\u6237-geo\u6570\u636e\u7ed3\u6784\u7684\u57fa\u672c\u7528\u6cd5",children:"10.1\u3001\u9644\u8fd1\u5546\u6237-GEO\u6570\u636e\u7ed3\u6784\u7684\u57fa\u672c\u7528\u6cd5"}),"\n",(0,r.jsx)(n.p,{children:"GEO\u5c31\u662fGeolocation\u7684\u7b80\u5199\u5f62\u5f0f\uff0c\u4ee3\u8868\u5730\u7406\u5750\u6807\u3002Redis\u57283.2\u7248\u672c\u4e2d\u52a0\u5165\u4e86\u5bf9GEO\u7684\u652f\u6301\uff0c\u5141\u8bb8\u5b58\u50a8\u5730\u7406\u5750\u6807\u4fe1\u606f\uff0c\u5e2e\u52a9\u6211\u4eec\u6839\u636e\u7ecf\u7eac\u5ea6\u6765\u68c0\u7d22\u6570\u636e\u3002\u5e38\u89c1\u7684\u547d\u4ee4\u6709\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"GEOADD\uff1a\u6dfb\u52a0\u4e00\u4e2a\u5730\u7406\u7a7a\u95f4\u4fe1\u606f\uff0c\u5305\u542b\uff1a\u7ecf\u5ea6\uff08longitude\uff09\u3001\u7eac\u5ea6\uff08latitude\uff09\u3001\u503c\uff08member\uff09"}),"\n",(0,r.jsx)(n.li,{children:"GEODIST\uff1a\u8ba1\u7b97\u6307\u5b9a\u7684\u4e24\u4e2a\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\u5e76\u8fd4\u56de"}),"\n",(0,r.jsx)(n.li,{children:"GEOHASH\uff1a\u5c06\u6307\u5b9amember\u7684\u5750\u6807\u8f6c\u4e3ahash\u5b57\u7b26\u4e32\u5f62\u5f0f\u5e76\u8fd4\u56de"}),"\n",(0,r.jsx)(n.li,{children:"GEOPOS\uff1a\u8fd4\u56de\u6307\u5b9amember\u7684\u5750\u6807"}),"\n",(0,r.jsx)(n.li,{children:"GEORADIUS\uff1a\u6307\u5b9a\u5706\u5fc3\u3001\u534a\u5f84\uff0c\u627e\u5230\u8be5\u5706\u5185\u5305\u542b\u7684\u6240\u6709member\uff0c\u5e76\u6309\u7167\u4e0e\u5706\u5fc3\u4e4b\u95f4\u7684\u8ddd\u79bb\u6392\u5e8f\u540e\u8fd4\u56de\u30026.\u4ee5\u540e\u5df2\u5e9f\u5f03"}),"\n",(0,r.jsx)(n.li,{children:"GEOSEARCH\uff1a\u5728\u6307\u5b9a\u8303\u56f4\u5185\u641c\u7d22member\uff0c\u5e76\u6309\u7167\u4e0e\u6307\u5b9a\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\u6392\u5e8f\u540e\u8fd4\u56de\u3002\u8303\u56f4\u53ef\u4ee5\u662f\u5706\u5f62\u6216\u77e9\u5f62\u30026.2.\u65b0\u529f\u80fd"}),"\n",(0,r.jsx)(n.li,{children:"GEOSEARCHSTORE\uff1a\u4e0eGEOSEARCH\u529f\u80fd\u4e00\u81f4\uff0c\u4e0d\u8fc7\u53ef\u4ee5\u628a\u7ed3\u679c\u5b58\u50a8\u5230\u4e00\u4e2a\u6307\u5b9a\u7684key\u3002 6.2.\u65b0\u529f\u80fd"}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"GEO\u5e95\u5c42\u4f7f\u7528\u7684\u662fZSET\uff0c\u5c06member\u8f6c\u6362\u4e3avalue\uff0c\u7ecf\u7eac\u5750\u6807\u8f6c\u6362\u4e3ascore"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"102-\u9644\u8fd1\u5546\u6237-\u5bfc\u5165\u5e97\u94fa\u6570\u636e\u5230geo",children:"10.2\u3001 \u9644\u8fd1\u5546\u6237-\u5bfc\u5165\u5e97\u94fa\u6570\u636e\u5230GEO"}),"\n",(0,r.jsx)(n.p,{children:"\u5177\u4f53\u573a\u666f\u8bf4\u660e\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653822036941",src:s(61441).A+"",width:"1200",height:"493"})}),"\n",(0,r.jsx)(n.p,{children:"\u5f53\u6211\u4eec\u70b9\u51fb\u7f8e\u98df\u4e4b\u540e\uff0c\u4f1a\u51fa\u73b0\u4e00\u7cfb\u5217\u7684\u5546\u5bb6\uff0c\u5546\u5bb6\u4e2d\u53ef\u4ee5\u6309\u7167\u591a\u79cd\u6392\u5e8f\u65b9\u5f0f\uff0c\u6211\u4eec\u6b64\u65f6\u5173\u6ce8\u7684\u662f\u8ddd\u79bb\uff0c\u8fd9\u4e2a\u5730\u65b9\u5c31\u9700\u8981\u4f7f\u7528\u5230\u6211\u4eec\u7684GEO\uff0c\u5411\u540e\u53f0\u4f20\u5165\u5f53\u524dapp\u6536\u96c6\u7684\u5730\u5740(\u6211\u4eec\u6b64\u5904\u662f\u5199\u6b7b\u7684) \uff0c\u4ee5\u5f53\u524d\u5750\u6807\u4f5c\u4e3a\u5706\u5fc3\uff0c\u540c\u65f6\u7ed1\u5b9a\u76f8\u540c\u7684\u5e97\u5bb6\u7c7b\u578btype\uff0c\u4ee5\u53ca\u5206\u9875\u4fe1\u606f\uff0c\u628a\u8fd9\u51e0\u4e2a\u6761\u4ef6\u4f20\u5165\u540e\u53f0\uff0c\u540e\u53f0\u67e5\u8be2\u51fa\u5bf9\u5e94\u7684\u6570\u636e\u518d\u8fd4\u56de\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653822021827",src:s(96104).A+"",width:"944",height:"495"})}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u8981\u505a\u7684\u4e8b\u60c5\u662f\uff1a\u5c06\u6570\u636e\u5e93\u8868\u4e2d\u7684\u6570\u636e\u5bfc\u5165\u5230redis\u4e2d\u53bb\uff0credis\u4e2d\u7684GEO\uff0cGEO\u5728redis\u4e2d\u5c31\u4e00\u4e2amenber\u548c\u4e00\u4e2a\u7ecf\u7eac\u5ea6\uff0c\u6211\u4eec\u628ax\u548cy\u8f74\u4f20\u5165\u5230redis\u505a\u7684\u7ecf\u7eac\u5ea6\u4f4d\u7f6e\u53bb\uff0c\u4f46\u6211\u4eec\u4e0d\u80fd\u628a\u6240\u6709\u7684\u6570\u636e\u90fd\u653e\u5165\u5230menber\u4e2d\u53bb\uff0c\u6bd5\u7adf\u4f5c\u4e3aredis\u662f\u4e00\u4e2a\u5185\u5b58\u7ea7\u6570\u636e\u5e93\uff0c\u5982\u679c\u5b58\u6d77\u91cf\u6570\u636e\uff0credis\u8fd8\u662f\u529b\u4e0d\u4ece\u5fc3\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u8fd9\u4e2a\u5730\u65b9\u5b58\u50a8\u4ed6\u7684id\u5373\u53ef\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u4f46\u662f\u8fd9\u4e2a\u65f6\u5019\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u5728redis\u4e2d\u5e76\u6ca1\u6709\u5b58\u50a8type\uff0c\u6240\u4ee5\u6211\u4eec\u65e0\u6cd5\u6839\u636etype\u6765\u5bf9\u6570\u636e\u8fdb\u884c\u7b5b\u9009\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u6309\u7167\u5546\u6237\u7c7b\u578b\u505a\u5206\u7ec4\uff0c\u7c7b\u578b\u76f8\u540c\u7684\u5546\u6237\u4f5c\u4e3a\u540c\u4e00\u7ec4\uff0c\u4ee5typeId\u4e3akey\u5b58\u5165\u540c\u4e00\u4e2aGEO\u96c6\u5408\u4e2d\u5373\u53ef"}),"\n",(0,r.jsx)(n.p,{children:"\u4ee3\u7801"}),"\n",(0,r.jsx)(n.p,{children:"HmDianPingApplicationTests"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@Test\nvoid loadShopData() {\n    // 1.\u67e5\u8be2\u5e97\u94fa\u4fe1\u606f\n    List<Shop> list = shopService.list();\n    // 2.\u628a\u5e97\u94fa\u5206\u7ec4\uff0c\u6309\u7167typeId\u5206\u7ec4\uff0ctypeId\u4e00\u81f4\u7684\u653e\u5230\u4e00\u4e2a\u96c6\u5408\n    Map<Long, List<Shop>> map = list.stream().collect(Collectors.groupingBy(Shop::getTypeId));\n    // 3.\u5206\u6279\u5b8c\u6210\u5199\u5165Redis\n    for (Map.Entry<Long, List<Shop>> entry : map.entrySet()) {\n        // 3.1.\u83b7\u53d6\u7c7b\u578bid\n        Long typeId = entry.getKey();\n        String key = SHOP_GEO_KEY + typeId;\n        // 3.2.\u83b7\u53d6\u540c\u7c7b\u578b\u7684\u5e97\u94fa\u7684\u96c6\u5408\n        List<Shop> value = entry.getValue();\n        List<RedisGeoCommands.GeoLocation<String>> locations = new ArrayList<>(value.size());\n        // 3.3.\u5199\u5165redis GEOADD key \u7ecf\u5ea6 \u7eac\u5ea6 member\n        for (Shop shop : value) {\n            // stringRedisTemplate.opsForGeo().add(key, new Point(shop.getX(), shop.getY()), shop.getId().toString());\n            locations.add(new RedisGeoCommands.GeoLocation<>(\n                    shop.getId().toString(),\n                    new Point(shop.getX(), shop.getY())\n            ));\n        }\n        stringRedisTemplate.opsForGeo().add(key, locations);\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"103-\u9644\u8fd1\u5546\u6237-\u5b9e\u73b0\u9644\u8fd1\u5546\u6237\u529f\u80fd",children:"10.3 \u9644\u8fd1\u5546\u6237-\u5b9e\u73b0\u9644\u8fd1\u5546\u6237\u529f\u80fd"}),"\n",(0,r.jsx)(n.p,{children:"SpringDataRedis\u76842.3.12.REALEASE\u7248\u672c\u5e76\u4e0d\u652f\u6301Redis 6.2\u63d0\u4f9b\u7684GEOSEARCH\u547d\u4ee4\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u63d0\u793a\u5176\u7248\u672c\uff0c\u4fee\u6539\u81ea\u5df1\u7684POM"}),"\n",(0,r.jsx)(n.p,{children:"\u7b2c\u4e00\u6b65\uff1a\u5bfc\u5165pom"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-data-redis</artifactId>\n    <exclusions>\n        <exclusion>\n            <artifactId>spring-data-redis</artifactId>\n            <groupId>org.springframework.data</groupId>\n        </exclusion>\n        <exclusion>\n            <artifactId>lettuce-core</artifactId>\n            <groupId>io.lettuce</groupId>\n        </exclusion>\n    </exclusions>\n</dependency>\n<dependency>\n    <groupId>org.springframework.data</groupId>\n    <artifactId>spring-data-redis</artifactId>\n    <version>2.6.2</version>\n</dependency>\n<dependency>\n    <groupId>io.lettuce</groupId>\n    <artifactId>lettuce-core</artifactId>\n    <version>6.1.6.RELEASE</version>\n</dependency>\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u7b2c\u4e8c\u6b65\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"ShopController"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@GetMapping("/of/type")\npublic Result queryShopByType(\n        @RequestParam("typeId") Integer typeId,\n        @RequestParam(value = "current", defaultValue = "1") Integer current,\n        @RequestParam(value = "x", required = false) Double x,\n        @RequestParam(value = "y", required = false) Double y\n) {\n   return shopService.queryShopByType(typeId, current, x, y);\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"ShopServiceImpl"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'\t@Override\n    public Result queryShopByType(Integer typeId, Integer current, Double x, Double y) {\n        // 1.\u5224\u65ad\u662f\u5426\u9700\u8981\u6839\u636e\u5750\u6807\u67e5\u8be2\n        if (x == null || y == null) {\n            // \u4e0d\u9700\u8981\u5750\u6807\u67e5\u8be2\uff0c\u6309\u6570\u636e\u5e93\u67e5\u8be2\n            Page<Shop> page = query()\n                    .eq("type_id", typeId)\n                    .page(new Page<>(current, SystemConstants.DEFAULT_PAGE_SIZE));\n            // \u8fd4\u56de\u6570\u636e\n            return Result.ok(page.getRecords());\n        }\n\n        // 2.\u8ba1\u7b97\u5206\u9875\u53c2\u6570\n        int from = (current - 1) * SystemConstants.DEFAULT_PAGE_SIZE;\n        int end = current * SystemConstants.DEFAULT_PAGE_SIZE;\n\n        // 3.\u67e5\u8be2redis\u3001\u6309\u7167\u8ddd\u79bb\u6392\u5e8f\u3001\u5206\u9875\u3002\u7ed3\u679c\uff1ashopId\u3001distance\n        String key = SHOP_GEO_KEY + typeId;\n        GeoResults<RedisGeoCommands.GeoLocation<String>> results = stringRedisTemplate.opsForGeo() // GEOSEARCH key BYLONLAT x y BYRADIUS 10 WITHDISTANCE\n                .search(\n                        key,\n                        GeoReference.fromCoordinate(x, y),\n                        new Distance(5000),\n                        RedisGeoCommands.GeoSearchCommandArgs.newGeoSearchArgs().includeDistance().limit(end)\n                );\n        // 4.\u89e3\u6790\u51faid\n        if (results == null) {\n            return Result.ok(Collections.emptyList());\n        }\n        List<GeoResult<RedisGeoCommands.GeoLocation<String>>> list = results.getContent();\n        if (list.size() <= from) {\n            // \u6ca1\u6709\u4e0b\u4e00\u9875\u4e86\uff0c\u7ed3\u675f\n            return Result.ok(Collections.emptyList());\n        }\n        // 4.1.\u622a\u53d6 from ~ end\u7684\u90e8\u5206\n        List<Long> ids = new ArrayList<>(list.size());\n        Map<String, Distance> distanceMap = new HashMap<>(list.size());\n        list.stream().skip(from).forEach(result -> {\n            // 4.2.\u83b7\u53d6\u5e97\u94faid\n            String shopIdStr = result.getContent().getName();\n            ids.add(Long.valueOf(shopIdStr));\n            // 4.3.\u83b7\u53d6\u8ddd\u79bb\n            Distance distance = result.getDistance();\n            distanceMap.put(shopIdStr, distance);\n        });\n        // 5.\u6839\u636eid\u67e5\u8be2Shop\n        String idStr = StrUtil.join(",", ids);\n        List<Shop> shops = query().in("id", ids).last("ORDER BY FIELD(id," + idStr + ")").list();\n        for (Shop shop : shops) {\n            shop.setDistance(distanceMap.get(shop.getId().toString()).getValue());\n        }\n        // 6.\u8fd4\u56de\n        return Result.ok(shops);\n    }\n'})}),"\n",(0,r.jsx)(n.h1,{id:"11\u7528\u6237\u7b7e\u5230",children:"11\u3001\u7528\u6237\u7b7e\u5230"}),"\n",(0,r.jsx)(n.h2,{id:"111\u7528\u6237\u7b7e\u5230-bitmap\u529f\u80fd\u6f14\u793a",children:"11.1\u3001\u7528\u6237\u7b7e\u5230-BitMap\u529f\u80fd\u6f14\u793a"}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u9488\u5bf9\u7b7e\u5230\u529f\u80fd\u5b8c\u5168\u53ef\u4ee5\u901a\u8fc7mysql\u6765\u5b8c\u6210\uff0c\u6bd4\u5982\u8bf4\u4ee5\u4e0b\u8fd9\u5f20\u8868"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653823145495",src:s(17523).A+"",width:"879",height:"269"})}),"\n",(0,r.jsx)(n.p,{children:"\u7528\u6237\u4e00\u6b21\u7b7e\u5230\uff0c\u5c31\u662f\u4e00\u6761\u8bb0\u5f55\uff0c\u5047\u5982\u67091000\u4e07\u7528\u6237\uff0c\u5e73\u5747\u6bcf\u4eba\u6bcf\u5e74\u7b7e\u5230\u6b21\u6570\u4e3a10\u6b21\uff0c\u5219\u8fd9\u5f20\u8868\u4e00\u5e74\u7684\u6570\u636e\u91cf\u4e3a 1\u4ebf\u6761"}),"\n",(0,r.jsx)(n.p,{children:"\u6bcf\u7b7e\u5230\u4e00\u6b21\u9700\u8981\u4f7f\u7528\uff088 + 8 + 1 + 1 + 3 + 1\uff09\u517122 \u5b57\u8282\u7684\u5185\u5b58\uff0c\u4e00\u4e2a\u6708\u5219\u6700\u591a\u9700\u8981600\u591a\u5b57\u8282"}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u5982\u4f55\u80fd\u591f\u7b80\u5316\u4e00\u70b9\u5462\uff1f\u5176\u5b9e\u53ef\u4ee5\u8003\u8651\u5c0f\u65f6\u5019\u4e00\u4e2a\u633a\u5e38\u89c1\u7684\u65b9\u6848\uff0c\u5c31\u662f\u5c0f\u65f6\u5019\uff0c\u54b1\u4eec\u51c6\u5907\u4e00\u5f20\u5c0f\u5c0f\u7684\u5361\u7247\uff0c\u4f60\u53ea\u8981\u7b7e\u5230\u5c31\u6253\u4e0a\u4e00\u4e2a\u52fe\uff0c\u6211\u6700\u540e\u5224\u65ad\u4f60\u662f\u5426\u7b7e\u5230\uff0c\u5176\u5b9e\u53ea\u9700\u8981\u5230\u5c0f\u5361\u7247\u4e0a\u770b\u4e00\u770b\u5c31\u77e5\u9053\u4e86"}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u7c7b\u4f3c\u8fd9\u6837\u7684\u65b9\u6848\u6765\u5b9e\u73b0\u6211\u4eec\u7684\u7b7e\u5230\u9700\u6c42\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u6309\u6708\u6765\u7edf\u8ba1\u7528\u6237\u7b7e\u5230\u4fe1\u606f\uff0c\u7b7e\u5230\u8bb0\u5f55\u4e3a1\uff0c\u672a\u7b7e\u5230\u5219\u8bb0\u5f55\u4e3a0."}),"\n",(0,r.jsx)(n.p,{children:"\u628a\u6bcf\u4e00\u4e2abit\u4f4d\u5bf9\u5e94\u5f53\u6708\u7684\u6bcf\u4e00\u5929\uff0c\u5f62\u6210\u4e86\u6620\u5c04\u5173\u7cfb\u3002\u75280\u548c1\u6807\u793a\u4e1a\u52a1\u72b6\u6001\uff0c\u8fd9\u79cd\u601d\u8def\u5c31\u79f0\u4e3a\u4f4d\u56fe\uff08BitMap\uff09\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u7528\u6781\u5c0f\u7684\u7a7a\u95f4\uff0c\u6765\u5b9e\u73b0\u4e86\u5927\u91cf\u6570\u636e\u7684\u8868\u793a"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Redis\u4e2d\u662f\u5229\u7528string\u7c7b\u578b\u6570\u636e\u7ed3\u6784\u5b9e\u73b0BitMap\uff0c\u56e0\u6b64\u6700\u5927\u4e0a\u9650\u662f512M"}),"\uff0c\u8f6c\u6362\u4e3abit\u5219\u662f 2^32\u4e2abit\u4f4d\u3002"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653824498278",src:s(11204).A+"",width:"1215",height:"267"})}),"\n",(0,r.jsx)(n.p,{children:"BitMap\u7684\u64cd\u4f5c\u547d\u4ee4\u6709\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"SETBIT\uff1a\u5411\u6307\u5b9a\u4f4d\u7f6e\uff08offset\uff09\u5b58\u5165\u4e00\u4e2a0\u62161"}),"\n",(0,r.jsx)(n.li,{children:"GETBIT \uff1a\u83b7\u53d6\u6307\u5b9a\u4f4d\u7f6e\uff08offset\uff09\u7684bit\u503c"}),"\n",(0,r.jsx)(n.li,{children:"BITCOUNT \uff1a\u7edf\u8ba1BitMap\u4e2d\u503c\u4e3a1\u7684bit\u4f4d\u7684\u6570\u91cf"}),"\n",(0,r.jsx)(n.li,{children:"BITFIELD \uff1a\u64cd\u4f5c\uff08\u67e5\u8be2\u3001\u4fee\u6539\u3001\u81ea\u589e\uff09BitMap\u4e2dbit\u6570\u7ec4\u4e2d\u7684\u6307\u5b9a\u4f4d\u7f6e\uff08offset\uff09\u7684\u503c"}),"\n",(0,r.jsx)(n.li,{children:"BITFIELD_RO \uff1a\u83b7\u53d6BitMap\u4e2dbit\u6570\u7ec4\uff0c\u5e76\u4ee5\u5341\u8fdb\u5236\u5f62\u5f0f\u8fd4\u56de"}),"\n",(0,r.jsx)(n.li,{children:"BITOP \uff1a\u5c06\u591a\u4e2aBitMap\u7684\u7ed3\u679c\u505a\u4f4d\u8fd0\u7b97\uff08\u4e0e \u3001\u6216\u3001\u5f02\u6216\uff09"}),"\n",(0,r.jsx)(n.li,{children:"BITPOS \uff1a\u67e5\u627ebit\u6570\u7ec4\u4e2d\u6307\u5b9a\u8303\u56f4\u5185\u7b2c\u4e00\u4e2a0\u62161\u51fa\u73b0\u7684\u4f4d\u7f6e"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"112-\u7528\u6237\u7b7e\u5230-\u5b9e\u73b0\u7b7e\u5230\u529f\u80fd",children:"11.2 \u3001\u7528\u6237\u7b7e\u5230-\u5b9e\u73b0\u7b7e\u5230\u529f\u80fd"}),"\n",(0,r.jsx)(n.p,{children:"\u9700\u6c42\uff1a\u5b9e\u73b0\u7b7e\u5230\u63a5\u53e3\uff0c\u5c06\u5f53\u524d\u7528\u6237\u5f53\u5929\u7b7e\u5230\u4fe1\u606f\u4fdd\u5b58\u5230Redis\u4e2d"}),"\n",(0,r.jsx)(n.p,{children:"\u601d\u8def\uff1a\u6211\u4eec\u53ef\u4ee5\u628a\u5e74\u548c\u6708\u4f5c\u4e3abitMap\u7684key\uff0c\u7136\u540e\u4fdd\u5b58\u5230\u4e00\u4e2abitMap\u4e2d\uff0c\u6bcf\u6b21\u7b7e\u5230\u5c31\u5230\u5bf9\u5e94\u7684\u4f4d\u4e0a\u628a\u6570\u5b57\u4ece0\u53d8\u62101\uff0c\u53ea\u8981\u5bf9\u5e94\u662f1\uff0c\u5c31\u8868\u660e\u8bf4\u660e\u8fd9\u4e00\u5929\u5df2\u7ecf\u7b7e\u5230\u4e86\uff0c\u53cd\u4e4b\u5219\u6ca1\u6709\u7b7e\u5230\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u901a\u8fc7\u63a5\u53e3\u6587\u6863\u53d1\u73b0\uff0c\u6b64\u63a5\u53e3\u5e76\u6ca1\u6709\u4f20\u9012\u4efb\u4f55\u7684\u53c2\u6570\uff0c\u6ca1\u6709\u53c2\u6570\u600e\u4e48\u786e\u5b9e\u662f\u54ea\u4e00\u5929\u7b7e\u5230\u5462\uff1f\u8fd9\u4e2a\u5f88\u5bb9\u6613\uff0c\u53ef\u4ee5\u901a\u8fc7\u540e\u53f0\u4ee3\u7801\u76f4\u63a5\u83b7\u53d6\u5373\u53ef\uff0c\u7136\u540e\u5230\u5bf9\u5e94\u7684\u5730\u5740\u4e0a\u53bb\u4fee\u6539bitMap\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653833970361",src:s(85186).A+"",width:"1184",height:"590"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u4ee3\u7801"})}),"\n",(0,r.jsx)(n.p,{children:"UserController"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:' @PostMapping("/sign")\n public Result sign(){\n    return userService.sign();\n }\n'})}),"\n",(0,r.jsx)(n.p,{children:"UserServiceImpl"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Override\npublic Result sign() {\n    // 1.\u83b7\u53d6\u5f53\u524d\u767b\u5f55\u7528\u6237\n    Long userId = UserHolder.getUser().getId();\n    // 2.\u83b7\u53d6\u65e5\u671f\n    LocalDateTime now = LocalDateTime.now();\n    // 3.\u62fc\u63a5key\n    String keySuffix = now.format(DateTimeFormatter.ofPattern(":yyyyMM"));\n    String key = USER_SIGN_KEY + userId + keySuffix;\n    // 4.\u83b7\u53d6\u4eca\u5929\u662f\u672c\u6708\u7684\u7b2c\u51e0\u5929\n    int dayOfMonth = now.getDayOfMonth();\n    // 5.\u5199\u5165Redis SETBIT key offset 1\n    stringRedisTemplate.opsForValue().setBit(key, dayOfMonth - 1, true);\n    return Result.ok();\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"113-\u7528\u6237\u7b7e\u5230-\u7b7e\u5230\u7edf\u8ba1",children:"11.3 \u7528\u6237\u7b7e\u5230-\u7b7e\u5230\u7edf\u8ba1"}),"\n",(0,r.jsx)(n.p,{children:"**\u95ee\u98981\uff1a**\u4ec0\u4e48\u53eb\u505a\u8fde\u7eed\u7b7e\u5230\u5929\u6570\uff1f\n\u4ece\u6700\u540e\u4e00\u6b21\u7b7e\u5230\u5f00\u59cb\u5411\u524d\u7edf\u8ba1\uff0c\u76f4\u5230\u9047\u5230\u7b2c\u4e00\u6b21\u672a\u7b7e\u5230\u4e3a\u6b62\uff0c\u8ba1\u7b97\u603b\u7684\u7b7e\u5230\u6b21\u6570\uff0c\u5c31\u662f\u8fde\u7eed\u7b7e\u5230\u5929\u6570\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653834455899",src:s(6081).A+"",width:"1028",height:"100"})}),"\n",(0,r.jsx)(n.p,{children:"Java\u903b\u8f91\u4ee3\u7801\uff1a\u83b7\u5f97\u5f53\u524d\u8fd9\u4e2a\u6708\u7684\u6700\u540e\u4e00\u6b21\u7b7e\u5230\u6570\u636e\uff0c\u5b9a\u4e49\u4e00\u4e2a\u8ba1\u6570\u5668\uff0c\u7136\u540e\u4e0d\u505c\u7684\u5411\u524d\u7edf\u8ba1\uff0c\u76f4\u5230\u83b7\u5f97\u7b2c\u4e00\u4e2a\u975e0\u7684\u6570\u5b57\u5373\u53ef\uff0c\u6bcf\u5f97\u5230\u4e00\u4e2a\u975e0\u7684\u6570\u5b57\u8ba1\u6570\u5668+1\uff0c\u76f4\u5230\u904d\u5386\u5b8c\u6240\u6709\u7684\u6570\u636e\uff0c\u5c31\u53ef\u4ee5\u83b7\u5f97\u5f53\u524d\u6708\u7684\u7b7e\u5230\u603b\u5929\u6570\u4e86"}),"\n",(0,r.jsx)(n.p,{children:"**\u95ee\u98982\uff1a**\u5982\u4f55\u5f97\u5230\u672c\u6708\u5230\u4eca\u5929\u4e3a\u6b62\u7684\u6240\u6709\u7b7e\u5230\u6570\u636e\uff1f"}),"\n",(0,r.jsx)(n.p,{children:"BITFIELD key GET u[dayOfMonth] 0"}),"\n",(0,r.jsx)(n.p,{children:"\u5047\u8bbe\u4eca\u5929\u662f10\u53f7\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u4ece\u5f53\u524d\u6708\u7684\u7b2c\u4e00\u5929\u5f00\u59cb\uff0c\u83b7\u5f97\u5230\u5f53\u524d\u8fd9\u4e00\u5929\u7684\u4f4d\u6570\uff0c\u662f10\u53f7\uff0c\u90a3\u4e48\u5c31\u662f10\u4f4d\uff0c\u53bb\u62ff\u8fd9\u6bb5\u65f6\u95f4\u7684\u6570\u636e\uff0c\u5c31\u80fd\u62ff\u5230\u6240\u6709\u7684\u6570\u636e\u4e86\uff0c\u90a3\u4e48\u8fd910\u5929\u91cc\u8fb9\u7b7e\u5230\u4e86\u591a\u5c11\u6b21\u5462\uff1f\u7edf\u8ba1\u6709\u591a\u5c11\u4e2a1\u5373\u53ef\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u95ee\u98983\uff1a\u5982\u4f55\u4ece\u540e\u5411\u524d\u904d\u5386\u6bcf\u4e2abit\u4f4d\uff1f"})}),"\n",(0,r.jsx)(n.p,{children:"\u6ce8\u610f\uff1abitMap\u8fd4\u56de\u7684\u6570\u636e\u662f10\u8fdb\u5236\uff0c\u54ea\u5047\u5982\u8bf4\u8fd4\u56de\u4e00\u4e2a\u6570\u5b578\uff0c\u90a3\u4e48\u6211\u54ea\u513f\u77e5\u9053\u5230\u5e95\u54ea\u4e9b\u662f0\uff0c\u54ea\u4e9b\u662f1\u5462\uff1f\u6211\u4eec\u53ea\u9700\u8981\u8ba9\u5f97\u5230\u768410\u8fdb\u5236\u6570\u5b57\u548c1\u505a\u4e0e\u8fd0\u7b97\u5c31\u53ef\u4ee5\u4e86\uff0c\u56e0\u4e3a1\u53ea\u6709\u9047\u89c11 \u624d\u662f1\uff0c\u5176\u4ed6\u6570\u5b57\u90fd\u662f0 \uff0c\u6211\u4eec\u628a\u7b7e\u5230\u7ed3\u679c\u548c1\u8fdb\u884c\u4e0e\u64cd\u4f5c\uff0c\u6bcf\u4e0e\u4e00\u6b21\uff0c\u5c31\u628a\u7b7e\u5230\u7ed3\u679c\u5411\u53f3\u79fb\u52a8\u4e00\u4f4d\uff0c\u4f9d\u6b21\u5185\u63a8\uff0c\u6211\u4eec\u5c31\u80fd\u5b8c\u6210\u9010\u4e2a\u904d\u5386\u7684\u6548\u679c\u4e86\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u9700\u6c42\uff1a\u5b9e\u73b0\u4e0b\u9762\u63a5\u53e3\uff0c\u7edf\u8ba1\u5f53\u524d\u7528\u6237\u622a\u6b62\u5f53\u524d\u65f6\u95f4\u5728\u672c\u6708\u7684\u8fde\u7eed\u7b7e\u5230\u5929\u6570"}),"\n",(0,r.jsx)(n.p,{children:"\u6709\u7528\u6237\u6709\u65f6\u95f4\u6211\u4eec\u5c31\u53ef\u4ee5\u7ec4\u7ec7\u51fa\u5bf9\u5e94\u7684key\uff0c\u6b64\u65f6\u5c31\u80fd\u627e\u5230\u8fd9\u4e2a\u7528\u6237\u622a\u6b62\u8fd9\u5929\u7684\u6240\u6709\u7b7e\u5230\u8bb0\u5f55\uff0c\u518d\u6839\u636e\u8fd9\u5957\u7b97\u6cd5\uff0c\u5c31\u80fd\u7edf\u8ba1\u51fa\u6765\u4ed6\u8fde\u7eed\u7b7e\u5230\u7684\u6b21\u6570\u4e86"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653835784444",src:s(9197).A+"",width:"665",height:"279"})}),"\n",(0,r.jsx)(n.p,{children:"\u4ee3\u7801"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"UserController"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@GetMapping("/sign/count")\npublic Result signCount(){\n    return userService.signCount();\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"UserServiceImpl"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Override\npublic Result signCount() {\n    // 1.\u83b7\u53d6\u5f53\u524d\u767b\u5f55\u7528\u6237\n    Long userId = UserHolder.getUser().getId();\n    // 2.\u83b7\u53d6\u65e5\u671f\n    LocalDateTime now = LocalDateTime.now();\n    // 3.\u62fc\u63a5key\n    String keySuffix = now.format(DateTimeFormatter.ofPattern(":yyyyMM"));\n    String key = USER_SIGN_KEY + userId + keySuffix;\n    // 4.\u83b7\u53d6\u4eca\u5929\u662f\u672c\u6708\u7684\u7b2c\u51e0\u5929\n    int dayOfMonth = now.getDayOfMonth();\n    // 5.\u83b7\u53d6\u672c\u6708\u622a\u6b62\u4eca\u5929\u4e3a\u6b62\u7684\u6240\u6709\u7684\u7b7e\u5230\u8bb0\u5f55\uff0c\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u5341\u8fdb\u5236\u7684\u6570\u5b57 BITFIELD sign:5:202203 GET u14 0\n    List<Long> result = stringRedisTemplate.opsForValue().bitField(\n            key,\n            BitFieldSubCommands.create()\n                    .get(BitFieldSubCommands.BitFieldType.unsigned(dayOfMonth)).valueAt(0)\n    );\n    if (result == null || result.isEmpty()) {\n        // \u6ca1\u6709\u4efb\u4f55\u7b7e\u5230\u7ed3\u679c\n        return Result.ok(0);\n    }\n    Long num = result.get(0);\n    if (num == null || num == 0) {\n        return Result.ok(0);\n    }\n    // 6.\u5faa\u73af\u904d\u5386\n    int count = 0;\n    while (true) {\n        // 6.1.\u8ba9\u8fd9\u4e2a\u6570\u5b57\u4e0e1\u505a\u4e0e\u8fd0\u7b97\uff0c\u5f97\u5230\u6570\u5b57\u7684\u6700\u540e\u4e00\u4e2abit\u4f4d  // \u5224\u65ad\u8fd9\u4e2abit\u4f4d\u662f\u5426\u4e3a0\n        if ((num & 1) == 0) {\n            // \u5982\u679c\u4e3a0\uff0c\u8bf4\u660e\u672a\u7b7e\u5230\uff0c\u7ed3\u675f\n            break;\n        }else {\n            // \u5982\u679c\u4e0d\u4e3a0\uff0c\u8bf4\u660e\u5df2\u7b7e\u5230\uff0c\u8ba1\u6570\u5668+1\n            count++;\n        }\n        // \u628a\u6570\u5b57\u53f3\u79fb\u4e00\u4f4d\uff0c\u629b\u5f03\u6700\u540e\u4e00\u4e2abit\u4f4d\uff0c\u7ee7\u7eed\u4e0b\u4e00\u4e2abit\u4f4d\n        num >>>= 1;\n    }\n    return Result.ok(count);\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u8ba1\u7b97\u8fde\u7eed\u5929\u6570\u7684\u65b9\u6cd52\uff1a\u5c06num\u8f6c\u4e3a\u4e8c\u8fdb\u5236\u4e32"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'//\u8bb0\u5f55\u8fde\u7eed\u7b7e\u5230\u6b21\u6570\nString binaryStr = Long.toBinaryString(num);\nint count = binaryStr.length() - binaryStr.lastIndexOf("0", dayOfMonth) - 1;\n'})}),"\n",(0,r.jsx)(n.h2,{id:"114-\u989d\u5916\u52a0\u9910-\u5173\u4e8e\u4f7f\u7528bitmap\u6765\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\u7684\u65b9\u6848",children:"11.4 \u989d\u5916\u52a0\u9910-\u5173\u4e8e\u4f7f\u7528bitmap\u6765\u89e3\u51b3\u7f13\u5b58\u7a7f\u900f\u7684\u65b9\u6848"}),"\n",(0,r.jsxs)(n.p,{children:["\u56de\u987e",(0,r.jsx)(n.strong,{children:"\u7f13\u5b58\u7a7f\u900f"}),"\uff1a"]}),"\n",(0,r.jsx)(n.p,{children:"\u53d1\u8d77\u4e86\u4e00\u4e2a\u6570\u636e\u5e93\u4e0d\u5b58\u5728\u7684\uff0credis\u91cc\u8fb9\u4e5f\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u901a\u5e38\u4f60\u53ef\u4ee5\u628a\u4ed6\u770b\u6210\u4e00\u4e2a\u653b\u51fb"}),"\n",(0,r.jsx)(n.p,{children:"\u89e3\u51b3\u65b9\u6848\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u5224\u65adid<0"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u6570\u636e\u5e93\u662f\u7a7a\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u76f4\u63a5\u5f80redis\u91cc\u8fb9\u628a\u8fd9\u4e2a\u7a7a\u6570\u636e\u7f13\u5b58\u8d77\u6765"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u7b2c\u4e00\u79cd\u89e3\u51b3\u65b9\u6848\uff1a\u9047\u5230\u7684\u95ee\u9898\u662f\u5982\u679c\u7528\u6237\u8bbf\u95ee\u7684\u662fid\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u5219\u6b64\u65f6\u5c31\u65e0\u6cd5\u751f\u6548"}),"\n",(0,r.jsx)(n.p,{children:"\u7b2c\u4e8c\u79cd\u89e3\u51b3\u65b9\u6848\uff1a\u9047\u5230\u7684\u95ee\u9898\u662f\uff1a\u5982\u679c\u662f\u4e0d\u540c\u7684id\u90a3\u5c31\u53ef\u4ee5\u9632\u6b62\u4e0b\u6b21\u8fc7\u6765\u76f4\u51fb\u6570\u636e"}),"\n",(0,r.jsx)(n.p,{children:"\u6240\u4ee5\u6211\u4eec\u5982\u4f55\u89e3\u51b3\u5462\uff1f"}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u53ef\u4ee5\u5c06\u6570\u636e\u5e93\u7684\u6570\u636e\uff0c\u6240\u5bf9\u5e94\u7684id\u5199\u5165\u5230\u4e00\u4e2alist\u96c6\u5408\u4e2d\uff0c\u5f53\u7528\u6237\u8fc7\u6765\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u6211\u4eec\u76f4\u63a5\u53bb\u5224\u65adlist\u4e2d\u662f\u5426\u5305\u542b\u5f53\u524d\u7684\u8981\u67e5\u8be2\u7684\u6570\u636e\uff0c\u5982\u679c\u8bf4\u7528\u6237\u8981\u67e5\u8be2\u7684id\u6570\u636e\u5e76\u4e0d\u5728list\u96c6\u5408\u4e2d\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\uff0c\u5982\u679clist\u4e2d\u5305\u542b\u5bf9\u5e94\u67e5\u8be2\u7684id\u6570\u636e\uff0c\u5219\u8bf4\u660e\u4e0d\u662f\u4e00\u6b21\u7f13\u5b58\u7a7f\u900f\u6570\u636e\uff0c\u5219\u76f4\u63a5\u653e\u884c\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653836416586",src:s(38519).A+"",width:"1285",height:"326"})}),"\n",(0,r.jsx)(n.p,{children:"\u73b0\u5728\u7684\u95ee\u9898\u662f\u8fd9\u4e2a\u4e3b\u952e\u5176\u5b9e\u5e76\u6ca1\u6709\u90a3\u4e48\u77ed\uff0c\u800c\u662f\u5f88\u957f\u7684\u4e00\u4e2a \u4e3b\u952e"}),"\n",(0,r.jsx)(n.p,{children:"\u54ea\u6015\u4f60\u5355\u72ec\u53bb\u63d0\u53d6\u8fd9\u4e2a\u4e3b\u952e\uff0c\u4f46\u662f\u572811\u5e74\u5de6\u53f3\uff0c\u6dd8\u5b9d\u7684\u5546\u54c1\u603b\u91cf\u5c31\u5df2\u7ecf\u8d85\u8fc710\u4ebf\u4e2a"}),"\n",(0,r.jsx)(n.p,{children:"\u6240\u4ee5\u5982\u679c\u91c7\u7528\u4ee5\u4e0a\u65b9\u6848\uff0c\u8fd9\u4e2alist\u4e5f\u4f1a\u5f88\u5927\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528bitmap\u6765\u51cf\u5c11list\u7684\u5b58\u50a8\u7a7a\u95f4"}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u53ef\u4ee5\u628alist\u6570\u636e\u62bd\u8c61\u6210\u4e00\u4e2a\u975e\u5e38\u5927\u7684bitmap\uff0c\u6211\u4eec\u4e0d\u518d\u4f7f\u7528list\uff0c\u800c\u662f\u5c06db\u4e2d\u7684id\u6570\u636e\u5229\u7528\u54c8\u5e0c\u601d\u60f3\uff0c\u6bd4\u5982\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"id % bitmap.size  = \u7b97\u51fa\u5f53\u524d\u8fd9\u4e2aid\u5bf9\u5e94\u5e94\u8be5\u843d\u5728bitmap\u7684\u54ea\u4e2a\u7d22\u5f15\u4e0a\uff0c\u7136\u540e\u5c06\u8fd9\u4e2a\u503c\u4ece0\u53d8\u62101\uff0c\u7136\u540e\u5f53\u7528\u6237\u6765\u67e5\u8be2\u6570\u636e\u65f6\uff0c\u6b64\u65f6\u5df2\u7ecf\u6ca1\u6709\u4e86list\uff0c\u8ba9\u7528\u6237\u7528\u4ed6\u67e5\u8be2\u7684id\u53bb\u7528\u76f8\u540c\u7684\u54c8\u5e0c\u7b97\u6cd5\uff0c \u7b97\u51fa\u6765\u5f53\u524d\u8fd9\u4e2aid\u5e94\u5f53\u843d\u5728bitmap\u7684\u54ea\u4e00\u4f4d\uff0c\u7136\u540e\u5224\u65ad\u8fd9\u4e00\u4f4d\u662f0\uff0c\u8fd8\u662f1\uff0c\u5982\u679c\u662f0\u5219\u8868\u660e\u8fd9\u4e00\u4f4d\u4e0a\u7684\u6570\u636e\u4e00\u5b9a\u4e0d\u5b58\u5728\uff0c  \u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f\u6765\u5904\u7406\uff0c\u9700\u8981\u91cd\u70b9\u8003\u8651\u4e00\u4e2a\u4e8b\u60c5\uff0c\u5c31\u662f\u8bef\u5dee\u7387\uff0c\u6240\u8c13\u7684\u8bef\u5dee\u7387\u5c31\u662f\u6307\u5f53\u53d1\u751f\u54c8\u5e0c\u51b2\u7a81\u7684\u65f6\u5019\uff0c\u4ea7\u751f\u7684\u8bef\u5dee\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653836578970",src:s(33643).A+"",width:"1302",height:"549"})}),"\n",(0,r.jsx)(n.h1,{id:"12uv\u7edf\u8ba1",children:"12\u3001UV\u7edf\u8ba1"}),"\n",(0,r.jsx)(n.h2,{id:"121-uv\u7edf\u8ba1-hyperloglog",children:"12.1 \u3001UV\u7edf\u8ba1-HyperLogLog"}),"\n",(0,r.jsx)(n.p,{children:"\u9996\u5148\u6211\u4eec\u641e\u61c2\u4e24\u4e2a\u6982\u5ff5\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"UV\uff1a\u5168\u79f0Unique Visitor\uff0c\u4e5f\u53eb\u72ec\u7acb\u8bbf\u5ba2\u91cf\uff0c\u662f\u6307\u901a\u8fc7\u4e92\u8054\u7f51\u8bbf\u95ee\u3001\u6d4f\u89c8\u8fd9\u4e2a\u7f51\u9875\u7684\u81ea\u7136\u4eba\u30021\u5929\u5185\u540c\u4e00\u4e2a\u7528\u6237\u591a\u6b21\u8bbf\u95ee\u8be5\u7f51\u7ad9\uff0c\u53ea\u8bb0\u5f551\u6b21\u3002"}),"\n",(0,r.jsx)(n.li,{children:"PV\uff1a\u5168\u79f0Page View\uff0c\u4e5f\u53eb\u9875\u9762\u8bbf\u95ee\u91cf\u6216\u70b9\u51fb\u91cf\uff0c\u7528\u6237\u6bcf\u8bbf\u95ee\u7f51\u7ad9\u7684\u4e00\u4e2a\u9875\u9762\uff0c\u8bb0\u5f551\u6b21PV\uff0c\u7528\u6237\u591a\u6b21\u6253\u5f00\u9875\u9762\uff0c\u5219\u8bb0\u5f55\u591a\u6b21PV\u3002\u5f80\u5f80\u7528\u6765\u8861\u91cf\u7f51\u7ad9\u7684\u6d41\u91cf\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u901a\u5e38\u6765\u8bf4UV\u4f1a\u6bd4PV\u5927\u5f88\u591a\uff0c\u6240\u4ee5\u8861\u91cf\u540c\u4e00\u4e2a\u7f51\u7ad9\u7684\u8bbf\u95ee\u91cf\uff0c\u6211\u4eec\u9700\u8981\u7efc\u5408\u8003\u8651\u5f88\u591a\u56e0\u7d20\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u662f\u5355\u7eaf\u7684\u628a\u8fd9\u4e24\u4e2a\u503c\u4f5c\u4e3a\u4e00\u4e2a\u53c2\u8003\u503c"}),"\n",(0,r.jsx)(n.p,{children:"UV\u7edf\u8ba1\u5728\u670d\u52a1\u7aef\u505a\u4f1a\u6bd4\u8f83\u9ebb\u70e6\uff0c\u56e0\u4e3a\u8981\u5224\u65ad\u8be5\u7528\u6237\u662f\u5426\u5df2\u7ecf\u7edf\u8ba1\u8fc7\u4e86\uff0c\u9700\u8981\u5c06\u7edf\u8ba1\u8fc7\u7684\u7528\u6237\u4fe1\u606f\u4fdd\u5b58\u3002\u4f46\u662f\u5982\u679c\u6bcf\u4e2a\u8bbf\u95ee\u7684\u7528\u6237\u90fd\u4fdd\u5b58\u5230Redis\u4e2d\uff0c\u6570\u636e\u91cf\u4f1a\u975e\u5e38\u6050\u6016\uff0c\u90a3\u600e\u4e48\u5904\u7406\u5462\uff1f"}),"\n",(0,r.jsxs)(n.p,{children:["Hyperloglog(HLL)\u662f\u4eceLoglog\u7b97\u6cd5\u6d3e\u751f\u7684\u6982\u7387\u7b97\u6cd5\uff0c\u7528\u4e8e\u786e\u5b9a\u975e\u5e38\u5927\u7684\u96c6\u5408\u7684\u57fa\u6570\uff0c\u800c\u4e0d\u9700\u8981\u5b58\u50a8\u5176\u6240\u6709\u503c\u3002\u76f8\u5173\u7b97\u6cd5\u539f\u7406\u5927\u5bb6\u53ef\u4ee5\u53c2\u8003\uff1a",(0,r.jsx)(n.a,{href:"https://juejin.cn/post/6844903785744056333#heading-0",children:"https://juejin.cn/post/6844903785744056333#heading-0"}),"\nRedis\u4e2d\u7684",(0,r.jsx)(n.strong,{children:"HLL\u662f\u57fa\u4e8estring\u7ed3\u6784\u5b9e\u73b0"}),"\u7684\uff0c\u5355\u4e2aHLL\u7684\u5185\u5b58",(0,r.jsx)(n.strong,{children:"\u6c38\u8fdc\u5c0f\u4e8e16kb"}),"\uff0c",(0,r.jsx)(n.strong,{children:"\u5185\u5b58\u5360\u7528\u4f4e"}),"\u7684\u4ee4\u4eba\u53d1\u6307\uff01\u4f5c\u4e3a\u4ee3\u4ef7\uff0c\u5176\u6d4b\u91cf\u7ed3\u679c\u662f\u6982\u7387\u6027\u7684\uff0c",(0,r.jsx)(n.strong,{children:"\u6709\u5c0f\u4e8e0.81\uff05\u7684\u8bef\u5dee"}),"\u3002\u4e0d\u8fc7\u5bf9\u4e8eUV\u7edf\u8ba1\u6765\u8bf4\uff0c\u8fd9\u5b8c\u5168\u53ef\u4ee5\u5ffd\u7565\u3002"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653837988985",src:s(18669).A+"",width:"1153",height:"401"})}),"\n",(0,r.jsx)(n.h2,{id:"122-uv\u7edf\u8ba1-\u6d4b\u8bd5\u767e\u4e07\u6570\u636e\u7684\u7edf\u8ba1",children:"12.2 UV\u7edf\u8ba1-\u6d4b\u8bd5\u767e\u4e07\u6570\u636e\u7684\u7edf\u8ba1"}),"\n",(0,r.jsx)(n.p,{children:"\u6d4b\u8bd5\u601d\u8def\uff1a\u6211\u4eec\u76f4\u63a5\u5229\u7528\u5355\u5143\u6d4b\u8bd5\uff0c\u5411HyperLogLog\u4e2d\u6dfb\u52a0100\u4e07\u6761\u6570\u636e\uff0c\u770b\u770b\u5185\u5b58\u5360\u7528\u548c\u7edf\u8ba1\u6548\u679c\u5982\u4f55"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"1653838053608",src:s(4919).A+"",width:"1097",height:"542"})}),"\n",(0,r.jsx)(n.p,{children:"\u7ecf\u8fc7\u6d4b\u8bd5\uff1a\u6211\u4eec\u4f1a\u53d1\u751f\u4ed6\u7684\u8bef\u5dee\u662f\u5728\u5141\u8bb8\u8303\u56f4\u5185\uff0c\u5e76\u4e14\u5185\u5b58\u5360\u7528\u6781\u5c0f"})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},56721:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653056228879-94895c2c0dbab2a7208d69fdaa23eb8f.png"},31011:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653057872536-9eb2c6f1fd501cd819e1888266c2ced9.png"},47622:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653059409865-cb2a89b9f449f21c17db3c25e1091ddb.png"},60336:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653060237073-eb5215d0547c6750350a5b2e31376d83.png"},99104:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653060337562-7549e13ec1d7652fae2049385d38185f.png"},44843:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653060588190-b771320642794be8e4a996d94ba451cb.png"},42015:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653066208144-d345fb6297811d9038429d9f60f26acb.png"},91903:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653067054461-4492eab23d528def64e4211b24c87239.png"},3605:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653068196656-7b5068d79335b82722ff9d5b5ff78c76.png"},54548:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653068874258-c3a709ecd82e7a20d8af3da618e0ad2f.png"},85436:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653069893050-929814d214e02b66a166661fd3c77c7a.png"},53908:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653319261433-6f1b6b2c3697792e35620cb8edc76b67.png"},29362:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653319474181-8e535d0bbac4a91a63c331e46c936fc4.png"},78404:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653320764547-d0d6d5a2f7da3847b8dcfeba813277c6.png"},89494:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653320822964-466b3ee0abbbd73f36fe9cd0253e421f.png"},34267:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653322097736-278a53bb15e2626e9b13f5bea7bf09d9.png"},23709:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653322506393-da56d43a16b9ff66c72518e284756414.png"},93475:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653322857620-2d306d0ae60dc0d16349cf3ad9812061.png"},99723:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653323595206-abb028ea254338de6fd7eec395344bff.png"},46743:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653326156516-33082a86d29189e7504d16beb560fa74.png"},6829:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653327124561-8c953665b127c44d3b8fb972d8c3fe59.png"},47447:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653327884526-a741403b3ec778c9dca93a58ae851c79.png"},94215:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653328022622-c00ad3e2337c6563106e3748aeb34ff1.png"},12056:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653328288627-7dc3477b4a350f2758c4923a5177c813.png"},99572:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653328663897-870c1898a669fd96ebc37a690ee782a9.png"},42450:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653357522914-f92e25710ec4dbeeb341a8c6f2cc5558.png"},64384:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653357860001-655f940c6f15fdd8e7bfa8f41067d380.png"},43871:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653360308731-4e09d0dc72e5d900ad0da641ccd56728.png"},60210:(e,n,s)=>{s.d(n,{A:()=>i});const i="data:image/png;base64,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"},49726:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653363100502-113462c935747977e045fa023ecf18aa.png"},42420:(e,n,s)=>{s.d(n,{A:()=>i});const i="data:image/png;base64,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"},5435:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653365145124-ad78951b72e49188a78f046989f5f656.png"},71853:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653365839526-93e920236a6fe1cd736a1bc7ab3bc3b8.png"},15405:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653366238564-5e720401ac69ffd19e2b6fb51d3e76f3.png"},24651:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653368335155-415b38bef66b581ec9e4c7f0d1941f46.png"},4101:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653368562591-60fb69603a789d2088996e7227a1b8f6.png"},73382:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653369268550-b6e6a8149f8a395f78e29ce3a41b881c.png"},41391:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653370271627-56488a3409f499c7d7a0d4b353ec380d.png"},36632:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653371854389-5f04c51091e9652518a4ea17509d49c3.png"},36144:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653373887844-3e0f2cb7309911ca79487b78387c6807.png"},85842:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653373908620-3381e30ae17111e261a4be5738f4699c.png"},97749:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653374044740-875d87186594e5963d14878d833e3e3e.png"},83592:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653374296906-cc745f5b1350a7ddf16130b5e8022c82.png"},90373:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653381992018-1d5a44acfecc041443f43e23b40c21bb.png"},252:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653382219377-a6812321cd90e27f01fc57964b175f8a.png"},49503:(e,n,s)=>{s.d(n,{A:()=>i});const i="data:image/png;base64,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"},61225:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653382830810-1cdde0d57bfb4d37bb4202d9c2e461c0.png"},87116:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653385920025-807b4434f5be755e6dd84e99931d84ff.png"},16670:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653387398820-0d92252ced0b4012b11c0cdc1d0d309f.png"},75403:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653387764938-9e34e8fbb34bd95866f4ea2d05e0593e.png"},58854:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653392181413-04ab514cfcce5c7a4b214497b3b82f92.png"},65940:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653392218531-a38fdb9aff0137028a0962e7cbbd57f0.png"},72740:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653392438917-ba4e7bb5a74e3be8524220e61cda3a5a.png"},48586:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653393304844-037e3af65e9849bf3f9384cfbf053cba.png"},74688:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653546070602-09e28ff0f8433fab9baa09b9893343ee.png"},95350:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653546736063-041c6d35782aaaff4e34bde50b209a28.png"},76733:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653548087334-93f4ef4cf0d5c6b04627911ce069240c.png"},42533:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653553093967-6e5ab38e8a10d480ba17d226cb928535.png"},96544:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653553998403-25255450d6bf1812e2b9ac7047b343de.png"},7400:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653554055048-6f7a508ec71caa7b58f4e14f5e4f0a68.png"},76473:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653560986599-7d971fdbe7c831ada1e731a6cca4e74b.png"},87528:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653561657295-f229a3d1c96d5d4312b2093d974ab91c.png"},33446:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653562234886-b63c25c30e5ecbbe2817cdf8b22c26fb.png"},60691:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653574849336-e46881ff81eae489bfb8be2e26c8c8b4.png"},15613:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653575176451-08f9d461a63ebd7c906c9305b74ed7f6.png"},85669:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653575506373-f4ac0b5da2dfb25d3e3ba71fe5501644.png"},44448:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653577301737-7938fcaeabd0f9faa07f03ce7d99c245.png"},35937:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653577349691-1f1ebe4b3ff2728fe9499c108935ee49.png"},64308:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653577445413-8aff8a2f256a3a853f0ff736b47bbb1b.png"},73017:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653577643629-903632109b4475d06df7ca117c96aaf3.png"},24146:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653577659166-526615099013070f8035d2f55e763d98.png"},45148:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653577689129-cca581d6719e225c0480ee93e465eb70.png"},80724:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653577801668-4cc58eaf0878f34a45d79a83e05fd783.png"},22987:(e,n,s)=>{s.d(n,{A:()=>i});const i="data:image/png;base64,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"},97779:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653578211854-2623827ee295ff3316f8a2b1ca8826c0.png"},33445:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653578560691-3c2b2270bc37c587706aaf6b1da15d96.png"},24518:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653578992639-e2651876be8eaeb2c3086b4f30789592.png"},45856:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653579931626-dca0e08c695f935d6eec703e63ac7384.png"},35842:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653581590453-7788e34944ed1fdaf2c7f7855755c847.png"},96053:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653805077118-5ecacdce68765d8e0c16c9a58eff05a3.png"},20866:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653805203758-df28f967db5e5a87b01f6e4986f8107d.png"},7325:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653806140822-cbe4300fd2aa2d334b2902a9f7655c9f.png"},84828:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653806253817-f9e314d005928f367cb8d8e31dc5ae63.png"},290:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653806706296-dddd4b2fe02e4929046120d2bf28824e.png"},35708:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653806973212-c22ee035e20fcac15759ea35bb3af3ed.png"},3041:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653808641260-71ff5b1617358eb536e3fc27356e42dd.png"},69341:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653808993693-016882ef7d55d955f6edc29a78105fc7.png"},31609:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653809450816-ab955d41d01da8757594752313820e60.png"},55579:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653809875208-195de3976b0a79c7e9c90d0a3c4be2f5.png"},20091:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653812346852-e05aba2bb12a5d017e4531fd4a14987a.png"},33539:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653813047671-de04cb3d9f1b72d23bb117651bd23e61.png"},40557:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653813462834-c3376b1d6605e530e78edd6550166cea.png"},1428:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653819821591-99c85d11bad882c5b31ab53fe2899ef5.png"},96104:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653822021827-c76a5071118a7a7ac9190fc234f6ee79.png"},61441:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653822036941-52559e9befee555391af9406205ab274.png"},17523:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653823145495-3269f72b8d44e6f1b7579d69cf5a3723.png"},11204:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653824498278-4ea71bd1a2dd49b3027f522af259c25b.png"},85186:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653833970361-3f7cce4d3dbe6015da029e4b1a2bc960.png"},6081:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653834455899-45f9ddbce8217c97eb18c1489cac820c.png"},9197:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653835784444-c9a564a72fd44b05d3363e78192691bd.png"},38519:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653836416586-067e8a63f480f6bfcb77ba23b2d47755.png"},33643:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653836578970-8ea772d88da5fcc399f4196ffbbef82b.png"},18669:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653837988985-2263ecee0d5c5a580881cf435af374d6.png"},4919:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1653838053608-3f4f376e6b98227c88fa6bc110df6d0c.png"},38819:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1656080546603-b8baa0925985e0a8b583bd6bac3e43cc.png"},289:(e,n,s)=>{s.d(n,{A:()=>i});const i="data:image/png;base64,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"},41544:(e,n,s)=>{s.d(n,{A:()=>i});const i="data:image/png;base64,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"},77737:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-20220523212915666-c224cc2b08f62bac30b60a0409723c59.png"},77629:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-20220523214414123-850e3bd71c3e5b5d0edf45ce4b1c8ff8.png"},73052:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-20230926155729468-0bb16dcc7b97c84a2d2a1e5bceb427be.png"},75698:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-20230927104013694-8a8ba7d5fd44fbd9b883327b75bba3b3.png"},95321:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-20230927104437637-e13a7781c23ac9546012966be8121ea7.png"},58529:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-20231003230525033-1778b19fd78b04cc334247b672989630.png"},25011:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-20231003230754547-932decc1c4636f1356312e83be7719a9.png"},63e3:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-20231004185259933-88d297fdc703cf8bbd4ef8d06324079d.png"},76271:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-20231031165531777-a61f499b106336d02f7ea0e5c9c7f7a9.png"},16890:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-20240120195705841-b4d0d46adefb4226d5dbf263fdd9fbd0.png"},45451:(e,n,s)=>{s.d(n,{A:()=>i});const i="data:image/png;base64,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"},95678:(e,n,s)=>{s.d(n,{A:()=>i});const i="data:image/png;base64,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"},9866:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/\u907f\u9707\u5668-300d81b89e8b26c24c55cf33bf41bfd8.gif"},28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>d});var i=s(96540);const r={},l=i.createContext(r);function t(e){const n=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);